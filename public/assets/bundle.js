"use strict";(()=>{var Ui=Object.create;var Kt=Object.defineProperty;var zi=Object.getOwnPropertyDescriptor;var Ki=Object.getOwnPropertyNames;var qi=Object.getPrototypeOf,Vi=Object.prototype.hasOwnProperty;var qt=(m,w)=>()=>(w||m((w={exports:{}}).exports,w),w.exports);var Gi=(m,w,y,B)=>{if(w&&typeof w=="object"||typeof w=="function")for(let E of Ki(w))!Vi.call(m,E)&&E!==y&&Kt(m,E,{get:()=>w[E],enumerable:!(B=zi(w,E))||B.enumerable});return m};var Vt=(m,w,y)=>(y=m!=null?Ui(qi(m)):{},Gi(w||!m||!m.__esModule?Kt(y,"default",{value:m,enumerable:!0}):y,m));var Yt=qt((qe,Ct)=>{(function(m,w){if(typeof qe=="object"&&typeof Ct=="object")Ct.exports=w();else if(typeof define=="function"&&define.amd)define([],w);else{var y=w();for(var B in y)(typeof qe=="object"?qe:m)[B]=y[B]}})(self,()=>(()=>{"use strict";var m={4567:function(E,r,a){var o=this&&this.__decorate||function(i,c,f,p){var S,d=arguments.length,g=d<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,f):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(i,c,f,p);else for(var k=i.length-1;k>=0;k--)(S=i[k])&&(g=(d<3?S(g):d>3?S(c,f,g):S(c,f))||g);return d>3&&g&&Object.defineProperty(c,f,g),g},u=this&&this.__param||function(i,c){return function(f,p){c(f,p,i)}};Object.defineProperty(r,"__esModule",{value:!0}),r.AccessibilityManager=void 0;let n=a(9042),l=a(6114),_=a(9924),v=a(844),h=a(5596),e=a(4725),s=a(3656),t=r.AccessibilityManager=class extends v.Disposable{constructor(i,c){super(),this._terminal=i,this._renderService=c,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let f=0;f<this._terminal.rows;f++)this._rowElements[f]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[f]);if(this._topBoundaryFocusListener=f=>this._handleBoundaryFocus(f,0),this._bottomBoundaryFocusListener=f=>this._handleBoundaryFocus(f,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new _.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(f=>this._handleResize(f.rows))),this.register(this._terminal.onRender(f=>this._refreshRows(f.start,f.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(f=>this._handleChar(f))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(f=>this._handleTab(f))),this.register(this._terminal.onKey(f=>this._handleKey(f.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new h.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,s.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,v.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(i){for(let c=0;c<i;c++)this._handleChar(" ")}_handleChar(i){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==i&&(this._charsToAnnounce+=i):this._charsToAnnounce+=i,i===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=n.tooMuchOutput)),l.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,l.isMac&&this._liveRegion.remove()}_handleKey(i){this._clearLiveRegion(),/\p{Control}/u.test(i)||this._charsToConsume.push(i)}_refreshRows(i,c){this._liveRegionDebouncer.refresh(i,c,this._terminal.rows)}_renderRows(i,c){let f=this._terminal.buffer,p=f.lines.length.toString();for(let S=i;S<=c;S++){let d=f.translateBufferLineToString(f.ydisp+S,!0),g=(f.ydisp+S+1).toString(),k=this._rowElements[S];k&&(d.length===0?k.innerText="\xA0":k.textContent=d,k.setAttribute("aria-posinset",g),k.setAttribute("aria-setsize",p))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(i,c){let f=i.target,p=this._rowElements[c===0?1:this._rowElements.length-2];if(f.getAttribute("aria-posinset")===(c===0?"1":`${this._terminal.buffer.lines.length}`)||i.relatedTarget!==p)return;let S,d;if(c===0?(S=f,d=this._rowElements.pop(),this._rowContainer.removeChild(d)):(S=this._rowElements.shift(),d=f,this._rowContainer.removeChild(S)),S.removeEventListener("focus",this._topBoundaryFocusListener),d.removeEventListener("focus",this._bottomBoundaryFocusListener),c===0){let g=this._createAccessibilityTreeNode();this._rowElements.unshift(g),this._rowContainer.insertAdjacentElement("afterbegin",g)}else{let g=this._createAccessibilityTreeNode();this._rowElements.push(g),this._rowContainer.appendChild(g)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(c===0?-1:1),this._rowElements[c===0?1:this._rowElements.length-2].focus(),i.preventDefault(),i.stopImmediatePropagation()}_handleResize(i){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let c=this._rowContainer.children.length;c<this._terminal.rows;c++)this._rowElements[c]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[c]);for(;this._rowElements.length>i;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let i=document.createElement("div");return i.setAttribute("role","listitem"),i.tabIndex=-1,this._refreshRowDimensions(i),i}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let i=0;i<this._terminal.rows;i++)this._refreshRowDimensions(this._rowElements[i])}}_refreshRowDimensions(i){i.style.height=`${this._renderService.dimensions.css.cell.height}px`}};r.AccessibilityManager=t=o([u(1,e.IRenderService)],t)},3614:(E,r)=>{function a(l){return l.replace(/\r?\n/g,"\r")}function o(l,_){return _?"\x1B[200~"+l+"\x1B[201~":l}function u(l,_,v,h){l=o(l=a(l),v.decPrivateModes.bracketedPasteMode&&h.rawOptions.ignoreBracketedPasteMode!==!0),v.triggerDataEvent(l,!0),_.value=""}function n(l,_,v){let h=v.getBoundingClientRect(),e=l.clientX-h.left-10,s=l.clientY-h.top-10;_.style.width="20px",_.style.height="20px",_.style.left=`${e}px`,_.style.top=`${s}px`,_.style.zIndex="1000",_.focus()}Object.defineProperty(r,"__esModule",{value:!0}),r.rightClickHandler=r.moveTextAreaUnderMouseCursor=r.paste=r.handlePasteEvent=r.copyHandler=r.bracketTextForPaste=r.prepareTextForTerminal=void 0,r.prepareTextForTerminal=a,r.bracketTextForPaste=o,r.copyHandler=function(l,_){l.clipboardData&&l.clipboardData.setData("text/plain",_.selectionText),l.preventDefault()},r.handlePasteEvent=function(l,_,v,h){l.stopPropagation(),l.clipboardData&&u(l.clipboardData.getData("text/plain"),_,v,h)},r.paste=u,r.moveTextAreaUnderMouseCursor=n,r.rightClickHandler=function(l,_,v,h,e){n(l,_,v),e&&h.rightClickSelect(l),_.value=h.selectionText,_.select()}},7239:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorContrastCache=void 0;let o=a(1505);r.ColorContrastCache=class{constructor(){this._color=new o.TwoKeyMap,this._css=new o.TwoKeyMap}setCss(u,n,l){this._css.set(u,n,l)}getCss(u,n){return this._css.get(u,n)}setColor(u,n,l){this._color.set(u,n,l)}getColor(u,n){return this._color.get(u,n)}clear(){this._color.clear(),this._css.clear()}}},3656:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.addDisposableDomListener=void 0,r.addDisposableDomListener=function(a,o,u,n){a.addEventListener(o,u,n);let l=!1;return{dispose:()=>{l||(l=!0,a.removeEventListener(o,u,n))}}}},6465:function(E,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,f=arguments.length,p=f<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,i);else for(var S=e.length-1;S>=0;S--)(c=e[S])&&(p=(f<3?c(p):f>3?c(s,t,p):c(s,t))||p);return f>3&&p&&Object.defineProperty(s,t,p),p},u=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Linkifier2=void 0;let n=a(3656),l=a(8460),_=a(844),v=a(2585),h=r.Linkifier2=class extends _.Disposable{get currentLink(){return this._currentLink}constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new l.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new l.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,_.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,_.toDisposable)(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{let s=this._linkProviders.indexOf(e);s!==-1&&this._linkProviders.splice(s,1)}}}attachToDom(e,s,t){this._element=e,this._mouseService=s,this._renderService=t,this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;let s=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!s)return;this._isMouseOut=!1;let t=e.composedPath();for(let i=0;i<t.length;i++){let c=t[i];if(c.classList.contains("xterm"))break;if(c.classList.contains("xterm-hover"))return}this._lastBufferCell&&s.x===this._lastBufferCell.x&&s.y===this._lastBufferCell.y||(this._handleHover(s),this._lastBufferCell=s)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,s){var t,i;this._activeProviderReplies&&s||((t=this._activeProviderReplies)===null||t===void 0||t.forEach(f=>{f?.forEach(p=>{p.link.dispose&&p.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let c=!1;for(let[f,p]of this._linkProviders.entries())s?!((i=this._activeProviderReplies)===null||i===void 0)&&i.get(f)&&(c=this._checkLinkProviderResult(f,e,c)):p.provideLinks(e.y,S=>{var d,g;if(this._isMouseOut)return;let k=S?.map(T=>({link:T}));(d=this._activeProviderReplies)===null||d===void 0||d.set(f,k),c=this._checkLinkProviderResult(f,e,c),((g=this._activeProviderReplies)===null||g===void 0?void 0:g.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,s){let t=new Set;for(let i=0;i<s.size;i++){let c=s.get(i);if(c)for(let f=0;f<c.length;f++){let p=c[f],S=p.link.range.start.y<e?0:p.link.range.start.x,d=p.link.range.end.y>e?this._bufferService.cols:p.link.range.end.x;for(let g=S;g<=d;g++){if(t.has(g)){c.splice(f--,1);break}t.add(g)}}}}_checkLinkProviderResult(e,s,t){var i;if(!this._activeProviderReplies)return t;let c=this._activeProviderReplies.get(e),f=!1;for(let p=0;p<e;p++)this._activeProviderReplies.has(p)&&!this._activeProviderReplies.get(p)||(f=!0);if(!f&&c){let p=c.find(S=>this._linkAtPosition(S.link,s));p&&(t=!0,this._handleNewLink(p))}if(this._activeProviderReplies.size===this._linkProviders.length&&!t)for(let p=0;p<this._activeProviderReplies.size;p++){let S=(i=this._activeProviderReplies.get(p))===null||i===void 0?void 0:i.find(d=>this._linkAtPosition(d.link,s));if(S){t=!0,this._handleNewLink(S);break}}return t}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;let s=this._positionFromMouseEvent(e,this._element,this._mouseService);s&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,s)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,s){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!s||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=s)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,_.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;let s=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);s&&this._linkAtPosition(e.link,s)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0||e.link.decorations.underline,pointerCursor:e.link.decorations===void 0||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var t,i;return(i=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||i===void 0?void 0:i.decorations.pointerCursor},set:t=>{var i,c;!((i=this._currentLink)===null||i===void 0)&&i.state&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&((c=this._element)===null||c===void 0||c.classList.toggle("xterm-cursor-pointer",t)))}},underline:{get:()=>{var t,i;return(i=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||i===void 0?void 0:i.decorations.underline},set:t=>{var i,c,f;!((i=this._currentLink)===null||i===void 0)&&i.state&&((f=(c=this._currentLink)===null||c===void 0?void 0:c.state)===null||f===void 0?void 0:f.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(t=>{if(!this._currentLink)return;let i=t.start===0?0:t.start+1+this._bufferService.buffer.ydisp,c=this._bufferService.buffer.ydisp+1+t.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=c&&(this._clearCurrentLink(i,c),this._lastMouseEvent&&this._element)){let f=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);f&&this._askForLink(f,!1)}})))}_linkHover(e,s,t){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),s.hover&&s.hover(t,s.text)}_fireUnderlineEvent(e,s){let t=e.range,i=this._bufferService.buffer.ydisp,c=this._createLinkUnderlineEvent(t.start.x-1,t.start.y-i-1,t.end.x,t.end.y-i-1,void 0);(s?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(c)}_linkLeave(e,s,t){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),s.leave&&s.leave(t,s.text)}_linkAtPosition(e,s){let t=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,c=s.y*this._bufferService.cols+s.x;return t<=c&&c<=i}_positionFromMouseEvent(e,s,t){let i=t.getCoords(e,s,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,s,t,i,c){return{x1:e,y1:s,x2:t,y2:i,cols:this._bufferService.cols,fg:c}}};r.Linkifier2=h=o([u(0,v.IBufferService)],h)},9042:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.tooMuchOutput=r.promptLabel=void 0,r.promptLabel="Terminal input",r.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(E,r,a){var o=this&&this.__decorate||function(h,e,s,t){var i,c=arguments.length,f=c<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,s):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(h,e,s,t);else for(var p=h.length-1;p>=0;p--)(i=h[p])&&(f=(c<3?i(f):c>3?i(e,s,f):i(e,s))||f);return c>3&&f&&Object.defineProperty(e,s,f),f},u=this&&this.__param||function(h,e){return function(s,t){e(s,t,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkProvider=void 0;let n=a(511),l=a(2585),_=r.OscLinkProvider=class{constructor(h,e,s){this._bufferService=h,this._optionsService=e,this._oscLinkService=s}provideLinks(h,e){var s;let t=this._bufferService.buffer.lines.get(h-1);if(!t)return void e(void 0);let i=[],c=this._optionsService.rawOptions.linkHandler,f=new n.CellData,p=t.getTrimmedLength(),S=-1,d=-1,g=!1;for(let k=0;k<p;k++)if(d!==-1||t.hasContent(k)){if(t.loadCell(k,f),f.hasExtendedAttrs()&&f.extended.urlId){if(d===-1){d=k,S=f.extended.urlId;continue}g=f.extended.urlId!==S}else d!==-1&&(g=!0);if(g||d!==-1&&k===p-1){let T=(s=this._oscLinkService.getLinkData(S))===null||s===void 0?void 0:s.uri;if(T){let x={start:{x:d+1,y:h},end:{x:k+(g||k!==p-1?0:1),y:h}},R=!1;if(!c?.allowNonHttpProtocols)try{let P=new URL(T);["http:","https:"].includes(P.protocol)||(R=!0)}catch{R=!0}R||i.push({text:T,range:x,activate:(P,O)=>c?c.activate(P,O,x):v(0,O),hover:(P,O)=>{var W;return(W=c?.hover)===null||W===void 0?void 0:W.call(c,P,O,x)},leave:(P,O)=>{var W;return(W=c?.leave)===null||W===void 0?void 0:W.call(c,P,O,x)}})}g=!1,f.hasExtendedAttrs()&&f.extended.urlId?(d=k,S=f.extended.urlId):(d=-1,S=-1)}}e(i)}};function v(h,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){let s=window.open();if(s){try{s.opener=null}catch{}s.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}r.OscLinkProvider=_=o([u(0,l.IBufferService),u(1,l.IOptionsService),u(2,l.IOscLinkService)],_)},6193:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.RenderDebouncer=void 0,r.RenderDebouncer=class{constructor(a,o){this._parentWindow=a,this._renderCallback=o,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(a,o,u){this._rowCount=u,a=a!==void 0?a:0,o=o!==void 0?o:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,o):o,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let a=Math.max(this._rowStart,0),o=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,o),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},5596:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ScreenDprMonitor=void 0;let o=a(844);class u extends o.Disposable{constructor(l){super(),this._parentWindow=l,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,o.toDisposable)(()=>{this.clearListener()}))}setListener(l){this._listener&&this.clearListener(),this._listener=l,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var l;this._outerListener&&((l=this._resolutionMediaMatchList)===null||l===void 0||l.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}r.ScreenDprMonitor=u},3236:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;let o=a(3614),u=a(3656),n=a(6465),l=a(9042),_=a(3730),v=a(1680),h=a(3107),e=a(5744),s=a(2950),t=a(1296),i=a(428),c=a(4269),f=a(5114),p=a(8934),S=a(3230),d=a(9312),g=a(4725),k=a(6731),T=a(8055),x=a(8969),R=a(8460),P=a(844),O=a(6114),W=a(8437),F=a(2584),C=a(7399),L=a(5941),D=a(9074),A=a(2585),N=a(5435),j=a(4567),K=typeof window<"u"?window.document:null;class z extends x.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(b={}){super(b),this.browser=O,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new P.MutableDisposable),this._onCursorMove=this.register(new R.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new R.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new R.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new R.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new R.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new R.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new R.EventEmitter),this._onBlur=this.register(new R.EventEmitter),this._onA11yCharEmitter=this.register(new R.EventEmitter),this._onA11yTabEmitter=this.register(new R.EventEmitter),this._onWillOpen=this.register(new R.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(n.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(_.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(D.DecorationService),this._instantiationService.setService(A.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((M,H)=>this.refresh(M,H))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(M=>this._reportWindowsOptions(M))),this.register(this._inputHandler.onColor(M=>this._handleColorEvent(M))),this.register((0,R.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,R.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,R.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,R.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(M=>this._afterResize(M.cols,M.rows))),this.register((0,P.toDisposable)(()=>{var M,H;this._customKeyEventHandler=void 0,(H=(M=this.element)===null||M===void 0?void 0:M.parentNode)===null||H===void 0||H.removeChild(this.element)}))}_handleColorEvent(b){if(this._themeService)for(let M of b){let H,I="";switch(M.index){case 256:H="foreground",I="10";break;case 257:H="background",I="11";break;case 258:H="cursor",I="12";break;default:H="ansi",I="4;"+M.index}switch(M.type){case 0:let q=T.color.toColorRGB(H==="ansi"?this._themeService.colors.ansi[M.index]:this._themeService.colors[H]);this.coreService.triggerDataEvent(`${F.C0.ESC}]${I};${(0,L.toRgbString)(q)}${F.C1_ESCAPED.ST}`);break;case 1:if(H==="ansi")this._themeService.modifyColors($=>$.ansi[M.index]=T.rgba.toColor(...M.color));else{let $=H;this._themeService.modifyColors(G=>G[$]=T.rgba.toColor(...M.color))}break;case 2:this._themeService.restoreColor(M.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(b){b?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(j.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(b){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(F.C0.ESC+"[I"),this.updateCursorStyle(b),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var b;return(b=this.textarea)===null||b===void 0?void 0:b.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(F.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let b=this.buffer.ybase+this.buffer.y,M=this.buffer.lines.get(b);if(!M)return;let H=Math.min(this.buffer.x,this.cols-1),I=this._renderService.dimensions.css.cell.height,q=M.getWidth(H),$=this._renderService.dimensions.css.cell.width*q,G=this.buffer.y*this._renderService.dimensions.css.cell.height,ee=H*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ee+"px",this.textarea.style.top=G+"px",this.textarea.style.width=$+"px",this.textarea.style.height=I+"px",this.textarea.style.lineHeight=I+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,u.addDisposableDomListener)(this.element,"copy",M=>{this.hasSelection()&&(0,o.copyHandler)(M,this._selectionService)}));let b=M=>(0,o.handlePasteEvent)(M,this.textarea,this.coreService,this.optionsService);this.register((0,u.addDisposableDomListener)(this.textarea,"paste",b)),this.register((0,u.addDisposableDomListener)(this.element,"paste",b)),O.isFirefox?this.register((0,u.addDisposableDomListener)(this.element,"mousedown",M=>{M.button===2&&(0,o.rightClickHandler)(M,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,u.addDisposableDomListener)(this.element,"contextmenu",M=>{(0,o.rightClickHandler)(M,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),O.isLinux&&this.register((0,u.addDisposableDomListener)(this.element,"auxclick",M=>{M.button===1&&(0,o.moveTextAreaUnderMouseCursor)(M,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,u.addDisposableDomListener)(this.textarea,"keyup",b=>this._keyUp(b),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keydown",b=>this._keyDown(b),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keypress",b=>this._keyPress(b),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionupdate",b=>this._compositionHelper.compositionupdate(b))),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,u.addDisposableDomListener)(this.textarea,"input",b=>this._inputEvent(b),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(b){var M;if(!b)throw new Error("Terminal requires a parent element.");b.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=b.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),b.appendChild(this.element);let H=K.createDocumentFragment();this._viewportElement=K.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),H.appendChild(this._viewportElement),this._viewportScrollArea=K.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=K.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=K.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),H.appendChild(this.screenElement),this.textarea=K.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",l.promptLabel),O.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(f.CoreBrowserService,this.textarea,(M=this._document.defaultView)!==null&&M!==void 0?M:window),this._instantiationService.setService(g.ICoreBrowserService,this._coreBrowserService),this.register((0,u.addDisposableDomListener)(this.textarea,"focus",I=>this._handleTextAreaFocus(I))),this.register((0,u.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(i.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(g.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(k.ThemeService),this._instantiationService.setService(g.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(c.CharacterJoinerService),this._instantiationService.setService(g.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(S.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(g.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(I=>this._onRender.fire(I))),this.onResize(I=>this._renderService.resize(I.cols,I.rows)),this._compositionView=K.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(s.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(H);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(p.MouseService),this._instantiationService.setService(g.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(v.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(I=>this.scrollLines(I.amount,I.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(d.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(g.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(I=>this.scrollLines(I.amount,I.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(I=>this._renderService.handleSelectionChanged(I.start,I.end,I.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(I=>{this.textarea.value=I,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(I=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(h.BufferDecorationRenderer,this.screenElement)),this.register((0,u.addDisposableDomListener)(this.element,"mousedown",I=>this._selectionService.handleMouseDown(I))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(j.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",I=>this._handleScreenReaderModeOptionChange(I))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",I=>{!this._overviewRulerRenderer&&I&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(t.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){let b=this,M=this.element;function H($){let G=b._mouseService.getMouseReportCoords($,b.screenElement);if(!G)return!1;let ee,ie;switch($.overrideType||$.type){case"mousemove":ie=32,$.buttons===void 0?(ee=3,$.button!==void 0&&(ee=$.button<3?$.button:3)):ee=1&$.buttons?0:4&$.buttons?1:2&$.buttons?2:3;break;case"mouseup":ie=0,ee=$.button<3?$.button:3;break;case"mousedown":ie=1,ee=$.button<3?$.button:3;break;case"wheel":if(b.viewport.getLinesScrolled($)===0)return!1;ie=$.deltaY<0?0:1,ee=4;break;default:return!1}return!(ie===void 0||ee===void 0||ee>4)&&b.coreMouseService.triggerMouseEvent({col:G.col,row:G.row,x:G.x,y:G.y,button:ee,action:ie,ctrl:$.ctrlKey,alt:$.altKey,shift:$.shiftKey})}let I={mouseup:null,wheel:null,mousedrag:null,mousemove:null},q={mouseup:$=>(H($),$.buttons||(this._document.removeEventListener("mouseup",I.mouseup),I.mousedrag&&this._document.removeEventListener("mousemove",I.mousedrag)),this.cancel($)),wheel:$=>(H($),this.cancel($,!0)),mousedrag:$=>{$.buttons&&H($)},mousemove:$=>{$.buttons||H($)}};this.register(this.coreMouseService.onProtocolChange($=>{$?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents($)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&$?I.mousemove||(M.addEventListener("mousemove",q.mousemove),I.mousemove=q.mousemove):(M.removeEventListener("mousemove",I.mousemove),I.mousemove=null),16&$?I.wheel||(M.addEventListener("wheel",q.wheel,{passive:!1}),I.wheel=q.wheel):(M.removeEventListener("wheel",I.wheel),I.wheel=null),2&$?I.mouseup||(M.addEventListener("mouseup",q.mouseup),I.mouseup=q.mouseup):(this._document.removeEventListener("mouseup",I.mouseup),M.removeEventListener("mouseup",I.mouseup),I.mouseup=null),4&$?I.mousedrag||(I.mousedrag=q.mousedrag):(this._document.removeEventListener("mousemove",I.mousedrag),I.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,u.addDisposableDomListener)(M,"mousedown",$=>{if($.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection($))return H($),I.mouseup&&this._document.addEventListener("mouseup",I.mouseup),I.mousedrag&&this._document.addEventListener("mousemove",I.mousedrag),this.cancel($)})),this.register((0,u.addDisposableDomListener)(M,"wheel",$=>{if(!I.wheel){if(!this.buffer.hasScrollback){let G=this.viewport.getLinesScrolled($);if(G===0)return;let ee=F.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+($.deltaY<0?"A":"B"),ie="";for(let ge=0;ge<Math.abs(G);ge++)ie+=ee;return this.coreService.triggerDataEvent(ie,!0),this.cancel($,!0)}return this.viewport.handleWheel($)?this.cancel($):void 0}},{passive:!1})),this.register((0,u.addDisposableDomListener)(M,"touchstart",$=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart($),this.cancel($)},{passive:!0})),this.register((0,u.addDisposableDomListener)(M,"touchmove",$=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove($)?void 0:this.cancel($)},{passive:!1}))}refresh(b,M){var H;(H=this._renderService)===null||H===void 0||H.refreshRows(b,M)}updateCursorStyle(b){var M;!((M=this._selectionService)===null||M===void 0)&&M.shouldColumnSelect(b)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(b,M,H=0){var I;H===1?(super.scrollLines(b,M,H),this.refresh(0,this.rows-1)):(I=this.viewport)===null||I===void 0||I.scrollLines(b)}paste(b){(0,o.paste)(b,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(b){this._customKeyEventHandler=b}registerLinkProvider(b){return this.linkifier2.registerLinkProvider(b)}registerCharacterJoiner(b){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let M=this._characterJoinerService.register(b);return this.refresh(0,this.rows-1),M}deregisterCharacterJoiner(b){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(b)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(b){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+b)}registerDecoration(b){return this._decorationService.registerDecoration(b)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(b,M,H){this._selectionService.setSelection(b,M,H)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var b;(b=this._selectionService)===null||b===void 0||b.clearSelection()}selectAll(){var b;(b=this._selectionService)===null||b===void 0||b.selectAll()}selectLines(b,M){var H;(H=this._selectionService)===null||H===void 0||H.selectLines(b,M)}_keyDown(b){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(b)===!1)return!1;let M=this.browser.isMac&&this.options.macOptionIsMeta&&b.altKey;if(!M&&!this._compositionHelper.keydown(b))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;M||b.key!=="Dead"&&b.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let H=(0,C.evaluateKeyboardEvent)(b,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(b),H.type===3||H.type===2){let I=this.rows-1;return this.scrollLines(H.type===2?-I:I),this.cancel(b,!0)}return H.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,b)||(H.cancel&&this.cancel(b,!0),!H.key||!!(b.key&&!b.ctrlKey&&!b.altKey&&!b.metaKey&&b.key.length===1&&b.key.charCodeAt(0)>=65&&b.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(H.key!==F.C0.ETX&&H.key!==F.C0.CR||(this.textarea.value=""),this._onKey.fire({key:H.key,domEvent:b}),this._showCursor(),this.coreService.triggerDataEvent(H.key,!0),!this.optionsService.rawOptions.screenReaderMode||b.altKey||b.ctrlKey?this.cancel(b,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(b,M){let H=b.isMac&&!this.options.macOptionIsMeta&&M.altKey&&!M.ctrlKey&&!M.metaKey||b.isWindows&&M.altKey&&M.ctrlKey&&!M.metaKey||b.isWindows&&M.getModifierState("AltGraph");return M.type==="keypress"?H:H&&(!M.keyCode||M.keyCode>47)}_keyUp(b){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(b)===!1||(function(M){return M.keyCode===16||M.keyCode===17||M.keyCode===18}(b)||this.focus(),this.updateCursorStyle(b),this._keyPressHandled=!1)}_keyPress(b){let M;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(b)===!1)return!1;if(this.cancel(b),b.charCode)M=b.charCode;else if(b.which===null||b.which===void 0)M=b.keyCode;else{if(b.which===0||b.charCode===0)return!1;M=b.which}return!(!M||(b.altKey||b.ctrlKey||b.metaKey)&&!this._isThirdLevelShift(this.browser,b)||(M=String.fromCharCode(M),this._onKey.fire({key:M,domEvent:b}),this._showCursor(),this.coreService.triggerDataEvent(M,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(b){if(b.data&&b.inputType==="insertText"&&(!b.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let M=b.data;return this.coreService.triggerDataEvent(M,!0),this.cancel(b),!0}return!1}resize(b,M){b!==this.cols||M!==this.rows?super.resize(b,M):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(b,M){var H,I;(H=this._charSizeService)===null||H===void 0||H.measure(),(I=this.viewport)===null||I===void 0||I.syncScrollArea(!0)}clear(){var b;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let M=1;M<this.rows;M++)this.buffer.lines.push(this.buffer.getBlankLine(W.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(b=this.viewport)===null||b===void 0||b.reset(),this.refresh(0,this.rows-1)}}reset(){var b,M;this.options.rows=this.rows,this.options.cols=this.cols;let H=this._customKeyEventHandler;this._setup(),super.reset(),(b=this._selectionService)===null||b===void 0||b.reset(),this._decorationService.reset(),(M=this.viewport)===null||M===void 0||M.reset(),this._customKeyEventHandler=H,this.refresh(0,this.rows-1)}clearTextureAtlas(){var b;(b=this._renderService)===null||b===void 0||b.clearTextureAtlas()}_reportFocus(){var b;!((b=this.element)===null||b===void 0)&&b.classList.contains("focus")?this.coreService.triggerDataEvent(F.C0.ESC+"[I"):this.coreService.triggerDataEvent(F.C0.ESC+"[O")}_reportWindowsOptions(b){if(this._renderService)switch(b){case N.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let M=this._renderService.dimensions.css.canvas.width.toFixed(0),H=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${F.C0.ESC}[4;${H};${M}t`);break;case N.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let I=this._renderService.dimensions.css.cell.width.toFixed(0),q=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${F.C0.ESC}[6;${q};${I}t`)}}cancel(b,M){if(this.options.cancelEvents||M)return b.preventDefault(),b.stopPropagation(),!1}}r.Terminal=z},9924:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TimeBasedDebouncer=void 0,r.TimeBasedDebouncer=class{constructor(a,o=1e3){this._renderCallback=a,this._debounceThresholdMS=o,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,o,u){this._rowCount=u,a=a!==void 0?a:0,o=o!==void 0?o:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,o):o;let n=Date.now();if(n-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=n,this._innerRefresh();else if(!this._additionalRefreshRequested){let l=n-this._lastRefreshMs,_=this._debounceThresholdMS-l;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},_)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let a=Math.max(this._rowStart,0),o=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,o)}}},1680:function(E,r,a){var o=this&&this.__decorate||function(s,t,i,c){var f,p=arguments.length,S=p<3?t:c===null?c=Object.getOwnPropertyDescriptor(t,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,t,i,c);else for(var d=s.length-1;d>=0;d--)(f=s[d])&&(S=(p<3?f(S):p>3?f(t,i,S):f(t,i))||S);return p>3&&S&&Object.defineProperty(t,i,S),S},u=this&&this.__param||function(s,t){return function(i,c){t(i,c,s)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Viewport=void 0;let n=a(3656),l=a(4725),_=a(8460),v=a(844),h=a(2585),e=r.Viewport=class extends v.Disposable{constructor(s,t,i,c,f,p,S,d){super(),this._viewportElement=s,this._scrollArea=t,this._bufferService=i,this._optionsService=c,this._charSizeService=f,this._renderService=p,this._coreBrowserService=S,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,n.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(g=>this._activeBuffer=g.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(g=>this._renderDimensions=g)),this._handleThemeChange(d.colors),this.register(d.onChangeColors(g=>this._handleThemeChange(g))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(s){this._viewportElement.style.backgroundColor=s.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(s){if(s)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let t=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==t&&(this._lastRecordedBufferHeight=t,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let s=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==s&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=s),this._refreshAnimationFrame=null}syncScrollArea(s=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(s);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(s)}_handleScroll(s){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});let t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let s=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(s*(this._smoothScrollState.target-this._smoothScrollState.origin)),s<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(s,t){let i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&this._viewportElement.scrollTop!==0||t>0&&i<this._lastRecordedBufferHeight)||(s.cancelable&&s.preventDefault(),!1)}handleWheel(s){let t=this._getPixelsScrolled(s);return t!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(s,t))}scrollLines(s){if(s!==0)if(this._optionsService.rawOptions.smoothScrollDuration){let t=s*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:s,suppressScrollEvent:!1})}_getPixelsScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let t=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(s,t){var i;let c,f="",p=[],S=t??this._bufferService.buffer.lines.length,d=this._bufferService.buffer.lines;for(let g=s;g<S;g++){let k=d.get(g);if(!k)continue;let T=(i=d.get(g+1))===null||i===void 0?void 0:i.isWrapped;if(f+=k.translateToString(!T),!T||g===d.length-1){let x=document.createElement("div");x.textContent=f,p.push(x),f.length>0&&(c=x),f=""}}return{bufferElements:p,cursorElement:c}}getLinesScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let t=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(s,t){let i=this._optionsService.rawOptions.fastScrollModifier;return i==="alt"&&t.altKey||i==="ctrl"&&t.ctrlKey||i==="shift"&&t.shiftKey?s*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:s*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(s){this._lastTouchY=s.touches[0].pageY}handleTouchMove(s){let t=this._lastTouchY-s.touches[0].pageY;return this._lastTouchY=s.touches[0].pageY,t!==0&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(s,t))}};r.Viewport=e=o([u(2,h.IBufferService),u(3,h.IOptionsService),u(4,l.ICharSizeService),u(5,l.IRenderService),u(6,l.ICoreBrowserService),u(7,l.IThemeService)],e)},3107:function(E,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,f=arguments.length,p=f<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,i);else for(var S=e.length-1;S>=0;S--)(c=e[S])&&(p=(f<3?c(p):f>3?c(s,t,p):c(s,t))||p);return f>3&&p&&Object.defineProperty(s,t,p),p},u=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferDecorationRenderer=void 0;let n=a(3656),l=a(4725),_=a(844),v=a(2585),h=r.BufferDecorationRenderer=class extends _.Disposable{constructor(e,s,t,i){super(),this._screenElement=e,this._bufferService=s,this._decorationService=t,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,n.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(c=>this._removeDecoration(c))),this.register((0,_.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var s,t;let i=document.createElement("div");i.classList.add("xterm-decoration"),i.classList.toggle("xterm-decoration-top-layer",((s=e?.options)===null||s===void 0?void 0:s.layer)==="top"),i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",i.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let c=(t=e.options.x)!==null&&t!==void 0?t:0;return c&&c>this._bufferService.cols&&(i.style.display="none"),this._refreshXPosition(e,i),i}_refreshStyle(e){let s=e.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let t=this._decorationElements.get(e);t||(t=this._createElement(e),e.element=t,this._decorationElements.set(e,t),this._container.appendChild(t),e.onDispose(()=>{this._decorationElements.delete(e),t.remove()})),t.style.top=s*this._renderService.dimensions.css.cell.height+"px",t.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(t)}}_refreshXPosition(e,s=e.element){var t;if(!s)return;let i=(t=e.options.x)!==null&&t!==void 0?t:0;(e.options.anchor||"left")==="right"?s.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var s;(s=this._decorationElements.get(e))===null||s===void 0||s.remove(),this._decorationElements.delete(e),e.dispose()}};r.BufferDecorationRenderer=h=o([u(1,v.IBufferService),u(2,v.IDecorationService),u(3,l.IRenderService)],h)},5871:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorZoneStore=void 0,r.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(let o of this._zones)if(o.color===a.options.overviewRulerOptions.color&&o.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(o,a.marker.line))return;if(this._lineAdjacentToZone(o,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(o,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,o){return o>=a.startBufferLine&&o<=a.endBufferLine}_lineAdjacentToZone(a,o,u){return o>=a.startBufferLine-this._linePadding[u||"full"]&&o<=a.endBufferLine+this._linePadding[u||"full"]}_addLineToZone(a,o){a.startBufferLine=Math.min(a.startBufferLine,o),a.endBufferLine=Math.max(a.endBufferLine,o)}}},5744:function(E,r,a){var o=this&&this.__decorate||function(c,f,p,S){var d,g=arguments.length,k=g<3?f:S===null?S=Object.getOwnPropertyDescriptor(f,p):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(c,f,p,S);else for(var T=c.length-1;T>=0;T--)(d=c[T])&&(k=(g<3?d(k):g>3?d(f,p,k):d(f,p))||k);return g>3&&k&&Object.defineProperty(f,p,k),k},u=this&&this.__param||function(c,f){return function(p,S){f(p,S,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OverviewRulerRenderer=void 0;let n=a(5871),l=a(3656),_=a(4725),v=a(844),h=a(2585),e={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},t={full:0,left:0,center:0,right:0},i=r.OverviewRulerRenderer=class extends v.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(c,f,p,S,d,g,k){var T;super(),this._viewportElement=c,this._screenElement=f,this._bufferService=p,this._decorationService=S,this._renderService=d,this._optionsService=g,this._coreBrowseService=k,this._colorZoneStore=new n.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(T=this._viewportElement.parentElement)===null||T===void 0||T.insertBefore(this._canvas,this._viewportElement);let x=this._canvas.getContext("2d");if(!x)throw new Error("Ctx cannot be null");this._ctx=x,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,v.toDisposable)(()=>{var R;(R=this._canvas)===null||R===void 0||R.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,l.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let c=Math.floor(this._canvas.width/3),f=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=c,s.center=f,s.right=c,this._refreshDrawHeightConstants(),t.full=0,t.left=0,t.center=s.left,t.right=s.left+s.center}_refreshDrawHeightConstants(){e.full=Math.round(2*this._coreBrowseService.dpr);let c=this._canvas.height/this._bufferService.buffer.lines.length,f=Math.round(Math.max(Math.min(c,12),6)*this._coreBrowseService.dpr);e.left=f,e.center=f,e.right=f}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let f of this._decorationService.decorations)this._colorZoneStore.addDecoration(f);this._ctx.lineWidth=1;let c=this._colorZoneStore.zones;for(let f of c)f.position!=="full"&&this._renderColorZone(f);for(let f of c)f.position==="full"&&this._renderColorZone(f);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(c){this._ctx.fillStyle=c.color,this._ctx.fillRect(t[c.position||"full"],Math.round((this._canvas.height-1)*(c.startBufferLine/this._bufferService.buffers.active.lines.length)-e[c.position||"full"]/2),s[c.position||"full"],Math.round((this._canvas.height-1)*((c.endBufferLine-c.startBufferLine)/this._bufferService.buffers.active.lines.length)+e[c.position||"full"]))}_queueRefresh(c,f){this._shouldUpdateDimensions=c||this._shouldUpdateDimensions,this._shouldUpdateAnchor=f||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};r.OverviewRulerRenderer=i=o([u(2,h.IBufferService),u(3,h.IDecorationService),u(4,_.IRenderService),u(5,h.IOptionsService),u(6,_.ICoreBrowserService)],i)},2950:function(E,r,a){var o=this&&this.__decorate||function(h,e,s,t){var i,c=arguments.length,f=c<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,s):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(h,e,s,t);else for(var p=h.length-1;p>=0;p--)(i=h[p])&&(f=(c<3?i(f):c>3?i(e,s,f):i(e,s))||f);return c>3&&f&&Object.defineProperty(e,s,f),f},u=this&&this.__param||function(h,e){return function(s,t){e(s,t,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CompositionHelper=void 0;let n=a(4725),l=a(2585),_=a(2584),v=r.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(h,e,s,t,i,c){this._textarea=h,this._compositionView=e,this._bufferService=s,this._optionsService=t,this._coreService=i,this._renderService=c,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(h){this._compositionView.textContent=h.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(h){if(this._isComposing||this._isSendingComposition){if(h.keyCode===229||h.keyCode===16||h.keyCode===17||h.keyCode===18)return!1;this._finalizeComposition(!1)}return h.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(h){if(this._compositionView.classList.remove("active"),this._isComposing=!1,h){let e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let s;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,s=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}},0)}else{this._isSendingComposition=!1;let e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){let h=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let e=this._textarea.value,s=e.replace(h,"");this._dataAlreadySent=s,e.length>h.length?this._coreService.triggerDataEvent(s,!0):e.length<h.length?this._coreService.triggerDataEvent(`${_.C0.DEL}`,!0):e.length===h.length&&e!==h&&this._coreService.triggerDataEvent(e,!0)}},0)}updateCompositionElements(h){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,t=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=t+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let c=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=t+"px",this._textarea.style.width=Math.max(c.width,1)+"px",this._textarea.style.height=Math.max(c.height,1)+"px",this._textarea.style.lineHeight=c.height+"px"}h||setTimeout(()=>this.updateCompositionElements(!0),0)}}};r.CompositionHelper=v=o([u(2,l.IBufferService),u(3,l.IOptionsService),u(4,l.ICoreService),u(5,n.IRenderService)],v)},9806:(E,r)=>{function a(o,u,n){let l=n.getBoundingClientRect(),_=o.getComputedStyle(n),v=parseInt(_.getPropertyValue("padding-left")),h=parseInt(_.getPropertyValue("padding-top"));return[u.clientX-l.left-v,u.clientY-l.top-h]}Object.defineProperty(r,"__esModule",{value:!0}),r.getCoords=r.getCoordsRelativeToElement=void 0,r.getCoordsRelativeToElement=a,r.getCoords=function(o,u,n,l,_,v,h,e,s){if(!v)return;let t=a(o,u,n);return t?(t[0]=Math.ceil((t[0]+(s?h/2:0))/h),t[1]=Math.ceil(t[1]/e),t[0]=Math.min(Math.max(t[0],1),l+(s?1:0)),t[1]=Math.min(Math.max(t[1],1),_),t):void 0}},9504:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.moveToCellSequence=void 0;let o=a(2584);function u(e,s,t,i){let c=e-n(e,t),f=s-n(s,t),p=Math.abs(c-f)-function(S,d,g){let k=0,T=S-n(S,g),x=d-n(d,g);for(let R=0;R<Math.abs(T-x);R++){let P=l(S,d)==="A"?-1:1,O=g.buffer.lines.get(T+P*R);O?.isWrapped&&k++}return k}(e,s,t);return h(p,v(l(e,s),i))}function n(e,s){let t=0,i=s.buffer.lines.get(e),c=i?.isWrapped;for(;c&&e>=0&&e<s.rows;)t++,i=s.buffer.lines.get(--e),c=i?.isWrapped;return t}function l(e,s){return e>s?"A":"B"}function _(e,s,t,i,c,f){let p=e,S=s,d="";for(;p!==t||S!==i;)p+=c?1:-1,c&&p>f.cols-1?(d+=f.buffer.translateBufferLineToString(S,!1,e,p),p=0,e=0,S++):!c&&p<0&&(d+=f.buffer.translateBufferLineToString(S,!1,0,e+1),p=f.cols-1,e=p,S--);return d+f.buffer.translateBufferLineToString(S,!1,e,p)}function v(e,s){let t=s?"O":"[";return o.C0.ESC+t+e}function h(e,s){e=Math.floor(e);let t="";for(let i=0;i<e;i++)t+=s;return t}r.moveToCellSequence=function(e,s,t,i){let c=t.buffer.x,f=t.buffer.y;if(!t.buffer.hasScrollback)return function(d,g,k,T,x,R){return u(g,T,x,R).length===0?"":h(_(d,g,d,g-n(g,x),!1,x).length,v("D",R))}(c,f,0,s,t,i)+u(f,s,t,i)+function(d,g,k,T,x,R){let P;P=u(g,T,x,R).length>0?T-n(T,x):g;let O=T,W=function(F,C,L,D,A,N){let j;return j=u(L,D,A,N).length>0?D-n(D,A):C,F<L&&j<=D||F>=L&&j<D?"C":"D"}(d,g,k,T,x,R);return h(_(d,P,k,O,W==="C",x).length,v(W,R))}(c,f,e,s,t,i);let p;if(f===s)return p=c>e?"D":"C",h(Math.abs(c-e),v(p,i));p=f>s?"D":"C";let S=Math.abs(f-s);return h(function(d,g){return g.cols-d}(f>s?e:c,t)+(S-1)*t.cols+1+((f>s?c:e)-1),v(p,i))}},1296:function(E,r,a){var o=this&&this.__decorate||function(x,R,P,O){var W,F=arguments.length,C=F<3?R:O===null?O=Object.getOwnPropertyDescriptor(R,P):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(x,R,P,O);else for(var L=x.length-1;L>=0;L--)(W=x[L])&&(C=(F<3?W(C):F>3?W(R,P,C):W(R,P))||C);return F>3&&C&&Object.defineProperty(R,P,C),C},u=this&&this.__param||function(x,R){return function(P,O){R(P,O,x)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRenderer=void 0;let n=a(3787),l=a(2550),_=a(2223),v=a(6171),h=a(4725),e=a(8055),s=a(8460),t=a(844),i=a(2585),c="xterm-dom-renderer-owner-",f="xterm-rows",p="xterm-fg-",S="xterm-bg-",d="xterm-focus",g="xterm-selection",k=1,T=r.DomRenderer=class extends t.Disposable{constructor(x,R,P,O,W,F,C,L,D,A){super(),this._element=x,this._screenElement=R,this._viewportElement=P,this._linkifier2=O,this._charSizeService=F,this._optionsService=C,this._bufferService=L,this._coreBrowserService=D,this._themeService=A,this._terminalClass=k++,this._rowElements=[],this.onRequestRedraw=this.register(new s.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(f),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(g),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,v.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(N=>this._injectCss(N))),this._injectCss(this._themeService.colors),this._rowFactory=W.createInstance(n.DomRendererRowFactory,document),this._element.classList.add(c+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(N=>this._handleLinkHover(N))),this.register(this._linkifier2.onHideLinkUnderline(N=>this._handleLinkLeave(N))),this.register((0,t.toDisposable)(()=>{this._element.classList.remove(c+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new l.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let x=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*x,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*x),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/x),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/x),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let P of this._rowElements)P.style.width=`${this.dimensions.css.canvas.width}px`,P.style.height=`${this.dimensions.css.cell.height}px`,P.style.lineHeight=`${this.dimensions.css.cell.height}px`,P.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let R=`${this._terminalSelector} .${f} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=R,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(x){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let R=`${this._terminalSelector} .${f} { color: ${x.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;R+=`${this._terminalSelector} .${f} .xterm-dim { color: ${e.color.multiplyOpacity(x.foreground,.5).css};}`,R+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,R+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",R+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${x.cursor.css};  color: ${x.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${x.cursor.css}; }}`,R+=`${this._terminalSelector} .${f}.${d} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${f}.${d} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${f} .xterm-cursor.xterm-cursor-block { background-color: ${x.cursor.css}; color: ${x.cursorAccent.css};}${this._terminalSelector} .${f} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${x.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${f} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${x.cursor.css} inset;}${this._terminalSelector} .${f} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${x.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,R+=`${this._terminalSelector} .${g} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${g} div { position: absolute; background-color: ${x.selectionBackgroundOpaque.css};}${this._terminalSelector} .${g} div { position: absolute; background-color: ${x.selectionInactiveBackgroundOpaque.css};}`;for(let[P,O]of x.ansi.entries())R+=`${this._terminalSelector} .${p}${P} { color: ${O.css}; }${this._terminalSelector} .${p}${P}.xterm-dim { color: ${e.color.multiplyOpacity(O,.5).css}; }${this._terminalSelector} .${S}${P} { background-color: ${O.css}; }`;R+=`${this._terminalSelector} .${p}${_.INVERTED_DEFAULT_COLOR} { color: ${e.color.opaque(x.background).css}; }${this._terminalSelector} .${p}${_.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${e.color.multiplyOpacity(e.color.opaque(x.background),.5).css}; }${this._terminalSelector} .${S}${_.INVERTED_DEFAULT_COLOR} { background-color: ${x.foreground.css}; }`,this._themeStyleElement.textContent=R}_setDefaultSpacing(){let x=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${x}px`,this._rowFactory.defaultSpacing=x}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(x,R){for(let P=this._rowElements.length;P<=R;P++){let O=document.createElement("div");this._rowContainer.appendChild(O),this._rowElements.push(O)}for(;this._rowElements.length>R;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(x,R){this._refreshRowElements(x,R),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(d)}handleFocus(){this._rowContainer.classList.add(d),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(x,R,P){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(x,R,P),this.renderRows(0,this._bufferService.rows-1),!x||!R)return;let O=x[1]-this._bufferService.buffer.ydisp,W=R[1]-this._bufferService.buffer.ydisp,F=Math.max(O,0),C=Math.min(W,this._bufferService.rows-1);if(F>=this._bufferService.rows||C<0)return;let L=document.createDocumentFragment();if(P){let D=x[0]>R[0];L.appendChild(this._createSelectionElement(F,D?R[0]:x[0],D?x[0]:R[0],C-F+1))}else{let D=O===F?x[0]:0,A=F===W?R[0]:this._bufferService.cols;L.appendChild(this._createSelectionElement(F,D,A));let N=C-F-1;if(L.appendChild(this._createSelectionElement(F+1,0,this._bufferService.cols,N)),F!==C){let j=W===C?R[0]:this._bufferService.cols;L.appendChild(this._createSelectionElement(C,0,j))}}this._selectionContainer.appendChild(L)}_createSelectionElement(x,R,P,O=1){let W=document.createElement("div");return W.style.height=O*this.dimensions.css.cell.height+"px",W.style.top=x*this.dimensions.css.cell.height+"px",W.style.left=R*this.dimensions.css.cell.width+"px",W.style.width=this.dimensions.css.cell.width*(P-R)+"px",W}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let x of this._rowElements)x.replaceChildren()}renderRows(x,R){let P=this._bufferService.buffer,O=P.ybase+P.y,W=Math.min(P.x,this._bufferService.cols-1),F=this._optionsService.rawOptions.cursorBlink,C=this._optionsService.rawOptions.cursorStyle,L=this._optionsService.rawOptions.cursorInactiveStyle;for(let D=x;D<=R;D++){let A=D+P.ydisp,N=this._rowElements[D],j=P.lines.get(A);if(!N||!j)break;N.replaceChildren(...this._rowFactory.createRow(j,A,A===O,C,L,W,F,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${c}${this._terminalClass}`}_handleLinkHover(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!0)}_handleLinkLeave(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!1)}_setCellUnderline(x,R,P,O,W,F){P<0&&(x=0),O<0&&(R=0);let C=this._bufferService.rows-1;P=Math.max(Math.min(P,C),0),O=Math.max(Math.min(O,C),0),W=Math.min(W,this._bufferService.cols);let L=this._bufferService.buffer,D=L.ybase+L.y,A=Math.min(L.x,W-1),N=this._optionsService.rawOptions.cursorBlink,j=this._optionsService.rawOptions.cursorStyle,K=this._optionsService.rawOptions.cursorInactiveStyle;for(let z=P;z<=O;++z){let Y=z+L.ydisp,b=this._rowElements[z],M=L.lines.get(Y);if(!b||!M)break;b.replaceChildren(...this._rowFactory.createRow(M,Y,Y===D,j,K,A,N,this.dimensions.css.cell.width,this._widthCache,F?z===P?x:0:-1,F?(z===O?R:W)-1:-1))}}};r.DomRenderer=T=o([u(4,i.IInstantiationService),u(5,h.ICharSizeService),u(6,i.IOptionsService),u(7,i.IBufferService),u(8,h.ICoreBrowserService),u(9,h.IThemeService)],T)},3787:function(E,r,a){var o=this&&this.__decorate||function(p,S,d,g){var k,T=arguments.length,x=T<3?S:g===null?g=Object.getOwnPropertyDescriptor(S,d):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(p,S,d,g);else for(var R=p.length-1;R>=0;R--)(k=p[R])&&(x=(T<3?k(x):T>3?k(S,d,x):k(S,d))||x);return T>3&&x&&Object.defineProperty(S,d,x),x},u=this&&this.__param||function(p,S){return function(d,g){S(d,g,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRendererRowFactory=void 0;let n=a(2223),l=a(643),_=a(511),v=a(2585),h=a(8055),e=a(4725),s=a(4269),t=a(6171),i=a(3734),c=r.DomRendererRowFactory=class{constructor(p,S,d,g,k,T,x){this._document=p,this._characterJoinerService=S,this._optionsService=d,this._coreBrowserService=g,this._coreService=k,this._decorationService=T,this._themeService=x,this._workCell=new _.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(p,S,d){this._selectionStart=p,this._selectionEnd=S,this._columnSelectMode=d}createRow(p,S,d,g,k,T,x,R,P,O,W){let F=[],C=this._characterJoinerService.getJoinedCharacters(S),L=this._themeService.colors,D,A=p.getNoBgTrimmedLength();d&&A<T+1&&(A=T+1);let N=0,j="",K=0,z=0,Y=0,b=!1,M=0,H=!1,I=0,q=[],$=O!==-1&&W!==-1;for(let G=0;G<A;G++){p.loadCell(G,this._workCell);let ee=this._workCell.getWidth();if(ee===0)continue;let ie=!1,ge=G,V=this._workCell;if(C.length>0&&G===C[0][0]){ie=!0;let Z=C.shift();V=new s.JoinedCellData(this._workCell,p.translateToString(!0,Z[0],Z[1]),Z[1]-Z[0]),ge=Z[1]-1,ee=V.getWidth()}let De=this._isCellInSelection(G,S),pt=d&&G===T,gt=$&&G>=O&&G<=W,mt=!1;this._decorationService.forEachDecorationAtCell(G,S,void 0,Z=>{mt=!0});let ze=V.getChars()||l.WHITESPACE_CELL_CHAR;if(ze===" "&&(V.isUnderline()||V.isOverline())&&(ze="\xA0"),I=ee*R-P.get(ze,V.isBold(),V.isItalic()),D){if(N&&(De&&H||!De&&!H&&V.bg===K)&&(De&&H&&L.selectionForeground||V.fg===z)&&V.extended.ext===Y&&gt===b&&I===M&&!pt&&!ie&&!mt){j+=ze,N++;continue}N&&(D.textContent=j),D=this._document.createElement("span"),N=0,j=""}else D=this._document.createElement("span");if(K=V.bg,z=V.fg,Y=V.extended.ext,b=gt,M=I,H=De,ie&&T>=G&&T<=ge&&(T=G),!this._coreService.isCursorHidden&&pt){if(q.push("xterm-cursor"),this._coreBrowserService.isFocused)x&&q.push("xterm-cursor-blink"),q.push(g==="bar"?"xterm-cursor-bar":g==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(k)switch(k){case"outline":q.push("xterm-cursor-outline");break;case"block":q.push("xterm-cursor-block");break;case"bar":q.push("xterm-cursor-bar");break;case"underline":q.push("xterm-cursor-underline")}}if(V.isBold()&&q.push("xterm-bold"),V.isItalic()&&q.push("xterm-italic"),V.isDim()&&q.push("xterm-dim"),j=V.isInvisible()?l.WHITESPACE_CELL_CHAR:V.getChars()||l.WHITESPACE_CELL_CHAR,V.isUnderline()&&(q.push(`xterm-underline-${V.extended.underlineStyle}`),j===" "&&(j="\xA0"),!V.isUnderlineColorDefault()))if(V.isUnderlineColorRGB())D.style.textDecorationColor=`rgb(${i.AttributeData.toColorRGB(V.getUnderlineColor()).join(",")})`;else{let Z=V.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&V.isBold()&&Z<8&&(Z+=8),D.style.textDecorationColor=L.ansi[Z].css}V.isOverline()&&(q.push("xterm-overline"),j===" "&&(j="\xA0")),V.isStrikethrough()&&q.push("xterm-strikethrough"),gt&&(D.style.textDecoration="underline");let se=V.getFgColor(),Be=V.getFgColorMode(),ne=V.getBgColor(),Re=V.getBgColorMode(),St=!!V.isInverse();if(St){let Z=se;se=ne,ne=Z;let $i=Be;Be=Re,Re=$i}let ce,bt,he,Te=!1;switch(this._decorationService.forEachDecorationAtCell(G,S,void 0,Z=>{Z.options.layer!=="top"&&Te||(Z.backgroundColorRGB&&(Re=50331648,ne=Z.backgroundColorRGB.rgba>>8&16777215,ce=Z.backgroundColorRGB),Z.foregroundColorRGB&&(Be=50331648,se=Z.foregroundColorRGB.rgba>>8&16777215,bt=Z.foregroundColorRGB),Te=Z.options.layer==="top")}),!Te&&De&&(ce=this._coreBrowserService.isFocused?L.selectionBackgroundOpaque:L.selectionInactiveBackgroundOpaque,ne=ce.rgba>>8&16777215,Re=50331648,Te=!0,L.selectionForeground&&(Be=50331648,se=L.selectionForeground.rgba>>8&16777215,bt=L.selectionForeground)),Te&&q.push("xterm-decoration-top"),Re){case 16777216:case 33554432:he=L.ansi[ne],q.push(`xterm-bg-${ne}`);break;case 50331648:he=h.rgba.toColor(ne>>16,ne>>8&255,255&ne),this._addStyle(D,`background-color:#${f((ne>>>0).toString(16),"0",6)}`);break;default:St?(he=L.foreground,q.push(`xterm-bg-${n.INVERTED_DEFAULT_COLOR}`)):he=L.background}switch(ce||V.isDim()&&(ce=h.color.multiplyOpacity(he,.5)),Be){case 16777216:case 33554432:V.isBold()&&se<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(se+=8),this._applyMinimumContrast(D,he,L.ansi[se],V,ce,void 0)||q.push(`xterm-fg-${se}`);break;case 50331648:let Z=h.rgba.toColor(se>>16&255,se>>8&255,255&se);this._applyMinimumContrast(D,he,Z,V,ce,bt)||this._addStyle(D,`color:#${f(se.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(D,he,L.foreground,V,ce,void 0)||St&&q.push(`xterm-fg-${n.INVERTED_DEFAULT_COLOR}`)}q.length&&(D.className=q.join(" "),q.length=0),pt||ie||mt?D.textContent=j:N++,I!==this.defaultSpacing&&(D.style.letterSpacing=`${I}px`),F.push(D),G=ge}return D&&N&&(D.textContent=j),F}_applyMinimumContrast(p,S,d,g,k,T){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,t.excludeFromContrastRatioDemands)(g.getCode()))return!1;let x=this._getContrastCache(g),R;if(k||T||(R=x.getColor(S.rgba,d.rgba)),R===void 0){let P=this._optionsService.rawOptions.minimumContrastRatio/(g.isDim()?2:1);R=h.color.ensureContrastRatio(k||S,T||d,P),x.setColor((k||S).rgba,(T||d).rgba,R??null)}return!!R&&(this._addStyle(p,`color:${R.css}`),!0)}_getContrastCache(p){return p.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(p,S){p.setAttribute("style",`${p.getAttribute("style")||""}${S};`)}_isCellInSelection(p,S){let d=this._selectionStart,g=this._selectionEnd;return!(!d||!g)&&(this._columnSelectMode?d[0]<=g[0]?p>=d[0]&&S>=d[1]&&p<g[0]&&S<=g[1]:p<d[0]&&S>=d[1]&&p>=g[0]&&S<=g[1]:S>d[1]&&S<g[1]||d[1]===g[1]&&S===d[1]&&p>=d[0]&&p<g[0]||d[1]<g[1]&&S===g[1]&&p<g[0]||d[1]<g[1]&&S===d[1]&&p>=d[0])}};function f(p,S,d){for(;p.length<d;)p=S+p;return p}r.DomRendererRowFactory=c=o([u(1,e.ICharacterJoinerService),u(2,v.IOptionsService),u(3,e.ICoreBrowserService),u(4,v.ICoreService),u(5,v.IDecorationService),u(6,e.IThemeService)],c)},2550:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WidthCache=void 0,r.WidthCache=class{constructor(a){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let o=a.createElement("span"),u=a.createElement("span");u.style.fontWeight="bold";let n=a.createElement("span");n.style.fontStyle="italic";let l=a.createElement("span");l.style.fontWeight="bold",l.style.fontStyle="italic",this._measureElements=[o,u,n,l],this._container.appendChild(o),this._container.appendChild(u),this._container.appendChild(n),this._container.appendChild(l),a.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,o,u,n){a===this._font&&o===this._fontSize&&u===this._weight&&n===this._weightBold||(this._font=a,this._fontSize=o,this._weight=u,this._weightBold=n,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${u}`,this._measureElements[1].style.fontWeight=`${n}`,this._measureElements[2].style.fontWeight=`${u}`,this._measureElements[3].style.fontWeight=`${n}`,this.clear())}get(a,o,u){let n=0;if(!o&&!u&&a.length===1&&(n=a.charCodeAt(0))<256)return this._flat[n]!==-9999?this._flat[n]:this._flat[n]=this._measure(a,0);let l=a;o&&(l+="B"),u&&(l+="I");let _=this._holey.get(l);if(_===void 0){let v=0;o&&(v|=1),u&&(v|=2),_=this._measure(a,v),this._holey.set(l,_)}return _}_measure(a,o){let u=this._measureElements[o];return u.textContent=a.repeat(32),u.offsetWidth/32}}},2223:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TEXT_BASELINE=r.DIM_OPACITY=r.INVERTED_DEFAULT_COLOR=void 0;let o=a(6114);r.INVERTED_DEFAULT_COLOR=257,r.DIM_OPACITY=.5,r.TEXT_BASELINE=o.isFirefox||o.isLegacyEdge?"bottom":"ideographic"},6171:(E,r)=>{function a(o){return 57508<=o&&o<=57558}Object.defineProperty(r,"__esModule",{value:!0}),r.createRenderDimensions=r.excludeFromContrastRatioDemands=r.isRestrictedPowerlineGlyph=r.isPowerlineGlyph=r.throwIfFalsy=void 0,r.throwIfFalsy=function(o){if(!o)throw new Error("value must not be falsy");return o},r.isPowerlineGlyph=a,r.isRestrictedPowerlineGlyph=function(o){return 57520<=o&&o<=57527},r.excludeFromContrastRatioDemands=function(o){return a(o)||function(u){return 9472<=u&&u<=9631}(o)},r.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionModel=void 0,r.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let a=this.selectionStart,o=this.selectionEnd;return!(!a||!o)&&(a[1]>o[1]||a[1]===o[1]&&a[0]>o[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(E,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,f=arguments.length,p=f<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,i);else for(var S=e.length-1;S>=0;S--)(c=e[S])&&(p=(f<3?c(p):f>3?c(s,t,p):c(s,t))||p);return f>3&&p&&Object.defineProperty(s,t,p),p},u=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharSizeService=void 0;let n=a(2585),l=a(8460),_=a(844),v=r.CharSizeService=class extends _.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,s,t){super(),this._optionsService=t,this.width=0,this.height=0,this._onCharSizeChange=this.register(new l.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new h(e,s,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){let e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};r.CharSizeService=v=o([u(2,n.IOptionsService)],v);class h{constructor(s,t,i){this._document=s,this._parentElement=t,this._optionsService=i,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;let s={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return s.width!==0&&s.height!==0&&(this._result.width=s.width/32,this._result.height=Math.ceil(s.height)),this._result}}},4269:function(E,r,a){var o=this&&this.__decorate||function(s,t,i,c){var f,p=arguments.length,S=p<3?t:c===null?c=Object.getOwnPropertyDescriptor(t,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,t,i,c);else for(var d=s.length-1;d>=0;d--)(f=s[d])&&(S=(p<3?f(S):p>3?f(t,i,S):f(t,i))||S);return p>3&&S&&Object.defineProperty(t,i,S),S},u=this&&this.__param||function(s,t){return function(i,c){t(i,c,s)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharacterJoinerService=r.JoinedCellData=void 0;let n=a(3734),l=a(643),_=a(511),v=a(2585);class h extends n.AttributeData{constructor(t,i,c){super(),this.content=0,this.combinedData="",this.fg=t.fg,this.bg=t.bg,this.combinedData=i,this._width=c}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(t){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.JoinedCellData=h;let e=r.CharacterJoinerService=class Jt{constructor(t){this._bufferService=t,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new _.CellData}register(t){let i={id:this._nextCharacterJoinerId++,handler:t};return this._characterJoiners.push(i),i.id}deregister(t){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===t)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(t){if(this._characterJoiners.length===0)return[];let i=this._bufferService.buffer.lines.get(t);if(!i||i.length===0)return[];let c=[],f=i.translateToString(!0),p=0,S=0,d=0,g=i.getFg(0),k=i.getBg(0);for(let T=0;T<i.getTrimmedLength();T++)if(i.loadCell(T,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==g||this._workCell.bg!==k){if(T-p>1){let x=this._getJoinedRanges(f,d,S,i,p);for(let R=0;R<x.length;R++)c.push(x[R])}p=T,d=S,g=this._workCell.fg,k=this._workCell.bg}S+=this._workCell.getChars().length||l.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-p>1){let T=this._getJoinedRanges(f,d,S,i,p);for(let x=0;x<T.length;x++)c.push(T[x])}return c}_getJoinedRanges(t,i,c,f,p){let S=t.substring(i,c),d=[];try{d=this._characterJoiners[0].handler(S)}catch(g){console.error(g)}for(let g=1;g<this._characterJoiners.length;g++)try{let k=this._characterJoiners[g].handler(S);for(let T=0;T<k.length;T++)Jt._mergeRanges(d,k[T])}catch(k){console.error(k)}return this._stringRangesToCellRanges(d,f,p),d}_stringRangesToCellRanges(t,i,c){let f=0,p=!1,S=0,d=t[f];if(d){for(let g=c;g<this._bufferService.cols;g++){let k=i.getWidth(g),T=i.getString(g).length||l.WHITESPACE_CELL_CHAR.length;if(k!==0){if(!p&&d[0]<=S&&(d[0]=g,p=!0),d[1]<=S){if(d[1]=g,d=t[++f],!d)break;d[0]<=S?(d[0]=g,p=!0):p=!1}S+=T}}d&&(d[1]=this._bufferService.cols)}}static _mergeRanges(t,i){let c=!1;for(let f=0;f<t.length;f++){let p=t[f];if(c){if(i[1]<=p[0])return t[f-1][1]=i[1],t;if(i[1]<=p[1])return t[f-1][1]=Math.max(i[1],p[1]),t.splice(f,1),t;t.splice(f,1),f--}else{if(i[1]<=p[0])return t.splice(f,0,i),t;if(i[1]<=p[1])return p[0]=Math.min(i[0],p[0]),t;i[0]<p[1]&&(p[0]=Math.min(i[0],p[0]),c=!0)}}return c?t[t.length-1][1]=i[1]:t.push(i),t}};r.CharacterJoinerService=e=o([u(0,v.IBufferService)],e)},5114:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreBrowserService=void 0,r.CoreBrowserService=class{constructor(a,o){this._textarea=a,this.window=o,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(E,r,a){var o=this&&this.__decorate||function(v,h,e,s){var t,i=arguments.length,c=i<3?h:s===null?s=Object.getOwnPropertyDescriptor(h,e):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(v,h,e,s);else for(var f=v.length-1;f>=0;f--)(t=v[f])&&(c=(i<3?t(c):i>3?t(h,e,c):t(h,e))||c);return i>3&&c&&Object.defineProperty(h,e,c),c},u=this&&this.__param||function(v,h){return function(e,s){h(e,s,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.MouseService=void 0;let n=a(4725),l=a(9806),_=r.MouseService=class{constructor(v,h){this._renderService=v,this._charSizeService=h}getCoords(v,h,e,s,t){return(0,l.getCoords)(window,v,h,e,s,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,t)}getMouseReportCoords(v,h){let e=(0,l.getCoordsRelativeToElement)(window,v,h);if(this._charSizeService.hasValidSize)return e[0]=Math.min(Math.max(e[0],0),this._renderService.dimensions.css.canvas.width-1),e[1]=Math.min(Math.max(e[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}};r.MouseService=_=o([u(0,n.IRenderService),u(1,n.ICharSizeService)],_)},3230:function(E,r,a){var o=this&&this.__decorate||function(c,f,p,S){var d,g=arguments.length,k=g<3?f:S===null?S=Object.getOwnPropertyDescriptor(f,p):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(c,f,p,S);else for(var T=c.length-1;T>=0;T--)(d=c[T])&&(k=(g<3?d(k):g>3?d(f,p,k):d(f,p))||k);return g>3&&k&&Object.defineProperty(f,p,k),k},u=this&&this.__param||function(c,f){return function(p,S){f(p,S,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.RenderService=void 0;let n=a(3656),l=a(6193),_=a(5596),v=a(4725),h=a(8460),e=a(844),s=a(7226),t=a(2585),i=r.RenderService=class extends e.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(c,f,p,S,d,g,k,T){if(super(),this._rowCount=c,this._charSizeService=S,this._renderer=this.register(new e.MutableDisposable),this._pausedResizeTask=new s.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new h.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new h.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new h.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new h.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new l.RenderDebouncer(k.window,(x,R)=>this._renderRows(x,R)),this.register(this._renderDebouncer),this._screenDprMonitor=new _.ScreenDprMonitor(k.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(g.onResize(()=>this._fullRefresh())),this.register(g.buffers.onBufferActivate(()=>{var x;return(x=this._renderer.value)===null||x===void 0?void 0:x.clear()})),this.register(p.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(d.onDecorationRegistered(()=>this._fullRefresh())),this.register(d.onDecorationRemoved(()=>this._fullRefresh())),this.register(p.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(g.cols,g.rows),this._fullRefresh()})),this.register(p.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(g.buffer.y,g.buffer.y,!0))),this.register((0,n.addDisposableDomListener)(k.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(T.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in k.window){let x=new k.window.IntersectionObserver(R=>this._handleIntersectionChange(R[R.length-1]),{threshold:0});x.observe(f),this.register({dispose:()=>x.disconnect()})}}_handleIntersectionChange(c){this._isPaused=c.isIntersecting===void 0?c.intersectionRatio===0:!c.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(c,f,p=!1){this._isPaused?this._needsFullRefresh=!0:(p||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(c,f,this._rowCount))}_renderRows(c,f){this._renderer.value&&(c=Math.min(c,this._rowCount-1),f=Math.min(f,this._rowCount-1),this._renderer.value.renderRows(c,f),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:c,end:f}),this._onRender.fire({start:c,end:f}),this._isNextRenderRedrawOnly=!0)}resize(c,f){this._rowCount=f,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(c){this._renderer.value=c,this._renderer.value.onRequestRedraw(f=>this.refreshRows(f.start,f.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(c){return this._renderDebouncer.addRefreshCallback(c)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var c,f;this._renderer.value&&((f=(c=this._renderer.value).clearTextureAtlas)===null||f===void 0||f.call(c),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(c,f){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(c,f)):this._renderer.value.handleResize(c,f),this._fullRefresh())}handleCharSizeChanged(){var c;(c=this._renderer.value)===null||c===void 0||c.handleCharSizeChanged()}handleBlur(){var c;(c=this._renderer.value)===null||c===void 0||c.handleBlur()}handleFocus(){var c;(c=this._renderer.value)===null||c===void 0||c.handleFocus()}handleSelectionChanged(c,f,p){var S;this._selectionState.start=c,this._selectionState.end=f,this._selectionState.columnSelectMode=p,(S=this._renderer.value)===null||S===void 0||S.handleSelectionChanged(c,f,p)}handleCursorMove(){var c;(c=this._renderer.value)===null||c===void 0||c.handleCursorMove()}clear(){var c;(c=this._renderer.value)===null||c===void 0||c.clear()}};r.RenderService=i=o([u(2,t.IOptionsService),u(3,v.ICharSizeService),u(4,t.IDecorationService),u(5,t.IBufferService),u(6,v.ICoreBrowserService),u(7,v.IThemeService)],i)},9312:function(E,r,a){var o=this&&this.__decorate||function(d,g,k,T){var x,R=arguments.length,P=R<3?g:T===null?T=Object.getOwnPropertyDescriptor(g,k):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(d,g,k,T);else for(var O=d.length-1;O>=0;O--)(x=d[O])&&(P=(R<3?x(P):R>3?x(g,k,P):x(g,k))||P);return R>3&&P&&Object.defineProperty(g,k,P),P},u=this&&this.__param||function(d,g){return function(k,T){g(k,T,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionService=void 0;let n=a(9806),l=a(9504),_=a(456),v=a(4725),h=a(8460),e=a(844),s=a(6114),t=a(4841),i=a(511),c=a(2585),f="\xA0",p=new RegExp(f,"g"),S=r.SelectionService=class extends e.Disposable{constructor(d,g,k,T,x,R,P,O,W){super(),this._element=d,this._screenElement=g,this._linkifier=k,this._bufferService=T,this._coreService=x,this._mouseService=R,this._optionsService=P,this._renderService=O,this._coreBrowserService=W,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new i.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new h.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new h.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new h.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new h.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=F=>this._handleMouseMove(F),this._mouseUpListener=F=>this._handleMouseUp(F),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(F=>this._handleTrim(F)),this.register(this._bufferService.buffers.onBufferActivate(F=>this._handleBufferActivate(F))),this.enable(),this._model=new _.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,e.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let d=this._model.finalSelectionStart,g=this._model.finalSelectionEnd;return!(!d||!g||d[0]===g[0]&&d[1]===g[1])}get selectionText(){let d=this._model.finalSelectionStart,g=this._model.finalSelectionEnd;if(!d||!g)return"";let k=this._bufferService.buffer,T=[];if(this._activeSelectionMode===3){if(d[0]===g[0])return"";let x=d[0]<g[0]?d[0]:g[0],R=d[0]<g[0]?g[0]:d[0];for(let P=d[1];P<=g[1];P++){let O=k.translateBufferLineToString(P,!0,x,R);T.push(O)}}else{let x=d[1]===g[1]?g[0]:void 0;T.push(k.translateBufferLineToString(d[1],!0,d[0],x));for(let R=d[1]+1;R<=g[1]-1;R++){let P=k.lines.get(R),O=k.translateBufferLineToString(R,!0);P?.isWrapped?T[T.length-1]+=O:T.push(O)}if(d[1]!==g[1]){let R=k.lines.get(g[1]),P=k.translateBufferLineToString(g[1],!0,0,g[0]);R&&R.isWrapped?T[T.length-1]+=P:T.push(P)}}return T.map(x=>x.replace(p," ")).join(s.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(d){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),s.isLinux&&d&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(d){let g=this._getMouseBufferCoords(d),k=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!!(k&&T&&g)&&this._areCoordsInSelection(g,k,T)}isCellInSelection(d,g){let k=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!(!k||!T)&&this._areCoordsInSelection([d,g],k,T)}_areCoordsInSelection(d,g,k){return d[1]>g[1]&&d[1]<k[1]||g[1]===k[1]&&d[1]===g[1]&&d[0]>=g[0]&&d[0]<k[0]||g[1]<k[1]&&d[1]===k[1]&&d[0]<k[0]||g[1]<k[1]&&d[1]===g[1]&&d[0]>=g[0]}_selectWordAtCursor(d,g){var k,T;let x=(T=(k=this._linkifier.currentLink)===null||k===void 0?void 0:k.link)===null||T===void 0?void 0:T.range;if(x)return this._model.selectionStart=[x.start.x-1,x.start.y-1],this._model.selectionStartLength=(0,t.getRangeLength)(x,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let R=this._getMouseBufferCoords(d);return!!R&&(this._selectWordAt(R,g),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(d,g){this._model.clearSelection(),d=Math.max(d,0),g=Math.min(g,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,d],this._model.selectionEnd=[this._bufferService.cols,g],this.refresh(),this._onSelectionChange.fire()}_handleTrim(d){this._model.handleTrim(d)&&this.refresh()}_getMouseBufferCoords(d){let g=this._mouseService.getCoords(d,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(g)return g[0]--,g[1]--,g[1]+=this._bufferService.buffer.ydisp,g}_getMouseEventScrollAmount(d){let g=(0,n.getCoordsRelativeToElement)(this._coreBrowserService.window,d,this._screenElement)[1],k=this._renderService.dimensions.css.canvas.height;return g>=0&&g<=k?0:(g>k&&(g-=k),g=Math.min(Math.max(g,-50),50),g/=50,g/Math.abs(g)+Math.round(14*g))}shouldForceSelection(d){return s.isMac?d.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:d.shiftKey}handleMouseDown(d){if(this._mouseDownTimeStamp=d.timeStamp,(d.button!==2||!this.hasSelection)&&d.button===0){if(!this._enabled){if(!this.shouldForceSelection(d))return;d.stopPropagation()}d.preventDefault(),this._dragScrollAmount=0,this._enabled&&d.shiftKey?this._handleIncrementalClick(d):d.detail===1?this._handleSingleClick(d):d.detail===2?this._handleDoubleClick(d):d.detail===3&&this._handleTripleClick(d),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(d){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(d))}_handleSingleClick(d){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(d)?3:0,this._model.selectionStart=this._getMouseBufferCoords(d),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let g=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);g&&g.length!==this._model.selectionStart[0]&&g.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(d){this._selectWordAtCursor(d,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(d){let g=this._getMouseBufferCoords(d);g&&(this._activeSelectionMode=2,this._selectLineAt(g[1]))}shouldColumnSelect(d){return d.altKey&&!(s.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(d){if(d.stopImmediatePropagation(),!this._model.selectionStart)return;let g=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(d),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(d),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let k=this._bufferService.buffer;if(this._model.selectionEnd[1]<k.lines.length){let T=k.lines.get(this._model.selectionEnd[1]);T&&T.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}g&&g[0]===this._model.selectionEnd[0]&&g[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let d=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(d.ydisp+this._bufferService.rows,d.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=d.ydisp),this.refresh()}}_handleMouseUp(d){let g=d.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&g<500&&d.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let k=this._mouseService.getCoords(d,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(k&&k[0]!==void 0&&k[1]!==void 0){let T=(0,l.moveToCellSequence)(k[0]-1,k[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(T,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let d=this._model.finalSelectionStart,g=this._model.finalSelectionEnd,k=!(!d||!g||d[0]===g[0]&&d[1]===g[1]);k?d&&g&&(this._oldSelectionStart&&this._oldSelectionEnd&&d[0]===this._oldSelectionStart[0]&&d[1]===this._oldSelectionStart[1]&&g[0]===this._oldSelectionEnd[0]&&g[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(d,g,k)):this._oldHasSelection&&this._fireOnSelectionChange(d,g,k)}_fireOnSelectionChange(d,g,k){this._oldSelectionStart=d,this._oldSelectionEnd=g,this._oldHasSelection=k,this._onSelectionChange.fire()}_handleBufferActivate(d){this.clearSelection(),this._trimListener.dispose(),this._trimListener=d.activeBuffer.lines.onTrim(g=>this._handleTrim(g))}_convertViewportColToCharacterIndex(d,g){let k=g;for(let T=0;g>=T;T++){let x=d.loadCell(T,this._workCell).getChars().length;this._workCell.getWidth()===0?k--:x>1&&g!==T&&(k+=x-1)}return k}setSelection(d,g,k){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[d,g],this._model.selectionStartLength=k,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(d){this._isClickInSelection(d)||(this._selectWordAtCursor(d,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(d,g,k=!0,T=!0){if(d[0]>=this._bufferService.cols)return;let x=this._bufferService.buffer,R=x.lines.get(d[1]);if(!R)return;let P=x.translateBufferLineToString(d[1],!1),O=this._convertViewportColToCharacterIndex(R,d[0]),W=O,F=d[0]-O,C=0,L=0,D=0,A=0;if(P.charAt(O)===" "){for(;O>0&&P.charAt(O-1)===" ";)O--;for(;W<P.length&&P.charAt(W+1)===" ";)W++}else{let K=d[0],z=d[0];R.getWidth(K)===0&&(C++,K--),R.getWidth(z)===2&&(L++,z++);let Y=R.getString(z).length;for(Y>1&&(A+=Y-1,W+=Y-1);K>0&&O>0&&!this._isCharWordSeparator(R.loadCell(K-1,this._workCell));){R.loadCell(K-1,this._workCell);let b=this._workCell.getChars().length;this._workCell.getWidth()===0?(C++,K--):b>1&&(D+=b-1,O-=b-1),O--,K--}for(;z<R.length&&W+1<P.length&&!this._isCharWordSeparator(R.loadCell(z+1,this._workCell));){R.loadCell(z+1,this._workCell);let b=this._workCell.getChars().length;this._workCell.getWidth()===2?(L++,z++):b>1&&(A+=b-1,W+=b-1),W++,z++}}W++;let N=O+F-C+D,j=Math.min(this._bufferService.cols,W-O+C+L-D-A);if(g||P.slice(O,W).trim()!==""){if(k&&N===0&&R.getCodePoint(0)!==32){let K=x.lines.get(d[1]-1);if(K&&R.isWrapped&&K.getCodePoint(this._bufferService.cols-1)!==32){let z=this._getWordAt([this._bufferService.cols-1,d[1]-1],!1,!0,!1);if(z){let Y=this._bufferService.cols-z.start;N-=Y,j+=Y}}}if(T&&N+j===this._bufferService.cols&&R.getCodePoint(this._bufferService.cols-1)!==32){let K=x.lines.get(d[1]+1);if(K?.isWrapped&&K.getCodePoint(0)!==32){let z=this._getWordAt([0,d[1]+1],!1,!1,!0);z&&(j+=z.length)}}return{start:N,length:j}}}_selectWordAt(d,g){let k=this._getWordAt(d,g);if(k){for(;k.start<0;)k.start+=this._bufferService.cols,d[1]--;this._model.selectionStart=[k.start,d[1]],this._model.selectionStartLength=k.length}}_selectToWordAt(d){let g=this._getWordAt(d,!0);if(g){let k=d[1];for(;g.start<0;)g.start+=this._bufferService.cols,k--;if(!this._model.areSelectionValuesReversed())for(;g.start+g.length>this._bufferService.cols;)g.length-=this._bufferService.cols,k++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?g.start:g.start+g.length,k]}}_isCharWordSeparator(d){return d.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(d.getChars())>=0}_selectLineAt(d){let g=this._bufferService.buffer.getWrappedRangeForLine(d),k={start:{x:0,y:g.first},end:{x:this._bufferService.cols-1,y:g.last}};this._model.selectionStart=[0,g.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,t.getRangeLength)(k,this._bufferService.cols)}};r.SelectionService=S=o([u(3,c.IBufferService),u(4,c.ICoreService),u(5,v.IMouseService),u(6,c.IOptionsService),u(7,v.IRenderService),u(8,v.ICoreBrowserService)],S)},4725:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IThemeService=r.ICharacterJoinerService=r.ISelectionService=r.IRenderService=r.IMouseService=r.ICoreBrowserService=r.ICharSizeService=void 0;let o=a(8343);r.ICharSizeService=(0,o.createDecorator)("CharSizeService"),r.ICoreBrowserService=(0,o.createDecorator)("CoreBrowserService"),r.IMouseService=(0,o.createDecorator)("MouseService"),r.IRenderService=(0,o.createDecorator)("RenderService"),r.ISelectionService=(0,o.createDecorator)("SelectionService"),r.ICharacterJoinerService=(0,o.createDecorator)("CharacterJoinerService"),r.IThemeService=(0,o.createDecorator)("ThemeService")},6731:function(E,r,a){var o=this&&this.__decorate||function(S,d,g,k){var T,x=arguments.length,R=x<3?d:k===null?k=Object.getOwnPropertyDescriptor(d,g):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(S,d,g,k);else for(var P=S.length-1;P>=0;P--)(T=S[P])&&(R=(x<3?T(R):x>3?T(d,g,R):T(d,g))||R);return x>3&&R&&Object.defineProperty(d,g,R),R},u=this&&this.__param||function(S,d){return function(g,k){d(g,k,S)}};Object.defineProperty(r,"__esModule",{value:!0}),r.ThemeService=r.DEFAULT_ANSI_COLORS=void 0;let n=a(7239),l=a(8055),_=a(8460),v=a(844),h=a(2585),e=l.css.toColor("#ffffff"),s=l.css.toColor("#000000"),t=l.css.toColor("#ffffff"),i=l.css.toColor("#000000"),c={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};r.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let S=[l.css.toColor("#2e3436"),l.css.toColor("#cc0000"),l.css.toColor("#4e9a06"),l.css.toColor("#c4a000"),l.css.toColor("#3465a4"),l.css.toColor("#75507b"),l.css.toColor("#06989a"),l.css.toColor("#d3d7cf"),l.css.toColor("#555753"),l.css.toColor("#ef2929"),l.css.toColor("#8ae234"),l.css.toColor("#fce94f"),l.css.toColor("#729fcf"),l.css.toColor("#ad7fa8"),l.css.toColor("#34e2e2"),l.css.toColor("#eeeeec")],d=[0,95,135,175,215,255];for(let g=0;g<216;g++){let k=d[g/36%6|0],T=d[g/6%6|0],x=d[g%6];S.push({css:l.channels.toCss(k,T,x),rgba:l.channels.toRgba(k,T,x)})}for(let g=0;g<24;g++){let k=8+10*g;S.push({css:l.channels.toCss(k,k,k),rgba:l.channels.toRgba(k,k,k)})}return S})());let f=r.ThemeService=class extends v.Disposable{get colors(){return this._colors}constructor(S){super(),this._optionsService=S,this._contrastCache=new n.ColorContrastCache,this._halfContrastCache=new n.ColorContrastCache,this._onChangeColors=this.register(new _.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:e,background:s,cursor:t,cursorAccent:i,selectionForeground:void 0,selectionBackgroundTransparent:c,selectionBackgroundOpaque:l.color.blend(s,c),selectionInactiveBackgroundTransparent:c,selectionInactiveBackgroundOpaque:l.color.blend(s,c),ansi:r.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(S={}){let d=this._colors;if(d.foreground=p(S.foreground,e),d.background=p(S.background,s),d.cursor=p(S.cursor,t),d.cursorAccent=p(S.cursorAccent,i),d.selectionBackgroundTransparent=p(S.selectionBackground,c),d.selectionBackgroundOpaque=l.color.blend(d.background,d.selectionBackgroundTransparent),d.selectionInactiveBackgroundTransparent=p(S.selectionInactiveBackground,d.selectionBackgroundTransparent),d.selectionInactiveBackgroundOpaque=l.color.blend(d.background,d.selectionInactiveBackgroundTransparent),d.selectionForeground=S.selectionForeground?p(S.selectionForeground,l.NULL_COLOR):void 0,d.selectionForeground===l.NULL_COLOR&&(d.selectionForeground=void 0),l.color.isOpaque(d.selectionBackgroundTransparent)&&(d.selectionBackgroundTransparent=l.color.opacity(d.selectionBackgroundTransparent,.3)),l.color.isOpaque(d.selectionInactiveBackgroundTransparent)&&(d.selectionInactiveBackgroundTransparent=l.color.opacity(d.selectionInactiveBackgroundTransparent,.3)),d.ansi=r.DEFAULT_ANSI_COLORS.slice(),d.ansi[0]=p(S.black,r.DEFAULT_ANSI_COLORS[0]),d.ansi[1]=p(S.red,r.DEFAULT_ANSI_COLORS[1]),d.ansi[2]=p(S.green,r.DEFAULT_ANSI_COLORS[2]),d.ansi[3]=p(S.yellow,r.DEFAULT_ANSI_COLORS[3]),d.ansi[4]=p(S.blue,r.DEFAULT_ANSI_COLORS[4]),d.ansi[5]=p(S.magenta,r.DEFAULT_ANSI_COLORS[5]),d.ansi[6]=p(S.cyan,r.DEFAULT_ANSI_COLORS[6]),d.ansi[7]=p(S.white,r.DEFAULT_ANSI_COLORS[7]),d.ansi[8]=p(S.brightBlack,r.DEFAULT_ANSI_COLORS[8]),d.ansi[9]=p(S.brightRed,r.DEFAULT_ANSI_COLORS[9]),d.ansi[10]=p(S.brightGreen,r.DEFAULT_ANSI_COLORS[10]),d.ansi[11]=p(S.brightYellow,r.DEFAULT_ANSI_COLORS[11]),d.ansi[12]=p(S.brightBlue,r.DEFAULT_ANSI_COLORS[12]),d.ansi[13]=p(S.brightMagenta,r.DEFAULT_ANSI_COLORS[13]),d.ansi[14]=p(S.brightCyan,r.DEFAULT_ANSI_COLORS[14]),d.ansi[15]=p(S.brightWhite,r.DEFAULT_ANSI_COLORS[15]),S.extendedAnsi){let g=Math.min(d.ansi.length-16,S.extendedAnsi.length);for(let k=0;k<g;k++)d.ansi[k+16]=p(S.extendedAnsi[k],r.DEFAULT_ANSI_COLORS[k+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(S){this._restoreColor(S),this._onChangeColors.fire(this.colors)}_restoreColor(S){if(S!==void 0)switch(S){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[S]=this._restoreColors.ansi[S]}else for(let d=0;d<this._restoreColors.ansi.length;++d)this._colors.ansi[d]=this._restoreColors.ansi[d]}modifyColors(S){S(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function p(S,d){if(S!==void 0)try{return l.css.toColor(S)}catch{}return d}r.ThemeService=f=o([u(0,h.IOptionsService)],f)},6349:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CircularList=void 0;let o=a(8460),u=a(844);class n extends u.Disposable{constructor(_){super(),this._maxLength=_,this.onDeleteEmitter=this.register(new o.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new o.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new o.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(_){if(this._maxLength===_)return;let v=new Array(_);for(let h=0;h<Math.min(_,this.length);h++)v[h]=this._array[this._getCyclicIndex(h)];this._array=v,this._maxLength=_,this._startIndex=0}get length(){return this._length}set length(_){if(_>this._length)for(let v=this._length;v<_;v++)this._array[v]=void 0;this._length=_}get(_){return this._array[this._getCyclicIndex(_)]}set(_,v){this._array[this._getCyclicIndex(_)]=v}push(_){this._array[this._getCyclicIndex(this._length)]=_,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(_,v,...h){if(v){for(let e=_;e<this._length-v;e++)this._array[this._getCyclicIndex(e)]=this._array[this._getCyclicIndex(e+v)];this._length-=v,this.onDeleteEmitter.fire({index:_,amount:v})}for(let e=this._length-1;e>=_;e--)this._array[this._getCyclicIndex(e+h.length)]=this._array[this._getCyclicIndex(e)];for(let e=0;e<h.length;e++)this._array[this._getCyclicIndex(_+e)]=h[e];if(h.length&&this.onInsertEmitter.fire({index:_,amount:h.length}),this._length+h.length>this._maxLength){let e=this._length+h.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=h.length}trimStart(_){_>this._length&&(_=this._length),this._startIndex+=_,this._length-=_,this.onTrimEmitter.fire(_)}shiftElements(_,v,h){if(!(v<=0)){if(_<0||_>=this._length)throw new Error("start argument out of range");if(_+h<0)throw new Error("Cannot shift elements in list beyond index 0");if(h>0){for(let s=v-1;s>=0;s--)this.set(_+s+h,this.get(_+s));let e=_+v+h-this._length;if(e>0)for(this._length+=e;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let e=0;e<v;e++)this.set(_+e+h,this.get(_+e))}}_getCyclicIndex(_){return(this._startIndex+_)%this._maxLength}}r.CircularList=n},1439:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function a(o,u=5){if(typeof o!="object")return o;let n=Array.isArray(o)?[]:{};for(let l in o)n[l]=u<=1?o[l]:o[l]&&a(o[l],u-1);return n}},8055:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.contrastRatio=r.toPaddedHex=r.rgba=r.rgb=r.css=r.color=r.channels=r.NULL_COLOR=void 0;let o=a(6114),u=0,n=0,l=0,_=0;var v,h,e,s,t;function i(f){let p=f.toString(16);return p.length<2?"0"+p:p}function c(f,p){return f<p?(p+.05)/(f+.05):(f+.05)/(p+.05)}r.NULL_COLOR={css:"#00000000",rgba:0},function(f){f.toCss=function(p,S,d,g){return g!==void 0?`#${i(p)}${i(S)}${i(d)}${i(g)}`:`#${i(p)}${i(S)}${i(d)}`},f.toRgba=function(p,S,d,g=255){return(p<<24|S<<16|d<<8|g)>>>0}}(v||(r.channels=v={})),function(f){function p(S,d){return _=Math.round(255*d),[u,n,l]=t.toChannels(S.rgba),{css:v.toCss(u,n,l,_),rgba:v.toRgba(u,n,l,_)}}f.blend=function(S,d){if(_=(255&d.rgba)/255,_===1)return{css:d.css,rgba:d.rgba};let g=d.rgba>>24&255,k=d.rgba>>16&255,T=d.rgba>>8&255,x=S.rgba>>24&255,R=S.rgba>>16&255,P=S.rgba>>8&255;return u=x+Math.round((g-x)*_),n=R+Math.round((k-R)*_),l=P+Math.round((T-P)*_),{css:v.toCss(u,n,l),rgba:v.toRgba(u,n,l)}},f.isOpaque=function(S){return(255&S.rgba)==255},f.ensureContrastRatio=function(S,d,g){let k=t.ensureContrastRatio(S.rgba,d.rgba,g);if(k)return t.toColor(k>>24&255,k>>16&255,k>>8&255)},f.opaque=function(S){let d=(255|S.rgba)>>>0;return[u,n,l]=t.toChannels(d),{css:v.toCss(u,n,l),rgba:d}},f.opacity=p,f.multiplyOpacity=function(S,d){return _=255&S.rgba,p(S,_*d/255)},f.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}}(h||(r.color=h={})),function(f){let p,S;if(!o.isNode){let d=document.createElement("canvas");d.width=1,d.height=1;let g=d.getContext("2d",{willReadFrequently:!0});g&&(p=g,p.globalCompositeOperation="copy",S=p.createLinearGradient(0,0,1,1))}f.toColor=function(d){if(d.match(/#[\da-f]{3,8}/i))switch(d.length){case 4:return u=parseInt(d.slice(1,2).repeat(2),16),n=parseInt(d.slice(2,3).repeat(2),16),l=parseInt(d.slice(3,4).repeat(2),16),t.toColor(u,n,l);case 5:return u=parseInt(d.slice(1,2).repeat(2),16),n=parseInt(d.slice(2,3).repeat(2),16),l=parseInt(d.slice(3,4).repeat(2),16),_=parseInt(d.slice(4,5).repeat(2),16),t.toColor(u,n,l,_);case 7:return{css:d,rgba:(parseInt(d.slice(1),16)<<8|255)>>>0};case 9:return{css:d,rgba:parseInt(d.slice(1),16)>>>0}}let g=d.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(g)return u=parseInt(g[1]),n=parseInt(g[2]),l=parseInt(g[3]),_=Math.round(255*(g[5]===void 0?1:parseFloat(g[5]))),t.toColor(u,n,l,_);if(!p||!S)throw new Error("css.toColor: Unsupported css format");if(p.fillStyle=S,p.fillStyle=d,typeof p.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(p.fillRect(0,0,1,1),[u,n,l,_]=p.getImageData(0,0,1,1).data,_!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:v.toRgba(u,n,l,_),css:d}}}(e||(r.css=e={})),function(f){function p(S,d,g){let k=S/255,T=d/255,x=g/255;return .2126*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.7152*(T<=.03928?T/12.92:Math.pow((T+.055)/1.055,2.4))+.0722*(x<=.03928?x/12.92:Math.pow((x+.055)/1.055,2.4))}f.relativeLuminance=function(S){return p(S>>16&255,S>>8&255,255&S)},f.relativeLuminance2=p}(s||(r.rgb=s={})),function(f){function p(d,g,k){let T=d>>24&255,x=d>>16&255,R=d>>8&255,P=g>>24&255,O=g>>16&255,W=g>>8&255,F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(T,x,R));for(;F<k&&(P>0||O>0||W>0);)P-=Math.max(0,Math.ceil(.1*P)),O-=Math.max(0,Math.ceil(.1*O)),W-=Math.max(0,Math.ceil(.1*W)),F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(T,x,R));return(P<<24|O<<16|W<<8|255)>>>0}function S(d,g,k){let T=d>>24&255,x=d>>16&255,R=d>>8&255,P=g>>24&255,O=g>>16&255,W=g>>8&255,F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(T,x,R));for(;F<k&&(P<255||O<255||W<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),O=Math.min(255,O+Math.ceil(.1*(255-O))),W=Math.min(255,W+Math.ceil(.1*(255-W))),F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(T,x,R));return(P<<24|O<<16|W<<8|255)>>>0}f.ensureContrastRatio=function(d,g,k){let T=s.relativeLuminance(d>>8),x=s.relativeLuminance(g>>8);if(c(T,x)<k){if(x<T){let O=p(d,g,k),W=c(T,s.relativeLuminance(O>>8));if(W<k){let F=S(d,g,k);return W>c(T,s.relativeLuminance(F>>8))?O:F}return O}let R=S(d,g,k),P=c(T,s.relativeLuminance(R>>8));if(P<k){let O=p(d,g,k);return P>c(T,s.relativeLuminance(O>>8))?R:O}return R}},f.reduceLuminance=p,f.increaseLuminance=S,f.toChannels=function(d){return[d>>24&255,d>>16&255,d>>8&255,255&d]},f.toColor=function(d,g,k,T){return{css:v.toCss(d,g,k,T),rgba:v.toRgba(d,g,k,T)}}}(t||(r.rgba=t={})),r.toPaddedHex=i,r.contrastRatio=c},8969:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreTerminal=void 0;let o=a(844),u=a(2585),n=a(4348),l=a(7866),_=a(744),v=a(7302),h=a(6975),e=a(8460),s=a(1753),t=a(1480),i=a(7994),c=a(9282),f=a(5435),p=a(5981),S=a(2660),d=!1;class g extends o.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new e.EventEmitter),this._onScroll.event(T=>{var x;(x=this._onScrollApi)===null||x===void 0||x.fire(T.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(T){for(let x in T)this.optionsService.options[x]=T[x]}constructor(T){super(),this._windowsWrappingHeuristics=this.register(new o.MutableDisposable),this._onBinary=this.register(new e.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new e.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new e.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new e.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new e.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new v.OptionsService(T)),this._instantiationService.setService(u.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(_.BufferService)),this._instantiationService.setService(u.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(l.LogService)),this._instantiationService.setService(u.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(h.CoreService)),this._instantiationService.setService(u.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(s.CoreMouseService)),this._instantiationService.setService(u.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(t.UnicodeService)),this._instantiationService.setService(u.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(i.CharsetService),this._instantiationService.setService(u.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(S.OscLinkService),this._instantiationService.setService(u.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new f.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,e.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,e.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,e.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,e.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new p.WriteBuffer((x,R)=>this._inputHandler.parse(x,R))),this.register((0,e.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(T,x){this._writeBuffer.write(T,x)}writeSync(T,x){this._logService.logLevel<=u.LogLevelEnum.WARN&&!d&&(this._logService.warn("writeSync is unreliable and will be removed soon."),d=!0),this._writeBuffer.writeSync(T,x)}resize(T,x){isNaN(T)||isNaN(x)||(T=Math.max(T,_.MINIMUM_COLS),x=Math.max(x,_.MINIMUM_ROWS),this._bufferService.resize(T,x))}scroll(T,x=!1){this._bufferService.scroll(T,x)}scrollLines(T,x,R){this._bufferService.scrollLines(T,x,R)}scrollPages(T){this.scrollLines(T*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(T){let x=T-this._bufferService.buffer.ydisp;x!==0&&this.scrollLines(x)}registerEscHandler(T,x){return this._inputHandler.registerEscHandler(T,x)}registerDcsHandler(T,x){return this._inputHandler.registerDcsHandler(T,x)}registerCsiHandler(T,x){return this._inputHandler.registerCsiHandler(T,x)}registerOscHandler(T,x){return this._inputHandler.registerOscHandler(T,x)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let T=!1,x=this.optionsService.rawOptions.windowsPty;x&&x.buildNumber!==void 0&&x.buildNumber!==void 0?T=x.backend==="conpty"&&x.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(T=!0),T?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let T=[];T.push(this.onLineFeed(c.updateWindowsModeWrappedState.bind(null,this._bufferService))),T.push(this.registerCsiHandler({final:"H"},()=>((0,c.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,o.toDisposable)(()=>{for(let x of T)x.dispose()})}}}r.CoreTerminal=g},8460:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let o=0;o<this._listeners.length;o++)if(this._listeners[o]===a)return void this._listeners.splice(o,1)}}})),this._event}fire(a,o){let u=[];for(let n=0;n<this._listeners.length;n++)u.push(this._listeners[n]);for(let n=0;n<u.length;n++)u[n].call(void 0,a,o)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(a,o){return a(u=>o.fire(u))}},5435:function(E,r,a){var o=this&&this.__decorate||function(F,C,L,D){var A,N=arguments.length,j=N<3?C:D===null?D=Object.getOwnPropertyDescriptor(C,L):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(F,C,L,D);else for(var K=F.length-1;K>=0;K--)(A=F[K])&&(j=(N<3?A(j):N>3?A(C,L,j):A(C,L))||j);return N>3&&j&&Object.defineProperty(C,L,j),j},u=this&&this.__param||function(F,C){return function(L,D){C(L,D,F)}};Object.defineProperty(r,"__esModule",{value:!0}),r.InputHandler=r.WindowsOptionsReportType=void 0;let n=a(2584),l=a(7116),_=a(2015),v=a(844),h=a(482),e=a(8437),s=a(8460),t=a(643),i=a(511),c=a(3734),f=a(2585),p=a(6242),S=a(6351),d=a(5941),g={"(":0,")":1,"*":2,"+":3,"-":1,".":2},k=131072;function T(F,C){if(F>24)return C.setWinLines||!1;switch(F){case 1:return!!C.restoreWin;case 2:return!!C.minimizeWin;case 3:return!!C.setWinPosition;case 4:return!!C.setWinSizePixels;case 5:return!!C.raiseWin;case 6:return!!C.lowerWin;case 7:return!!C.refreshWin;case 8:return!!C.setWinSizeChars;case 9:return!!C.maximizeWin;case 10:return!!C.fullscreenWin;case 11:return!!C.getWinState;case 13:return!!C.getWinPosition;case 14:return!!C.getWinSizePixels;case 15:return!!C.getScreenSizePixels;case 16:return!!C.getCellSizePixels;case 18:return!!C.getWinSizeChars;case 19:return!!C.getScreenSizeChars;case 20:return!!C.getIconTitle;case 21:return!!C.getWinTitle;case 22:return!!C.pushTitle;case 23:return!!C.popTitle;case 24:return!!C.setWinLines}return!1}var x;(function(F){F[F.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",F[F.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(x||(r.WindowsOptionsReportType=x={}));let R=0;class P extends v.Disposable{getAttrData(){return this._curAttrData}constructor(C,L,D,A,N,j,K,z,Y=new _.EscapeSequenceParser){super(),this._bufferService=C,this._charsetService=L,this._coreService=D,this._logService=A,this._optionsService=N,this._oscLinkService=j,this._coreMouseService=K,this._unicodeService=z,this._parser=Y,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new h.StringToUtf32,this._utf8Decoder=new h.Utf8ToUtf32,this._workCell=new i.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new s.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new s.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new s.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new s.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new s.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new s.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new s.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new s.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new s.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new s.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new s.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new O(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(b=>this._activeBuffer=b.activeBuffer)),this._parser.setCsiHandlerFallback((b,M)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(b),params:M.toArray()})}),this._parser.setEscHandlerFallback(b=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(b)})}),this._parser.setExecuteHandlerFallback(b=>{this._logService.debug("Unknown EXECUTE code: ",{code:b})}),this._parser.setOscHandlerFallback((b,M,H)=>{this._logService.debug("Unknown OSC code: ",{identifier:b,action:M,data:H})}),this._parser.setDcsHandlerFallback((b,M,H)=>{M==="HOOK"&&(H=H.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(b),action:M,payload:H})}),this._parser.setPrintHandler((b,M,H)=>this.print(b,M,H)),this._parser.registerCsiHandler({final:"@"},b=>this.insertChars(b)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},b=>this.scrollLeft(b)),this._parser.registerCsiHandler({final:"A"},b=>this.cursorUp(b)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},b=>this.scrollRight(b)),this._parser.registerCsiHandler({final:"B"},b=>this.cursorDown(b)),this._parser.registerCsiHandler({final:"C"},b=>this.cursorForward(b)),this._parser.registerCsiHandler({final:"D"},b=>this.cursorBackward(b)),this._parser.registerCsiHandler({final:"E"},b=>this.cursorNextLine(b)),this._parser.registerCsiHandler({final:"F"},b=>this.cursorPrecedingLine(b)),this._parser.registerCsiHandler({final:"G"},b=>this.cursorCharAbsolute(b)),this._parser.registerCsiHandler({final:"H"},b=>this.cursorPosition(b)),this._parser.registerCsiHandler({final:"I"},b=>this.cursorForwardTab(b)),this._parser.registerCsiHandler({final:"J"},b=>this.eraseInDisplay(b,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},b=>this.eraseInDisplay(b,!0)),this._parser.registerCsiHandler({final:"K"},b=>this.eraseInLine(b,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},b=>this.eraseInLine(b,!0)),this._parser.registerCsiHandler({final:"L"},b=>this.insertLines(b)),this._parser.registerCsiHandler({final:"M"},b=>this.deleteLines(b)),this._parser.registerCsiHandler({final:"P"},b=>this.deleteChars(b)),this._parser.registerCsiHandler({final:"S"},b=>this.scrollUp(b)),this._parser.registerCsiHandler({final:"T"},b=>this.scrollDown(b)),this._parser.registerCsiHandler({final:"X"},b=>this.eraseChars(b)),this._parser.registerCsiHandler({final:"Z"},b=>this.cursorBackwardTab(b)),this._parser.registerCsiHandler({final:"`"},b=>this.charPosAbsolute(b)),this._parser.registerCsiHandler({final:"a"},b=>this.hPositionRelative(b)),this._parser.registerCsiHandler({final:"b"},b=>this.repeatPrecedingCharacter(b)),this._parser.registerCsiHandler({final:"c"},b=>this.sendDeviceAttributesPrimary(b)),this._parser.registerCsiHandler({prefix:">",final:"c"},b=>this.sendDeviceAttributesSecondary(b)),this._parser.registerCsiHandler({final:"d"},b=>this.linePosAbsolute(b)),this._parser.registerCsiHandler({final:"e"},b=>this.vPositionRelative(b)),this._parser.registerCsiHandler({final:"f"},b=>this.hVPosition(b)),this._parser.registerCsiHandler({final:"g"},b=>this.tabClear(b)),this._parser.registerCsiHandler({final:"h"},b=>this.setMode(b)),this._parser.registerCsiHandler({prefix:"?",final:"h"},b=>this.setModePrivate(b)),this._parser.registerCsiHandler({final:"l"},b=>this.resetMode(b)),this._parser.registerCsiHandler({prefix:"?",final:"l"},b=>this.resetModePrivate(b)),this._parser.registerCsiHandler({final:"m"},b=>this.charAttributes(b)),this._parser.registerCsiHandler({final:"n"},b=>this.deviceStatus(b)),this._parser.registerCsiHandler({prefix:"?",final:"n"},b=>this.deviceStatusPrivate(b)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},b=>this.softReset(b)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},b=>this.setCursorStyle(b)),this._parser.registerCsiHandler({final:"r"},b=>this.setScrollRegion(b)),this._parser.registerCsiHandler({final:"s"},b=>this.saveCursor(b)),this._parser.registerCsiHandler({final:"t"},b=>this.windowOptions(b)),this._parser.registerCsiHandler({final:"u"},b=>this.restoreCursor(b)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},b=>this.insertColumns(b)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},b=>this.deleteColumns(b)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},b=>this.selectProtected(b)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},b=>this.requestMode(b,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},b=>this.requestMode(b,!1)),this._parser.setExecuteHandler(n.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(n.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(n.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(n.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(n.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(n.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(n.C1.IND,()=>this.index()),this._parser.setExecuteHandler(n.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(n.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new p.OscHandler(b=>(this.setTitle(b),this.setIconName(b),!0))),this._parser.registerOscHandler(1,new p.OscHandler(b=>this.setIconName(b))),this._parser.registerOscHandler(2,new p.OscHandler(b=>this.setTitle(b))),this._parser.registerOscHandler(4,new p.OscHandler(b=>this.setOrReportIndexedColor(b))),this._parser.registerOscHandler(8,new p.OscHandler(b=>this.setHyperlink(b))),this._parser.registerOscHandler(10,new p.OscHandler(b=>this.setOrReportFgColor(b))),this._parser.registerOscHandler(11,new p.OscHandler(b=>this.setOrReportBgColor(b))),this._parser.registerOscHandler(12,new p.OscHandler(b=>this.setOrReportCursorColor(b))),this._parser.registerOscHandler(104,new p.OscHandler(b=>this.restoreIndexedColor(b))),this._parser.registerOscHandler(110,new p.OscHandler(b=>this.restoreFgColor(b))),this._parser.registerOscHandler(111,new p.OscHandler(b=>this.restoreBgColor(b))),this._parser.registerOscHandler(112,new p.OscHandler(b=>this.restoreCursorColor(b))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let b in l.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:b},()=>this.selectCharset("("+b)),this._parser.registerEscHandler({intermediates:")",final:b},()=>this.selectCharset(")"+b)),this._parser.registerEscHandler({intermediates:"*",final:b},()=>this.selectCharset("*"+b)),this._parser.registerEscHandler({intermediates:"+",final:b},()=>this.selectCharset("+"+b)),this._parser.registerEscHandler({intermediates:"-",final:b},()=>this.selectCharset("-"+b)),this._parser.registerEscHandler({intermediates:".",final:b},()=>this.selectCharset("."+b)),this._parser.registerEscHandler({intermediates:"/",final:b},()=>this.selectCharset("/"+b));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(b=>(this._logService.error("Parsing error: ",b),b)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new S.DcsHandler((b,M)=>this.requestStatusString(b,M)))}_preserveStack(C,L,D,A){this._parseStack.paused=!0,this._parseStack.cursorStartX=C,this._parseStack.cursorStartY=L,this._parseStack.decodedLength=D,this._parseStack.position=A}_logSlowResolvingAsync(C){this._logService.logLevel<=f.LogLevelEnum.WARN&&Promise.race([C,new Promise((L,D)=>setTimeout(()=>D("#SLOW_TIMEOUT"),5e3))]).catch(L=>{if(L!=="#SLOW_TIMEOUT")throw L;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(C,L){let D,A=this._activeBuffer.x,N=this._activeBuffer.y,j=0,K=this._parseStack.paused;if(K){if(D=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,L))return this._logSlowResolvingAsync(D),D;A=this._parseStack.cursorStartX,N=this._parseStack.cursorStartY,this._parseStack.paused=!1,C.length>k&&(j=this._parseStack.position+k)}if(this._logService.logLevel<=f.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof C=="string"?` "${C}"`:` "${Array.prototype.map.call(C,z=>String.fromCharCode(z)).join("")}"`),typeof C=="string"?C.split("").map(z=>z.charCodeAt(0)):C),this._parseBuffer.length<C.length&&this._parseBuffer.length<k&&(this._parseBuffer=new Uint32Array(Math.min(C.length,k))),K||this._dirtyRowTracker.clearRange(),C.length>k)for(let z=j;z<C.length;z+=k){let Y=z+k<C.length?z+k:C.length,b=typeof C=="string"?this._stringDecoder.decode(C.substring(z,Y),this._parseBuffer):this._utf8Decoder.decode(C.subarray(z,Y),this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,b))return this._preserveStack(A,N,b,z),this._logSlowResolvingAsync(D),D}else if(!K){let z=typeof C=="string"?this._stringDecoder.decode(C,this._parseBuffer):this._utf8Decoder.decode(C,this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,z))return this._preserveStack(A,N,z,0),this._logSlowResolvingAsync(D),D}this._activeBuffer.x===A&&this._activeBuffer.y===N||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(C,L,D){let A,N,j=this._charsetService.charset,K=this._optionsService.rawOptions.screenReaderMode,z=this._bufferService.cols,Y=this._coreService.decPrivateModes.wraparound,b=this._coreService.modes.insertMode,M=this._curAttrData,H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&D-L>0&&H.getWidth(this._activeBuffer.x-1)===2&&H.setCellFromCodePoint(this._activeBuffer.x-1,0,1,M.fg,M.bg,M.extended);for(let I=L;I<D;++I){if(A=C[I],N=this._unicodeService.wcwidth(A),A<127&&j){let q=j[String.fromCharCode(A)];q&&(A=q.charCodeAt(0))}if(K&&this._onA11yChar.fire((0,h.stringFromCodePoint)(A)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),N||!this._activeBuffer.x){if(this._activeBuffer.x+N-1>=z){if(Y){for(;this._activeBuffer.x<z;)H.setCellFromCodePoint(this._activeBuffer.x++,0,1,M.fg,M.bg,M.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=z-1,N===2)continue}if(b&&(H.insertCells(this._activeBuffer.x,N,this._activeBuffer.getNullCell(M),M),H.getWidth(z-1)===2&&H.setCellFromCodePoint(z-1,t.NULL_CELL_CODE,t.NULL_CELL_WIDTH,M.fg,M.bg,M.extended)),H.setCellFromCodePoint(this._activeBuffer.x++,A,N,M.fg,M.bg,M.extended),N>0)for(;--N;)H.setCellFromCodePoint(this._activeBuffer.x++,0,0,M.fg,M.bg,M.extended)}else H.getWidth(this._activeBuffer.x-1)?H.addCodepointToCell(this._activeBuffer.x-1,A):H.addCodepointToCell(this._activeBuffer.x-2,A)}D-L>0&&(H.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<z&&D-L>0&&H.getWidth(this._activeBuffer.x)===0&&!H.hasContent(this._activeBuffer.x)&&H.setCellFromCodePoint(this._activeBuffer.x,0,1,M.fg,M.bg,M.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(C,L){return C.final!=="t"||C.prefix||C.intermediates?this._parser.registerCsiHandler(C,L):this._parser.registerCsiHandler(C,D=>!T(D.params[0],this._optionsService.rawOptions.windowOptions)||L(D))}registerDcsHandler(C,L){return this._parser.registerDcsHandler(C,new S.DcsHandler(L))}registerEscHandler(C,L){return this._parser.registerEscHandler(C,L)}registerOscHandler(C,L){return this._parser.registerOscHandler(C,new p.OscHandler(L))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var C;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||C===void 0)&&C.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);L.hasWidth(this._activeBuffer.x)&&!L.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let C=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-C),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(C=this._bufferService.cols-1){this._activeBuffer.x=Math.min(C,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(C,L){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=C,this._activeBuffer.y=this._activeBuffer.scrollTop+L):(this._activeBuffer.x=C,this._activeBuffer.y=L),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(C,L){this._restrictCursor(),this._setCursor(this._activeBuffer.x+C,this._activeBuffer.y+L)}cursorUp(C){let L=this._activeBuffer.y-this._activeBuffer.scrollTop;return L>=0?this._moveCursor(0,-Math.min(L,C.params[0]||1)):this._moveCursor(0,-(C.params[0]||1)),!0}cursorDown(C){let L=this._activeBuffer.scrollBottom-this._activeBuffer.y;return L>=0?this._moveCursor(0,Math.min(L,C.params[0]||1)):this._moveCursor(0,C.params[0]||1),!0}cursorForward(C){return this._moveCursor(C.params[0]||1,0),!0}cursorBackward(C){return this._moveCursor(-(C.params[0]||1),0),!0}cursorNextLine(C){return this.cursorDown(C),this._activeBuffer.x=0,!0}cursorPrecedingLine(C){return this.cursorUp(C),this._activeBuffer.x=0,!0}cursorCharAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(C){return this._setCursor(C.length>=2?(C.params[1]||1)-1:0,(C.params[0]||1)-1),!0}charPosAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(C){return this._moveCursor(C.params[0]||1,0),!0}linePosAbsolute(C){return this._setCursor(this._activeBuffer.x,(C.params[0]||1)-1),!0}vPositionRelative(C){return this._moveCursor(0,C.params[0]||1),!0}hVPosition(C){return this.cursorPosition(C),!0}tabClear(C){let L=C.params[0];return L===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:L===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let L=C.params[0]||1;for(;L--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let L=C.params[0]||1;for(;L--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(C){let L=C.params[0];return L===1&&(this._curAttrData.bg|=536870912),L!==2&&L!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(C,L,D,A=!1,N=!1){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);j.replaceCells(L,D,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),N),A&&(j.isWrapped=!1)}_resetBufferLine(C,L=!1){let D=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);D&&(D.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),L),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+C),D.isWrapped=!1)}eraseInDisplay(C,L=!1){let D;switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,L);D<this._bufferService.rows;D++)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(D);break;case 1:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D,0,this._activeBuffer.x+1,!0,L),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(D+1).isWrapped=!1);D--;)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(0);break;case 2:for(D=this._bufferService.rows,this._dirtyRowTracker.markDirty(D-1);D--;)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(0);break;case 3:let A=this._activeBuffer.lines.length-this._bufferService.rows;A>0&&(this._activeBuffer.lines.trimStart(A),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-A,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-A,0),this._onScroll.fire(0))}return!0}eraseInLine(C,L=!1){switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,L);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,L);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,L)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(C){this._restrictCursor();let L=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,A=this._bufferService.rows-1-this._activeBuffer.scrollBottom,N=this._bufferService.rows-1+this._activeBuffer.ybase-A+1;for(;L--;)this._activeBuffer.lines.splice(N-1,1),this._activeBuffer.lines.splice(D,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(C){this._restrictCursor();let L=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,A;for(A=this._bufferService.rows-1-this._activeBuffer.scrollBottom,A=this._bufferService.rows-1+this._activeBuffer.ybase-A;L--;)this._activeBuffer.lines.splice(D,1),this._activeBuffer.lines.splice(A,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.insertCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.deleteCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(C){let L=C.params[0]||1;for(;L--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(C){let L=C.params[0]||1;for(;L--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(e.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.deleteCells(0,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.insertCells(0,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.insertCells(this._activeBuffer.x,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.deleteCells(this._activeBuffer.x,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(C.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(C){if(!this._parser.precedingCodepoint)return!0;let L=C.params[0]||1,D=new Uint32Array(L);for(let A=0;A<L;++A)D[A]=this._parser.precedingCodepoint;return this.print(D,0,D.length),!0}sendDeviceAttributesPrimary(C){return C.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(C){return C.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(C.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(C){return(this._optionsService.rawOptions.termName+"").indexOf(C)===0}setMode(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,l.DEFAULT_CHARSET),this._charsetService.setgCharset(1,l.DEFAULT_CHARSET),this._charsetService.setgCharset(2,l.DEFAULT_CHARSET),this._charsetService.setgCharset(3,l.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),C.params[L]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(C,L){let D=this._coreService.decPrivateModes,{activeProtocol:A,activeEncoding:N}=this._coreMouseService,j=this._coreService,{buffers:K,cols:z}=this._bufferService,{active:Y,alt:b}=K,M=this._optionsService.rawOptions,H=G=>G?1:2,I=C.params[0];return q=I,$=L?I===2?4:I===4?H(j.modes.insertMode):I===12?3:I===20?H(M.convertEol):0:I===1?H(D.applicationCursorKeys):I===3?M.windowOptions.setWinLines?z===80?2:z===132?1:0:0:I===6?H(D.origin):I===7?H(D.wraparound):I===8?3:I===9?H(A==="X10"):I===12?H(M.cursorBlink):I===25?H(!j.isCursorHidden):I===45?H(D.reverseWraparound):I===66?H(D.applicationKeypad):I===67?4:I===1e3?H(A==="VT200"):I===1002?H(A==="DRAG"):I===1003?H(A==="ANY"):I===1004?H(D.sendFocus):I===1005?4:I===1006?H(N==="SGR"):I===1015?4:I===1016?H(N==="SGR_PIXELS"):I===1048?1:I===47||I===1047||I===1049?H(Y===b):I===2004?H(D.bracketedPasteMode):0,j.triggerDataEvent(`${n.C0.ESC}[${L?"":"?"}${q};${$}$y`),!0;var q,$}_updateAttrColor(C,L,D,A,N){return L===2?(C|=50331648,C&=-16777216,C|=c.AttributeData.fromColorRGB([D,A,N])):L===5&&(C&=-50331904,C|=33554432|255&D),C}_extractColor(C,L,D){let A=[0,0,-1,0,0,0],N=0,j=0;do{if(A[j+N]=C.params[L+j],C.hasSubParams(L+j)){let K=C.getSubParams(L+j),z=0;do A[1]===5&&(N=1),A[j+z+1+N]=K[z];while(++z<K.length&&z+j+1+N<A.length);break}if(A[1]===5&&j+N>=2||A[1]===2&&j+N>=5)break;A[1]&&(N=1)}while(++j+L<C.length&&j+N<A.length);for(let K=2;K<A.length;++K)A[K]===-1&&(A[K]=0);switch(A[0]){case 38:D.fg=this._updateAttrColor(D.fg,A[1],A[3],A[4],A[5]);break;case 48:D.bg=this._updateAttrColor(D.bg,A[1],A[3],A[4],A[5]);break;case 58:D.extended=D.extended.clone(),D.extended.underlineColor=this._updateAttrColor(D.extended.underlineColor,A[1],A[3],A[4],A[5])}return j}_processUnderline(C,L){L.extended=L.extended.clone(),(!~C||C>5)&&(C=1),L.extended.underlineStyle=C,L.fg|=268435456,C===0&&(L.fg&=-268435457),L.updateExtended()}_processSGR0(C){C.fg=e.DEFAULT_ATTR_DATA.fg,C.bg=e.DEFAULT_ATTR_DATA.bg,C.extended=C.extended.clone(),C.extended.underlineStyle=0,C.extended.underlineColor&=-67108864,C.updateExtended()}charAttributes(C){if(C.length===1&&C.params[0]===0)return this._processSGR0(this._curAttrData),!0;let L=C.length,D,A=this._curAttrData;for(let N=0;N<L;N++)D=C.params[N],D>=30&&D<=37?(A.fg&=-50331904,A.fg|=16777216|D-30):D>=40&&D<=47?(A.bg&=-50331904,A.bg|=16777216|D-40):D>=90&&D<=97?(A.fg&=-50331904,A.fg|=16777224|D-90):D>=100&&D<=107?(A.bg&=-50331904,A.bg|=16777224|D-100):D===0?this._processSGR0(A):D===1?A.fg|=134217728:D===3?A.bg|=67108864:D===4?(A.fg|=268435456,this._processUnderline(C.hasSubParams(N)?C.getSubParams(N)[0]:1,A)):D===5?A.fg|=536870912:D===7?A.fg|=67108864:D===8?A.fg|=1073741824:D===9?A.fg|=2147483648:D===2?A.bg|=134217728:D===21?this._processUnderline(2,A):D===22?(A.fg&=-134217729,A.bg&=-134217729):D===23?A.bg&=-67108865:D===24?(A.fg&=-268435457,this._processUnderline(0,A)):D===25?A.fg&=-536870913:D===27?A.fg&=-67108865:D===28?A.fg&=-1073741825:D===29?A.fg&=2147483647:D===39?(A.fg&=-67108864,A.fg|=16777215&e.DEFAULT_ATTR_DATA.fg):D===49?(A.bg&=-67108864,A.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):D===38||D===48||D===58?N+=this._extractColor(C,N,A):D===53?A.bg|=1073741824:D===55?A.bg&=-1073741825:D===59?(A.extended=A.extended.clone(),A.extended.underlineColor=-1,A.updateExtended()):D===100?(A.fg&=-67108864,A.fg|=16777215&e.DEFAULT_ATTR_DATA.fg,A.bg&=-67108864,A.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",D);return!0}deviceStatus(C){switch(C.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:let L=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${L};${D}R`)}return!0}deviceStatusPrivate(C){if(C.params[0]===6){let L=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${L};${D}R`)}return!0}softReset(C){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(C){let L=C.params[0]||1;switch(L){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let D=L%2==1;return this._optionsService.options.cursorBlink=D,!0}setScrollRegion(C){let L=C.params[0]||1,D;return(C.length<2||(D=C.params[1])>this._bufferService.rows||D===0)&&(D=this._bufferService.rows),D>L&&(this._activeBuffer.scrollTop=L-1,this._activeBuffer.scrollBottom=D-1,this._setCursor(0,0)),!0}windowOptions(C){if(!T(C.params[0],this._optionsService.rawOptions.windowOptions))return!0;let L=C.length>1?C.params[1]:0;switch(C.params[0]){case 14:L!==2&&this._onRequestWindowsOptionsReport.fire(x.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(x.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:L!==0&&L!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),L!==0&&L!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:L!==0&&L!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),L!==0&&L!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(C){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(C){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(C){return this._windowTitle=C,this._onTitleChange.fire(C),!0}setIconName(C){return this._iconName=C,!0}setOrReportIndexedColor(C){let L=[],D=C.split(";");for(;D.length>1;){let A=D.shift(),N=D.shift();if(/^\d+$/.exec(A)){let j=parseInt(A);if(W(j))if(N==="?")L.push({type:0,index:j});else{let K=(0,d.parseColor)(N);K&&L.push({type:1,index:j,color:K})}}}return L.length&&this._onColor.fire(L),!0}setHyperlink(C){let L=C.split(";");return!(L.length<2)&&(L[1]?this._createHyperlink(L[0],L[1]):!L[0]&&this._finishHyperlink())}_createHyperlink(C,L){this._getCurrentLinkId()&&this._finishHyperlink();let D=C.split(":"),A,N=D.findIndex(j=>j.startsWith("id="));return N!==-1&&(A=D[N].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:A,uri:L}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(C,L){let D=C.split(";");for(let A=0;A<D.length&&!(L>=this._specialColors.length);++A,++L)if(D[A]==="?")this._onColor.fire([{type:0,index:this._specialColors[L]}]);else{let N=(0,d.parseColor)(D[A]);N&&this._onColor.fire([{type:1,index:this._specialColors[L],color:N}])}return!0}setOrReportFgColor(C){return this._setOrReportSpecialColor(C,0)}setOrReportBgColor(C){return this._setOrReportSpecialColor(C,1)}setOrReportCursorColor(C){return this._setOrReportSpecialColor(C,2)}restoreIndexedColor(C){if(!C)return this._onColor.fire([{type:2}]),!0;let L=[],D=C.split(";");for(let A=0;A<D.length;++A)if(/^\d+$/.exec(D[A])){let N=parseInt(D[A]);W(N)&&L.push({type:2,index:N})}return L.length&&this._onColor.fire(L),!0}restoreFgColor(C){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(C){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(C){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,l.DEFAULT_CHARSET),!0}selectCharset(C){return C.length!==2?(this.selectDefaultCharset(),!0):(C[0]==="/"||this._charsetService.setgCharset(g[C[0]],l.CHARSETS[C[1]]||l.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let C=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,C,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(C){return this._charsetService.setgLevel(C),!0}screenAlignmentPattern(){let C=new i.CellData;C.content=4194373,C.fg=this._curAttrData.fg,C.bg=this._curAttrData.bg,this._setCursor(0,0);for(let L=0;L<this._bufferService.rows;++L){let D=this._activeBuffer.ybase+this._activeBuffer.y+L,A=this._activeBuffer.lines.get(D);A&&(A.fill(C),A.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(C,L){let D=this._bufferService.buffer,A=this._optionsService.rawOptions;return(N=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${N}${n.C0.ESC}\\`),!0))(C==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:C==='"p'?'P1$r61;1"p':C==="r"?`P1$r${D.scrollTop+1};${D.scrollBottom+1}r`:C==="m"?"P1$r0m":C===" q"?`P1$r${{block:2,underline:4,bar:6}[A.cursorStyle]-(A.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(C,L){this._dirtyRowTracker.markRangeDirty(C,L)}}r.InputHandler=P;let O=class{constructor(F){this._bufferService=F,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(F){F<this.start?this.start=F:F>this.end&&(this.end=F)}markRangeDirty(F,C){F>C&&(R=F,F=C,C=R),F<this.start&&(this.start=F),C>this.end&&(this.end=C)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function W(F){return 0<=F&&F<256}O=o([u(0,f.IBufferService)],O)},844:(E,r)=>{function a(o){for(let u of o)u.dispose();o.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let o of this._disposables)o.dispose();this._disposables.length=0}register(o){return this._disposables.push(o),o}unregister(o){let u=this._disposables.indexOf(o);u!==-1&&this._disposables.splice(u,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(o){var u;this._isDisposed||o===this._value||((u=this._value)===null||u===void 0||u.dispose(),this._value=o)}clear(){this.value=void 0}dispose(){var o;this._isDisposed=!0,(o=this._value)===null||o===void 0||o.dispose(),this._value=void 0}},r.toDisposable=function(o){return{dispose:o}},r.disposeArray=a,r.getDisposeArrayDisposable=function(o){return{dispose:()=>a(o)}}},1505:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FourKeyMap=r.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(u,n,l){this._data[u]||(this._data[u]={}),this._data[u][n]=l}get(u,n){return this._data[u]?this._data[u][n]:void 0}clear(){this._data={}}}r.TwoKeyMap=a,r.FourKeyMap=class{constructor(){this._data=new a}set(o,u,n,l,_){this._data.get(o,u)||this._data.set(o,u,new a),this._data.get(o,u).set(n,l,_)}get(o,u,n,l){var _;return(_=this._data.get(o,u))===null||_===void 0?void 0:_.get(n,l)}clear(){this._data.clear()}}},6114:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isChromeOS=r.isLinux=r.isWindows=r.isIphone=r.isIpad=r.isMac=r.getSafariVersion=r.isSafari=r.isLegacyEdge=r.isFirefox=r.isNode=void 0,r.isNode=typeof navigator>"u";let a=r.isNode?"node":navigator.userAgent,o=r.isNode?"node":navigator.platform;r.isFirefox=a.includes("Firefox"),r.isLegacyEdge=a.includes("Edge"),r.isSafari=/^((?!chrome|android).)*safari/i.test(a),r.getSafariVersion=function(){if(!r.isSafari)return 0;let u=a.match(/Version\/(\d+)/);return u===null||u.length<2?0:parseInt(u[1])},r.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(o),r.isIpad=o==="iPad",r.isIphone=o==="iPhone",r.isWindows=["Windows","Win16","Win32","WinCE"].includes(o),r.isLinux=o.indexOf("Linux")>=0,r.isChromeOS=/\bCrOS\b/.test(a)},6106:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SortedList=void 0;let a=0;r.SortedList=class{constructor(o){this._getKey=o,this._array=[]}clear(){this._array.length=0}insert(o){this._array.length!==0?(a=this._search(this._getKey(o)),this._array.splice(a,0,o)):this._array.push(o)}delete(o){if(this._array.length===0)return!1;let u=this._getKey(o);if(u===void 0||(a=this._search(u),a===-1)||this._getKey(this._array[a])!==u)return!1;do if(this._array[a]===o)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===u);return!1}*getKeyIterator(o){if(this._array.length!==0&&(a=this._search(o),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===o))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===o)}forEachByKey(o,u){if(this._array.length!==0&&(a=this._search(o),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===o))do u(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===o)}values(){return[...this._array].values()}_search(o){let u=0,n=this._array.length-1;for(;n>=u;){let l=u+n>>1,_=this._getKey(this._array[l]);if(_>o)n=l-1;else{if(!(_<o)){for(;l>0&&this._getKey(this._array[l-1])===o;)l--;return l}u=l+1}}return u}}},7226:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DebouncedIdleTask=r.IdleTaskQueue=r.PriorityTaskQueue=void 0;let o=a(6114);class u{constructor(){this._tasks=[],this._i=0}enqueue(_){this._tasks.push(_),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(_){this._idleCallback=void 0;let v=0,h=0,e=_.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(v=Date.now(),this._tasks[this._i]()||this._i++,v=Math.max(1,Date.now()-v),h=Math.max(v,h),s=_.timeRemaining(),1.5*h>s)return e-v<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-v))}ms`),void this._start();e=s}this.clear()}}class n extends u{_requestCallback(_){return setTimeout(()=>_(this._createDeadline(16)))}_cancelCallback(_){clearTimeout(_)}_createDeadline(_){let v=Date.now()+_;return{timeRemaining:()=>Math.max(0,v-Date.now())}}}r.PriorityTaskQueue=n,r.IdleTaskQueue=!o.isNode&&"requestIdleCallback"in window?class extends u{_requestCallback(l){return requestIdleCallback(l)}_cancelCallback(l){cancelIdleCallback(l)}}:n,r.DebouncedIdleTask=class{constructor(){this._queue=new r.IdleTaskQueue}set(l){this._queue.clear(),this._queue.enqueue(l)}flush(){this._queue.flush()}}},9282:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.updateWindowsModeWrappedState=void 0;let o=a(643);r.updateWindowsModeWrappedState=function(u){let n=u.buffer.lines.get(u.buffer.ybase+u.buffer.y-1),l=n?.get(u.cols-1),_=u.buffer.lines.get(u.buffer.ybase+u.buffer.y);_&&l&&(_.isWrapped=l[o.CHAR_DATA_CODE_INDEX]!==o.NULL_CELL_CODE&&l[o.CHAR_DATA_CODE_INDEX]!==o.WHITESPACE_CELL_CODE)}},3734:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ExtendedAttrs=r.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new o}static toColorRGB(n){return[n>>>16&255,n>>>8&255,255&n]}static fromColorRGB(n){return(255&n[0])<<16|(255&n[1])<<8|255&n[2]}clone(){let n=new a;return n.fg=this.fg,n.bg=this.bg,n.extended=this.extended.clone(),n}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}r.AttributeData=a;class o{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(n){this._ext=n}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(n){this._ext&=-469762049,this._ext|=n<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(n){this._ext&=-67108864,this._ext|=67108863&n}get urlId(){return this._urlId}set urlId(n){this._urlId=n}constructor(n=0,l=0){this._ext=0,this._urlId=0,this._ext=n,this._urlId=l}clone(){return new o(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}r.ExtendedAttrs=o},9092:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Buffer=r.MAX_BUFFER_SIZE=void 0;let o=a(6349),u=a(7226),n=a(3734),l=a(8437),_=a(4634),v=a(511),h=a(643),e=a(4863),s=a(7116);r.MAX_BUFFER_SIZE=4294967295,r.Buffer=class{constructor(t,i,c){this._hasScrollback=t,this._optionsService=i,this._bufferService=c,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=l.DEFAULT_ATTR_DATA.clone(),this.savedCharset=s.DEFAULT_CHARSET,this.markers=[],this._nullCell=v.CellData.fromCharData([0,h.NULL_CELL_CHAR,h.NULL_CELL_WIDTH,h.NULL_CELL_CODE]),this._whitespaceCell=v.CellData.fromCharData([0,h.WHITESPACE_CELL_CHAR,h.WHITESPACE_CELL_WIDTH,h.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new u.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg,this._nullCell.extended=t.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg,this._whitespaceCell.extended=t.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(t,i){return new l.BufferLine(this._bufferService.cols,this.getNullCell(t),i)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows}_getCorrectBufferLength(t){if(!this._hasScrollback)return t;let i=t+this._optionsService.rawOptions.scrollback;return i>r.MAX_BUFFER_SIZE?r.MAX_BUFFER_SIZE:i}fillViewportRows(t){if(this.lines.length===0){t===void 0&&(t=l.DEFAULT_ATTR_DATA);let i=this._rows;for(;i--;)this.lines.push(this.getBlankLine(t))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(t,i){let c=this.getNullCell(l.DEFAULT_ATTR_DATA),f=0,p=this._getCorrectBufferLength(i);if(p>this.lines.maxLength&&(this.lines.maxLength=p),this.lines.length>0){if(this._cols<t)for(let d=0;d<this.lines.length;d++)f+=+this.lines.get(d).resize(t,c);let S=0;if(this._rows<i)for(let d=this._rows;d<i;d++)this.lines.length<i+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new l.BufferLine(t,c)):this.ybase>0&&this.lines.length<=this.ybase+this.y+S+1?(this.ybase--,S++,this.ydisp>0&&this.ydisp--):this.lines.push(new l.BufferLine(t,c)));else for(let d=this._rows;d>i;d--)this.lines.length>i+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(p<this.lines.maxLength){let d=this.lines.length-p;d>0&&(this.lines.trimStart(d),this.ybase=Math.max(this.ybase-d,0),this.ydisp=Math.max(this.ydisp-d,0),this.savedY=Math.max(this.savedY-d,0)),this.lines.maxLength=p}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,i-1),S&&(this.y+=S),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=i-1,this._isReflowEnabled&&(this._reflow(t,i),this._cols>t))for(let S=0;S<this.lines.length;S++)f+=+this.lines.get(S).resize(t,c);this._cols=t,this._rows=i,this._memoryCleanupQueue.clear(),f>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let t=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,t=!1);let i=0;for(;this._memoryCleanupPosition<this.lines.length;)if(i+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),i>100)return!0;return t}get _isReflowEnabled(){let t=this._optionsService.rawOptions.windowsPty;return t&&t.buildNumber?this._hasScrollback&&t.backend==="conpty"&&t.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(t,i){this._cols!==t&&(t>this._cols?this._reflowLarger(t,i):this._reflowSmaller(t,i))}_reflowLarger(t,i){let c=(0,_.reflowLargerGetLinesToRemove)(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(l.DEFAULT_ATTR_DATA));if(c.length>0){let f=(0,_.reflowLargerCreateNewLayout)(this.lines,c);(0,_.reflowLargerApplyNewLayout)(this.lines,f.layout),this._reflowLargerAdjustViewport(t,i,f.countRemoved)}}_reflowLargerAdjustViewport(t,i,c){let f=this.getNullCell(l.DEFAULT_ATTR_DATA),p=c;for(;p-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<i&&this.lines.push(new l.BufferLine(t,f))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-c,0)}_reflowSmaller(t,i){let c=this.getNullCell(l.DEFAULT_ATTR_DATA),f=[],p=0;for(let S=this.lines.length-1;S>=0;S--){let d=this.lines.get(S);if(!d||!d.isWrapped&&d.getTrimmedLength()<=t)continue;let g=[d];for(;d.isWrapped&&S>0;)d=this.lines.get(--S),g.unshift(d);let k=this.ybase+this.y;if(k>=S&&k<S+g.length)continue;let T=g[g.length-1].getTrimmedLength(),x=(0,_.reflowSmallerGetNewLineLengths)(g,this._cols,t),R=x.length-g.length,P;P=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+R):Math.max(0,this.lines.length-this.lines.maxLength+R);let O=[];for(let A=0;A<R;A++){let N=this.getBlankLine(l.DEFAULT_ATTR_DATA,!0);O.push(N)}O.length>0&&(f.push({start:S+g.length+p,newLines:O}),p+=O.length),g.push(...O);let W=x.length-1,F=x[W];F===0&&(W--,F=x[W]);let C=g.length-R-1,L=T;for(;C>=0;){let A=Math.min(L,F);if(g[W]===void 0)break;if(g[W].copyCellsFrom(g[C],L-A,F-A,A,!0),F-=A,F===0&&(W--,F=x[W]),L-=A,L===0){C--;let N=Math.max(C,0);L=(0,_.getWrappedLineTrimmedLength)(g,N,this._cols)}}for(let A=0;A<g.length;A++)x[A]<t&&g[A].setCell(x[A],c);let D=R-P;for(;D-- >0;)this.ybase===0?this.y<i-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+p)-i&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+R,this.ybase+i-1)}if(f.length>0){let S=[],d=[];for(let W=0;W<this.lines.length;W++)d.push(this.lines.get(W));let g=this.lines.length,k=g-1,T=0,x=f[T];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+p);let R=0;for(let W=Math.min(this.lines.maxLength-1,g+p-1);W>=0;W--)if(x&&x.start>k+R){for(let F=x.newLines.length-1;F>=0;F--)this.lines.set(W--,x.newLines[F]);W++,S.push({index:k+1,amount:x.newLines.length}),R+=x.newLines.length,x=f[++T]}else this.lines.set(W,d[k--]);let P=0;for(let W=S.length-1;W>=0;W--)S[W].index+=P,this.lines.onInsertEmitter.fire(S[W]),P+=S[W].amount;let O=Math.max(0,g+p-this.lines.maxLength);O>0&&this.lines.onTrimEmitter.fire(O)}}translateBufferLineToString(t,i,c=0,f){let p=this.lines.get(t);return p?p.translateToString(i,c,f):""}getWrappedRangeForLine(t){let i=t,c=t;for(;i>0&&this.lines.get(i).isWrapped;)i--;for(;c+1<this.lines.length&&this.lines.get(c+1).isWrapped;)c++;return{first:i,last:c}}setupTabStops(t){for(t!=null?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.rawOptions.tabStopWidth)this.tabs[t]=!0}prevStop(t){for(t==null&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t}nextStop(t){for(t==null&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t}clearMarkers(t){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].line===t&&(this.markers[i].dispose(),this.markers.splice(i--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].dispose(),this.markers.splice(t--,1);this._isClearing=!1}addMarker(t){let i=new e.Marker(t);return this.markers.push(i),i.register(this.lines.onTrim(c=>{i.line-=c,i.line<0&&i.dispose()})),i.register(this.lines.onInsert(c=>{i.line>=c.index&&(i.line+=c.amount)})),i.register(this.lines.onDelete(c=>{i.line>=c.index&&i.line<c.index+c.amount&&i.dispose(),i.line>c.index&&(i.line-=c.amount)})),i.register(i.onDispose(()=>this._removeMarker(i))),i}_removeMarker(t){this._isClearing||this.markers.splice(this.markers.indexOf(t),1)}}},8437:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLine=r.DEFAULT_ATTR_DATA=void 0;let o=a(3734),u=a(511),n=a(643),l=a(482);r.DEFAULT_ATTR_DATA=Object.freeze(new o.AttributeData);let _=0;class v{constructor(e,s,t=!1){this.isWrapped=t,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);let i=s||u.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let c=0;c<e;++c)this.setCell(c,i);this.length=e}get(e){let s=this._data[3*e+0],t=2097151&s;return[this._data[3*e+1],2097152&s?this._combined[e]:t?(0,l.stringFromCodePoint)(t):"",s>>22,2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):t]}set(e,s){this._data[3*e+1]=s[n.CHAR_DATA_ATTR_INDEX],s[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=s[1],this._data[3*e+0]=2097152|e|s[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=s[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|s[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){let s=this._data[3*e+0];return 2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&s}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){let s=this._data[3*e+0];return 2097152&s?this._combined[e]:2097151&s?(0,l.stringFromCodePoint)(2097151&s):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,s){return _=3*e,s.content=this._data[_+0],s.fg=this._data[_+1],s.bg=this._data[_+2],2097152&s.content&&(s.combinedData=this._combined[e]),268435456&s.bg&&(s.extended=this._extendedAttrs[e]),s}setCell(e,s){2097152&s.content&&(this._combined[e]=s.combinedData),268435456&s.bg&&(this._extendedAttrs[e]=s.extended),this._data[3*e+0]=s.content,this._data[3*e+1]=s.fg,this._data[3*e+2]=s.bg}setCellFromCodePoint(e,s,t,i,c,f){268435456&c&&(this._extendedAttrs[e]=f),this._data[3*e+0]=s|t<<22,this._data[3*e+1]=i,this._data[3*e+2]=c}addCodepointToCell(e,s){let t=this._data[3*e+0];2097152&t?this._combined[e]+=(0,l.stringFromCodePoint)(s):(2097151&t?(this._combined[e]=(0,l.stringFromCodePoint)(2097151&t)+(0,l.stringFromCodePoint)(s),t&=-2097152,t|=2097152):t=s|4194304,this._data[3*e+0]=t)}insertCells(e,s,t,i){if((e%=this.length)&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),s<this.length-e){let c=new u.CellData;for(let f=this.length-e-s-1;f>=0;--f)this.setCell(e+s+f,this.loadCell(e+f,c));for(let f=0;f<s;++f)this.setCell(e+f,t)}else for(let c=e;c<this.length;++c)this.setCell(c,t);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs)}deleteCells(e,s,t,i){if(e%=this.length,s<this.length-e){let c=new u.CellData;for(let f=0;f<this.length-e-s;++f)this.setCell(e+f,this.loadCell(e+s+f,c));for(let f=this.length-s;f<this.length;++f)this.setCell(f,t)}else for(let c=e;c<this.length;++c)this.setCell(c,t);e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),this.getWidth(e)!==0||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs)}replaceCells(e,s,t,i,c=!1){if(c)for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs);e<s&&e<this.length;)this.isProtected(e)||this.setCell(e,t),e++;else for(e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs);e<s&&e<this.length;)this.setCell(e++,t)}resize(e,s){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let t=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*t)this._data=new Uint32Array(this._data.buffer,0,t);else{let i=new Uint32Array(t);i.set(this._data),this._data=i}for(let i=this.length;i<e;++i)this.setCell(i,s)}else{this._data=this._data.subarray(0,t);let i=Object.keys(this._combined);for(let f=0;f<i.length;f++){let p=parseInt(i[f],10);p>=e&&delete this._combined[p]}let c=Object.keys(this._extendedAttrs);for(let f=0;f<c.length;f++){let p=parseInt(c[f],10);p>=e&&delete this._extendedAttrs[p]}}return this.length=e,4*t*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,s=!1){if(s)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(let s in e._combined)this._combined[s]=e._combined[s];this._extendedAttrs={};for(let s in e._extendedAttrs)this._extendedAttrs[s]=e._extendedAttrs[s];this.isWrapped=e.isWrapped}clone(){let e=new v(0);e._data=new Uint32Array(this._data),e.length=this.length;for(let s in this._combined)e._combined[s]=this._combined[s];for(let s in this._extendedAttrs)e._extendedAttrs[s]=this._extendedAttrs[s];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,s,t,i,c){let f=e._data;if(c)for(let S=i-1;S>=0;S--){for(let d=0;d<3;d++)this._data[3*(t+S)+d]=f[3*(s+S)+d];268435456&f[3*(s+S)+2]&&(this._extendedAttrs[t+S]=e._extendedAttrs[s+S])}else for(let S=0;S<i;S++){for(let d=0;d<3;d++)this._data[3*(t+S)+d]=f[3*(s+S)+d];268435456&f[3*(s+S)+2]&&(this._extendedAttrs[t+S]=e._extendedAttrs[s+S])}let p=Object.keys(e._combined);for(let S=0;S<p.length;S++){let d=parseInt(p[S],10);d>=s&&(this._combined[d-s+t]=e._combined[d])}}translateToString(e=!1,s=0,t=this.length){e&&(t=Math.min(t,this.getTrimmedLength()));let i="";for(;s<t;){let c=this._data[3*s+0],f=2097151&c;i+=2097152&c?this._combined[s]:f?(0,l.stringFromCodePoint)(f):n.WHITESPACE_CELL_CHAR,s+=c>>22||1}return i}}r.BufferLine=v},4841:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getRangeLength=void 0,r.getRangeLength=function(a,o){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return o*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(E,r)=>{function a(o,u,n){if(u===o.length-1)return o[u].getTrimmedLength();let l=!o[u].hasContent(n-1)&&o[u].getWidth(n-1)===1,_=o[u+1].getWidth(0)===2;return l&&_?n-1:n}Object.defineProperty(r,"__esModule",{value:!0}),r.getWrappedLineTrimmedLength=r.reflowSmallerGetNewLineLengths=r.reflowLargerApplyNewLayout=r.reflowLargerCreateNewLayout=r.reflowLargerGetLinesToRemove=void 0,r.reflowLargerGetLinesToRemove=function(o,u,n,l,_){let v=[];for(let h=0;h<o.length-1;h++){let e=h,s=o.get(++e);if(!s.isWrapped)continue;let t=[o.get(h)];for(;e<o.length&&s.isWrapped;)t.push(s),s=o.get(++e);if(l>=h&&l<e){h+=t.length-1;continue}let i=0,c=a(t,i,u),f=1,p=0;for(;f<t.length;){let d=a(t,f,u),g=d-p,k=n-c,T=Math.min(g,k);t[i].copyCellsFrom(t[f],p,c,T,!1),c+=T,c===n&&(i++,c=0),p+=T,p===d&&(f++,p=0),c===0&&i!==0&&t[i-1].getWidth(n-1)===2&&(t[i].copyCellsFrom(t[i-1],n-1,c++,1,!1),t[i-1].setCell(n-1,_))}t[i].replaceCells(c,n,_);let S=0;for(let d=t.length-1;d>0&&(d>i||t[d].getTrimmedLength()===0);d--)S++;S>0&&(v.push(h+t.length-S),v.push(S)),h+=t.length-1}return v},r.reflowLargerCreateNewLayout=function(o,u){let n=[],l=0,_=u[l],v=0;for(let h=0;h<o.length;h++)if(_===h){let e=u[++l];o.onDeleteEmitter.fire({index:h-v,amount:e}),h+=e-1,v+=e,_=u[++l]}else n.push(h);return{layout:n,countRemoved:v}},r.reflowLargerApplyNewLayout=function(o,u){let n=[];for(let l=0;l<u.length;l++)n.push(o.get(u[l]));for(let l=0;l<n.length;l++)o.set(l,n[l]);o.length=u.length},r.reflowSmallerGetNewLineLengths=function(o,u,n){let l=[],_=o.map((s,t)=>a(o,t,u)).reduce((s,t)=>s+t),v=0,h=0,e=0;for(;e<_;){if(_-e<n){l.push(_-e);break}v+=n;let s=a(o,h,u);v>s&&(v-=s,h++);let t=o[h].getWidth(v-1)===2;t&&v--;let i=t?n-1:n;l.push(i),e+=i}return l},r.getWrappedLineTrimmedLength=a},5295:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferSet=void 0;let o=a(8460),u=a(844),n=a(9092);class l extends u.Disposable{constructor(v,h){super(),this._optionsService=v,this._bufferService=h,this._onBufferActivate=this.register(new o.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(v){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(v),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(v,h){this._normal.resize(v,h),this._alt.resize(v,h),this.setupTabStops(v)}setupTabStops(v){this._normal.setupTabStops(v),this._alt.setupTabStops(v)}}r.BufferSet=l},511:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CellData=void 0;let o=a(482),u=a(643),n=a(3734);class l extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(v){let h=new l;return h.setFromCharData(v),h}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,o.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(v){this.fg=v[u.CHAR_DATA_ATTR_INDEX],this.bg=0;let h=!1;if(v[u.CHAR_DATA_CHAR_INDEX].length>2)h=!0;else if(v[u.CHAR_DATA_CHAR_INDEX].length===2){let e=v[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){let s=v[u.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(e-55296)+s-56320+65536|v[u.CHAR_DATA_WIDTH_INDEX]<<22:h=!0}else h=!0}else this.content=v[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[u.CHAR_DATA_WIDTH_INDEX]<<22;h&&(this.combinedData=v[u.CHAR_DATA_CHAR_INDEX],this.content=2097152|v[u.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.CellData=l},643:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WHITESPACE_CELL_CODE=r.WHITESPACE_CELL_WIDTH=r.WHITESPACE_CELL_CHAR=r.NULL_CELL_CODE=r.NULL_CELL_WIDTH=r.NULL_CELL_CHAR=r.CHAR_DATA_CODE_INDEX=r.CHAR_DATA_WIDTH_INDEX=r.CHAR_DATA_CHAR_INDEX=r.CHAR_DATA_ATTR_INDEX=r.DEFAULT_EXT=r.DEFAULT_ATTR=r.DEFAULT_COLOR=void 0,r.DEFAULT_COLOR=0,r.DEFAULT_ATTR=256|r.DEFAULT_COLOR<<9,r.DEFAULT_EXT=0,r.CHAR_DATA_ATTR_INDEX=0,r.CHAR_DATA_CHAR_INDEX=1,r.CHAR_DATA_WIDTH_INDEX=2,r.CHAR_DATA_CODE_INDEX=3,r.NULL_CELL_CHAR="",r.NULL_CELL_WIDTH=1,r.NULL_CELL_CODE=0,r.WHITESPACE_CELL_CHAR=" ",r.WHITESPACE_CELL_WIDTH=1,r.WHITESPACE_CELL_CODE=32},4863:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Marker=void 0;let o=a(8460),u=a(844);class n{get id(){return this._id}constructor(_){this.line=_,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new o.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,u.disposeArray)(this._disposables),this._disposables.length=0)}register(_){return this._disposables.push(_),_}}r.Marker=n,n._nextId=1},7116:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CHARSET=r.CHARSETS=void 0,r.CHARSETS={},r.DEFAULT_CHARSET=r.CHARSETS.B,r.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},r.CHARSETS.A={"#":"\xA3"},r.CHARSETS.B=void 0,r.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},r.CHARSETS.C=r.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},r.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},r.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},r.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},r.CHARSETS.E=r.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},r.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},r.CHARSETS.H=r.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(E,r)=>{var a,o,u;Object.defineProperty(r,"__esModule",{value:!0}),r.C1_ESCAPED=r.C1=r.C0=void 0,function(n){n.NUL="\0",n.SOH="",n.STX="",n.ETX="",n.EOT="",n.ENQ="",n.ACK="",n.BEL="\x07",n.BS="\b",n.HT="	",n.LF=`
`,n.VT="\v",n.FF="\f",n.CR="\r",n.SO="",n.SI="",n.DLE="",n.DC1="",n.DC2="",n.DC3="",n.DC4="",n.NAK="",n.SYN="",n.ETB="",n.CAN="",n.EM="",n.SUB="",n.ESC="\x1B",n.FS="",n.GS="",n.RS="",n.US="",n.SP=" ",n.DEL="\x7F"}(a||(r.C0=a={})),function(n){n.PAD="\x80",n.HOP="\x81",n.BPH="\x82",n.NBH="\x83",n.IND="\x84",n.NEL="\x85",n.SSA="\x86",n.ESA="\x87",n.HTS="\x88",n.HTJ="\x89",n.VTS="\x8A",n.PLD="\x8B",n.PLU="\x8C",n.RI="\x8D",n.SS2="\x8E",n.SS3="\x8F",n.DCS="\x90",n.PU1="\x91",n.PU2="\x92",n.STS="\x93",n.CCH="\x94",n.MW="\x95",n.SPA="\x96",n.EPA="\x97",n.SOS="\x98",n.SGCI="\x99",n.SCI="\x9A",n.CSI="\x9B",n.ST="\x9C",n.OSC="\x9D",n.PM="\x9E",n.APC="\x9F"}(o||(r.C1=o={})),function(n){n.ST=`${a.ESC}\\`}(u||(r.C1_ESCAPED=u={}))},7399:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.evaluateKeyboardEvent=void 0;let o=a(2584),u={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};r.evaluateKeyboardEvent=function(n,l,_,v){let h={type:0,cancel:!1,key:void 0},e=(n.shiftKey?1:0)|(n.altKey?2:0)|(n.ctrlKey?4:0)|(n.metaKey?8:0);switch(n.keyCode){case 0:n.key==="UIKeyInputUpArrow"?h.key=l?o.C0.ESC+"OA":o.C0.ESC+"[A":n.key==="UIKeyInputLeftArrow"?h.key=l?o.C0.ESC+"OD":o.C0.ESC+"[D":n.key==="UIKeyInputRightArrow"?h.key=l?o.C0.ESC+"OC":o.C0.ESC+"[C":n.key==="UIKeyInputDownArrow"&&(h.key=l?o.C0.ESC+"OB":o.C0.ESC+"[B");break;case 8:if(n.altKey){h.key=o.C0.ESC+o.C0.DEL;break}h.key=o.C0.DEL;break;case 9:if(n.shiftKey){h.key=o.C0.ESC+"[Z";break}h.key=o.C0.HT,h.cancel=!0;break;case 13:h.key=n.altKey?o.C0.ESC+o.C0.CR:o.C0.CR,h.cancel=!0;break;case 27:h.key=o.C0.ESC,n.altKey&&(h.key=o.C0.ESC+o.C0.ESC),h.cancel=!0;break;case 37:if(n.metaKey)break;e?(h.key=o.C0.ESC+"[1;"+(e+1)+"D",h.key===o.C0.ESC+"[1;3D"&&(h.key=o.C0.ESC+(_?"b":"[1;5D"))):h.key=l?o.C0.ESC+"OD":o.C0.ESC+"[D";break;case 39:if(n.metaKey)break;e?(h.key=o.C0.ESC+"[1;"+(e+1)+"C",h.key===o.C0.ESC+"[1;3C"&&(h.key=o.C0.ESC+(_?"f":"[1;5C"))):h.key=l?o.C0.ESC+"OC":o.C0.ESC+"[C";break;case 38:if(n.metaKey)break;e?(h.key=o.C0.ESC+"[1;"+(e+1)+"A",_||h.key!==o.C0.ESC+"[1;3A"||(h.key=o.C0.ESC+"[1;5A")):h.key=l?o.C0.ESC+"OA":o.C0.ESC+"[A";break;case 40:if(n.metaKey)break;e?(h.key=o.C0.ESC+"[1;"+(e+1)+"B",_||h.key!==o.C0.ESC+"[1;3B"||(h.key=o.C0.ESC+"[1;5B")):h.key=l?o.C0.ESC+"OB":o.C0.ESC+"[B";break;case 45:n.shiftKey||n.ctrlKey||(h.key=o.C0.ESC+"[2~");break;case 46:h.key=e?o.C0.ESC+"[3;"+(e+1)+"~":o.C0.ESC+"[3~";break;case 36:h.key=e?o.C0.ESC+"[1;"+(e+1)+"H":l?o.C0.ESC+"OH":o.C0.ESC+"[H";break;case 35:h.key=e?o.C0.ESC+"[1;"+(e+1)+"F":l?o.C0.ESC+"OF":o.C0.ESC+"[F";break;case 33:n.shiftKey?h.type=2:n.ctrlKey?h.key=o.C0.ESC+"[5;"+(e+1)+"~":h.key=o.C0.ESC+"[5~";break;case 34:n.shiftKey?h.type=3:n.ctrlKey?h.key=o.C0.ESC+"[6;"+(e+1)+"~":h.key=o.C0.ESC+"[6~";break;case 112:h.key=e?o.C0.ESC+"[1;"+(e+1)+"P":o.C0.ESC+"OP";break;case 113:h.key=e?o.C0.ESC+"[1;"+(e+1)+"Q":o.C0.ESC+"OQ";break;case 114:h.key=e?o.C0.ESC+"[1;"+(e+1)+"R":o.C0.ESC+"OR";break;case 115:h.key=e?o.C0.ESC+"[1;"+(e+1)+"S":o.C0.ESC+"OS";break;case 116:h.key=e?o.C0.ESC+"[15;"+(e+1)+"~":o.C0.ESC+"[15~";break;case 117:h.key=e?o.C0.ESC+"[17;"+(e+1)+"~":o.C0.ESC+"[17~";break;case 118:h.key=e?o.C0.ESC+"[18;"+(e+1)+"~":o.C0.ESC+"[18~";break;case 119:h.key=e?o.C0.ESC+"[19;"+(e+1)+"~":o.C0.ESC+"[19~";break;case 120:h.key=e?o.C0.ESC+"[20;"+(e+1)+"~":o.C0.ESC+"[20~";break;case 121:h.key=e?o.C0.ESC+"[21;"+(e+1)+"~":o.C0.ESC+"[21~";break;case 122:h.key=e?o.C0.ESC+"[23;"+(e+1)+"~":o.C0.ESC+"[23~";break;case 123:h.key=e?o.C0.ESC+"[24;"+(e+1)+"~":o.C0.ESC+"[24~";break;default:if(!n.ctrlKey||n.shiftKey||n.altKey||n.metaKey)if(_&&!v||!n.altKey||n.metaKey)!_||n.altKey||n.ctrlKey||n.shiftKey||!n.metaKey?n.key&&!n.ctrlKey&&!n.altKey&&!n.metaKey&&n.keyCode>=48&&n.key.length===1?h.key=n.key:n.key&&n.ctrlKey&&(n.key==="_"&&(h.key=o.C0.US),n.key==="@"&&(h.key=o.C0.NUL)):n.keyCode===65&&(h.type=1);else{let s=u[n.keyCode],t=s?.[n.shiftKey?1:0];if(t)h.key=o.C0.ESC+t;else if(n.keyCode>=65&&n.keyCode<=90){let i=n.ctrlKey?n.keyCode-64:n.keyCode+32,c=String.fromCharCode(i);n.shiftKey&&(c=c.toUpperCase()),h.key=o.C0.ESC+c}else if(n.keyCode===32)h.key=o.C0.ESC+(n.ctrlKey?o.C0.NUL:" ");else if(n.key==="Dead"&&n.code.startsWith("Key")){let i=n.code.slice(3,4);n.shiftKey||(i=i.toLowerCase()),h.key=o.C0.ESC+i,h.cancel=!0}}else n.keyCode>=65&&n.keyCode<=90?h.key=String.fromCharCode(n.keyCode-64):n.keyCode===32?h.key=o.C0.NUL:n.keyCode>=51&&n.keyCode<=55?h.key=String.fromCharCode(n.keyCode-51+27):n.keyCode===56?h.key=o.C0.DEL:n.keyCode===219?h.key=o.C0.ESC:n.keyCode===220?h.key=o.C0.FS:n.keyCode===221&&(h.key=o.C0.GS)}return h}},482:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Utf8ToUtf32=r.StringToUtf32=r.utf32ToString=r.stringFromCodePoint=void 0,r.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},r.utf32ToString=function(a,o=0,u=a.length){let n="";for(let l=o;l<u;++l){let _=a[l];_>65535?(_-=65536,n+=String.fromCharCode(55296+(_>>10))+String.fromCharCode(_%1024+56320)):n+=String.fromCharCode(_)}return n},r.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,o){let u=a.length;if(!u)return 0;let n=0,l=0;if(this._interim){let _=a.charCodeAt(l++);56320<=_&&_<=57343?o[n++]=1024*(this._interim-55296)+_-56320+65536:(o[n++]=this._interim,o[n++]=_),this._interim=0}for(let _=l;_<u;++_){let v=a.charCodeAt(_);if(55296<=v&&v<=56319){if(++_>=u)return this._interim=v,n;let h=a.charCodeAt(_);56320<=h&&h<=57343?o[n++]=1024*(v-55296)+h-56320+65536:(o[n++]=v,o[n++]=h)}else v!==65279&&(o[n++]=v)}return n}},r.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,o){let u=a.length;if(!u)return 0;let n,l,_,v,h=0,e=0,s=0;if(this.interim[0]){let c=!1,f=this.interim[0];f&=(224&f)==192?31:(240&f)==224?15:7;let p,S=0;for(;(p=63&this.interim[++S])&&S<4;)f<<=6,f|=p;let d=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,g=d-S;for(;s<g;){if(s>=u)return 0;if(p=a[s++],(192&p)!=128){s--,c=!0;break}this.interim[S++]=p,f<<=6,f|=63&p}c||(d===2?f<128?s--:o[h++]=f:d===3?f<2048||f>=55296&&f<=57343||f===65279||(o[h++]=f):f<65536||f>1114111||(o[h++]=f)),this.interim.fill(0)}let t=u-4,i=s;for(;i<u;){for(;!(!(i<t)||128&(n=a[i])||128&(l=a[i+1])||128&(_=a[i+2])||128&(v=a[i+3]));)o[h++]=n,o[h++]=l,o[h++]=_,o[h++]=v,i+=4;if(n=a[i++],n<128)o[h++]=n;else if((224&n)==192){if(i>=u)return this.interim[0]=n,h;if(l=a[i++],(192&l)!=128){i--;continue}if(e=(31&n)<<6|63&l,e<128){i--;continue}o[h++]=e}else if((240&n)==224){if(i>=u)return this.interim[0]=n,h;if(l=a[i++],(192&l)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=l,h;if(_=a[i++],(192&_)!=128){i--;continue}if(e=(15&n)<<12|(63&l)<<6|63&_,e<2048||e>=55296&&e<=57343||e===65279)continue;o[h++]=e}else if((248&n)==240){if(i>=u)return this.interim[0]=n,h;if(l=a[i++],(192&l)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=l,h;if(_=a[i++],(192&_)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=l,this.interim[2]=_,h;if(v=a[i++],(192&v)!=128){i--;continue}if(e=(7&n)<<18|(63&l)<<12|(63&_)<<6|63&v,e<65536||e>1114111)continue;o[h++]=e}}return h}}},225:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeV6=void 0;let a=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],o=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],u;r.UnicodeV6=class{constructor(){if(this.version="6",!u){u=new Uint8Array(65536),u.fill(1),u[0]=0,u.fill(0,1,32),u.fill(0,127,160),u.fill(2,4352,4448),u[9001]=2,u[9002]=2,u.fill(2,11904,42192),u[12351]=1,u.fill(2,44032,55204),u.fill(2,63744,64256),u.fill(2,65040,65050),u.fill(2,65072,65136),u.fill(2,65280,65377),u.fill(2,65504,65511);for(let n=0;n<a.length;++n)u.fill(0,a[n][0],a[n][1]+1)}}wcwidth(n){return n<32?0:n<127?1:n<65536?u[n]:function(l,_){let v,h=0,e=_.length-1;if(l<_[0][0]||l>_[e][1])return!1;for(;e>=h;)if(v=h+e>>1,l>_[v][1])h=v+1;else{if(!(l<_[v][0]))return!0;e=v-1}return!1}(n,o)?0:n>=131072&&n<=196605||n>=196608&&n<=262141?2:1}}},5981:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WriteBuffer=void 0;let o=a(8460),u=a(844);class n extends u.Disposable{constructor(_){super(),this._action=_,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new o.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(_,v){if(v!==void 0&&this._syncCalls>v)return void(this._syncCalls=0);if(this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let h;for(this._isSyncWriting=!0;h=this._writeBuffer.shift();){this._action(h);let e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(_,v){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(v),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(v)}_innerWrite(_=0,v=!0){let h=_||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let e=this._writeBuffer[this._bufferOffset],s=this._action(e,v);if(s){let i=c=>Date.now()-h>=12?setTimeout(()=>this._innerWrite(0,c)):this._innerWrite(h,c);return void s.catch(c=>(queueMicrotask(()=>{throw c}),Promise.resolve(!1))).then(i)}let t=this._callbacks[this._bufferOffset];if(t&&t(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-h>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}r.WriteBuffer=n},5941:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toRgbString=r.parseColor=void 0;let a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,o=/^[\da-f]+$/;function u(n,l){let _=n.toString(16),v=_.length<2?"0"+_:_;switch(l){case 4:return _[0];case 8:return v;case 12:return(v+v).slice(0,3);default:return v+v}}r.parseColor=function(n){if(!n)return;let l=n.toLowerCase();if(l.indexOf("rgb:")===0){l=l.slice(4);let _=a.exec(l);if(_){let v=_[1]?15:_[4]?255:_[7]?4095:65535;return[Math.round(parseInt(_[1]||_[4]||_[7]||_[10],16)/v*255),Math.round(parseInt(_[2]||_[5]||_[8]||_[11],16)/v*255),Math.round(parseInt(_[3]||_[6]||_[9]||_[12],16)/v*255)]}}else if(l.indexOf("#")===0&&(l=l.slice(1),o.exec(l)&&[3,6,9,12].includes(l.length))){let _=l.length/3,v=[0,0,0];for(let h=0;h<3;++h){let e=parseInt(l.slice(_*h,_*h+_),16);v[h]=_===1?e<<4:_===2?e:_===3?e>>4:e>>8}return v}},r.toRgbString=function(n,l=16){let[_,v,h]=n;return`rgb:${u(_,l)}/${u(v,l)}/${u(h,l)}`}},5770:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PAYLOAD_LIMIT=void 0,r.PAYLOAD_LIMIT=1e7},6351:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DcsHandler=r.DcsParser=void 0;let o=a(482),u=a(8742),n=a(5770),l=[];r.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=l,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=l}registerHandler(v,h){this._handlers[v]===void 0&&(this._handlers[v]=[]);let e=this._handlers[v];return e.push(h),{dispose:()=>{let s=e.indexOf(h);s!==-1&&e.splice(s,1)}}}clearHandler(v){this._handlers[v]&&delete this._handlers[v]}setHandlerFallback(v){this._handlerFb=v}reset(){if(this._active.length)for(let v=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;v>=0;--v)this._active[v].unhook(!1);this._stack.paused=!1,this._active=l,this._ident=0}hook(v,h){if(this.reset(),this._ident=v,this._active=this._handlers[v]||l,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(h);else this._handlerFb(this._ident,"HOOK",h)}put(v,h,e){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(v,h,e);else this._handlerFb(this._ident,"PUT",(0,o.utf32ToString)(v,h,e))}unhook(v,h=!0){if(this._active.length){let e=!1,s=this._active.length-1,t=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,e=h,t=this._stack.fallThrough,this._stack.paused=!1),!t&&e===!1){for(;s>=0&&(e=this._active[s].unhook(v),e!==!0);s--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,e;s--}for(;s>=0;s--)if(e=this._active[s].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,e}else this._handlerFb(this._ident,"UNHOOK",v);this._active=l,this._ident=0}};let _=new u.Params;_.addParam(0),r.DcsHandler=class{constructor(v){this._handler=v,this._data="",this._params=_,this._hitLimit=!1}hook(v){this._params=v.length>1||v.params[0]?v.clone():_,this._data="",this._hitLimit=!1}put(v,h,e){this._hitLimit||(this._data+=(0,o.utf32ToString)(v,h,e),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(v){let h=!1;if(this._hitLimit)h=!1;else if(v&&(h=this._handler(this._data,this._params),h instanceof Promise))return h.then(e=>(this._params=_,this._data="",this._hitLimit=!1,e));return this._params=_,this._data="",this._hitLimit=!1,h}}},2015:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EscapeSequenceParser=r.VT500_TRANSITION_TABLE=r.TransitionTable=void 0;let o=a(844),u=a(8742),n=a(6242),l=a(6351);class _{constructor(s){this.table=new Uint8Array(s)}setDefault(s,t){this.table.fill(s<<4|t)}add(s,t,i,c){this.table[t<<8|s]=i<<4|c}addMany(s,t,i,c){for(let f=0;f<s.length;f++)this.table[t<<8|s[f]]=i<<4|c}}r.TransitionTable=_;let v=160;r.VT500_TRANSITION_TABLE=function(){let e=new _(4095),s=Array.apply(null,Array(256)).map((S,d)=>d),t=(S,d)=>s.slice(S,d),i=t(32,127),c=t(0,24);c.push(25),c.push.apply(c,t(28,32));let f=t(0,14),p;for(p in e.setDefault(1,0),e.addMany(i,0,2,0),f)e.addMany([24,26,153,154],p,3,0),e.addMany(t(128,144),p,3,0),e.addMany(t(144,152),p,3,0),e.add(156,p,0,0),e.add(27,p,11,1),e.add(157,p,4,8),e.addMany([152,158,159],p,0,7),e.add(155,p,11,3),e.add(144,p,11,9);return e.addMany(c,0,3,0),e.addMany(c,1,3,1),e.add(127,1,0,1),e.addMany(c,8,0,8),e.addMany(c,3,3,3),e.add(127,3,0,3),e.addMany(c,4,3,4),e.add(127,4,0,4),e.addMany(c,6,3,6),e.addMany(c,5,3,5),e.add(127,5,0,5),e.addMany(c,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(t(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(c,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(t(64,127),3,7,0),e.addMany(t(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(t(48,60),4,8,4),e.addMany(t(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(t(32,64),6,0,6),e.add(127,6,0,6),e.addMany(t(64,127),6,0,0),e.addMany(t(32,48),3,9,5),e.addMany(t(32,48),5,9,5),e.addMany(t(48,64),5,0,6),e.addMany(t(64,127),5,7,0),e.addMany(t(32,48),4,9,5),e.addMany(t(32,48),1,9,2),e.addMany(t(32,48),2,9,2),e.addMany(t(48,127),2,10,0),e.addMany(t(48,80),1,10,0),e.addMany(t(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(t(96,127),1,10,0),e.add(80,1,11,9),e.addMany(c,9,0,9),e.add(127,9,0,9),e.addMany(t(28,32),9,0,9),e.addMany(t(32,48),9,9,12),e.addMany(t(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(c,11,0,11),e.addMany(t(32,128),11,0,11),e.addMany(t(28,32),11,0,11),e.addMany(c,10,0,10),e.add(127,10,0,10),e.addMany(t(28,32),10,0,10),e.addMany(t(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(t(32,48),10,9,12),e.addMany(c,12,0,12),e.add(127,12,0,12),e.addMany(t(28,32),12,0,12),e.addMany(t(32,48),12,9,12),e.addMany(t(48,64),12,0,11),e.addMany(t(64,127),12,12,13),e.addMany(t(64,127),10,12,13),e.addMany(t(64,127),9,12,13),e.addMany(c,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(v,0,2,0),e.add(v,8,5,8),e.add(v,6,0,6),e.add(v,11,0,11),e.add(v,13,13,13),e}();class h extends o.Disposable{constructor(s=r.VT500_TRANSITION_TABLE){super(),this._transitions=s,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new u.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(t,i,c)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,i)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,o.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new l.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(s,t=[64,126]){let i=0;if(s.prefix){if(s.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=s.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(s.intermediates){if(s.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let f=0;f<s.intermediates.length;++f){let p=s.intermediates.charCodeAt(f);if(32>p||p>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=p}}if(s.final.length!==1)throw new Error("final must be a single byte");let c=s.final.charCodeAt(0);if(t[0]>c||c>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=c,i}identToString(s){let t=[];for(;s;)t.push(String.fromCharCode(255&s)),s>>=8;return t.reverse().join("")}setPrintHandler(s){this._printHandler=s}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(s,t){let i=this._identifier(s,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);let c=this._escHandlers[i];return c.push(t),{dispose:()=>{let f=c.indexOf(t);f!==-1&&c.splice(f,1)}}}clearEscHandler(s){this._escHandlers[this._identifier(s,[48,126])]&&delete this._escHandlers[this._identifier(s,[48,126])]}setEscHandlerFallback(s){this._escHandlerFb=s}setExecuteHandler(s,t){this._executeHandlers[s.charCodeAt(0)]=t}clearExecuteHandler(s){this._executeHandlers[s.charCodeAt(0)]&&delete this._executeHandlers[s.charCodeAt(0)]}setExecuteHandlerFallback(s){this._executeHandlerFb=s}registerCsiHandler(s,t){let i=this._identifier(s);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);let c=this._csiHandlers[i];return c.push(t),{dispose:()=>{let f=c.indexOf(t);f!==-1&&c.splice(f,1)}}}clearCsiHandler(s){this._csiHandlers[this._identifier(s)]&&delete this._csiHandlers[this._identifier(s)]}setCsiHandlerFallback(s){this._csiHandlerFb=s}registerDcsHandler(s,t){return this._dcsParser.registerHandler(this._identifier(s),t)}clearDcsHandler(s){this._dcsParser.clearHandler(this._identifier(s))}setDcsHandlerFallback(s){this._dcsParser.setHandlerFallback(s)}registerOscHandler(s,t){return this._oscParser.registerHandler(s,t)}clearOscHandler(s){this._oscParser.clearHandler(s)}setOscHandlerFallback(s){this._oscParser.setHandlerFallback(s)}setErrorHandler(s){this._errorHandler=s}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(s,t,i,c,f){this._parseStack.state=s,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=c,this._parseStack.chunkPos=f}parse(s,t,i){let c,f=0,p=0,S=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,S=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let d=this._parseStack.handlers,g=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&g>-1){for(;g>=0&&(c=d[g](this._params),c!==!0);g--)if(c instanceof Promise)return this._parseStack.handlerPos=g,c}this._parseStack.handlers=[];break;case 4:if(i===!1&&g>-1){for(;g>=0&&(c=d[g](),c!==!0);g--)if(c instanceof Promise)return this._parseStack.handlerPos=g,c}this._parseStack.handlers=[];break;case 6:if(f=s[this._parseStack.chunkPos],c=this._dcsParser.unhook(f!==24&&f!==26,i),c)return c;f===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(f=s[this._parseStack.chunkPos],c=this._oscParser.end(f!==24&&f!==26,i),c)return c;f===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,S=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let d=S;d<t;++d){switch(f=s[d],p=this._transitions.table[this.currentState<<8|(f<160?f:v)],p>>4){case 2:for(let R=d+1;;++R){if(R>=t||(f=s[R])<32||f>126&&f<v){this._printHandler(s,d,R),d=R-1;break}if(++R>=t||(f=s[R])<32||f>126&&f<v){this._printHandler(s,d,R),d=R-1;break}if(++R>=t||(f=s[R])<32||f>126&&f<v){this._printHandler(s,d,R),d=R-1;break}if(++R>=t||(f=s[R])<32||f>126&&f<v){this._printHandler(s,d,R),d=R-1;break}}break;case 3:this._executeHandlers[f]?this._executeHandlers[f]():this._executeHandlerFb(f),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:d,code:f,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let g=this._csiHandlers[this._collect<<8|f],k=g?g.length-1:-1;for(;k>=0&&(c=g[k](this._params),c!==!0);k--)if(c instanceof Promise)return this._preserveStack(3,g,k,p,d),c;k<0&&this._csiHandlerFb(this._collect<<8|f,this._params),this.precedingCodepoint=0;break;case 8:do switch(f){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(f-48)}while(++d<t&&(f=s[d])>47&&f<60);d--;break;case 9:this._collect<<=8,this._collect|=f;break;case 10:let T=this._escHandlers[this._collect<<8|f],x=T?T.length-1:-1;for(;x>=0&&(c=T[x](),c!==!0);x--)if(c instanceof Promise)return this._preserveStack(4,T,x,p,d),c;x<0&&this._escHandlerFb(this._collect<<8|f),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|f,this._params);break;case 13:for(let R=d+1;;++R)if(R>=t||(f=s[R])===24||f===26||f===27||f>127&&f<v){this._dcsParser.put(s,d,R),d=R-1;break}break;case 14:if(c=this._dcsParser.unhook(f!==24&&f!==26),c)return this._preserveStack(6,[],0,p,d),c;f===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let R=d+1;;R++)if(R>=t||(f=s[R])<32||f>127&&f<v){this._oscParser.put(s,d,R),d=R-1;break}break;case 6:if(c=this._oscParser.end(f!==24&&f!==26),c)return this._preserveStack(5,[],0,p,d),c;f===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&p}}}r.EscapeSequenceParser=h},6242:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OscHandler=r.OscParser=void 0;let o=a(5770),u=a(482),n=[];r.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(l,_){this._handlers[l]===void 0&&(this._handlers[l]=[]);let v=this._handlers[l];return v.push(_),{dispose:()=>{let h=v.indexOf(_);h!==-1&&v.splice(h,1)}}}clearHandler(l){this._handlers[l]&&delete this._handlers[l]}setHandlerFallback(l){this._handlerFb=l}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(this._state===2)for(let l=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;l>=0;--l)this._active[l].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let l=this._active.length-1;l>=0;l--)this._active[l].start();else this._handlerFb(this._id,"START")}_put(l,_,v){if(this._active.length)for(let h=this._active.length-1;h>=0;h--)this._active[h].put(l,_,v);else this._handlerFb(this._id,"PUT",(0,u.utf32ToString)(l,_,v))}start(){this.reset(),this._state=1}put(l,_,v){if(this._state!==3){if(this._state===1)for(;_<v;){let h=l[_++];if(h===59){this._state=2,this._start();break}if(h<48||57<h)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+h-48}this._state===2&&v-_>0&&this._put(l,_,v)}}end(l,_=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let v=!1,h=this._active.length-1,e=!1;if(this._stack.paused&&(h=this._stack.loopPosition-1,v=_,e=this._stack.fallThrough,this._stack.paused=!1),!e&&v===!1){for(;h>=0&&(v=this._active[h].end(l),v!==!0);h--)if(v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=h,this._stack.fallThrough=!1,v;h--}for(;h>=0;h--)if(v=this._active[h].end(!1),v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=h,this._stack.fallThrough=!0,v}else this._handlerFb(this._id,"END",l);this._active=n,this._id=-1,this._state=0}}},r.OscHandler=class{constructor(l){this._handler=l,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(l,_,v){this._hitLimit||(this._data+=(0,u.utf32ToString)(l,_,v),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(l){let _=!1;if(this._hitLimit)_=!1;else if(l&&(_=this._handler(this._data),_ instanceof Promise))return _.then(v=>(this._data="",this._hitLimit=!1,v));return this._data="",this._hitLimit=!1,_}}},8742:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Params=void 0;let a=2147483647;class o{static fromArray(n){let l=new o;if(!n.length)return l;for(let _=Array.isArray(n[0])?1:0;_<n.length;++_){let v=n[_];if(Array.isArray(v))for(let h=0;h<v.length;++h)l.addSubParam(v[h]);else l.addParam(v)}return l}constructor(n=32,l=32){if(this.maxLength=n,this.maxSubParamsLength=l,l>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(n),this.length=0,this._subParams=new Int32Array(l),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(n),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let n=new o(this.maxLength,this.maxSubParamsLength);return n.params.set(this.params),n.length=this.length,n._subParams.set(this._subParams),n._subParamsLength=this._subParamsLength,n._subParamsIdx.set(this._subParamsIdx),n._rejectDigits=this._rejectDigits,n._rejectSubDigits=this._rejectSubDigits,n._digitIsSub=this._digitIsSub,n}toArray(){let n=[];for(let l=0;l<this.length;++l){n.push(this.params[l]);let _=this._subParamsIdx[l]>>8,v=255&this._subParamsIdx[l];v-_>0&&n.push(Array.prototype.slice.call(this._subParams,_,v))}return n}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(n){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=n>a?a:n}}addSubParam(n){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=n>a?a:n,this._subParamsIdx[this.length-1]++}}hasSubParams(n){return(255&this._subParamsIdx[n])-(this._subParamsIdx[n]>>8)>0}getSubParams(n){let l=this._subParamsIdx[n]>>8,_=255&this._subParamsIdx[n];return _-l>0?this._subParams.subarray(l,_):null}getSubParamsAll(){let n={};for(let l=0;l<this.length;++l){let _=this._subParamsIdx[l]>>8,v=255&this._subParamsIdx[l];v-_>0&&(n[l]=this._subParams.slice(_,v))}return n}addDigit(n){let l;if(this._rejectDigits||!(l=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let _=this._digitIsSub?this._subParams:this.params,v=_[l-1];_[l-1]=~v?Math.min(10*v+n,a):n}}r.Params=o},5741:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AddonManager=void 0,r.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,o){let u={instance:o,dispose:o.dispose,isDisposed:!1};this._addons.push(u),o.dispose=()=>this._wrappedAddonDispose(u),o.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let o=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===a){o=u;break}if(o===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(o,1)}}},8771:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferApiView=void 0;let o=a(3785),u=a(511);r.BufferApiView=class{constructor(n,l){this._buffer=n,this.type=l}init(n){return this._buffer=n,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(n){let l=this._buffer.lines.get(n);if(l)return new o.BufferLineApiView(l)}getNullCell(){return new u.CellData}}},3785:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLineApiView=void 0;let o=a(511);r.BufferLineApiView=class{constructor(u){this._line=u}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(u,n){if(!(u<0||u>=this._line.length))return n?(this._line.loadCell(u,n),n):this._line.loadCell(u,new o.CellData)}translateToString(u,n,l){return this._line.translateToString(u,n,l)}}},8285:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferNamespaceApi=void 0;let o=a(8771),u=a(8460),n=a(844);class l extends n.Disposable{constructor(v){super(),this._core=v,this._onBufferChange=this.register(new u.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new o.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new o.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}r.BufferNamespaceApi=l},7975:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ParserApi=void 0,r.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,o){return this._core.registerCsiHandler(a,u=>o(u.toArray()))}addCsiHandler(a,o){return this.registerCsiHandler(a,o)}registerDcsHandler(a,o){return this._core.registerDcsHandler(a,(u,n)=>o(u,n.toArray()))}addDcsHandler(a,o){return this.registerDcsHandler(a,o)}registerEscHandler(a,o){return this._core.registerEscHandler(a,o)}addEscHandler(a,o){return this.registerEscHandler(a,o)}registerOscHandler(a,o){return this._core.registerOscHandler(a,o)}addOscHandler(a,o){return this.registerOscHandler(a,o)}}},7090:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeApi=void 0,r.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(E,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,f=arguments.length,p=f<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,i);else for(var S=e.length-1;S>=0;S--)(c=e[S])&&(p=(f<3?c(p):f>3?c(s,t,p):c(s,t))||p);return f>3&&p&&Object.defineProperty(s,t,p),p},u=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferService=r.MINIMUM_ROWS=r.MINIMUM_COLS=void 0;let n=a(8460),l=a(844),_=a(5295),v=a(2585);r.MINIMUM_COLS=2,r.MINIMUM_ROWS=1;let h=r.BufferService=class extends l.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,r.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,r.MINIMUM_ROWS),this.buffers=this.register(new _.BufferSet(e,this))}resize(e,s){this.cols=e,this.rows=s,this.buffers.resize(e,s),this._onResize.fire({cols:e,rows:s})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,s=!1){let t=this.buffer,i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=t.getBlankLine(e,s),this._cachedBlankLine=i),i.isWrapped=s;let c=t.ybase+t.scrollTop,f=t.ybase+t.scrollBottom;if(t.scrollTop===0){let p=t.lines.isFull;f===t.lines.length-1?p?t.lines.recycle().copyFrom(i):t.lines.push(i.clone()):t.lines.splice(f+1,0,i.clone()),p?this.isUserScrolling&&(t.ydisp=Math.max(t.ydisp-1,0)):(t.ybase++,this.isUserScrolling||t.ydisp++)}else{let p=f-c+1;t.lines.shiftElements(c+1,p-1,-1),t.lines.set(f,i.clone())}this.isUserScrolling||(t.ydisp=t.ybase),this._onScroll.fire(t.ydisp)}scrollLines(e,s,t){let i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);let c=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),c!==i.ydisp&&(s||this._onScroll.fire(i.ydisp))}};r.BufferService=h=o([u(0,v.IOptionsService)],h)},7994:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharsetService=void 0,r.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,o){this._charsets[a]=o,this.glevel===a&&(this.charset=o)}}},1753:function(E,r,a){var o=this&&this.__decorate||function(i,c,f,p){var S,d=arguments.length,g=d<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,f):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(i,c,f,p);else for(var k=i.length-1;k>=0;k--)(S=i[k])&&(g=(d<3?S(g):d>3?S(c,f,g):S(c,f))||g);return d>3&&g&&Object.defineProperty(c,f,g),g},u=this&&this.__param||function(i,c){return function(f,p){c(f,p,i)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreMouseService=void 0;let n=a(2585),l=a(8460),_=a(844),v={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:i=>i.button!==4&&i.action===1&&(i.ctrl=!1,i.alt=!1,i.shift=!1,!0)},VT200:{events:19,restrict:i=>i.action!==32},DRAG:{events:23,restrict:i=>i.action!==32||i.button!==3},ANY:{events:31,restrict:i=>!0}};function h(i,c){let f=(i.ctrl?16:0)|(i.shift?4:0)|(i.alt?8:0);return i.button===4?(f|=64,f|=i.action):(f|=3&i.button,4&i.button&&(f|=64),8&i.button&&(f|=128),i.action===32?f|=32:i.action!==0||c||(f|=3)),f}let e=String.fromCharCode,s={DEFAULT:i=>{let c=[h(i,!1)+32,i.col+32,i.row+32];return c[0]>255||c[1]>255||c[2]>255?"":`\x1B[M${e(c[0])}${e(c[1])}${e(c[2])}`},SGR:i=>{let c=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${h(i,!0)};${i.col};${i.row}${c}`},SGR_PIXELS:i=>{let c=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${h(i,!0)};${i.x};${i.y}${c}`}},t=r.CoreMouseService=class extends _.Disposable{constructor(i,c){super(),this._bufferService=i,this._coreService=c,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new l.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let f of Object.keys(v))this.addProtocol(f,v[f]);for(let f of Object.keys(s))this.addEncoding(f,s[f]);this.reset()}addProtocol(i,c){this._protocols[i]=c}addEncoding(i,c){this._encodings[i]=c}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(i){if(!this._protocols[i])throw new Error(`unknown protocol "${i}"`);this._activeProtocol=i,this._onProtocolChange.fire(this._protocols[i].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(i){if(!this._encodings[i])throw new Error(`unknown encoding "${i}"`);this._activeEncoding=i}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(i){if(i.col<0||i.col>=this._bufferService.cols||i.row<0||i.row>=this._bufferService.rows||i.button===4&&i.action===32||i.button===3&&i.action!==32||i.button!==4&&(i.action===2||i.action===3)||(i.col++,i.row++,i.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,i,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(i))return!1;let c=this._encodings[this._activeEncoding](i);return c&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(c):this._coreService.triggerDataEvent(c,!0)),this._lastEvent=i,!0}explainEvents(i){return{down:!!(1&i),up:!!(2&i),drag:!!(4&i),move:!!(8&i),wheel:!!(16&i)}}_equalEvents(i,c,f){if(f){if(i.x!==c.x||i.y!==c.y)return!1}else if(i.col!==c.col||i.row!==c.row)return!1;return i.button===c.button&&i.action===c.action&&i.ctrl===c.ctrl&&i.alt===c.alt&&i.shift===c.shift}};r.CoreMouseService=t=o([u(0,n.IBufferService),u(1,n.ICoreService)],t)},6975:function(E,r,a){var o=this&&this.__decorate||function(t,i,c,f){var p,S=arguments.length,d=S<3?i:f===null?f=Object.getOwnPropertyDescriptor(i,c):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,i,c,f);else for(var g=t.length-1;g>=0;g--)(p=t[g])&&(d=(S<3?p(d):S>3?p(i,c,d):p(i,c))||d);return S>3&&d&&Object.defineProperty(i,c,d),d},u=this&&this.__param||function(t,i){return function(c,f){i(c,f,t)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreService=void 0;let n=a(1439),l=a(8460),_=a(844),v=a(2585),h=Object.freeze({insertMode:!1}),e=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),s=r.CoreService=class extends _.Disposable{constructor(t,i,c){super(),this._bufferService=t,this._logService=i,this._optionsService=c,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new l.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new l.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new l.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new l.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(h),this.decPrivateModes=(0,n.clone)(e)}reset(){this.modes=(0,n.clone)(h),this.decPrivateModes=(0,n.clone)(e)}triggerDataEvent(t,i=!1){if(this._optionsService.rawOptions.disableStdin)return;let c=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&c.ybase!==c.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${t}"`,()=>t.split("").map(f=>f.charCodeAt(0))),this._onData.fire(t)}triggerBinaryEvent(t){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${t}"`,()=>t.split("").map(i=>i.charCodeAt(0))),this._onBinary.fire(t))}};r.CoreService=s=o([u(0,v.IBufferService),u(1,v.ILogService),u(2,v.IOptionsService)],s)},9074:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DecorationService=void 0;let o=a(8055),u=a(8460),n=a(844),l=a(6106),_=0,v=0;class h extends n.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new l.SortedList(t=>t?.marker.line),this._onDecorationRegistered=this.register(new u.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new u.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,n.toDisposable)(()=>this.reset()))}registerDecoration(t){if(t.marker.isDisposed)return;let i=new e(t);if(i){let c=i.marker.onDispose(()=>i.dispose());i.onDispose(()=>{i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),c.dispose())}),this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(let t of this._decorations.values())t.dispose();this._decorations.clear()}*getDecorationsAtCell(t,i,c){var f,p,S;let d=0,g=0;for(let k of this._decorations.getKeyIterator(i))d=(f=k.options.x)!==null&&f!==void 0?f:0,g=d+((p=k.options.width)!==null&&p!==void 0?p:1),t>=d&&t<g&&(!c||((S=k.options.layer)!==null&&S!==void 0?S:"bottom")===c)&&(yield k)}forEachDecorationAtCell(t,i,c,f){this._decorations.forEachByKey(i,p=>{var S,d,g;_=(S=p.options.x)!==null&&S!==void 0?S:0,v=_+((d=p.options.width)!==null&&d!==void 0?d:1),t>=_&&t<v&&(!c||((g=p.options.layer)!==null&&g!==void 0?g:"bottom")===c)&&f(p)})}}r.DecorationService=h;class e extends n.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=o.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=o.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(t){super(),this.options=t,this.onRenderEmitter=this.register(new u.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=t.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.InstantiationService=r.ServiceCollection=void 0;let o=a(2585),u=a(8343);class n{constructor(..._){this._entries=new Map;for(let[v,h]of _)this.set(v,h)}set(_,v){let h=this._entries.get(_);return this._entries.set(_,v),h}forEach(_){for(let[v,h]of this._entries.entries())_(v,h)}has(_){return this._entries.has(_)}get(_){return this._entries.get(_)}}r.ServiceCollection=n,r.InstantiationService=class{constructor(){this._services=new n,this._services.set(o.IInstantiationService,this)}setService(l,_){this._services.set(l,_)}getService(l){return this._services.get(l)}createInstance(l,..._){let v=(0,u.getServiceDependencies)(l).sort((s,t)=>s.index-t.index),h=[];for(let s of v){let t=this._services.get(s.id);if(!t)throw new Error(`[createInstance] ${l.name} depends on UNKNOWN service ${s.id}.`);h.push(t)}let e=v.length>0?v[0].index:_.length;if(_.length!==e)throw new Error(`[createInstance] First service dependency of ${l.name} at position ${e+1} conflicts with ${_.length} static arguments`);return new l(..._,...h)}}},7866:function(E,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,f=arguments.length,p=f<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,i);else for(var S=e.length-1;S>=0;S--)(c=e[S])&&(p=(f<3?c(p):f>3?c(s,t,p):c(s,t))||p);return f>3&&p&&Object.defineProperty(s,t,p),p},u=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.traceCall=r.setTraceLogger=r.LogService=void 0;let n=a(844),l=a(2585),_={trace:l.LogLevelEnum.TRACE,debug:l.LogLevelEnum.DEBUG,info:l.LogLevelEnum.INFO,warn:l.LogLevelEnum.WARN,error:l.LogLevelEnum.ERROR,off:l.LogLevelEnum.OFF},v,h=r.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=l.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),v=this}_updateLogLevel(){this._logLevel=_[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let s=0;s<e.length;s++)typeof e[s]=="function"&&(e[s]=e[s]())}_log(e,s,t){this._evalLazyOptionalParams(t),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+s,...t)}trace(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.TRACE&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.trace.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,s)}debug(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.DEBUG&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.debug.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,s)}info(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.INFO&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.info.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.info,e,s)}warn(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.WARN&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.warn.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.warn,e,s)}error(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.ERROR&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.error.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.error,e,s)}};r.LogService=h=o([u(0,l.IOptionsService)],h),r.setTraceLogger=function(e){v=e},r.traceCall=function(e,s,t){if(typeof t.value!="function")throw new Error("not supported");let i=t.value;t.value=function(...c){if(v.logLevel!==l.LogLevelEnum.TRACE)return i.apply(this,c);v.trace(`GlyphRenderer#${i.name}(${c.map(p=>JSON.stringify(p)).join(", ")})`);let f=i.apply(this,c);return v.trace(`GlyphRenderer#${i.name} return`,f),f}}},7302:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OptionsService=r.DEFAULT_OPTIONS=void 0;let o=a(8460),u=a(844),n=a(6114);r.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let l=["normal","bold","100","200","300","400","500","600","700","800","900"];class _ extends u.Disposable{constructor(h){super(),this._onOptionChange=this.register(new o.EventEmitter),this.onOptionChange=this._onOptionChange.event;let e=Object.assign({},r.DEFAULT_OPTIONS);for(let s in h)if(s in e)try{let t=h[s];e[s]=this._sanitizeAndValidateOption(s,t)}catch(t){console.error(t)}this.rawOptions=e,this.options=Object.assign({},e),this._setupOptions()}onSpecificOptionChange(h,e){return this.onOptionChange(s=>{s===h&&e(this.rawOptions[h])})}onMultipleOptionChange(h,e){return this.onOptionChange(s=>{h.indexOf(s)!==-1&&e()})}_setupOptions(){let h=s=>{if(!(s in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},e=(s,t)=>{if(!(s in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);t=this._sanitizeAndValidateOption(s,t),this.rawOptions[s]!==t&&(this.rawOptions[s]=t,this._onOptionChange.fire(s))};for(let s in this.rawOptions){let t={get:h.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this.options,s,t)}}_sanitizeAndValidateOption(h,e){switch(h){case"cursorStyle":if(e||(e=r.DEFAULT_OPTIONS[h]),!function(s){return s==="block"||s==="underline"||s==="bar"}(e))throw new Error(`"${e}" is not a valid value for ${h}`);break;case"wordSeparator":e||(e=r.DEFAULT_OPTIONS[h]);break;case"fontWeight":case"fontWeightBold":if(typeof e=="number"&&1<=e&&e<=1e3)break;e=l.includes(e)?e:r.DEFAULT_OPTIONS[h];break;case"cursorWidth":e=Math.floor(e);case"lineHeight":case"tabStopWidth":if(e<1)throw new Error(`${h} cannot be less than 1, value: ${e}`);break;case"minimumContrastRatio":e=Math.max(1,Math.min(21,Math.round(10*e)/10));break;case"scrollback":if((e=Math.min(e,4294967295))<0)throw new Error(`${h} cannot be less than 0, value: ${e}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(e<=0)throw new Error(`${h} cannot be less than or equal to 0, value: ${e}`);break;case"rows":case"cols":if(!e&&e!==0)throw new Error(`${h} must be numeric, value: ${e}`);break;case"windowsPty":e=e??{}}return e}}r.OptionsService=_},2660:function(E,r,a){var o=this&&this.__decorate||function(_,v,h,e){var s,t=arguments.length,i=t<3?v:e===null?e=Object.getOwnPropertyDescriptor(v,h):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(_,v,h,e);else for(var c=_.length-1;c>=0;c--)(s=_[c])&&(i=(t<3?s(i):t>3?s(v,h,i):s(v,h))||i);return t>3&&i&&Object.defineProperty(v,h,i),i},u=this&&this.__param||function(_,v){return function(h,e){v(h,e,_)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkService=void 0;let n=a(2585),l=r.OscLinkService=class{constructor(_){this._bufferService=_,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(_){let v=this._bufferService.buffer;if(_.id===void 0){let c=v.addMarker(v.ybase+v.y),f={data:_,id:this._nextId++,lines:[c]};return c.onDispose(()=>this._removeMarkerFromLink(f,c)),this._dataByLinkId.set(f.id,f),f.id}let h=_,e=this._getEntryIdKey(h),s=this._entriesWithId.get(e);if(s)return this.addLineToLink(s.id,v.ybase+v.y),s.id;let t=v.addMarker(v.ybase+v.y),i={id:this._nextId++,key:this._getEntryIdKey(h),data:h,lines:[t]};return t.onDispose(()=>this._removeMarkerFromLink(i,t)),this._entriesWithId.set(i.key,i),this._dataByLinkId.set(i.id,i),i.id}addLineToLink(_,v){let h=this._dataByLinkId.get(_);if(h&&h.lines.every(e=>e.line!==v)){let e=this._bufferService.buffer.addMarker(v);h.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(h,e))}}getLinkData(_){var v;return(v=this._dataByLinkId.get(_))===null||v===void 0?void 0:v.data}_getEntryIdKey(_){return`${_.id};;${_.uri}`}_removeMarkerFromLink(_,v){let h=_.lines.indexOf(v);h!==-1&&(_.lines.splice(h,1),_.lines.length===0&&(_.data.id!==void 0&&this._entriesWithId.delete(_.key),this._dataByLinkId.delete(_.id)))}};r.OscLinkService=l=o([u(0,n.IBufferService)],l)},8343:(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;let a="di$target",o="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(u){return u[o]||[]},r.createDecorator=function(u){if(r.serviceRegistry.has(u))return r.serviceRegistry.get(u);let n=function(l,_,v){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(h,e,s){e[a]===e?e[o].push({id:h,index:s}):(e[o]=[{id:h,index:s}],e[a]=e)})(n,l,v)};return n.toString=()=>u,r.serviceRegistry.set(u,n),n}},2585:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;let o=a(8343);var u;r.IBufferService=(0,o.createDecorator)("BufferService"),r.ICoreMouseService=(0,o.createDecorator)("CoreMouseService"),r.ICoreService=(0,o.createDecorator)("CoreService"),r.ICharsetService=(0,o.createDecorator)("CharsetService"),r.IInstantiationService=(0,o.createDecorator)("InstantiationService"),function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.OFF=5]="OFF"}(u||(r.LogLevelEnum=u={})),r.ILogService=(0,o.createDecorator)("LogService"),r.IOptionsService=(0,o.createDecorator)("OptionsService"),r.IOscLinkService=(0,o.createDecorator)("OscLinkService"),r.IUnicodeService=(0,o.createDecorator)("UnicodeService"),r.IDecorationService=(0,o.createDecorator)("DecorationService")},1480:(E,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeService=void 0;let o=a(8460),u=a(225);r.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new o.EventEmitter,this.onChange=this._onChange.event;let n=new u.UnicodeV6;this.register(n),this._active=n.version,this._activeProvider=n}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(n){if(!this._providers[n])throw new Error(`unknown Unicode version "${n}"`);this._active=n,this._activeProvider=this._providers[n],this._onChange.fire(n)}register(n){this._providers[n.version]=n}wcwidth(n){return this._activeProvider.wcwidth(n)}getStringCellWidth(n){let l=0,_=n.length;for(let v=0;v<_;++v){let h=n.charCodeAt(v);if(55296<=h&&h<=56319){if(++v>=_)return l+this.wcwidth(h);let e=n.charCodeAt(v);56320<=e&&e<=57343?h=1024*(h-55296)+e-56320+65536:l+=this.wcwidth(e)}l+=this.wcwidth(h)}return l}}}},w={};function y(E){var r=w[E];if(r!==void 0)return r.exports;var a=w[E]={exports:{}};return m[E].call(a.exports,a,a.exports,y),a.exports}var B={};return(()=>{var E=B;Object.defineProperty(E,"__esModule",{value:!0}),E.Terminal=void 0;let r=y(9042),a=y(3236),o=y(844),u=y(5741),n=y(8285),l=y(7975),_=y(7090),v=["cols","rows"];class h extends o.Disposable{constructor(s){super(),this._core=this.register(new a.Terminal(s)),this._addonManager=this.register(new u.AddonManager),this._publicOptions=Object.assign({},this._core.options);let t=c=>this._core.options[c],i=(c,f)=>{this._checkReadonlyOptions(c),this._core.options[c]=f};for(let c in this._core.options){let f={get:t.bind(this,c),set:i.bind(this,c)};Object.defineProperty(this._publicOptions,c,f)}}_checkReadonlyOptions(s){if(v.includes(s))throw new Error(`Option "${s}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new _.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new n.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let s=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:s.applicationCursorKeys,applicationKeypadMode:s.applicationKeypad,bracketedPasteMode:s.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:s.origin,reverseWraparoundMode:s.reverseWraparound,sendFocusMode:s.sendFocus,wraparoundMode:s.wraparound}}get options(){return this._publicOptions}set options(s){for(let t in s)this._publicOptions[t]=s[t]}blur(){this._core.blur()}focus(){this._core.focus()}resize(s,t){this._verifyIntegers(s,t),this._core.resize(s,t)}open(s){this._core.open(s)}attachCustomKeyEventHandler(s){this._core.attachCustomKeyEventHandler(s)}registerLinkProvider(s){return this._core.registerLinkProvider(s)}registerCharacterJoiner(s){return this._checkProposedApi(),this._core.registerCharacterJoiner(s)}deregisterCharacterJoiner(s){this._checkProposedApi(),this._core.deregisterCharacterJoiner(s)}registerMarker(s=0){return this._verifyIntegers(s),this._core.registerMarker(s)}registerDecoration(s){var t,i,c;return this._checkProposedApi(),this._verifyPositiveIntegers((t=s.x)!==null&&t!==void 0?t:0,(i=s.width)!==null&&i!==void 0?i:0,(c=s.height)!==null&&c!==void 0?c:0),this._core.registerDecoration(s)}hasSelection(){return this._core.hasSelection()}select(s,t,i){this._verifyIntegers(s,t,i),this._core.select(s,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(s,t){this._verifyIntegers(s,t),this._core.selectLines(s,t)}dispose(){super.dispose()}scrollLines(s){this._verifyIntegers(s),this._core.scrollLines(s)}scrollPages(s){this._verifyIntegers(s),this._core.scrollPages(s)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(s){this._verifyIntegers(s),this._core.scrollToLine(s)}clear(){this._core.clear()}write(s,t){this._core.write(s,t)}writeln(s,t){this._core.write(s),this._core.write(`\r
`,t)}paste(s){this._core.paste(s)}refresh(s,t){this._verifyIntegers(s,t),this._core.refresh(s,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(s){this._addonManager.loadAddon(this,s)}static get strings(){return r}_verifyIntegers(...s){for(let t of s)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...s){for(let t of s)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}E.Terminal=h})(),B})())});var Zt=qt((Ve,yt)=>{(function(m,w){typeof Ve=="object"&&typeof yt=="object"?yt.exports=w():typeof define=="function"&&define.amd?define([],w):typeof Ve=="object"?Ve.FitAddon=w():m.FitAddon=w()})(self,()=>(()=>{"use strict";var m={};return(()=>{var w=m;Object.defineProperty(w,"__esModule",{value:!0}),w.FitAddon=void 0,w.FitAddon=class{activate(y){this._terminal=y}dispose(){}fit(){let y=this.proposeDimensions();if(!y||!this._terminal||isNaN(y.cols)||isNaN(y.rows))return;let B=this._terminal._core;this._terminal.rows===y.rows&&this._terminal.cols===y.cols||(B._renderService.clear(),this._terminal.resize(y.cols,y.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let y=this._terminal._core,B=y._renderService.dimensions;if(B.css.cell.width===0||B.css.cell.height===0)return;let E=this._terminal.options.scrollback===0?0:y.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(r.getPropertyValue("height")),o=Math.max(0,parseInt(r.getPropertyValue("width"))),u=window.getComputedStyle(this._terminal.element),n=a-(parseInt(u.getPropertyValue("padding-top"))+parseInt(u.getPropertyValue("padding-bottom"))),l=o-(parseInt(u.getPropertyValue("padding-right"))+parseInt(u.getPropertyValue("padding-left")))-E;return{cols:Math.max(2,Math.floor(l/B.css.cell.width)),rows:Math.max(1,Math.floor(n/B.css.cell.height))}}}})(),m})())});function Gt(m){return m.replace(/\x1b\[[0-9;]*[a-zA-Z]/g,"")}function Ae(){return new URLSearchParams(window.location.search).get("session")}function Me(){return new URLSearchParams(window.location.search).get("project")}function Ke(m,w=null){let y=new URL(window.location.href);y.searchParams.set("session",m),w&&y.searchParams.set("project",w),window.history.pushState({sessionId:m},"",y)}function wt(){let m=new URL(window.location.href);m.searchParams.delete("session"),m.searchParams.delete("project"),window.history.pushState({},"",m)}function Xt(){wt()}var U={sessionID:null,currentProject:null,isFileBrowserOpen:!1,isFileEditorOpen:!1,currentEditingFile:null,currentBrowserPath:null,isConnected:!1};var Qt=Vt(Yt()),ei=Vt(Zt());var X=null,me=null,J=null,Pe=0,Xi=10,Ji=1e3;function ti(){J&&(J.onopen=null,J.onmessage=null,J.onclose=null,J.onerror=null,(J.readyState===WebSocket.OPEN||J.readyState===WebSocket.CONNECTING)&&J.close(),J=null),U.isConnected=!1,Pe=0}function de(){ti(),X&&(X.dispose(),X=null),me=null}function Ge(){ti();let w=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`,y=new URLSearchParams;U.sessionID&&y.append("sessionID",U.sessionID),U.currentProject&&y.append("projectName",U.currentProject),y.toString()&&(w+=`?${y.toString()}`),J=new WebSocket(w),J.onopen=()=>{U.isConnected=!0,Pe=0,X&&U.sessionID&&(X.clearTextureAtlas?.(),X.refresh(0,(X.rows||1)-1)),X&&J&&J.send(JSON.stringify({type:"resize",cols:X.cols,rows:X.rows}))},J.onmessage=B=>{try{let E=JSON.parse(B.data);switch(E.type){case"output":X?.write(E.data);break;case"sessionID":U.sessionID=E.sessionID,Ke(E.sessionID,U.currentProject);break;case"exit":X?.write(`\r
Process exited with code: ${E.exitCode}\r
`),X?.write(`Connection closed. Go back to session list.\r
`),U.isConnected=!1;break;default:break}}catch(E){console.error("Error parsing message:",E)}},J.onclose=()=>{if(U.isConnected=!1,Pe<Xi){let B=Ji*Math.pow(2,Pe);Pe++,X?.write(`\r
Connection lost. Attempting to reconnect...\r
`),setTimeout(Ge,B)}else X?.write(`\r
Connection lost. Max reconnect attempts reached. Go back to session list.\r
`)},J.onerror=()=>{X?.write(`\r
WebSocket error occurred. Attempting to reconnect.\r
`),J?.close()}}function ue(){let m=document.getElementById("terminal-container");if(!m)return;m.innerHTML=`
    <div class="flex flex-col h-full">
      <div id="terminal" class="flex-1"></div>
    </div>
  `,X&&X.dispose(),X=new Qt.Terminal({cursorBlink:!0,fontFamily:"Courier New, monospace",fontSize:14,theme:{background:"#000000",foreground:"#00ff00",cursor:"#00ff00",cursorAccent:"#000000",selection:"rgba(0, 255, 0, 0.3)"},allowTransparency:!1}),me=new ei.FitAddon,X.loadAddon(me);let w=document.getElementById("terminal");if(!w)return;X.open(w),me.fit(),X.onData(B=>{J&&J.readyState===WebSocket.OPEN&&J.send(JSON.stringify({type:"input",data:B}))}),X.focus(),Ge();let y=window.showNavigationBar;y&&y()}function ii(){me&&me.fit(),U.isConnected&&X&&J&&J.readyState===WebSocket.OPEN&&J.send(JSON.stringify({type:"resize",cols:X.cols,rows:X.rows}))}function Ie(){return J}var si;(function(m){m[m.None=0]="None",m[m.Mutable=1]="Mutable",m[m.Watching=2]="Watching",m[m.RecursedCheck=4]="RecursedCheck",m[m.Recursed=8]="Recursed",m[m.Dirty=16]="Dirty",m[m.Pending=32]="Pending"})(si||(si={}));var ri=[],xt=[],{link:Ze,unlink:Lt,propagate:Yi,checkDirty:Zi,endTracking:mi,startTracking:Si,shallowPropagate:Qi}=function({update:m,notify:w,unwatched:y}){let B=0;return{link:function(o,u){let n=u.depsTail;if(n!==void 0&&n.dep===o)return;let l;if(4&u.flags&&(l=n!==void 0?n.nextDep:u.deps,l!==void 0&&l.dep===o))return l.version=B,void(u.depsTail=l);let _=o.subsTail;if(_!==void 0&&_.version===B&&_.sub===u)return;let v=u.depsTail=o.subsTail={version:B,dep:o,sub:u,prevDep:n,nextDep:l,prevSub:_,nextSub:void 0};l!==void 0&&(l.prevDep=v),n!==void 0?n.nextDep=v:u.deps=v,_!==void 0?_.nextSub=v:o.subs=v},unlink:E,propagate:function(o){let u,n=o.nextSub;e:for(;;){let l=o.sub,_=l.flags;if(3&_&&(60&_?12&_?4&_?48&_||!a(o,l)?_=0:(l.flags=40|_,_&=1):l.flags=-9&_|32:_=0:l.flags=32|_,2&_&&w(l),1&_)){let v=l.subs;if(v!==void 0){o=v,v.nextSub!==void 0&&(u={value:n,prev:u},n=o.nextSub);continue}}if((o=n)===void 0){for(;u!==void 0;)if(o=u.value,u=u.prev,o!==void 0){n=o.nextSub;continue e}break}n=o.nextSub}},checkDirty:function(o,u){let n,l=0;e:for(;;){let _=o.dep,v=_.flags,h=!1;if(16&u.flags)h=!0;else if(17&~v){if(!(33&~v)){o.nextSub===void 0&&o.prevSub===void 0||(n={value:o,prev:n}),o=_.deps,u=_,++l;continue}}else if(m(_)){let e=_.subs;e.nextSub!==void 0&&r(e),h=!0}if(h||o.nextDep===void 0){for(;l;){--l;let e=u.subs,s=e.nextSub!==void 0;if(s?(o=n.value,n=n.prev):o=e,h){if(m(u)){s&&r(e),u=o.sub;continue}}else u.flags&=-33;if(u=o.sub,o.nextDep!==void 0){o=o.nextDep;continue e}h=!1}return h}o=o.nextDep}},endTracking:function(o){let u=o.depsTail,n=u!==void 0?u.nextDep:o.deps;for(;n!==void 0;)n=E(n,o);o.flags&=-5},startTracking:function(o){++B,o.depsTail=void 0,o.flags=-57&o.flags|4},shallowPropagate:r};function E(o,u=o.sub){let n=o.dep,l=o.prevDep,_=o.nextDep,v=o.nextSub,h=o.prevSub;return _!==void 0?_.prevDep=l:u.depsTail=l,l!==void 0?l.nextDep=_:u.deps=_,v!==void 0?v.prevSub=h:n.subsTail=h,h!==void 0?h.nextSub=v:(n.subs=v)===void 0&&y(n),_}function r(o){do{let u=o.sub,n=o.nextSub,l=u.flags;(48&l)==32&&(u.flags=16|l,2&l&&w(u)),o=n}while(o!==void 0)}function a(o,u){let n=u.depsTail;if(n!==void 0){let l=u.deps;do{if(l===o)return!0;if(l===n)break;l=l.nextDep}while(l!==void 0)}return!1}}({update:m=>"getter"in m?is(m):wi(m,m.value),notify:function m(w){let y=w.flags;if(!(64&y)){w.flags=64|y;let B=w.subs;B!==void 0?m(B.sub):xt[Dt++]=w}},unwatched(m){if("getter"in m){let w=m.deps;if(w!==void 0){m.flags=17;do w=Lt(w,m);while(w!==void 0)}}else"previousValue"in m||Ot.call(m)}}),we,Ce,es=0,Xe=0,Dt=0;function ae(m){let w=we;return we=m,w}function ni(m){let w=Ce;return Ce=m,w}function bi(m){return rs.bind({previousValue:m,value:m,subs:void 0,subsTail:void 0,flags:1})}function ts(m){let w={fn:m,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:2};we!==void 0?Ze(w,we):Ce!==void 0&&Ze(w,Ce);let y=ae(w);try{w.fn()}finally{ae(y)}return Ot.bind(w)}function is(m){let w=ae(m);Si(m);try{let y=m.value;return y!==(m.value=m.getter(y))}finally{ae(w),mi(m)}}function wi(m,w){return m.flags=1,m.previousValue!==(m.previousValue=w)}function Ci(m,w){if(16&w||32&w&&Zi(m.deps,m)){let B=ae(m);Si(m);try{m.fn()}finally{ae(B),mi(m)}return}32&w&&(m.flags=-33&w);let y=m.deps;for(;y!==void 0;){let B=y.dep,E=B.flags;64&E&&Ci(B,B.flags=-65&E),y=y.nextDep}}function ss(){for(;Xe<Dt;){let m=xt[Xe];xt[Xe++]=void 0,Ci(m,m.flags&=-65)}Xe=0,Dt=0}function rs(...m){if(!m.length){let w=this.value;if(16&this.flags&&wi(this,w)){let y=this.subs;y!==void 0&&Qi(y)}return we!==void 0&&Ze(this,we),w}{let w=m[0];if(this.value!==(this.value=w)){this.flags=17;let y=this.subs;y!==void 0&&(Yi(y),es||ss())}}}function Ot(){let m=this.deps;for(;m!==void 0;)m=Lt(m,this);let w=this.subs;w!==void 0&&Lt(w),this.flags=0}var ns={greedy:!1};var os=m=>{ri.push(ae(void 0));try{return m()}finally{ae(ri.pop())}},_e=class{constructor(w,y){this._=w(y)}get value(){return this._()}set value(w){this._(w)}peek(){return os(this._)}valueOf(){return this.value}};var Bt=class extends _e{constructor(w){super(bi,[w])}get value(){return super.value[0]}set value(w){super.value=[w]}peek(){return super.peek()[0]}};var yi=(m,{greedy:w=!1}=ns)=>w?new Bt(m):new _e(bi,m);var oi=m=>{yi=m},{isArray:ai}=Array,{assign:as,defineProperties:ls,entries:Ht,freeze:Ei}=Object,Rt=class{#e;constructor(w){this.#e=w}valueOf(){return this.#e}toString(){return String(this.#e)}};var li=m=>document.createComment(m),be=42,ki=new Set(["plaintext","script","style","textarea","title","xmp"]),xi=new Set(["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),Oe=Ei({}),te=Ei([]),re=(m,w)=>(m.children===te&&(m.children=[]),m.children.push(w),w.parent=m,w),cs=(m,w,y)=>{m.props===Oe&&(m.props={}),m.props[w]=y},He=(m,w,y)=>{m!==w&&y.push(m)},ve=class{constructor(w){this.type=w,this.parent=null}toJSON(){return[this.type,this.data]}},Qe=class extends ve{constructor(w){super(8),this.data=w}toString(){return`<!--${this.data}-->`}},et=class extends ve{constructor(w){super(10),this.data=w}toString(){return`<!${this.data}>`}},tt=class extends ve{constructor(w){super(3),this.data=w}toString(){return this.data}},it=class extends ve{constructor(){super(be),this.name="template",this.props=Oe,this.children=te}toJSON(){let w=[be];return He(this.props,Oe,w),He(this.children,te,w),w}toString(){let w="";for(let y in this.props){let B=this.props[y];B!=null&&(typeof B=="boolean"?B&&(w+=` ${y}`):w+=` ${y}="${B}"`)}return`<template${w}>${this.children.join("")}</template>`}},st=class extends ve{constructor(w,y=!1){super(1),this.name=w,this.xml=y,this.props=Oe,this.children=te}toJSON(){let w=[1,this.name,+this.xml];return He(this.props,Oe,w),He(this.children,te,w),w}toString(){let{xml:w,name:y,props:B,children:E}=this,{length:r}=E,a=`<${y}`;for(let o in B){let u=B[o];u!=null&&(typeof u=="boolean"?u&&(a+=w?` ${o}=""`:` ${o}`):a+=` ${o}="${u}"`)}if(r){a+=">";for(let o=!w&&ki.has(y),u=0;u<r;u++)a+=o?E[u].data:E[u];a+=`</${y}>`}else a+=w?" />":xi.has(y)?">":`></${y}>`;return a}},rt=class extends ve{constructor(){super(11),this.name="#fragment",this.children=te}toJSON(){let w=[11];return He(this.children,te,w),w}toString(){return this.children.join("")}},fe="\0",hs=`"${fe}"`,ds=`'${fe}'`,us=/\x00|<[^><\s]+/g,fs=/([^\s/>=]+)(?:=(\x00|(?:(['"])[\s\S]*?\3)))?/g,_s=(m,w,y,B,E)=>[w,y,B],Je=m=>{let w=[];for(;m.parent;){switch(m.type){case be:case 1:m.name==="template"&&w.push(-1)}w.push(m.parent.children.indexOf(m)),m=m.parent}return w},ci=(m,w)=>{do m=m.parent;while(w.has(m));return m},vs=(m,w)=>w<0?m.content:m.childNodes[w],ps=(m,w)=>w.reduceRight(vs,m),hi,Li=!1,Ft=({firstChild:m,lastChild:w})=>{let y=hi||(hi=document.createRange());return y.setStartAfter(m),y.setEndAfter(w),y.deleteContents(),m},at=(m,w)=>Li&&m.nodeType===11?1/w<0?w?Ft(m):m.lastChild:w?m.valueOf():m.firstChild:m,oe=Symbol("nodes"),gs={get(){return this.firstChild.parentNode}},ms={value(m){Ft(this).replaceWith(m)}},Ss={value(){Ft(this).remove()}},bs={value(){let{parentNode:m}=this;if(m===this)this[oe]===te&&(this[oe]=[...this.childNodes]);else{if(m){let{firstChild:w,lastChild:y}=this;for(this[oe]=[w];w!==y;)this[oe].push(w=w.nextSibling)}this.replaceChildren(...this[oe])}return this}};function Wt(m){let w=li("<>"),y=li("</>");return m.replaceChildren(w,...m.childNodes,y),Li=!0,ls(m,{[oe]:{writable:!0,value:te},firstChild:{value:w},lastChild:{value:y},parentNode:gs,valueOf:bs,replaceWith:ms,remove:Ss})}Wt.prototype=DocumentFragment.prototype;var Se=16,di=32768,Di=((m=globalThis.document)=>{let w,y=m.createElement("template");return(B,E=!1)=>{if(E)return w||(w=m.createRange(),w.selectNodeContents(m.createElementNS("http://www.w3.org/2000/svg","svg"))),w.createContextualFragment(B);y.innerHTML=B;let r=y.content;return y=y.cloneNode(!1),r}})(document),Ye=Symbol("ref"),ws=(m,w)=>{for(let[y,B]of Ht(w)){let E=y==="role"?y:`aria-${y.toLowerCase()}`;B==null?m.removeAttribute(E):m.setAttribute(E,B)}},Bi=m=>(w,y)=>{y==null?w.removeAttribute(m):w.setAttribute(m,y)},Cs=(m,w)=>{m[oe]=((y,B,E,r)=>{let a=r.parentNode,o=B.length,u=y.length,n=o,l=0,_=0,v=null;for(;l<u||_<n;)if(u===l){let h=n<o?_?E(B[_-1],-0).nextSibling:E(B[n],0):r;for(;_<n;)a.insertBefore(E(B[_++],1),h)}else if(n===_)for(;l<u;)v&&v.has(y[l])||E(y[l],-1).remove(),l++;else if(y[l]===B[_])l++,_++;else if(y[u-1]===B[n-1])u--,n--;else if(y[l]===B[n-1]&&B[_]===y[u-1]){let h=E(y[--u],-0).nextSibling;a.insertBefore(E(B[_++],1),E(y[l++],-0).nextSibling),a.insertBefore(E(B[--n],1),h),y[u]=B[n]}else{if(!v){v=new Map;let e=_;for(;e<n;)v.set(B[e],e++)}let h=v.get(y[l])??-1;if(h<0)E(y[l++],-1).remove();else if(_<h&&h<n){let e=l,s=1;for(;++e<u&&e<n&&v.get(y[e])===h+s;)s++;if(s>h-_){let t=E(y[l],0);for(;_<h;)a.insertBefore(E(B[_++],1),t)}else a.replaceChild(E(B[_++],1),E(y[l++],-1))}else l++}return B})(m[oe]||te,w,at,m)},ui=new WeakMap,Tt=(m,w)=>{let y=typeof w=="object"?w??m:((E,r)=>{let a=ui.get(E);return a?a.data=r:ui.set(E,a=document.createTextNode(r)),a})(m,w),B=m[oe]??m;y!==B&&B.replaceWith(at(m[oe]=y,1))},ys=(m,w)=>{Tt(m,w instanceof _e?w.value:w)},Es=({dataset:m},w)=>{for(let[y,B]of Ht(w))B==null?delete m[y]:m[y]=B},fi=new Map,Et=m=>{let w=fi.get(m);return w||fi.set(m,w=At(m)),w},At=m=>(w,y)=>{w[m]=y},ks=(m,w)=>{for(let[y,B]of Ht(w))Bi(y)(m,B)},xs=(m,w,y)=>y?(B,E)=>{let r=B[w];r?.length&&B.removeEventListener(m,...r),E&&B.addEventListener(m,...E),B[w]=E}:(B,E)=>{let r=B[w];r&&B.removeEventListener(m,r),E&&B.addEventListener(m,E),B[w]=E},Ls=m=>(w,y)=>{w.toggleAttribute(m,!!y)},Mt=!1,Ri=!0,nt=m=>{Ri=m},Nt=()=>Ri,lt=m=>at(m.n?m.update(m):m.valueOf(!1),1),_i=(m,w)=>{let y=[],B=m.length,E=w.length;for(let r,a,o=0,u=0;u<E;u++)r=w[u],y[u]=o<B&&(a=m[o++]).t===r.t?(w[u]=a).update(r):r.valueOf(!1);return y},vi=(m,w,y)=>{let B=yi,E=y.length,r=0;oi(o=>r<E?y[r++]:y[r++]=o instanceof _e?o:B(o));let a=Nt();a&&nt(!a);try{return m(w,Ti)}finally{a&&nt(a),oi(B)}},Pt=(m,w)=>(m.t===w.t?m.update(w):(m.n.replaceWith(lt(w)),m=w),m),Ds=(m,w,y)=>{let B,E=[],r=[Se,null,y],a=!0;return ts(()=>{if(a)a=!1,B=vi(w,y,E),E.length||(E=te),B?(m.replaceWith(lt(B)),r[1]=B):m.remove();else{let o=vi(w,y,E);B&&Pt(B,o)===o&&(r[2]=B=o)}}),r},pi=Symbol(),Ti={},ot=class m{constructor(w,y){this.t=w,this.v=y,this.n=null,this.k=-1}valueOf(w=Nt()){let[y,B,E]=this.t,r=document.importNode(y,!0),a=this.v,o,u,n,l=a.length,_=te;if(0<l){for(_=B.slice(0);l--;){let[s,t,i]=B[l],c=a[l];if(u!==s&&(o=ps(r,s),u=s),i&Se){let f=o[pi]||(o[pi]={});if(i===Se){for(let{name:p,value:S}of o.attributes)f[p]??=S;f.children??=[...o.content.childNodes],_[l]=Ds(o,c,f)}else t(f,c),_[l]=[i,t,f]}else{let f=!0;w||!(8&i)||i&di||(1&i?(f=!1,c.length&&t(o,c[0]instanceof m?_i(te,c):c)):c instanceof m&&(f=!1,t(o,lt(c)))),f&&(i===512?this.k=l:(i===16384&&(n??=new Set).add(o),t(o,c))),_[l]=[i,t,c,o],w&&8&i&&o.remove()}}n&&(s=>{for(let t of s){let i=t[Ye];typeof i=="function"?i(t):i instanceof _e?i.value=t:i&&(i.current=t)}})(n)}let{childNodes:v}=r,h=v.length,e=h===1?v[0]:h?Wt(r):r;return this.v=_,this.n=e,-1<this.k&&E.set(_[this.k][2],e,this),e}update(w){let y=this.k,B=this.v,E=w.v;if(-1<y&&B[y][2]!==E[y])return((a,o)=>a.t[2].get(o)?.update(a)??a.valueOf(!1))(w,E[y]);let{length:r}=B;for(;r--;){let a=B[r],[o,u,n]=a;if(o===512)continue;let l=E[r];if(o&Se)if(o===Se){let _=l(n,Ti);u&&Pt(u,_)===_&&(a[2]=_)}else u(n,l);else{let _=l;if(1&o){if(8&o)l.length&&l[0]instanceof m&&(_=_i(n,l));else if(256&o&&l[0]===n[0])continue}else if(8&o)if(o&di){if(l===n){u(a[3],_);continue}}else n instanceof m&&(l=Pt(n,l),_=l.n);l!==n&&(a[2]=l,u(a[3],_))}}return this.n}},gi=new WeakMap,It=class extends Map{constructor(){super()._=new FinalizationRegistry(w=>this.delete(w))}get(w){let y=super.get(w)?.deref();return y&&gi.get(y)}set(w,y,B){gi.set(y,B),this._.register(y,w),super.set(w,new WeakRef(y))}},Bs=(({Comment:m=Qe,DocumentType:w=et,Text:y=tt,Fragment:B=rt,Element:E=st,Component:r=it,update:a=_s})=>(o,u,n)=>{let l=o.join(fe).trim(),_=new Set,v=[],h=new B,e=0,s=0,t=0,i=te;for(let c of l.matchAll(us)){if(0<s){s--;continue}let f=c[0],p=c.index;if(e<p&&re(h,new y(l.slice(e,p))),f===fe){h.name==="table"&&(h=re(h,new E("tbody",n)),_.add(h));let S=re(h,new m("\u25E6"));v.push(a(S,8,Je(S),"",u[t++])),e=p+1}else if(f.startsWith("<!")){let S=l.indexOf(">",p+2);if(l.slice(S-2,S+1)==="-->"){let d=l.slice(p+4,S-2);d[0]==="!"&&re(h,new m(d.slice(1).replace(/!$/,"")))}else re(h,new w(l.slice(p+2,S)));e=S+1}else if(f.startsWith("</")){let S=l.indexOf(">",p+2);n&&h.name==="svg"&&(n=!1),h=ci(h,_),e=S+1}else{let S=p+f.length,d=l.indexOf(">",S),g=f.slice(1),k=g;if(g===fe?(k="template",h=re(h,new r),i=Je(h).slice(1),v.push(a(h,be,i,"",u[t++]))):(n||(k=k.toLowerCase(),h.name!=="table"||k!=="tr"&&k!=="td"||(h=re(h,new E("tbody",n)),_.add(h)),h.name==="tbody"&&k==="td"&&(h=re(h,new E("tr",n)),_.add(h))),h=re(h,new E(k,!!n&&k!=="svg")),i=te),S<d){let x=!1;for(let[R,P,O]of l.slice(S,d).matchAll(fs))if(O===fe||O===hs||O===ds||(x=P.endsWith(fe))){let W=i===te?i=Je(h):i;v.push(a(h,2,W,x?P.slice(0,-1):P,u[t++])),x=!1,s++}else cs(h,P,!O||O.slice(1,-1));i=te}e=d+1;let T=0<d&&l[d-1]==="/";if(n)T&&(h=h.parent);else if(T||xi.has(k))h=T?ci(h,_):h.parent;else if(k==="svg")n=!0;else if(ki.has(k)){let x=l.indexOf(`</${g}>`,e),R=l.slice(e,x);R.trim()===fe?(s++,v.push(a(h,3,Je(h),"",u[t++]))):re(h,new y(R)),h=h.parent,e=x+g.length+3,s++;continue}}}return e<l.length&&re(h,new y(l.slice(e))),[h,v]})({Comment:Qe,DocumentType:et,Text:tt,Fragment:rt,Element:st,Component:it,update:(m,w,y,B,E)=>{switch(w){case be:return[y,E,Se];case 8:return ai(E)?[y,Cs,9]:E instanceof Rt?[y,(r=m.xml,(a,o)=>{let u=a[Ye]??(a[Ye]={});u.v!==o&&(u.f=Wt(Di(o,r)),u.v=o),Tt(a,u.f)}),8192]:E instanceof _e?[y,ys,32776]:[y,Tt,8];case 3:return[y,Et("textContent"),2048];case 2:{let a=m.type===be;switch(B.at(0)){case"@":{let o=ai(E);return[y,xs(B.slice(1),Symbol(B),o),o?257:256]}case"?":return[y,Ls(B.slice(1)),4096];case".":return B==="..."?[y,a?as:ks,a?144:128]:[y,At(B.slice(1)),a?80:64];default:return a?[y,At(B),1040]:B==="aria"?[y,ws,2]:B!=="data"||/^object$/i.test(m.name)?B==="key"?[y,Mt=!0,512]:B==="ref"?[y,Et(Ye),16384]:B.startsWith("on")?[y,Et(B.toLowerCase()),64]:[y,Bi(B),4]:[y,Es,32]}}}var r}}),Ai=(m,w=new WeakMap)=>(y,...B)=>{let E=w.get(y);return E||(E=Bs(y,B,m),E.push((()=>{let r=Mt;return Mt=!1,r})()?new It:null),E[0]=Di(E[0].toString(),m),w.set(y,E)),new ot(E,B)},Rs=Ai(!1),Hr=Ai(!0),kt=new WeakMap;function Q(m,...w){let y=Rs.apply(null,arguments);return Nt()?y.valueOf(!0):y}var pe=(m,w)=>{let y=kt.get(m);if(y&&y[0](),typeof w=="function"){let B;nt(!1);let E=function(r){let a={deps:void 0,depsTail:void 0,subs:void 0,subsTail:void 0,flags:0};Ce!==void 0&&Ze(a,Ce);let o=ae(void 0),u=ni(a);try{r()}finally{ni(u),ae(o)}return Ot.bind(a)}(()=>{B=w()});if(y&&y[1].t===B.t)y[1].update(B);else{let r=B.valueOf(!1);m.replaceChildren(r)}kt.set(m,[E,B])}else nt(!0),kt.delete(m),m.replaceChildren(w instanceof ot?lt(w):at(w,1));return m};async function ct(){let m=document.getElementById("file-browser");if(m)if(U.isFileBrowserOpen)m.classList.add("hidden"),m.classList.remove("flex","fullscreen"),U.isFileBrowserOpen=!1;else{m.classList.remove("hidden"),m.classList.add("flex","fullscreen"),U.isFileBrowserOpen=!0;let w=U.currentProject?`../projects/${U.currentProject}`:"~";await ye(w)}}async function ye(m){try{let w=await fetch(`/api/browse?path=${encodeURIComponent(m)}`),y=await w.json();if(!w.ok)throw new Error(y.error||"Failed to load directory");U.currentBrowserPath=y.currentPath,Ts(y);let B=document.getElementById("current-dir");B&&(B.value=y.currentPath)}catch(w){console.error("Error loading directory:",w),await window.Swal.fire({title:"Error",text:"Failed to load directory: "+w.message,icon:"error"})}}function Ts(m){let w=document.getElementById("file-list");if(!w)return;let y=B=>Q`<div class="file-item p-2 rounded cursor-pointer flex items-center gap-2 text-sm" onclick=${()=>B.type==="directory"?ye(B.path):ht(B.path)}>
    <span class="text-lg">${B.type==="directory"?"\u{1F4C1}":"\u{1F4C4}"}</span>
    <span class="flex-1 truncate" title=${B.name}>${B.name.length>25?B.name.substring(0,22)+"...":B.name}</span>
  </div>`;pe(w,Q`<div>
      ${m.parentPath&&m.parentPath!==m.currentPath?y({name:"..",type:"directory",path:m.parentPath}):null}
      ${m.items.map(B=>y(B))}
    </div>`)}async function ht(m){try{let w=await fetch(`/api/file?path=${encodeURIComponent(m)}`),y=await w.json();if(!w.ok)throw new Error(y.error||"Failed to load file");U.currentEditingFile=y.path;let B=document.getElementById("file-editor");B?.classList.remove("hidden"),B?.classList.add("flex","fullscreen"),U.isFileEditorOpen=!0;let E=document.getElementById("file-content"),r=document.getElementById("editor-filename");E&&(E.value=y.content),r&&(r.textContent=m.split("/").pop()||"")}catch(w){console.error("Error opening file:",w),await window.Swal.fire({title:"Error",text:"Failed to open file: "+w.message,icon:"error"})}}async function Fe(){if(!U.currentEditingFile){await window.Swal.fire({title:"Warning",text:"No file is currently being edited",icon:"warning"});return}try{let w=document.getElementById("file-content")?.value||"",y=await fetch("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:U.currentEditingFile,content:w})}),B=await y.json();if(!y.ok)throw new Error(B.error||"Failed to save file");let E=document.getElementById("save-file");if(E){let r=E.textContent||"Save";E.textContent="Saved!",E.classList.add("btn-success"),setTimeout(()=>{E.textContent=r,E.classList.remove("btn-success")},1e3)}}catch(m){console.error("Error saving file:",m),await window.Swal.fire({title:"Error",text:"Failed to save file: "+m.message,icon:"error"})}}function Ee(){let m=document.getElementById("file-editor");m?.classList.add("hidden"),m?.classList.remove("flex","fullscreen"),U.isFileEditorOpen=!1,U.currentEditingFile=null}function ke(){let m=document.getElementById("file-browser");m?.classList.add("hidden"),m?.classList.remove("flex","fullscreen"),U.isFileBrowserOpen=!1}function dt(){let m=document.getElementById("new-file-modal"),w=document.getElementById("new-file-name");!m||!w||(w.value="",m.showModal(),w.focus())}function ut(){let m=document.getElementById("new-folder-modal"),w=document.getElementById("new-folder-name");!m||!w||(w.value="",m.showModal(),w.focus())}async function We(){let w=(document.getElementById("new-file-name")?.value||"").trim();if(!w)return;if(!U.currentBrowserPath){await window.Swal.fire({title:"Warning",text:"No directory selected",icon:"warning"});return}let y=`${U.currentBrowserPath}/${w}`;try{let B=await fetch("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:y,content:""})}),E=await B.json();if(!B.ok)throw new Error(E.error||"Failed to create file");await ye(U.currentBrowserPath),await ht(y),document.getElementById("new-file-modal")?.close()}catch(B){console.error("Error creating file:",B),await window.Swal.fire({title:"Error",text:"Failed to create file: "+B.message,icon:"error"})}}async function Ne(){let w=(document.getElementById("new-folder-name")?.value||"").trim();if(!w)return;if(!U.currentBrowserPath){await window.Swal.fire({title:"Warning",text:"No directory selected",icon:"warning"});return}let y=`${U.currentBrowserPath}/${w}`;try{let B=await fetch("/api/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:y})}),E=await B.json();if(!B.ok)throw new Error(E.error||"Failed to create folder");await ye(U.currentBrowserPath),document.getElementById("new-folder-modal")?.close()}catch(B){console.error("Error creating folder:",B),await window.Swal.fire({title:"Error",text:"Failed to create folder: "+B.message,icon:"error"})}}function _t(){typeof window.cleanupTerminal=="function"&&window.cleanupTerminal(),U.sessionID=null,U.currentProject=null,typeof window.updateURLWithoutSession=="function"&&window.updateURLWithoutSession(),le()}function vt(){typeof window.cleanupTerminal=="function"&&window.cleanupTerminal(),U.sessionID=null,U.currentProject=null,le()}async function le(){let m=window.hideNavigationBar;m&&m();try{let[w,y]=await Promise.all([fetch("/api/sessions"),fetch("/api/projects-with-worktrees")]),B=await w.json(),E=await y.json(),r=document.getElementById("terminal-container");if(!r)return;let a=n=>Q`
      <div class="card bg-base-200 shadow-lg hover:shadow-xl transition-shadow">
        <div class="card-body p-4">
          <div class="flex justify-between items-start">
            <div class="cursor-pointer flex-1" onclick=${()=>ft(n.id,n.projectName)}>
              <div class="flex items-center gap-2 mb-2">
                <h3 class="font-semibold text-sm">${n.id}</h3>
                <span class="badge badge-primary badge-sm">${n.projectName}</span>
              </div>
              <p class="text-xs opacity-70 line-clamp-2 break-all">Status: <span>${Gt(n.status)}</span></p>
              <p class="text-xs opacity-50">Created: ${new Date(n.created).toLocaleString()}</p>
            </div>
            <div class="flex gap-2">
              <button class="btn btn-primary btn-sm" onclick=${()=>ft(n.id,n.projectName)}>Connect</button>
              <button class="btn btn-error btn-sm" onclick=${()=>Ut(n.id)}>Kill</button>
            </div>
          </div>
        </div>
      </div>`,o=(n,l)=>Q`
      <div class="bg-base-100 rounded-lg p-3 flex justify-between items-center">
        <div class="cursor-pointer flex-1" onclick=${()=>window.openWorktree?.(n,l.name)}>
          <div class="flex items-center gap-2">
            <span class="text-success"></span>
            <span class="font-medium text-sm">${l.name}</span>
            <span class="badge badge-outline badge-xs">${l.branch}</span>
          </div>
          <p class="text-xs opacity-60 mt-1">${l.relativePath}</p>
        </div>
        <div class="flex gap-1">
          <button class="btn btn-xs btn-primary" onclick=${()=>window.openWorktree?.(n,l.name)}>Open</button>
          <button class="btn btn-xs btn-success" onclick=${()=>window.mergeWorktree?.(n,l.name)}>Merge</button>
          <button class="btn btn-xs btn-error" onclick=${()=>window.deleteWorktree?.(n,l.name)}>Delete</button>
        </div>
      </div>`,u=n=>Q`
      <div class="card bg-base-300 shadow-lg">
        <div class="card-body p-4">
          <div class="flex justify-between items-center mb-4">
            <div class="cursor-pointer flex-1" onclick=${()=>je(n.name)}>
              <h3 class="text-lg font-bold">${n.name}</h3>
            </div>
            <div class="flex gap-2">
              <button class="btn btn-primary btn-sm" onclick=${()=>je(n.name)}>Open Project</button>
              <button class="btn btn-secondary btn-sm" onclick=${()=>window.createWorktreeModal?.(n.name)}>+ Worktree</button>
              <button class="btn btn-error btn-sm" onclick=${()=>$t(n.name)}>Delete</button>
            </div>
          </div>
          ${n.worktrees.length>0?Q`<div class="mt-3">
                <h4 class="text-sm font-semibold mb-2 opacity-80">Worktrees:</h4>
                <div class="grid gap-2">
                  ${n.worktrees.map(l=>o(n.name,l))}
                </div>
               </div>`:Q`<p class="text-xs opacity-50 mt-2">No worktrees</p>`}
        </div>
      </div>`;pe(r,Q`<div class="p-6 max-w-6xl mx-auto h-full flex flex-col overflow-y-auto">
        <div class="flex items-center justify-between mb-8">
          <h1 class="text-3xl font-bold">Shell Dashboard</h1>
          <div class="flex gap-2">
            <button class="btn btn-outline btn-sm" onclick=${()=>window.showEnvironmentManager?.()}><span class="text-lg"></span> Environment Variables</button>
            <button class="btn btn-outline btn-sm" onclick=${()=>window.showAliasesManager?.()}><span class="text-lg"></span> Shell Aliases</button>
          </div>
        </div>
        <div class="mb-8">
          <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><span class="text-primary"></span> All Active Sessions</h2>
          <div class="grid gap-3 mb-6">
            ${B.length===0?Q`<p class="text-center opacity-70 py-4">No active sessions</p>`:B.map(n=>a(n))}
          </div>
        </div>
        <div class="mb-8">
          <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><span class="text-secondary"></span> All Projects & Worktrees</h2>
          <div class="mb-6">
            <div class="flex gap-2">
              <input type="text" id="project-name" placeholder="Enter project name" class="input input-bordered flex-1">
              <button class="btn btn-primary" onclick=${()=>jt()}>Create Project</button>
            </div>
          </div>
          <div class="grid gap-4">
            ${E.length===0?Q`<p class="text-center opacity-70 py-4">No projects found</p>`:E.map(n=>u(n))}
          </div>
        </div>
      </div>`)}catch(w){console.error("Failed to load sessions and projects:",w);let y=document.getElementById("terminal-container");y&&(y.innerHTML='<div class="p-6 text-center text-error">Error loading sessions and projects</div>')}}async function jt(){let w=(document.getElementById("project-name")?.value||"").trim();if(!w){await window.Swal.fire({title:"Error",text:"Please enter a project name",icon:"error"});return}try{let y=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:w})}),B=await y.json();y.ok?je(B.name):await window.Swal.fire({title:"Error",text:B.error||"Failed to create project",icon:"error"})}catch(y){console.error("Error creating project:",y),await window.Swal.fire({title:"Error",text:"Error creating project",icon:"error"})}}async function $t(m){if((await window.Swal.fire({title:"Delete Project?",text:`Are you sure you want to delete the project "${m}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{let y=await fetch(`/api/projects/${encodeURIComponent(m)}`,{method:"DELETE"}),B=await y.json();y.ok?(await window.Swal.fire({title:"Deleted!",text:B.message||"Project deleted successfully",icon:"success"}),le()):await window.Swal.fire({title:"Error",text:B.error||"Failed to delete project",icon:"error"})}catch(y){console.error("Error deleting project:",y),await window.Swal.fire({title:"Error",text:"Error deleting project",icon:"error"})}}function je(m){U.currentProject=m,U.sessionID=null,ue()}function ft(m,w){typeof de=="function"&&de(),U.sessionID=m,U.currentProject=w??U.currentProject,typeof window.updateURLWithSession=="function"&&window.updateURLWithSession(m,U.currentProject),ue()}async function Ut(m){try{let y=await(await fetch(`/api/sessions/${m}`,{method:"DELETE"})).json();y.success?le():await window.Swal.fire({title:"Error",text:"Failed to kill session: "+y.message,icon:"error"})}catch(w){console.error("Error killing session:",w),await window.Swal.fire({title:"Error",text:"Error killing session",icon:"error"})}}function Mi(){let m=document.getElementById("nav-bar");if(m){m.classList.remove("hidden");let w=document.getElementById("current-path");w&&U.currentProject&&(w.textContent=`Project: ${U.currentProject}`)}}function Pi(){document.getElementById("nav-bar")?.classList.add("hidden")}function Ii(){window.addEventListener("popstate",()=>{U.sessionID=Ae(),U.currentProject=Me(),U.sessionID?ue():le()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("back-to-sessions")?.addEventListener("click",()=>{de(),U.currentProject?vt():_t()}),document.getElementById("browse-files")?.addEventListener("click",()=>void ct()),document.getElementById("close-browser")?.addEventListener("click",()=>ke()),document.getElementById("new-folder")?.addEventListener("click",()=>ut()),document.getElementById("new-file")?.addEventListener("click",()=>dt()),document.getElementById("create-file-btn")?.addEventListener("click",()=>void We()),document.getElementById("cancel-file-btn")?.addEventListener("click",()=>document.getElementById("new-file-modal")?.close()),document.getElementById("create-folder-btn")?.addEventListener("click",()=>void Ne()),document.getElementById("cancel-folder-btn")?.addEventListener("click",()=>document.getElementById("new-folder-modal")?.close()),document.getElementById("new-file-name")?.addEventListener("keypress",o=>{o.key==="Enter"&&We()}),document.getElementById("new-folder-name")?.addEventListener("keypress",o=>{o.key==="Enter"&&Ne()}),document.getElementById("save-file")?.addEventListener("click",()=>void Fe()),document.getElementById("close-editor")?.addEventListener("click",()=>Ee()),document.getElementById("file-content")?.addEventListener("keydown",o=>{let u=o;if((u.ctrlKey||u.metaKey)&&u.key==="s"&&(u.preventDefault(),Fe()),u.key==="Tab"&&o.target instanceof HTMLTextAreaElement){u.preventDefault();let n=o.target.selectionStart,l=o.target.selectionEnd,_=o.target.value;o.target.value=_.substring(0,n)+"	"+_.substring(l),o.target.selectionStart=o.target.selectionEnd=n+1}}),document.addEventListener("keydown",o=>{o.key==="Escape"&&(U.isFileEditorOpen?Ee():U.isFileBrowserOpen&&ke())}),document.addEventListener("click",o=>{let u=document.getElementById("file-browser"),n=document.getElementById("file-editor");U.isFileBrowserOpen&&u&&!u.contains(o.target)&&!o.target.closest("#browse-files")&&ke(),U.isFileEditorOpen&&n&&!n.contains(o.target)&&(o.target.closest(".file-item")||Ee())}),document.getElementById("file-browser")?.addEventListener("click",o=>o.stopPropagation()),document.getElementById("file-editor")?.addEventListener("click",o=>o.stopPropagation()),Ms(),As()}),window.addEventListener("resize",()=>ii()),document.addEventListener("visibilitychange",()=>{let m=window.terminalInstance;if(!document.hidden&&m){if(m.focus?.(),!U.isConnected){let w=Ie();(!w||w.readyState!==WebSocket.OPEN)&&window.connectWebSocket?.()}}else if(document.hidden){let w=Ie();w&&w.readyState===WebSocket.OPEN&&w.close()}}),document.addEventListener("click",m=>{let w=document.getElementById("custom-input-container");w&&!w.contains(m.target)&&window.terminalInstance?.focus?.()}),window.addEventListener("beforeunload",()=>de())}function As(){let m=document.getElementById("custom-command-input");if(!m)return;let w=JSON.parse(localStorage.getItem("terminalCommandHistory")||"[]"),y=-1,B="",E=null,r=l=>{if(l&&l.trim()){let _=w.indexOf(l);_>-1&&w.splice(_,1),w.unshift(l),w.length>100&&(w=w.slice(0,100)),localStorage.setItem("terminalCommandHistory",JSON.stringify(w))}},a=()=>{E?.remove(),E=document.createElement("div"),E.className="absolute bottom-full left-0 right-0 bg-base-200 border border-base-300 rounded-t-lg max-h-40 overflow-y-auto z-50 hidden",E.style.marginBottom="2px";let l=m.parentElement;return l.style.position="relative",l.appendChild(E),E},o=l=>{E||a();let _=w.filter(v=>v.toLowerCase().includes(l.toLowerCase())&&v!==l).slice(0,5);if(_.length===0){E.classList.add("hidden");return}E.innerHTML="",_.forEach(v=>{let h=document.createElement("div");h.className="px-3 py-2 cursor-pointer hover:bg-base-300 text-sm",h.textContent=v,h.addEventListener("click",()=>{m.value=v,E.classList.add("hidden"),m.focus()}),E.appendChild(h)}),E.classList.remove("hidden")},u=()=>{E?.classList.add("hidden")},n=()=>{let l=Ie(),_=(m.value||"").trim();!_||!l||(r(_),y=-1,B="",u(),window.terminalInstance?.focus?.(),setTimeout(()=>{U.isConnected&&l&&l.readyState===WebSocket.OPEN&&(l.send(JSON.stringify({type:"input",data:_})),setTimeout(()=>{l.send(JSON.stringify({type:"input",data:"\r"}))},50),m.value="",m.style.height="auto",m.rows=1,setTimeout(()=>m.focus(),100))},50))};m.addEventListener("keydown",l=>{let _=l;_.key==="Enter"?_.shiftKey?setTimeout(()=>{m.style.height="auto",m.style.height=Math.min(m.scrollHeight,120)+"px"},0):(_.preventDefault(),n()):_.key==="ArrowUp"?(_.preventDefault(),y===-1&&(B=m.value),y<w.length-1&&(y++,m.value=w[y],u())):_.key==="ArrowDown"?(_.preventDefault(),y>0?(y--,m.value=w[y],u()):y===0&&(y=-1,m.value=B,u())):_.key==="Escape"&&(u(),y=-1,B="")}),m.addEventListener("input",()=>{m.style.height="auto",m.style.height=Math.min(m.scrollHeight,120)+"px",y=-1,B=m.value;let l=m.value.trim();l.length>0?o(l):u()}),m.addEventListener("blur",()=>{m.value.trim()||(m.style.height="auto",m.rows=1),setTimeout(()=>u(),200)}),m.addEventListener("focus",()=>{let l=m.value.trim();l.length>0&&o(l)}),a(),document.addEventListener("click",l=>{!m.contains(l.target)&&(!E||!E.contains(l.target))&&u()})}function Ms(){document.getElementById("virtual-keyboard")?.addEventListener("click",async w=>{let y=w.target.closest("button[data-key-code]");if(!y)return;let B=parseInt(y.dataset.keyCode||"0",10),E="";switch(B){case 27:E="\x1B";break;case 9:E="	";break;case 17:{let o=(await window.Swal.fire({title:"Ctrl Key Combination",input:"text",inputLabel:"Enter next key for Ctrl combination",inputPlaceholder:"e.g., 'c' for Ctrl+C, 'z' for Ctrl+Z",showCancelButton:!0,inputValidator:u=>u?void 0:"You need to enter a key!"})).value;if(o){let u=o.toLowerCase().charCodeAt(0);u>=97&&u<=122?E=String.fromCharCode(u-96):o==="["?E="\x1B":o==="\\"?E="":o==="]"?E="":o==="^"?E="":o==="_"&&(E="")}break}case 3:E="";break;case 38:E="\x1B[A";break;case 40:E="\x1B[B";break;case 37:E="\x1B[D";break;case 39:E="\x1B[C";break;default:break}let r=Ie();U.isConnected&&E&&r&&(window.terminalInstance?.focus?.(),setTimeout(()=>r.send(JSON.stringify({type:"input",data:E})),50))})}var xe=null,$e=!1;async function Oi(){try{let w=await(await fetch("/api/environment")).json(),y=document.getElementById("terminal-container");if(!y)return;let B="Loaded",E=w.text||"",r=h=>{B=h,v(),(h.includes("Saved")||h.includes("failed")||h.includes("error"))&&setTimeout(()=>{B===h&&(B="",v())},3e3)},a=async()=>{try{r("Saving...");let h=await fetch("/api/environment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:E})});if(h.ok){let e=await h.json();$e=!1,r(`Saved (${Object.keys(e.variables).length} variables)`),xe&&(window.clearTimeout(xe),xe=null)}else{let e=await h.json();console.error("Failed to save environment variables:",e),r("Save failed")}}catch(h){console.error("Error saving environment variables:",h),r("Save error")}},o=h=>{E=h.target.value,$e=!0,r("Unsaved changes..."),xe&&window.clearTimeout(xe),xe=window.setTimeout(async()=>{await a()},2e3)},u=async()=>{confirm("Are you sure you want to clear all environment variables?")&&(E="",$e=!0,v(),await a())},n=async()=>{$e&&await a(),window.showSessionsAndProjectsList?.()},l=()=>{let h="text-sm transition-colors duration-200 ";return B.includes("Saved")?h+"text-success":B.includes("Saving")?h+"text-warning":B.includes("failed")||B.includes("error")?h+"text-error":h+"opacity-70"},_=()=>Q`<div class="p-6 max-w-4xl mx-auto h-full flex flex-col">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold">Global Environment Variables</h1>
        <div class="flex gap-2">
          <span class=${l()}>${B}</span>
          <button class="btn btn-outline" onclick=${n}> Back to Dashboard</button>
        </div>
      </div>
      <div class="bg-base-200 rounded-lg p-4 mb-6">
        <p class="text-sm opacity-70 mb-2">Edit environment variables in KEY=VALUE format. Comments starting with # are ignored. These variables will be available in all new terminal sessions across all projects. Changes are automatically saved as you type.</p>
        <p class="text-xs opacity-50">Example: NODE_ENV=production</p>
      </div>
      <div class="bg-base-100 rounded-lg border border-base-300 flex-1 flex flex-col">
        <div class="flex items-center justify-between p-4 border-b border-base-300">
          <h2 class="text-xl font-semibold">Environment Variables</h2>
          <div class="flex gap-2">
            <button class="btn btn-error btn-sm" onclick=${u}>Clear All</button>
            <button class="btn btn-primary btn-sm" onclick=${a}>Save Now</button>
          </div>
        </div>
        <div class="flex-1 p-4">
          <textarea class="textarea textarea-bordered w-full h-full resize-none font-mono text-sm" placeholder="# Add your environment variables here\n# Format: KEY=VALUE\n# Example:\nNODE_ENV=production\nAPI_URL=https://api.example.com\nDEBUG=true" spellcheck="false" oninput=${o}>${E}</textarea>
        </div>
      </div>
    </div>`,v=()=>pe(y,_());v(),window.addEventListener("beforeunload",async()=>{$e&&await a()})}catch(m){console.error("Error loading environment variables:",m),alert("Failed to load environment variables")}}var Le=null,Ue=!1;async function Hi(){try{let w=await(await fetch("/api/aliases")).json(),y=document.getElementById("terminal-container");if(!y)return;let B="Loaded",E=w.text||"",r=h=>{B=h,v(),(h.includes("Saved")||h.includes("failed")||h.includes("error"))&&setTimeout(()=>{B===h&&(B="",v())},3e3)},a=async()=>{try{r("Saving...");let h=await fetch("/api/aliases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:E})});if(h.ok){let e=await h.json();Ue=!1,r(`Saved (${e.aliasCount||0} aliases)`),Le&&(window.clearTimeout(Le),Le=null)}else{let e=await h.json();console.error("Failed to save aliases:",e),r("Save failed"),e.details&&e.details.length>0&&alert(`Save failed:
`+e.details.join(`
`))}}catch(h){console.error("Error saving aliases:",h),r("Save error")}},o=h=>{E=h.target.value,Ue=!0,r("Unsaved changes..."),Le&&window.clearTimeout(Le),Le=window.setTimeout(async()=>{await a()},2e3)},u=async()=>{confirm("Are you sure you want to clear all aliases? This will remove all MyShell24-managed aliases from your .zshrc file.")&&(E="",Ue=!0,v(),await a())},n=async()=>{Ue&&await a(),window.showSessionsAndProjectsList?.()},l=()=>{let h="text-sm transition-colors duration-200 ";return B.includes("Saved")?h+"text-success":B.includes("Saving")?h+"text-warning":B.includes("failed")||B.includes("error")?h+"text-error":h+"opacity-70"},_=()=>Q`<div class="p-6 max-w-4xl mx-auto h-full flex flex-col">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold">Shell Aliases Manager</h1>
        <div class="flex gap-2">
          <span class=${l()}>${B}</span>
          <button class="btn btn-outline" onclick=${n}> Back to Dashboard</button>
        </div>
      </div>
      <div class="bg-base-200 rounded-lg p-4 mb-6">
        <p class="text-sm opacity-70 mb-2">Create and manage zsh shell aliases. Aliases are stored in your ~/.zshrc file. Use the format: <code>alias name='command'</code> or just <code>name=command</code> (auto-formatted). Changes are automatically saved and will be available in new terminal sessions.</p>
        <p class="text-xs opacity-50 mb-2">Examples:<br> <code>alias ll='ls -la'</code><br> <code>alias gs='git status'</code><br> <code>alias ..='cd ..'</code></p>
        <div class="text-xs opacity-50">
          <strong>Location:</strong> ${w.zshrcPath||"~/.zshrc"}
          ${w.hasZshrc?Q`<span class="text-success"> Found</span>`:Q`<span class="text-warning"> Will be created</span>`}
        </div>
      </div>
      <div class="bg-base-100 rounded-lg border border-base-300 flex-1 flex flex-col">
        <div class="flex items-center justify-between p-4 border-b border-base-300">
          <h2 class="text-xl font-semibold">Shell Aliases</h2>
          <div class="flex gap-2">
            <button class="btn btn-error btn-sm" onclick=${u}>Clear All</button>
            <button class="btn btn-primary btn-sm" onclick=${a}>Save Now</button>
          </div>
        </div>
        <div class="flex-1 p-4">
          <textarea class="textarea textarea-bordered w-full h-full resize-none font-mono text-sm" placeholder="# Add your shell aliases here\n# Format: alias name='command' or just name=command\n# Examples:\nalias ll='ls -la'\nalias gs='git status'\nalias ..='cd ..'\nalias grep='grep --color=auto'\nalias h='history'\nalias c='clear'" spellcheck="false" oninput=${o}>${E}</textarea>
        </div>
      </div>
    </div>`,v=()=>pe(y,_());v(),window.addEventListener("beforeunload",async()=>{Ue&&await a()})}catch(m){console.error("Error loading aliases:",m),alert("Failed to load aliases")}}function Fi(m){if(!document.getElementById("new-worktree-modal")){document.body.insertAdjacentHTML("beforeend",`
      <dialog id="new-worktree-modal" class="modal">
        <div class="modal-box">
          <h3 class="font-bold text-lg">Create New Worktree</h3>
          <div class="py-4">
            <div class="mb-4">
              <label class="label"><span class="label-text">Worktree Name</span></label>
              <input type="text" id="new-worktree-name" placeholder="Enter worktree name..." class="input input-bordered w-full" />
            </div>
            <div class="mb-4">
              <label class="label"><span class="label-text">Branch Name (optional)</span></label>
              <input type="text" id="new-worktree-branch" placeholder="Enter new branch name..." class="input input-bordered w-full" />
              <div class="label"><span class="label-text-alt">Leave empty to checkout existing branch</span></div>
            </div>
          </div>
          <div class="modal-action">
            <button id="create-worktree-btn" class="btn btn-secondary">Create Worktree</button>
            <button id="cancel-worktree-btn" class="btn">Cancel</button>
          </div>
        </div>
        <form method="dialog" class="modal-backdrop"><button>close</button></form>
      </dialog>`),document.getElementById("create-worktree-btn")?.addEventListener("click",()=>zt(m)),document.getElementById("cancel-worktree-btn")?.addEventListener("click",()=>document.getElementById("new-worktree-modal")?.close());let B=document.getElementById("new-worktree-name"),E=document.getElementById("new-worktree-branch");B?.addEventListener("keypress",r=>{r.key==="Enter"&&zt(m)}),E?.addEventListener("keypress",r=>{r.key==="Enter"&&zt(m)})}document.getElementById("new-worktree-name").value="",document.getElementById("new-worktree-branch").value="",document.getElementById("new-worktree-modal")?.showModal(),document.getElementById("new-worktree-name")?.focus()}async function zt(m){let w=document.getElementById("new-worktree-name"),y=document.getElementById("new-worktree-branch"),B=(w?.value||"").trim(),E=(y?.value||"").trim();if(!B){await window.Swal.fire({title:"Error",text:"Please enter a worktree name",icon:"error"});return}try{let r=await fetch(`/api/projects/${encodeURIComponent(m)}/worktrees`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:B,branch:E||void 0})}),a=await r.json();r.ok?(document.getElementById("new-worktree-modal")?.close(),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:a.error||"Failed to create worktree",icon:"error"})}catch(r){console.error("Error creating worktree:",r),await window.Swal.fire({title:"Error",text:"Error creating worktree",icon:"error"})}}function Wi(m,w){U.sessionID=null,U.currentProject=`${m}/worktrees/${w}`,window.initializeTerminal?.()}async function Ni(m,w){let{value:y}=await window.Swal.fire({title:"Enter target branch",input:"text",inputLabel:"Target branch to merge into",inputValue:"main",showCancelButton:!0,inputValidator:E=>E?void 0:"You need to enter a branch name!"});if(!(!y||!(await window.Swal.fire({title:"Confirm merge",text:`Are you sure you want to merge worktree "${w}" into "${y}"? This will also delete the worktree.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, merge it!"})).isConfirmed))try{let E=await fetch(`/api/projects/${encodeURIComponent(m)}/worktrees/${encodeURIComponent(w)}/merge`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetBranch:y||"main"})}),r=await E.json();E.ok?(await window.Swal.fire({title:"Success!",text:r.message||"Worktree merged successfully",icon:"success"}),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:r.error||"Failed to merge worktree",icon:"error"})}catch(E){console.error("Error merging worktree:",E),await window.Swal.fire({title:"Error",text:"Error merging worktree",icon:"error"})}}async function ji(m,w){if((await window.Swal.fire({title:"Delete Worktree",text:`Are you sure you want to delete worktree "${w}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{let B=await fetch(`/api/projects/${encodeURIComponent(m)}/worktrees/${encodeURIComponent(w)}`,{method:"DELETE"}),E=await B.json();B.ok?(await window.Swal.fire({title:"Success!",text:E.message||"Worktree deleted successfully",icon:"success"}),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:E.error||"Failed to delete worktree",icon:"error"})}catch(B){console.error("Error deleting worktree:",B),await window.Swal.fire({title:"Error",text:"Error deleting worktree",icon:"error"})}}Object.assign(window,{getSessionIDFromURL:Ae,getProjectFromURL:Me,updateURLWithSession:Ke,clearURLParams:wt,updateURLWithoutSession:Xt,initializeTerminal:ue,cleanupTerminal:de,connectWebSocket:Ge,showNavigationBar:Mi,hideNavigationBar:Pi,goBackToProjectList:vt,goBackToSessionList:_t,showSessionsAndProjectsList:le,createNewProject:jt,deleteProject:$t,selectProject:je,connectToSession:ft,killSession:Ut,toggleFileBrowser:ct,loadDirectory:ye,openFileInEditor:ht,saveCurrentFile:Fe,closeFileBrowser:ke,closeFileEditor:Ee,createNewFile:dt,createNewFolder:ut,handleFileCreation:We,handleFolderCreation:Ne,showEnvironmentManager:Oi,showAliasesManager:Hi,createWorktreeModal:Fi,openWorktree:Wi,mergeWorktree:Ni,deleteWorktree:ji});U.sessionID=Ae();U.currentProject=Me();Ii();U.sessionID?ue():le();})();
//# sourceMappingURL=bundle.js.map
