"use strict";(()=>{var Gi=Object.create;var Gt=Object.defineProperty;var Xi=Object.getOwnPropertyDescriptor;var Ji=Object.getOwnPropertyNames;var Yi=Object.getPrototypeOf,Zi=Object.prototype.hasOwnProperty;var Xt=(v,S)=>()=>(S||v((S={exports:{}}).exports,S),S.exports);var Qi=(v,S,y,T)=>{if(S&&typeof S=="object"||typeof S=="function")for(let k of Ji(S))!Zi.call(v,k)&&k!==y&&Gt(v,k,{get:()=>S[k],enumerable:!(T=Xi(S,k))||T.enumerable});return v};var Jt=(v,S,y)=>(y=v!=null?Gi(Yi(v)):{},Qi(S||!v||!v.__esModule?Gt(y,"default",{value:v,enumerable:!0}):y,v));var ei=Xt((Xe,kt)=>{(function(v,S){if(typeof Xe=="object"&&typeof kt=="object")kt.exports=S();else if(typeof define=="function"&&define.amd)define([],S);else{var y=S();for(var T in y)(typeof Xe=="object"?Xe:v)[T]=y[T]}})(self,()=>(()=>{"use strict";var v={4567:function(k,r,a){var o=this&&this.__decorate||function(i,c,u,g){var b,h=arguments.length,m=h<3?c:g===null?g=Object.getOwnPropertyDescriptor(c,u):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(i,c,u,g);else for(var E=i.length-1;E>=0;E--)(b=i[E])&&(m=(h<3?b(m):h>3?b(c,u,m):b(c,u))||m);return h>3&&m&&Object.defineProperty(c,u,m),m},d=this&&this.__param||function(i,c){return function(u,g){c(u,g,i)}};Object.defineProperty(r,"__esModule",{value:!0}),r.AccessibilityManager=void 0;let n=a(9042),l=a(6114),_=a(9924),p=a(844),f=a(5596),e=a(4725),s=a(3656),t=r.AccessibilityManager=class extends p.Disposable{constructor(i,c){super(),this._terminal=i,this._renderService=c,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let u=0;u<this._terminal.rows;u++)this._rowElements[u]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[u]);if(this._topBoundaryFocusListener=u=>this._handleBoundaryFocus(u,0),this._bottomBoundaryFocusListener=u=>this._handleBoundaryFocus(u,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new _.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(u=>this._handleResize(u.rows))),this.register(this._terminal.onRender(u=>this._refreshRows(u.start,u.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(u=>this._handleChar(u))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(u=>this._handleTab(u))),this.register(this._terminal.onKey(u=>this._handleKey(u.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new f.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,s.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,p.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(i){for(let c=0;c<i;c++)this._handleChar(" ")}_handleChar(i){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==i&&(this._charsToAnnounce+=i):this._charsToAnnounce+=i,i===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=n.tooMuchOutput)),l.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,l.isMac&&this._liveRegion.remove()}_handleKey(i){this._clearLiveRegion(),/\p{Control}/u.test(i)||this._charsToConsume.push(i)}_refreshRows(i,c){this._liveRegionDebouncer.refresh(i,c,this._terminal.rows)}_renderRows(i,c){let u=this._terminal.buffer,g=u.lines.length.toString();for(let b=i;b<=c;b++){let h=u.translateBufferLineToString(u.ydisp+b,!0),m=(u.ydisp+b+1).toString(),E=this._rowElements[b];E&&(h.length===0?E.innerText="\xA0":E.textContent=h,E.setAttribute("aria-posinset",m),E.setAttribute("aria-setsize",g))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(i,c){let u=i.target,g=this._rowElements[c===0?1:this._rowElements.length-2];if(u.getAttribute("aria-posinset")===(c===0?"1":`${this._terminal.buffer.lines.length}`)||i.relatedTarget!==g)return;let b,h;if(c===0?(b=u,h=this._rowElements.pop(),this._rowContainer.removeChild(h)):(b=this._rowElements.shift(),h=u,this._rowContainer.removeChild(b)),b.removeEventListener("focus",this._topBoundaryFocusListener),h.removeEventListener("focus",this._bottomBoundaryFocusListener),c===0){let m=this._createAccessibilityTreeNode();this._rowElements.unshift(m),this._rowContainer.insertAdjacentElement("afterbegin",m)}else{let m=this._createAccessibilityTreeNode();this._rowElements.push(m),this._rowContainer.appendChild(m)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(c===0?-1:1),this._rowElements[c===0?1:this._rowElements.length-2].focus(),i.preventDefault(),i.stopImmediatePropagation()}_handleResize(i){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let c=this._rowContainer.children.length;c<this._terminal.rows;c++)this._rowElements[c]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[c]);for(;this._rowElements.length>i;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let i=document.createElement("div");return i.setAttribute("role","listitem"),i.tabIndex=-1,this._refreshRowDimensions(i),i}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let i=0;i<this._terminal.rows;i++)this._refreshRowDimensions(this._rowElements[i])}}_refreshRowDimensions(i){i.style.height=`${this._renderService.dimensions.css.cell.height}px`}};r.AccessibilityManager=t=o([d(1,e.IRenderService)],t)},3614:(k,r)=>{function a(l){return l.replace(/\r?\n/g,"\r")}function o(l,_){return _?"\x1B[200~"+l+"\x1B[201~":l}function d(l,_,p,f){l=o(l=a(l),p.decPrivateModes.bracketedPasteMode&&f.rawOptions.ignoreBracketedPasteMode!==!0),p.triggerDataEvent(l,!0),_.value=""}function n(l,_,p){let f=p.getBoundingClientRect(),e=l.clientX-f.left-10,s=l.clientY-f.top-10;_.style.width="20px",_.style.height="20px",_.style.left=`${e}px`,_.style.top=`${s}px`,_.style.zIndex="1000",_.focus()}Object.defineProperty(r,"__esModule",{value:!0}),r.rightClickHandler=r.moveTextAreaUnderMouseCursor=r.paste=r.handlePasteEvent=r.copyHandler=r.bracketTextForPaste=r.prepareTextForTerminal=void 0,r.prepareTextForTerminal=a,r.bracketTextForPaste=o,r.copyHandler=function(l,_){l.clipboardData&&l.clipboardData.setData("text/plain",_.selectionText),l.preventDefault()},r.handlePasteEvent=function(l,_,p,f){l.stopPropagation(),l.clipboardData&&d(l.clipboardData.getData("text/plain"),_,p,f)},r.paste=d,r.moveTextAreaUnderMouseCursor=n,r.rightClickHandler=function(l,_,p,f,e){n(l,_,p),e&&f.rightClickSelect(l),_.value=f.selectionText,_.select()}},7239:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorContrastCache=void 0;let o=a(1505);r.ColorContrastCache=class{constructor(){this._color=new o.TwoKeyMap,this._css=new o.TwoKeyMap}setCss(d,n,l){this._css.set(d,n,l)}getCss(d,n){return this._css.get(d,n)}setColor(d,n,l){this._color.set(d,n,l)}getColor(d,n){return this._color.get(d,n)}clear(){this._color.clear(),this._css.clear()}}},3656:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.addDisposableDomListener=void 0,r.addDisposableDomListener=function(a,o,d,n){a.addEventListener(o,d,n);let l=!1;return{dispose:()=>{l||(l=!0,a.removeEventListener(o,d,n))}}}},6465:function(k,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,u=arguments.length,g=u<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,t,i);else for(var b=e.length-1;b>=0;b--)(c=e[b])&&(g=(u<3?c(g):u>3?c(s,t,g):c(s,t))||g);return u>3&&g&&Object.defineProperty(s,t,g),g},d=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Linkifier2=void 0;let n=a(3656),l=a(8460),_=a(844),p=a(2585),f=r.Linkifier2=class extends _.Disposable{get currentLink(){return this._currentLink}constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new l.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new l.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,_.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,_.toDisposable)(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{let s=this._linkProviders.indexOf(e);s!==-1&&this._linkProviders.splice(s,1)}}}attachToDom(e,s,t){this._element=e,this._mouseService=s,this._renderService=t,this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;let s=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!s)return;this._isMouseOut=!1;let t=e.composedPath();for(let i=0;i<t.length;i++){let c=t[i];if(c.classList.contains("xterm"))break;if(c.classList.contains("xterm-hover"))return}this._lastBufferCell&&s.x===this._lastBufferCell.x&&s.y===this._lastBufferCell.y||(this._handleHover(s),this._lastBufferCell=s)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,s){var t,i;this._activeProviderReplies&&s||((t=this._activeProviderReplies)===null||t===void 0||t.forEach(u=>{u?.forEach(g=>{g.link.dispose&&g.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let c=!1;for(let[u,g]of this._linkProviders.entries())s?!((i=this._activeProviderReplies)===null||i===void 0)&&i.get(u)&&(c=this._checkLinkProviderResult(u,e,c)):g.provideLinks(e.y,b=>{var h,m;if(this._isMouseOut)return;let E=b?.map(R=>({link:R}));(h=this._activeProviderReplies)===null||h===void 0||h.set(u,E),c=this._checkLinkProviderResult(u,e,c),((m=this._activeProviderReplies)===null||m===void 0?void 0:m.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,s){let t=new Set;for(let i=0;i<s.size;i++){let c=s.get(i);if(c)for(let u=0;u<c.length;u++){let g=c[u],b=g.link.range.start.y<e?0:g.link.range.start.x,h=g.link.range.end.y>e?this._bufferService.cols:g.link.range.end.x;for(let m=b;m<=h;m++){if(t.has(m)){c.splice(u--,1);break}t.add(m)}}}}_checkLinkProviderResult(e,s,t){var i;if(!this._activeProviderReplies)return t;let c=this._activeProviderReplies.get(e),u=!1;for(let g=0;g<e;g++)this._activeProviderReplies.has(g)&&!this._activeProviderReplies.get(g)||(u=!0);if(!u&&c){let g=c.find(b=>this._linkAtPosition(b.link,s));g&&(t=!0,this._handleNewLink(g))}if(this._activeProviderReplies.size===this._linkProviders.length&&!t)for(let g=0;g<this._activeProviderReplies.size;g++){let b=(i=this._activeProviderReplies.get(g))===null||i===void 0?void 0:i.find(h=>this._linkAtPosition(h.link,s));if(b){t=!0,this._handleNewLink(b);break}}return t}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;let s=this._positionFromMouseEvent(e,this._element,this._mouseService);s&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,s)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,s){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!s||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=s)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,_.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;let s=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);s&&this._linkAtPosition(e.link,s)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0||e.link.decorations.underline,pointerCursor:e.link.decorations===void 0||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var t,i;return(i=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||i===void 0?void 0:i.decorations.pointerCursor},set:t=>{var i,c;!((i=this._currentLink)===null||i===void 0)&&i.state&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&((c=this._element)===null||c===void 0||c.classList.toggle("xterm-cursor-pointer",t)))}},underline:{get:()=>{var t,i;return(i=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||i===void 0?void 0:i.decorations.underline},set:t=>{var i,c,u;!((i=this._currentLink)===null||i===void 0)&&i.state&&((u=(c=this._currentLink)===null||c===void 0?void 0:c.state)===null||u===void 0?void 0:u.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(t=>{if(!this._currentLink)return;let i=t.start===0?0:t.start+1+this._bufferService.buffer.ydisp,c=this._bufferService.buffer.ydisp+1+t.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=c&&(this._clearCurrentLink(i,c),this._lastMouseEvent&&this._element)){let u=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);u&&this._askForLink(u,!1)}})))}_linkHover(e,s,t){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),s.hover&&s.hover(t,s.text)}_fireUnderlineEvent(e,s){let t=e.range,i=this._bufferService.buffer.ydisp,c=this._createLinkUnderlineEvent(t.start.x-1,t.start.y-i-1,t.end.x,t.end.y-i-1,void 0);(s?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(c)}_linkLeave(e,s,t){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),s.leave&&s.leave(t,s.text)}_linkAtPosition(e,s){let t=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,c=s.y*this._bufferService.cols+s.x;return t<=c&&c<=i}_positionFromMouseEvent(e,s,t){let i=t.getCoords(e,s,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,s,t,i,c){return{x1:e,y1:s,x2:t,y2:i,cols:this._bufferService.cols,fg:c}}};r.Linkifier2=f=o([d(0,p.IBufferService)],f)},9042:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.tooMuchOutput=r.promptLabel=void 0,r.promptLabel="Terminal input",r.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(k,r,a){var o=this&&this.__decorate||function(f,e,s,t){var i,c=arguments.length,u=c<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,s):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(f,e,s,t);else for(var g=f.length-1;g>=0;g--)(i=f[g])&&(u=(c<3?i(u):c>3?i(e,s,u):i(e,s))||u);return c>3&&u&&Object.defineProperty(e,s,u),u},d=this&&this.__param||function(f,e){return function(s,t){e(s,t,f)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkProvider=void 0;let n=a(511),l=a(2585),_=r.OscLinkProvider=class{constructor(f,e,s){this._bufferService=f,this._optionsService=e,this._oscLinkService=s}provideLinks(f,e){var s;let t=this._bufferService.buffer.lines.get(f-1);if(!t)return void e(void 0);let i=[],c=this._optionsService.rawOptions.linkHandler,u=new n.CellData,g=t.getTrimmedLength(),b=-1,h=-1,m=!1;for(let E=0;E<g;E++)if(h!==-1||t.hasContent(E)){if(t.loadCell(E,u),u.hasExtendedAttrs()&&u.extended.urlId){if(h===-1){h=E,b=u.extended.urlId;continue}m=u.extended.urlId!==b}else h!==-1&&(m=!0);if(m||h!==-1&&E===g-1){let R=(s=this._oscLinkService.getLinkData(b))===null||s===void 0?void 0:s.uri;if(R){let x={start:{x:h+1,y:f},end:{x:E+(m||E!==g-1?0:1),y:f}},B=!1;if(!c?.allowNonHttpProtocols)try{let P=new URL(R);["http:","https:"].includes(P.protocol)||(B=!0)}catch{B=!0}B||i.push({text:R,range:x,activate:(P,O)=>c?c.activate(P,O,x):p(0,O),hover:(P,O)=>{var W;return(W=c?.hover)===null||W===void 0?void 0:W.call(c,P,O,x)},leave:(P,O)=>{var W;return(W=c?.leave)===null||W===void 0?void 0:W.call(c,P,O,x)}})}m=!1,u.hasExtendedAttrs()&&u.extended.urlId?(h=E,b=u.extended.urlId):(h=-1,b=-1)}}e(i)}};function p(f,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){let s=window.open();if(s){try{s.opener=null}catch{}s.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}r.OscLinkProvider=_=o([d(0,l.IBufferService),d(1,l.IOptionsService),d(2,l.IOscLinkService)],_)},6193:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.RenderDebouncer=void 0,r.RenderDebouncer=class{constructor(a,o){this._parentWindow=a,this._renderCallback=o,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(a,o,d){this._rowCount=d,a=a!==void 0?a:0,o=o!==void 0?o:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,o):o,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let a=Math.max(this._rowStart,0),o=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,o),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},5596:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ScreenDprMonitor=void 0;let o=a(844);class d extends o.Disposable{constructor(l){super(),this._parentWindow=l,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,o.toDisposable)(()=>{this.clearListener()}))}setListener(l){this._listener&&this.clearListener(),this._listener=l,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var l;this._outerListener&&((l=this._resolutionMediaMatchList)===null||l===void 0||l.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}r.ScreenDprMonitor=d},3236:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;let o=a(3614),d=a(3656),n=a(6465),l=a(9042),_=a(3730),p=a(1680),f=a(3107),e=a(5744),s=a(2950),t=a(1296),i=a(428),c=a(4269),u=a(5114),g=a(8934),b=a(3230),h=a(9312),m=a(4725),E=a(6731),R=a(8055),x=a(8969),B=a(8460),P=a(844),O=a(6114),W=a(8437),F=a(2584),C=a(7399),L=a(5941),D=a(9074),A=a(2585),N=a(5435),j=a(4567),K=typeof window<"u"?window.document:null;class z extends x.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(w={}){super(w),this.browser=O,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new P.MutableDisposable),this._onCursorMove=this.register(new B.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new B.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new B.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new B.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new B.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new B.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new B.EventEmitter),this._onBlur=this.register(new B.EventEmitter),this._onA11yCharEmitter=this.register(new B.EventEmitter),this._onA11yTabEmitter=this.register(new B.EventEmitter),this._onWillOpen=this.register(new B.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(n.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(_.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(D.DecorationService),this._instantiationService.setService(A.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((M,H)=>this.refresh(M,H))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(M=>this._reportWindowsOptions(M))),this.register(this._inputHandler.onColor(M=>this._handleColorEvent(M))),this.register((0,B.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,B.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,B.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,B.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(M=>this._afterResize(M.cols,M.rows))),this.register((0,P.toDisposable)(()=>{var M,H;this._customKeyEventHandler=void 0,(H=(M=this.element)===null||M===void 0?void 0:M.parentNode)===null||H===void 0||H.removeChild(this.element)}))}_handleColorEvent(w){if(this._themeService)for(let M of w){let H,I="";switch(M.index){case 256:H="foreground",I="10";break;case 257:H="background",I="11";break;case 258:H="cursor",I="12";break;default:H="ansi",I="4;"+M.index}switch(M.type){case 0:let q=R.color.toColorRGB(H==="ansi"?this._themeService.colors.ansi[M.index]:this._themeService.colors[H]);this.coreService.triggerDataEvent(`${F.C0.ESC}]${I};${(0,L.toRgbString)(q)}${F.C1_ESCAPED.ST}`);break;case 1:if(H==="ansi")this._themeService.modifyColors(U=>U.ansi[M.index]=R.rgba.toColor(...M.color));else{let U=H;this._themeService.modifyColors(G=>G[U]=R.rgba.toColor(...M.color))}break;case 2:this._themeService.restoreColor(M.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(w){w?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(j.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(w){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(F.C0.ESC+"[I"),this.updateCursorStyle(w),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var w;return(w=this.textarea)===null||w===void 0?void 0:w.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(F.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let w=this.buffer.ybase+this.buffer.y,M=this.buffer.lines.get(w);if(!M)return;let H=Math.min(this.buffer.x,this.cols-1),I=this._renderService.dimensions.css.cell.height,q=M.getWidth(H),U=this._renderService.dimensions.css.cell.width*q,G=this.buffer.y*this._renderService.dimensions.css.cell.height,Q=H*this._renderService.dimensions.css.cell.width;this.textarea.style.left=Q+"px",this.textarea.style.top=G+"px",this.textarea.style.width=U+"px",this.textarea.style.height=I+"px",this.textarea.style.lineHeight=I+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,d.addDisposableDomListener)(this.element,"copy",M=>{this.hasSelection()&&(0,o.copyHandler)(M,this._selectionService)}));let w=M=>(0,o.handlePasteEvent)(M,this.textarea,this.coreService,this.optionsService);this.register((0,d.addDisposableDomListener)(this.textarea,"paste",w)),this.register((0,d.addDisposableDomListener)(this.element,"paste",w)),O.isFirefox?this.register((0,d.addDisposableDomListener)(this.element,"mousedown",M=>{M.button===2&&(0,o.rightClickHandler)(M,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,d.addDisposableDomListener)(this.element,"contextmenu",M=>{(0,o.rightClickHandler)(M,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),O.isLinux&&this.register((0,d.addDisposableDomListener)(this.element,"auxclick",M=>{M.button===1&&(0,o.moveTextAreaUnderMouseCursor)(M,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,d.addDisposableDomListener)(this.textarea,"keyup",w=>this._keyUp(w),!0)),this.register((0,d.addDisposableDomListener)(this.textarea,"keydown",w=>this._keyDown(w),!0)),this.register((0,d.addDisposableDomListener)(this.textarea,"keypress",w=>this._keyPress(w),!0)),this.register((0,d.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,d.addDisposableDomListener)(this.textarea,"compositionupdate",w=>this._compositionHelper.compositionupdate(w))),this.register((0,d.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,d.addDisposableDomListener)(this.textarea,"input",w=>this._inputEvent(w),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(w){var M;if(!w)throw new Error("Terminal requires a parent element.");w.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=w.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),w.appendChild(this.element);let H=K.createDocumentFragment();this._viewportElement=K.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),H.appendChild(this._viewportElement),this._viewportScrollArea=K.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=K.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=K.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),H.appendChild(this.screenElement),this.textarea=K.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",l.promptLabel),O.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(u.CoreBrowserService,this.textarea,(M=this._document.defaultView)!==null&&M!==void 0?M:window),this._instantiationService.setService(m.ICoreBrowserService,this._coreBrowserService),this.register((0,d.addDisposableDomListener)(this.textarea,"focus",I=>this._handleTextAreaFocus(I))),this.register((0,d.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(i.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(m.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(E.ThemeService),this._instantiationService.setService(m.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(c.CharacterJoinerService),this._instantiationService.setService(m.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(b.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(m.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(I=>this._onRender.fire(I))),this.onResize(I=>this._renderService.resize(I.cols,I.rows)),this._compositionView=K.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(s.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(H);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(g.MouseService),this._instantiationService.setService(m.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(p.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(I=>this.scrollLines(I.amount,I.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(h.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(m.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(I=>this.scrollLines(I.amount,I.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(I=>this._renderService.handleSelectionChanged(I.start,I.end,I.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(I=>{this.textarea.value=I,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(I=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,d.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(f.BufferDecorationRenderer,this.screenElement)),this.register((0,d.addDisposableDomListener)(this.element,"mousedown",I=>this._selectionService.handleMouseDown(I))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(j.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",I=>this._handleScreenReaderModeOptionChange(I))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",I=>{!this._overviewRulerRenderer&&I&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(t.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){let w=this,M=this.element;function H(U){let G=w._mouseService.getMouseReportCoords(U,w.screenElement);if(!G)return!1;let Q,te;switch(U.overrideType||U.type){case"mousemove":te=32,U.buttons===void 0?(Q=3,U.button!==void 0&&(Q=U.button<3?U.button:3)):Q=1&U.buttons?0:4&U.buttons?1:2&U.buttons?2:3;break;case"mouseup":te=0,Q=U.button<3?U.button:3;break;case"mousedown":te=1,Q=U.button<3?U.button:3;break;case"wheel":if(w.viewport.getLinesScrolled(U)===0)return!1;te=U.deltaY<0?0:1,Q=4;break;default:return!1}return!(te===void 0||Q===void 0||Q>4)&&w.coreMouseService.triggerMouseEvent({col:G.col,row:G.row,x:G.x,y:G.y,button:Q,action:te,ctrl:U.ctrlKey,alt:U.altKey,shift:U.shiftKey})}let I={mouseup:null,wheel:null,mousedrag:null,mousemove:null},q={mouseup:U=>(H(U),U.buttons||(this._document.removeEventListener("mouseup",I.mouseup),I.mousedrag&&this._document.removeEventListener("mousemove",I.mousedrag)),this.cancel(U)),wheel:U=>(H(U),this.cancel(U,!0)),mousedrag:U=>{U.buttons&&H(U)},mousemove:U=>{U.buttons||H(U)}};this.register(this.coreMouseService.onProtocolChange(U=>{U?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(U)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&U?I.mousemove||(M.addEventListener("mousemove",q.mousemove),I.mousemove=q.mousemove):(M.removeEventListener("mousemove",I.mousemove),I.mousemove=null),16&U?I.wheel||(M.addEventListener("wheel",q.wheel,{passive:!1}),I.wheel=q.wheel):(M.removeEventListener("wheel",I.wheel),I.wheel=null),2&U?I.mouseup||(M.addEventListener("mouseup",q.mouseup),I.mouseup=q.mouseup):(this._document.removeEventListener("mouseup",I.mouseup),M.removeEventListener("mouseup",I.mouseup),I.mouseup=null),4&U?I.mousedrag||(I.mousedrag=q.mousedrag):(this._document.removeEventListener("mousemove",I.mousedrag),I.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,d.addDisposableDomListener)(M,"mousedown",U=>{if(U.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(U))return H(U),I.mouseup&&this._document.addEventListener("mouseup",I.mouseup),I.mousedrag&&this._document.addEventListener("mousemove",I.mousedrag),this.cancel(U)})),this.register((0,d.addDisposableDomListener)(M,"wheel",U=>{if(!I.wheel){if(!this.buffer.hasScrollback){let G=this.viewport.getLinesScrolled(U);if(G===0)return;let Q=F.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(U.deltaY<0?"A":"B"),te="";for(let pe=0;pe<Math.abs(G);pe++)te+=Q;return this.coreService.triggerDataEvent(te,!0),this.cancel(U,!0)}return this.viewport.handleWheel(U)?this.cancel(U):void 0}},{passive:!1})),this.register((0,d.addDisposableDomListener)(M,"touchstart",U=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(U),this.cancel(U)},{passive:!0})),this.register((0,d.addDisposableDomListener)(M,"touchmove",U=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(U)?void 0:this.cancel(U)},{passive:!1}))}refresh(w,M){var H;(H=this._renderService)===null||H===void 0||H.refreshRows(w,M)}updateCursorStyle(w){var M;!((M=this._selectionService)===null||M===void 0)&&M.shouldColumnSelect(w)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(w,M,H=0){var I;H===1?(super.scrollLines(w,M,H),this.refresh(0,this.rows-1)):(I=this.viewport)===null||I===void 0||I.scrollLines(w)}paste(w){(0,o.paste)(w,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(w){this._customKeyEventHandler=w}registerLinkProvider(w){return this.linkifier2.registerLinkProvider(w)}registerCharacterJoiner(w){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let M=this._characterJoinerService.register(w);return this.refresh(0,this.rows-1),M}deregisterCharacterJoiner(w){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(w)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(w){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+w)}registerDecoration(w){return this._decorationService.registerDecoration(w)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(w,M,H){this._selectionService.setSelection(w,M,H)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var w;(w=this._selectionService)===null||w===void 0||w.clearSelection()}selectAll(){var w;(w=this._selectionService)===null||w===void 0||w.selectAll()}selectLines(w,M){var H;(H=this._selectionService)===null||H===void 0||H.selectLines(w,M)}_keyDown(w){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(w)===!1)return!1;let M=this.browser.isMac&&this.options.macOptionIsMeta&&w.altKey;if(!M&&!this._compositionHelper.keydown(w))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;M||w.key!=="Dead"&&w.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let H=(0,C.evaluateKeyboardEvent)(w,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(w),H.type===3||H.type===2){let I=this.rows-1;return this.scrollLines(H.type===2?-I:I),this.cancel(w,!0)}return H.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,w)||(H.cancel&&this.cancel(w,!0),!H.key||!!(w.key&&!w.ctrlKey&&!w.altKey&&!w.metaKey&&w.key.length===1&&w.key.charCodeAt(0)>=65&&w.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(H.key!==F.C0.ETX&&H.key!==F.C0.CR||(this.textarea.value=""),this._onKey.fire({key:H.key,domEvent:w}),this._showCursor(),this.coreService.triggerDataEvent(H.key,!0),!this.optionsService.rawOptions.screenReaderMode||w.altKey||w.ctrlKey?this.cancel(w,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(w,M){let H=w.isMac&&!this.options.macOptionIsMeta&&M.altKey&&!M.ctrlKey&&!M.metaKey||w.isWindows&&M.altKey&&M.ctrlKey&&!M.metaKey||w.isWindows&&M.getModifierState("AltGraph");return M.type==="keypress"?H:H&&(!M.keyCode||M.keyCode>47)}_keyUp(w){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(w)===!1||(function(M){return M.keyCode===16||M.keyCode===17||M.keyCode===18}(w)||this.focus(),this.updateCursorStyle(w),this._keyPressHandled=!1)}_keyPress(w){let M;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(w)===!1)return!1;if(this.cancel(w),w.charCode)M=w.charCode;else if(w.which===null||w.which===void 0)M=w.keyCode;else{if(w.which===0||w.charCode===0)return!1;M=w.which}return!(!M||(w.altKey||w.ctrlKey||w.metaKey)&&!this._isThirdLevelShift(this.browser,w)||(M=String.fromCharCode(M),this._onKey.fire({key:M,domEvent:w}),this._showCursor(),this.coreService.triggerDataEvent(M,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(w){if(w.data&&w.inputType==="insertText"&&(!w.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let M=w.data;return this.coreService.triggerDataEvent(M,!0),this.cancel(w),!0}return!1}resize(w,M){w!==this.cols||M!==this.rows?super.resize(w,M):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(w,M){var H,I;(H=this._charSizeService)===null||H===void 0||H.measure(),(I=this.viewport)===null||I===void 0||I.syncScrollArea(!0)}clear(){var w;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let M=1;M<this.rows;M++)this.buffer.lines.push(this.buffer.getBlankLine(W.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(w=this.viewport)===null||w===void 0||w.reset(),this.refresh(0,this.rows-1)}}reset(){var w,M;this.options.rows=this.rows,this.options.cols=this.cols;let H=this._customKeyEventHandler;this._setup(),super.reset(),(w=this._selectionService)===null||w===void 0||w.reset(),this._decorationService.reset(),(M=this.viewport)===null||M===void 0||M.reset(),this._customKeyEventHandler=H,this.refresh(0,this.rows-1)}clearTextureAtlas(){var w;(w=this._renderService)===null||w===void 0||w.clearTextureAtlas()}_reportFocus(){var w;!((w=this.element)===null||w===void 0)&&w.classList.contains("focus")?this.coreService.triggerDataEvent(F.C0.ESC+"[I"):this.coreService.triggerDataEvent(F.C0.ESC+"[O")}_reportWindowsOptions(w){if(this._renderService)switch(w){case N.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let M=this._renderService.dimensions.css.canvas.width.toFixed(0),H=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${F.C0.ESC}[4;${H};${M}t`);break;case N.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let I=this._renderService.dimensions.css.cell.width.toFixed(0),q=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${F.C0.ESC}[6;${q};${I}t`)}}cancel(w,M){if(this.options.cancelEvents||M)return w.preventDefault(),w.stopPropagation(),!1}}r.Terminal=z},9924:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TimeBasedDebouncer=void 0,r.TimeBasedDebouncer=class{constructor(a,o=1e3){this._renderCallback=a,this._debounceThresholdMS=o,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,o,d){this._rowCount=d,a=a!==void 0?a:0,o=o!==void 0?o:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,o):o;let n=Date.now();if(n-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=n,this._innerRefresh();else if(!this._additionalRefreshRequested){let l=n-this._lastRefreshMs,_=this._debounceThresholdMS-l;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},_)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let a=Math.max(this._rowStart,0),o=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,o)}}},1680:function(k,r,a){var o=this&&this.__decorate||function(s,t,i,c){var u,g=arguments.length,b=g<3?t:c===null?c=Object.getOwnPropertyDescriptor(t,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(s,t,i,c);else for(var h=s.length-1;h>=0;h--)(u=s[h])&&(b=(g<3?u(b):g>3?u(t,i,b):u(t,i))||b);return g>3&&b&&Object.defineProperty(t,i,b),b},d=this&&this.__param||function(s,t){return function(i,c){t(i,c,s)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Viewport=void 0;let n=a(3656),l=a(4725),_=a(8460),p=a(844),f=a(2585),e=r.Viewport=class extends p.Disposable{constructor(s,t,i,c,u,g,b,h){super(),this._viewportElement=s,this._scrollArea=t,this._bufferService=i,this._optionsService=c,this._charSizeService=u,this._renderService=g,this._coreBrowserService=b,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,n.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(m=>this._activeBuffer=m.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(m=>this._renderDimensions=m)),this._handleThemeChange(h.colors),this.register(h.onChangeColors(m=>this._handleThemeChange(m))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(s){this._viewportElement.style.backgroundColor=s.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(s){if(s)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let t=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==t&&(this._lastRecordedBufferHeight=t,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let s=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==s&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=s),this._refreshAnimationFrame=null}syncScrollArea(s=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(s);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(s)}_handleScroll(s){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});let t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let s=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(s*(this._smoothScrollState.target-this._smoothScrollState.origin)),s<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(s,t){let i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&this._viewportElement.scrollTop!==0||t>0&&i<this._lastRecordedBufferHeight)||(s.cancelable&&s.preventDefault(),!1)}handleWheel(s){let t=this._getPixelsScrolled(s);return t!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(s,t))}scrollLines(s){if(s!==0)if(this._optionsService.rawOptions.smoothScrollDuration){let t=s*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:s,suppressScrollEvent:!1})}_getPixelsScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let t=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(s,t){var i;let c,u="",g=[],b=t??this._bufferService.buffer.lines.length,h=this._bufferService.buffer.lines;for(let m=s;m<b;m++){let E=h.get(m);if(!E)continue;let R=(i=h.get(m+1))===null||i===void 0?void 0:i.isWrapped;if(u+=E.translateToString(!R),!R||m===h.length-1){let x=document.createElement("div");x.textContent=u,g.push(x),u.length>0&&(c=x),u=""}}return{bufferElements:g,cursorElement:c}}getLinesScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let t=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(s,t){let i=this._optionsService.rawOptions.fastScrollModifier;return i==="alt"&&t.altKey||i==="ctrl"&&t.ctrlKey||i==="shift"&&t.shiftKey?s*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:s*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(s){this._lastTouchY=s.touches[0].pageY}handleTouchMove(s){let t=this._lastTouchY-s.touches[0].pageY;return this._lastTouchY=s.touches[0].pageY,t!==0&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(s,t))}};r.Viewport=e=o([d(2,f.IBufferService),d(3,f.IOptionsService),d(4,l.ICharSizeService),d(5,l.IRenderService),d(6,l.ICoreBrowserService),d(7,l.IThemeService)],e)},3107:function(k,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,u=arguments.length,g=u<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,t,i);else for(var b=e.length-1;b>=0;b--)(c=e[b])&&(g=(u<3?c(g):u>3?c(s,t,g):c(s,t))||g);return u>3&&g&&Object.defineProperty(s,t,g),g},d=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferDecorationRenderer=void 0;let n=a(3656),l=a(4725),_=a(844),p=a(2585),f=r.BufferDecorationRenderer=class extends _.Disposable{constructor(e,s,t,i){super(),this._screenElement=e,this._bufferService=s,this._decorationService=t,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,n.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(c=>this._removeDecoration(c))),this.register((0,_.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var s,t;let i=document.createElement("div");i.classList.add("xterm-decoration"),i.classList.toggle("xterm-decoration-top-layer",((s=e?.options)===null||s===void 0?void 0:s.layer)==="top"),i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",i.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let c=(t=e.options.x)!==null&&t!==void 0?t:0;return c&&c>this._bufferService.cols&&(i.style.display="none"),this._refreshXPosition(e,i),i}_refreshStyle(e){let s=e.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let t=this._decorationElements.get(e);t||(t=this._createElement(e),e.element=t,this._decorationElements.set(e,t),this._container.appendChild(t),e.onDispose(()=>{this._decorationElements.delete(e),t.remove()})),t.style.top=s*this._renderService.dimensions.css.cell.height+"px",t.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(t)}}_refreshXPosition(e,s=e.element){var t;if(!s)return;let i=(t=e.options.x)!==null&&t!==void 0?t:0;(e.options.anchor||"left")==="right"?s.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var s;(s=this._decorationElements.get(e))===null||s===void 0||s.remove(),this._decorationElements.delete(e),e.dispose()}};r.BufferDecorationRenderer=f=o([d(1,p.IBufferService),d(2,p.IDecorationService),d(3,l.IRenderService)],f)},5871:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorZoneStore=void 0,r.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(let o of this._zones)if(o.color===a.options.overviewRulerOptions.color&&o.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(o,a.marker.line))return;if(this._lineAdjacentToZone(o,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(o,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,o){return o>=a.startBufferLine&&o<=a.endBufferLine}_lineAdjacentToZone(a,o,d){return o>=a.startBufferLine-this._linePadding[d||"full"]&&o<=a.endBufferLine+this._linePadding[d||"full"]}_addLineToZone(a,o){a.startBufferLine=Math.min(a.startBufferLine,o),a.endBufferLine=Math.max(a.endBufferLine,o)}}},5744:function(k,r,a){var o=this&&this.__decorate||function(c,u,g,b){var h,m=arguments.length,E=m<3?u:b===null?b=Object.getOwnPropertyDescriptor(u,g):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(c,u,g,b);else for(var R=c.length-1;R>=0;R--)(h=c[R])&&(E=(m<3?h(E):m>3?h(u,g,E):h(u,g))||E);return m>3&&E&&Object.defineProperty(u,g,E),E},d=this&&this.__param||function(c,u){return function(g,b){u(g,b,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OverviewRulerRenderer=void 0;let n=a(5871),l=a(3656),_=a(4725),p=a(844),f=a(2585),e={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},t={full:0,left:0,center:0,right:0},i=r.OverviewRulerRenderer=class extends p.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(c,u,g,b,h,m,E){var R;super(),this._viewportElement=c,this._screenElement=u,this._bufferService=g,this._decorationService=b,this._renderService=h,this._optionsService=m,this._coreBrowseService=E,this._colorZoneStore=new n.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(R=this._viewportElement.parentElement)===null||R===void 0||R.insertBefore(this._canvas,this._viewportElement);let x=this._canvas.getContext("2d");if(!x)throw new Error("Ctx cannot be null");this._ctx=x,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,p.toDisposable)(()=>{var B;(B=this._canvas)===null||B===void 0||B.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,l.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let c=Math.floor(this._canvas.width/3),u=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=c,s.center=u,s.right=c,this._refreshDrawHeightConstants(),t.full=0,t.left=0,t.center=s.left,t.right=s.left+s.center}_refreshDrawHeightConstants(){e.full=Math.round(2*this._coreBrowseService.dpr);let c=this._canvas.height/this._bufferService.buffer.lines.length,u=Math.round(Math.max(Math.min(c,12),6)*this._coreBrowseService.dpr);e.left=u,e.center=u,e.right=u}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let u of this._decorationService.decorations)this._colorZoneStore.addDecoration(u);this._ctx.lineWidth=1;let c=this._colorZoneStore.zones;for(let u of c)u.position!=="full"&&this._renderColorZone(u);for(let u of c)u.position==="full"&&this._renderColorZone(u);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(c){this._ctx.fillStyle=c.color,this._ctx.fillRect(t[c.position||"full"],Math.round((this._canvas.height-1)*(c.startBufferLine/this._bufferService.buffers.active.lines.length)-e[c.position||"full"]/2),s[c.position||"full"],Math.round((this._canvas.height-1)*((c.endBufferLine-c.startBufferLine)/this._bufferService.buffers.active.lines.length)+e[c.position||"full"]))}_queueRefresh(c,u){this._shouldUpdateDimensions=c||this._shouldUpdateDimensions,this._shouldUpdateAnchor=u||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};r.OverviewRulerRenderer=i=o([d(2,f.IBufferService),d(3,f.IDecorationService),d(4,_.IRenderService),d(5,f.IOptionsService),d(6,_.ICoreBrowserService)],i)},2950:function(k,r,a){var o=this&&this.__decorate||function(f,e,s,t){var i,c=arguments.length,u=c<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,s):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(f,e,s,t);else for(var g=f.length-1;g>=0;g--)(i=f[g])&&(u=(c<3?i(u):c>3?i(e,s,u):i(e,s))||u);return c>3&&u&&Object.defineProperty(e,s,u),u},d=this&&this.__param||function(f,e){return function(s,t){e(s,t,f)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CompositionHelper=void 0;let n=a(4725),l=a(2585),_=a(2584),p=r.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(f,e,s,t,i,c){this._textarea=f,this._compositionView=e,this._bufferService=s,this._optionsService=t,this._coreService=i,this._renderService=c,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(f){this._compositionView.textContent=f.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(f){if(this._isComposing||this._isSendingComposition){if(f.keyCode===229||f.keyCode===16||f.keyCode===17||f.keyCode===18)return!1;this._finalizeComposition(!1)}return f.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(f){if(this._compositionView.classList.remove("active"),this._isComposing=!1,f){let e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let s;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,s=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}},0)}else{this._isSendingComposition=!1;let e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){let f=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let e=this._textarea.value,s=e.replace(f,"");this._dataAlreadySent=s,e.length>f.length?this._coreService.triggerDataEvent(s,!0):e.length<f.length?this._coreService.triggerDataEvent(`${_.C0.DEL}`,!0):e.length===f.length&&e!==f&&this._coreService.triggerDataEvent(e,!0)}},0)}updateCompositionElements(f){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,t=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=t+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let c=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=t+"px",this._textarea.style.width=Math.max(c.width,1)+"px",this._textarea.style.height=Math.max(c.height,1)+"px",this._textarea.style.lineHeight=c.height+"px"}f||setTimeout(()=>this.updateCompositionElements(!0),0)}}};r.CompositionHelper=p=o([d(2,l.IBufferService),d(3,l.IOptionsService),d(4,l.ICoreService),d(5,n.IRenderService)],p)},9806:(k,r)=>{function a(o,d,n){let l=n.getBoundingClientRect(),_=o.getComputedStyle(n),p=parseInt(_.getPropertyValue("padding-left")),f=parseInt(_.getPropertyValue("padding-top"));return[d.clientX-l.left-p,d.clientY-l.top-f]}Object.defineProperty(r,"__esModule",{value:!0}),r.getCoords=r.getCoordsRelativeToElement=void 0,r.getCoordsRelativeToElement=a,r.getCoords=function(o,d,n,l,_,p,f,e,s){if(!p)return;let t=a(o,d,n);return t?(t[0]=Math.ceil((t[0]+(s?f/2:0))/f),t[1]=Math.ceil(t[1]/e),t[0]=Math.min(Math.max(t[0],1),l+(s?1:0)),t[1]=Math.min(Math.max(t[1],1),_),t):void 0}},9504:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.moveToCellSequence=void 0;let o=a(2584);function d(e,s,t,i){let c=e-n(e,t),u=s-n(s,t),g=Math.abs(c-u)-function(b,h,m){let E=0,R=b-n(b,m),x=h-n(h,m);for(let B=0;B<Math.abs(R-x);B++){let P=l(b,h)==="A"?-1:1,O=m.buffer.lines.get(R+P*B);O?.isWrapped&&E++}return E}(e,s,t);return f(g,p(l(e,s),i))}function n(e,s){let t=0,i=s.buffer.lines.get(e),c=i?.isWrapped;for(;c&&e>=0&&e<s.rows;)t++,i=s.buffer.lines.get(--e),c=i?.isWrapped;return t}function l(e,s){return e>s?"A":"B"}function _(e,s,t,i,c,u){let g=e,b=s,h="";for(;g!==t||b!==i;)g+=c?1:-1,c&&g>u.cols-1?(h+=u.buffer.translateBufferLineToString(b,!1,e,g),g=0,e=0,b++):!c&&g<0&&(h+=u.buffer.translateBufferLineToString(b,!1,0,e+1),g=u.cols-1,e=g,b--);return h+u.buffer.translateBufferLineToString(b,!1,e,g)}function p(e,s){let t=s?"O":"[";return o.C0.ESC+t+e}function f(e,s){e=Math.floor(e);let t="";for(let i=0;i<e;i++)t+=s;return t}r.moveToCellSequence=function(e,s,t,i){let c=t.buffer.x,u=t.buffer.y;if(!t.buffer.hasScrollback)return function(h,m,E,R,x,B){return d(m,R,x,B).length===0?"":f(_(h,m,h,m-n(m,x),!1,x).length,p("D",B))}(c,u,0,s,t,i)+d(u,s,t,i)+function(h,m,E,R,x,B){let P;P=d(m,R,x,B).length>0?R-n(R,x):m;let O=R,W=function(F,C,L,D,A,N){let j;return j=d(L,D,A,N).length>0?D-n(D,A):C,F<L&&j<=D||F>=L&&j<D?"C":"D"}(h,m,E,R,x,B);return f(_(h,P,E,O,W==="C",x).length,p(W,B))}(c,u,e,s,t,i);let g;if(u===s)return g=c>e?"D":"C",f(Math.abs(c-e),p(g,i));g=u>s?"D":"C";let b=Math.abs(u-s);return f(function(h,m){return m.cols-h}(u>s?e:c,t)+(b-1)*t.cols+1+((u>s?c:e)-1),p(g,i))}},1296:function(k,r,a){var o=this&&this.__decorate||function(x,B,P,O){var W,F=arguments.length,C=F<3?B:O===null?O=Object.getOwnPropertyDescriptor(B,P):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(x,B,P,O);else for(var L=x.length-1;L>=0;L--)(W=x[L])&&(C=(F<3?W(C):F>3?W(B,P,C):W(B,P))||C);return F>3&&C&&Object.defineProperty(B,P,C),C},d=this&&this.__param||function(x,B){return function(P,O){B(P,O,x)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRenderer=void 0;let n=a(3787),l=a(2550),_=a(2223),p=a(6171),f=a(4725),e=a(8055),s=a(8460),t=a(844),i=a(2585),c="xterm-dom-renderer-owner-",u="xterm-rows",g="xterm-fg-",b="xterm-bg-",h="xterm-focus",m="xterm-selection",E=1,R=r.DomRenderer=class extends t.Disposable{constructor(x,B,P,O,W,F,C,L,D,A){super(),this._element=x,this._screenElement=B,this._viewportElement=P,this._linkifier2=O,this._charSizeService=F,this._optionsService=C,this._bufferService=L,this._coreBrowserService=D,this._themeService=A,this._terminalClass=E++,this._rowElements=[],this.onRequestRedraw=this.register(new s.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(u),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(m),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,p.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(N=>this._injectCss(N))),this._injectCss(this._themeService.colors),this._rowFactory=W.createInstance(n.DomRendererRowFactory,document),this._element.classList.add(c+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(N=>this._handleLinkHover(N))),this.register(this._linkifier2.onHideLinkUnderline(N=>this._handleLinkLeave(N))),this.register((0,t.toDisposable)(()=>{this._element.classList.remove(c+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new l.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let x=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*x,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*x),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/x),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/x),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let P of this._rowElements)P.style.width=`${this.dimensions.css.canvas.width}px`,P.style.height=`${this.dimensions.css.cell.height}px`,P.style.lineHeight=`${this.dimensions.css.cell.height}px`,P.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let B=`${this._terminalSelector} .${u} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=B,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(x){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let B=`${this._terminalSelector} .${u} { color: ${x.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;B+=`${this._terminalSelector} .${u} .xterm-dim { color: ${e.color.multiplyOpacity(x.foreground,.5).css};}`,B+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,B+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",B+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${x.cursor.css};  color: ${x.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${x.cursor.css}; }}`,B+=`${this._terminalSelector} .${u}.${h} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${u}.${h} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-block { background-color: ${x.cursor.css}; color: ${x.cursorAccent.css};}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${x.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${x.cursor.css} inset;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${x.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,B+=`${this._terminalSelector} .${m} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${m} div { position: absolute; background-color: ${x.selectionBackgroundOpaque.css};}${this._terminalSelector} .${m} div { position: absolute; background-color: ${x.selectionInactiveBackgroundOpaque.css};}`;for(let[P,O]of x.ansi.entries())B+=`${this._terminalSelector} .${g}${P} { color: ${O.css}; }${this._terminalSelector} .${g}${P}.xterm-dim { color: ${e.color.multiplyOpacity(O,.5).css}; }${this._terminalSelector} .${b}${P} { background-color: ${O.css}; }`;B+=`${this._terminalSelector} .${g}${_.INVERTED_DEFAULT_COLOR} { color: ${e.color.opaque(x.background).css}; }${this._terminalSelector} .${g}${_.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${e.color.multiplyOpacity(e.color.opaque(x.background),.5).css}; }${this._terminalSelector} .${b}${_.INVERTED_DEFAULT_COLOR} { background-color: ${x.foreground.css}; }`,this._themeStyleElement.textContent=B}_setDefaultSpacing(){let x=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${x}px`,this._rowFactory.defaultSpacing=x}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(x,B){for(let P=this._rowElements.length;P<=B;P++){let O=document.createElement("div");this._rowContainer.appendChild(O),this._rowElements.push(O)}for(;this._rowElements.length>B;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(x,B){this._refreshRowElements(x,B),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(h)}handleFocus(){this._rowContainer.classList.add(h),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(x,B,P){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(x,B,P),this.renderRows(0,this._bufferService.rows-1),!x||!B)return;let O=x[1]-this._bufferService.buffer.ydisp,W=B[1]-this._bufferService.buffer.ydisp,F=Math.max(O,0),C=Math.min(W,this._bufferService.rows-1);if(F>=this._bufferService.rows||C<0)return;let L=document.createDocumentFragment();if(P){let D=x[0]>B[0];L.appendChild(this._createSelectionElement(F,D?B[0]:x[0],D?x[0]:B[0],C-F+1))}else{let D=O===F?x[0]:0,A=F===W?B[0]:this._bufferService.cols;L.appendChild(this._createSelectionElement(F,D,A));let N=C-F-1;if(L.appendChild(this._createSelectionElement(F+1,0,this._bufferService.cols,N)),F!==C){let j=W===C?B[0]:this._bufferService.cols;L.appendChild(this._createSelectionElement(C,0,j))}}this._selectionContainer.appendChild(L)}_createSelectionElement(x,B,P,O=1){let W=document.createElement("div");return W.style.height=O*this.dimensions.css.cell.height+"px",W.style.top=x*this.dimensions.css.cell.height+"px",W.style.left=B*this.dimensions.css.cell.width+"px",W.style.width=this.dimensions.css.cell.width*(P-B)+"px",W}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let x of this._rowElements)x.replaceChildren()}renderRows(x,B){let P=this._bufferService.buffer,O=P.ybase+P.y,W=Math.min(P.x,this._bufferService.cols-1),F=this._optionsService.rawOptions.cursorBlink,C=this._optionsService.rawOptions.cursorStyle,L=this._optionsService.rawOptions.cursorInactiveStyle;for(let D=x;D<=B;D++){let A=D+P.ydisp,N=this._rowElements[D],j=P.lines.get(A);if(!N||!j)break;N.replaceChildren(...this._rowFactory.createRow(j,A,A===O,C,L,W,F,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${c}${this._terminalClass}`}_handleLinkHover(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!0)}_handleLinkLeave(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!1)}_setCellUnderline(x,B,P,O,W,F){P<0&&(x=0),O<0&&(B=0);let C=this._bufferService.rows-1;P=Math.max(Math.min(P,C),0),O=Math.max(Math.min(O,C),0),W=Math.min(W,this._bufferService.cols);let L=this._bufferService.buffer,D=L.ybase+L.y,A=Math.min(L.x,W-1),N=this._optionsService.rawOptions.cursorBlink,j=this._optionsService.rawOptions.cursorStyle,K=this._optionsService.rawOptions.cursorInactiveStyle;for(let z=P;z<=O;++z){let Y=z+L.ydisp,w=this._rowElements[z],M=L.lines.get(Y);if(!w||!M)break;w.replaceChildren(...this._rowFactory.createRow(M,Y,Y===D,j,K,A,N,this.dimensions.css.cell.width,this._widthCache,F?z===P?x:0:-1,F?(z===O?B:W)-1:-1))}}};r.DomRenderer=R=o([d(4,i.IInstantiationService),d(5,f.ICharSizeService),d(6,i.IOptionsService),d(7,i.IBufferService),d(8,f.ICoreBrowserService),d(9,f.IThemeService)],R)},3787:function(k,r,a){var o=this&&this.__decorate||function(g,b,h,m){var E,R=arguments.length,x=R<3?b:m===null?m=Object.getOwnPropertyDescriptor(b,h):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(g,b,h,m);else for(var B=g.length-1;B>=0;B--)(E=g[B])&&(x=(R<3?E(x):R>3?E(b,h,x):E(b,h))||x);return R>3&&x&&Object.defineProperty(b,h,x),x},d=this&&this.__param||function(g,b){return function(h,m){b(h,m,g)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRendererRowFactory=void 0;let n=a(2223),l=a(643),_=a(511),p=a(2585),f=a(8055),e=a(4725),s=a(4269),t=a(6171),i=a(3734),c=r.DomRendererRowFactory=class{constructor(g,b,h,m,E,R,x){this._document=g,this._characterJoinerService=b,this._optionsService=h,this._coreBrowserService=m,this._coreService=E,this._decorationService=R,this._themeService=x,this._workCell=new _.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(g,b,h){this._selectionStart=g,this._selectionEnd=b,this._columnSelectMode=h}createRow(g,b,h,m,E,R,x,B,P,O,W){let F=[],C=this._characterJoinerService.getJoinedCharacters(b),L=this._themeService.colors,D,A=g.getNoBgTrimmedLength();h&&A<R+1&&(A=R+1);let N=0,j="",K=0,z=0,Y=0,w=!1,M=0,H=!1,I=0,q=[],U=O!==-1&&W!==-1;for(let G=0;G<A;G++){g.loadCell(G,this._workCell);let Q=this._workCell.getWidth();if(Q===0)continue;let te=!1,pe=G,V=this._workCell;if(C.length>0&&G===C[0][0]){te=!0;let Z=C.shift();V=new s.JoinedCellData(this._workCell,g.translateToString(!0,Z[0],Z[1]),Z[1]-Z[0]),pe=Z[1]-1,Q=V.getWidth()}let Be=this._isCellInSelection(G,b),St=h&&G===R,bt=U&&G>=O&&G<=W,wt=!1;this._decorationService.forEachDecorationAtCell(G,b,void 0,Z=>{wt=!0});let Ve=V.getChars()||l.WHITESPACE_CELL_CHAR;if(Ve===" "&&(V.isUnderline()||V.isOverline())&&(Ve="\xA0"),I=Q*B-P.get(Ve,V.isBold(),V.isItalic()),D){if(N&&(Be&&H||!Be&&!H&&V.bg===K)&&(Be&&H&&L.selectionForeground||V.fg===z)&&V.extended.ext===Y&&bt===w&&I===M&&!St&&!te&&!wt){j+=Ve,N++;continue}N&&(D.textContent=j),D=this._document.createElement("span"),N=0,j=""}else D=this._document.createElement("span");if(K=V.bg,z=V.fg,Y=V.extended.ext,w=bt,M=I,H=Be,te&&R>=G&&R<=pe&&(R=G),!this._coreService.isCursorHidden&&St){if(q.push("xterm-cursor"),this._coreBrowserService.isFocused)x&&q.push("xterm-cursor-blink"),q.push(m==="bar"?"xterm-cursor-bar":m==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(E)switch(E){case"outline":q.push("xterm-cursor-outline");break;case"block":q.push("xterm-cursor-block");break;case"bar":q.push("xterm-cursor-bar");break;case"underline":q.push("xterm-cursor-underline")}}if(V.isBold()&&q.push("xterm-bold"),V.isItalic()&&q.push("xterm-italic"),V.isDim()&&q.push("xterm-dim"),j=V.isInvisible()?l.WHITESPACE_CELL_CHAR:V.getChars()||l.WHITESPACE_CELL_CHAR,V.isUnderline()&&(q.push(`xterm-underline-${V.extended.underlineStyle}`),j===" "&&(j="\xA0"),!V.isUnderlineColorDefault()))if(V.isUnderlineColorRGB())D.style.textDecorationColor=`rgb(${i.AttributeData.toColorRGB(V.getUnderlineColor()).join(",")})`;else{let Z=V.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&V.isBold()&&Z<8&&(Z+=8),D.style.textDecorationColor=L.ansi[Z].css}V.isOverline()&&(q.push("xterm-overline"),j===" "&&(j="\xA0")),V.isStrikethrough()&&q.push("xterm-strikethrough"),bt&&(D.style.textDecoration="underline");let ie=V.getFgColor(),Re=V.getFgColorMode(),re=V.getBgColor(),Te=V.getBgColorMode(),Ct=!!V.isInverse();if(Ct){let Z=ie;ie=re,re=Z;let Vi=Re;Re=Te,Te=Vi}let ce,yt,he,Ae=!1;switch(this._decorationService.forEachDecorationAtCell(G,b,void 0,Z=>{Z.options.layer!=="top"&&Ae||(Z.backgroundColorRGB&&(Te=50331648,re=Z.backgroundColorRGB.rgba>>8&16777215,ce=Z.backgroundColorRGB),Z.foregroundColorRGB&&(Re=50331648,ie=Z.foregroundColorRGB.rgba>>8&16777215,yt=Z.foregroundColorRGB),Ae=Z.options.layer==="top")}),!Ae&&Be&&(ce=this._coreBrowserService.isFocused?L.selectionBackgroundOpaque:L.selectionInactiveBackgroundOpaque,re=ce.rgba>>8&16777215,Te=50331648,Ae=!0,L.selectionForeground&&(Re=50331648,ie=L.selectionForeground.rgba>>8&16777215,yt=L.selectionForeground)),Ae&&q.push("xterm-decoration-top"),Te){case 16777216:case 33554432:he=L.ansi[re],q.push(`xterm-bg-${re}`);break;case 50331648:he=f.rgba.toColor(re>>16,re>>8&255,255&re),this._addStyle(D,`background-color:#${u((re>>>0).toString(16),"0",6)}`);break;default:Ct?(he=L.foreground,q.push(`xterm-bg-${n.INVERTED_DEFAULT_COLOR}`)):he=L.background}switch(ce||V.isDim()&&(ce=f.color.multiplyOpacity(he,.5)),Re){case 16777216:case 33554432:V.isBold()&&ie<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ie+=8),this._applyMinimumContrast(D,he,L.ansi[ie],V,ce,void 0)||q.push(`xterm-fg-${ie}`);break;case 50331648:let Z=f.rgba.toColor(ie>>16&255,ie>>8&255,255&ie);this._applyMinimumContrast(D,he,Z,V,ce,yt)||this._addStyle(D,`color:#${u(ie.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(D,he,L.foreground,V,ce,void 0)||Ct&&q.push(`xterm-fg-${n.INVERTED_DEFAULT_COLOR}`)}q.length&&(D.className=q.join(" "),q.length=0),St||te||wt?D.textContent=j:N++,I!==this.defaultSpacing&&(D.style.letterSpacing=`${I}px`),F.push(D),G=pe}return D&&N&&(D.textContent=j),F}_applyMinimumContrast(g,b,h,m,E,R){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,t.excludeFromContrastRatioDemands)(m.getCode()))return!1;let x=this._getContrastCache(m),B;if(E||R||(B=x.getColor(b.rgba,h.rgba)),B===void 0){let P=this._optionsService.rawOptions.minimumContrastRatio/(m.isDim()?2:1);B=f.color.ensureContrastRatio(E||b,R||h,P),x.setColor((E||b).rgba,(R||h).rgba,B??null)}return!!B&&(this._addStyle(g,`color:${B.css}`),!0)}_getContrastCache(g){return g.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(g,b){g.setAttribute("style",`${g.getAttribute("style")||""}${b};`)}_isCellInSelection(g,b){let h=this._selectionStart,m=this._selectionEnd;return!(!h||!m)&&(this._columnSelectMode?h[0]<=m[0]?g>=h[0]&&b>=h[1]&&g<m[0]&&b<=m[1]:g<h[0]&&b>=h[1]&&g>=m[0]&&b<=m[1]:b>h[1]&&b<m[1]||h[1]===m[1]&&b===h[1]&&g>=h[0]&&g<m[0]||h[1]<m[1]&&b===m[1]&&g<m[0]||h[1]<m[1]&&b===h[1]&&g>=h[0])}};function u(g,b,h){for(;g.length<h;)g=b+g;return g}r.DomRendererRowFactory=c=o([d(1,e.ICharacterJoinerService),d(2,p.IOptionsService),d(3,e.ICoreBrowserService),d(4,p.ICoreService),d(5,p.IDecorationService),d(6,e.IThemeService)],c)},2550:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WidthCache=void 0,r.WidthCache=class{constructor(a){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let o=a.createElement("span"),d=a.createElement("span");d.style.fontWeight="bold";let n=a.createElement("span");n.style.fontStyle="italic";let l=a.createElement("span");l.style.fontWeight="bold",l.style.fontStyle="italic",this._measureElements=[o,d,n,l],this._container.appendChild(o),this._container.appendChild(d),this._container.appendChild(n),this._container.appendChild(l),a.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,o,d,n){a===this._font&&o===this._fontSize&&d===this._weight&&n===this._weightBold||(this._font=a,this._fontSize=o,this._weight=d,this._weightBold=n,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${d}`,this._measureElements[1].style.fontWeight=`${n}`,this._measureElements[2].style.fontWeight=`${d}`,this._measureElements[3].style.fontWeight=`${n}`,this.clear())}get(a,o,d){let n=0;if(!o&&!d&&a.length===1&&(n=a.charCodeAt(0))<256)return this._flat[n]!==-9999?this._flat[n]:this._flat[n]=this._measure(a,0);let l=a;o&&(l+="B"),d&&(l+="I");let _=this._holey.get(l);if(_===void 0){let p=0;o&&(p|=1),d&&(p|=2),_=this._measure(a,p),this._holey.set(l,_)}return _}_measure(a,o){let d=this._measureElements[o];return d.textContent=a.repeat(32),d.offsetWidth/32}}},2223:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TEXT_BASELINE=r.DIM_OPACITY=r.INVERTED_DEFAULT_COLOR=void 0;let o=a(6114);r.INVERTED_DEFAULT_COLOR=257,r.DIM_OPACITY=.5,r.TEXT_BASELINE=o.isFirefox||o.isLegacyEdge?"bottom":"ideographic"},6171:(k,r)=>{function a(o){return 57508<=o&&o<=57558}Object.defineProperty(r,"__esModule",{value:!0}),r.createRenderDimensions=r.excludeFromContrastRatioDemands=r.isRestrictedPowerlineGlyph=r.isPowerlineGlyph=r.throwIfFalsy=void 0,r.throwIfFalsy=function(o){if(!o)throw new Error("value must not be falsy");return o},r.isPowerlineGlyph=a,r.isRestrictedPowerlineGlyph=function(o){return 57520<=o&&o<=57527},r.excludeFromContrastRatioDemands=function(o){return a(o)||function(d){return 9472<=d&&d<=9631}(o)},r.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionModel=void 0,r.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let a=this.selectionStart,o=this.selectionEnd;return!(!a||!o)&&(a[1]>o[1]||a[1]===o[1]&&a[0]>o[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(k,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,u=arguments.length,g=u<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,t,i);else for(var b=e.length-1;b>=0;b--)(c=e[b])&&(g=(u<3?c(g):u>3?c(s,t,g):c(s,t))||g);return u>3&&g&&Object.defineProperty(s,t,g),g},d=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharSizeService=void 0;let n=a(2585),l=a(8460),_=a(844),p=r.CharSizeService=class extends _.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,s,t){super(),this._optionsService=t,this.width=0,this.height=0,this._onCharSizeChange=this.register(new l.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new f(e,s,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){let e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};r.CharSizeService=p=o([d(2,n.IOptionsService)],p);class f{constructor(s,t,i){this._document=s,this._parentElement=t,this._optionsService=i,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;let s={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return s.width!==0&&s.height!==0&&(this._result.width=s.width/32,this._result.height=Math.ceil(s.height)),this._result}}},4269:function(k,r,a){var o=this&&this.__decorate||function(s,t,i,c){var u,g=arguments.length,b=g<3?t:c===null?c=Object.getOwnPropertyDescriptor(t,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(s,t,i,c);else for(var h=s.length-1;h>=0;h--)(u=s[h])&&(b=(g<3?u(b):g>3?u(t,i,b):u(t,i))||b);return g>3&&b&&Object.defineProperty(t,i,b),b},d=this&&this.__param||function(s,t){return function(i,c){t(i,c,s)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharacterJoinerService=r.JoinedCellData=void 0;let n=a(3734),l=a(643),_=a(511),p=a(2585);class f extends n.AttributeData{constructor(t,i,c){super(),this.content=0,this.combinedData="",this.fg=t.fg,this.bg=t.bg,this.combinedData=i,this._width=c}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(t){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.JoinedCellData=f;let e=r.CharacterJoinerService=class Qt{constructor(t){this._bufferService=t,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new _.CellData}register(t){let i={id:this._nextCharacterJoinerId++,handler:t};return this._characterJoiners.push(i),i.id}deregister(t){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===t)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(t){if(this._characterJoiners.length===0)return[];let i=this._bufferService.buffer.lines.get(t);if(!i||i.length===0)return[];let c=[],u=i.translateToString(!0),g=0,b=0,h=0,m=i.getFg(0),E=i.getBg(0);for(let R=0;R<i.getTrimmedLength();R++)if(i.loadCell(R,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==m||this._workCell.bg!==E){if(R-g>1){let x=this._getJoinedRanges(u,h,b,i,g);for(let B=0;B<x.length;B++)c.push(x[B])}g=R,h=b,m=this._workCell.fg,E=this._workCell.bg}b+=this._workCell.getChars().length||l.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-g>1){let R=this._getJoinedRanges(u,h,b,i,g);for(let x=0;x<R.length;x++)c.push(R[x])}return c}_getJoinedRanges(t,i,c,u,g){let b=t.substring(i,c),h=[];try{h=this._characterJoiners[0].handler(b)}catch(m){console.error(m)}for(let m=1;m<this._characterJoiners.length;m++)try{let E=this._characterJoiners[m].handler(b);for(let R=0;R<E.length;R++)Qt._mergeRanges(h,E[R])}catch(E){console.error(E)}return this._stringRangesToCellRanges(h,u,g),h}_stringRangesToCellRanges(t,i,c){let u=0,g=!1,b=0,h=t[u];if(h){for(let m=c;m<this._bufferService.cols;m++){let E=i.getWidth(m),R=i.getString(m).length||l.WHITESPACE_CELL_CHAR.length;if(E!==0){if(!g&&h[0]<=b&&(h[0]=m,g=!0),h[1]<=b){if(h[1]=m,h=t[++u],!h)break;h[0]<=b?(h[0]=m,g=!0):g=!1}b+=R}}h&&(h[1]=this._bufferService.cols)}}static _mergeRanges(t,i){let c=!1;for(let u=0;u<t.length;u++){let g=t[u];if(c){if(i[1]<=g[0])return t[u-1][1]=i[1],t;if(i[1]<=g[1])return t[u-1][1]=Math.max(i[1],g[1]),t.splice(u,1),t;t.splice(u,1),u--}else{if(i[1]<=g[0])return t.splice(u,0,i),t;if(i[1]<=g[1])return g[0]=Math.min(i[0],g[0]),t;i[0]<g[1]&&(g[0]=Math.min(i[0],g[0]),c=!0)}}return c?t[t.length-1][1]=i[1]:t.push(i),t}};r.CharacterJoinerService=e=o([d(0,p.IBufferService)],e)},5114:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreBrowserService=void 0,r.CoreBrowserService=class{constructor(a,o){this._textarea=a,this.window=o,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(k,r,a){var o=this&&this.__decorate||function(p,f,e,s){var t,i=arguments.length,c=i<3?f:s===null?s=Object.getOwnPropertyDescriptor(f,e):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(p,f,e,s);else for(var u=p.length-1;u>=0;u--)(t=p[u])&&(c=(i<3?t(c):i>3?t(f,e,c):t(f,e))||c);return i>3&&c&&Object.defineProperty(f,e,c),c},d=this&&this.__param||function(p,f){return function(e,s){f(e,s,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.MouseService=void 0;let n=a(4725),l=a(9806),_=r.MouseService=class{constructor(p,f){this._renderService=p,this._charSizeService=f}getCoords(p,f,e,s,t){return(0,l.getCoords)(window,p,f,e,s,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,t)}getMouseReportCoords(p,f){let e=(0,l.getCoordsRelativeToElement)(window,p,f);if(this._charSizeService.hasValidSize)return e[0]=Math.min(Math.max(e[0],0),this._renderService.dimensions.css.canvas.width-1),e[1]=Math.min(Math.max(e[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}};r.MouseService=_=o([d(0,n.IRenderService),d(1,n.ICharSizeService)],_)},3230:function(k,r,a){var o=this&&this.__decorate||function(c,u,g,b){var h,m=arguments.length,E=m<3?u:b===null?b=Object.getOwnPropertyDescriptor(u,g):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(c,u,g,b);else for(var R=c.length-1;R>=0;R--)(h=c[R])&&(E=(m<3?h(E):m>3?h(u,g,E):h(u,g))||E);return m>3&&E&&Object.defineProperty(u,g,E),E},d=this&&this.__param||function(c,u){return function(g,b){u(g,b,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.RenderService=void 0;let n=a(3656),l=a(6193),_=a(5596),p=a(4725),f=a(8460),e=a(844),s=a(7226),t=a(2585),i=r.RenderService=class extends e.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(c,u,g,b,h,m,E,R){if(super(),this._rowCount=c,this._charSizeService=b,this._renderer=this.register(new e.MutableDisposable),this._pausedResizeTask=new s.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new f.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new f.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new f.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new f.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new l.RenderDebouncer(E.window,(x,B)=>this._renderRows(x,B)),this.register(this._renderDebouncer),this._screenDprMonitor=new _.ScreenDprMonitor(E.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(m.onResize(()=>this._fullRefresh())),this.register(m.buffers.onBufferActivate(()=>{var x;return(x=this._renderer.value)===null||x===void 0?void 0:x.clear()})),this.register(g.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(h.onDecorationRegistered(()=>this._fullRefresh())),this.register(h.onDecorationRemoved(()=>this._fullRefresh())),this.register(g.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(m.cols,m.rows),this._fullRefresh()})),this.register(g.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(m.buffer.y,m.buffer.y,!0))),this.register((0,n.addDisposableDomListener)(E.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(R.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in E.window){let x=new E.window.IntersectionObserver(B=>this._handleIntersectionChange(B[B.length-1]),{threshold:0});x.observe(u),this.register({dispose:()=>x.disconnect()})}}_handleIntersectionChange(c){this._isPaused=c.isIntersecting===void 0?c.intersectionRatio===0:!c.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(c,u,g=!1){this._isPaused?this._needsFullRefresh=!0:(g||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(c,u,this._rowCount))}_renderRows(c,u){this._renderer.value&&(c=Math.min(c,this._rowCount-1),u=Math.min(u,this._rowCount-1),this._renderer.value.renderRows(c,u),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:c,end:u}),this._onRender.fire({start:c,end:u}),this._isNextRenderRedrawOnly=!0)}resize(c,u){this._rowCount=u,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(c){this._renderer.value=c,this._renderer.value.onRequestRedraw(u=>this.refreshRows(u.start,u.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(c){return this._renderDebouncer.addRefreshCallback(c)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var c,u;this._renderer.value&&((u=(c=this._renderer.value).clearTextureAtlas)===null||u===void 0||u.call(c),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(c,u){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(c,u)):this._renderer.value.handleResize(c,u),this._fullRefresh())}handleCharSizeChanged(){var c;(c=this._renderer.value)===null||c===void 0||c.handleCharSizeChanged()}handleBlur(){var c;(c=this._renderer.value)===null||c===void 0||c.handleBlur()}handleFocus(){var c;(c=this._renderer.value)===null||c===void 0||c.handleFocus()}handleSelectionChanged(c,u,g){var b;this._selectionState.start=c,this._selectionState.end=u,this._selectionState.columnSelectMode=g,(b=this._renderer.value)===null||b===void 0||b.handleSelectionChanged(c,u,g)}handleCursorMove(){var c;(c=this._renderer.value)===null||c===void 0||c.handleCursorMove()}clear(){var c;(c=this._renderer.value)===null||c===void 0||c.clear()}};r.RenderService=i=o([d(2,t.IOptionsService),d(3,p.ICharSizeService),d(4,t.IDecorationService),d(5,t.IBufferService),d(6,p.ICoreBrowserService),d(7,p.IThemeService)],i)},9312:function(k,r,a){var o=this&&this.__decorate||function(h,m,E,R){var x,B=arguments.length,P=B<3?m:R===null?R=Object.getOwnPropertyDescriptor(m,E):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(h,m,E,R);else for(var O=h.length-1;O>=0;O--)(x=h[O])&&(P=(B<3?x(P):B>3?x(m,E,P):x(m,E))||P);return B>3&&P&&Object.defineProperty(m,E,P),P},d=this&&this.__param||function(h,m){return function(E,R){m(E,R,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionService=void 0;let n=a(9806),l=a(9504),_=a(456),p=a(4725),f=a(8460),e=a(844),s=a(6114),t=a(4841),i=a(511),c=a(2585),u="\xA0",g=new RegExp(u,"g"),b=r.SelectionService=class extends e.Disposable{constructor(h,m,E,R,x,B,P,O,W){super(),this._element=h,this._screenElement=m,this._linkifier=E,this._bufferService=R,this._coreService=x,this._mouseService=B,this._optionsService=P,this._renderService=O,this._coreBrowserService=W,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new i.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new f.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new f.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new f.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new f.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=F=>this._handleMouseMove(F),this._mouseUpListener=F=>this._handleMouseUp(F),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(F=>this._handleTrim(F)),this.register(this._bufferService.buffers.onBufferActivate(F=>this._handleBufferActivate(F))),this.enable(),this._model=new _.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,e.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let h=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;return!(!h||!m||h[0]===m[0]&&h[1]===m[1])}get selectionText(){let h=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;if(!h||!m)return"";let E=this._bufferService.buffer,R=[];if(this._activeSelectionMode===3){if(h[0]===m[0])return"";let x=h[0]<m[0]?h[0]:m[0],B=h[0]<m[0]?m[0]:h[0];for(let P=h[1];P<=m[1];P++){let O=E.translateBufferLineToString(P,!0,x,B);R.push(O)}}else{let x=h[1]===m[1]?m[0]:void 0;R.push(E.translateBufferLineToString(h[1],!0,h[0],x));for(let B=h[1]+1;B<=m[1]-1;B++){let P=E.lines.get(B),O=E.translateBufferLineToString(B,!0);P?.isWrapped?R[R.length-1]+=O:R.push(O)}if(h[1]!==m[1]){let B=E.lines.get(m[1]),P=E.translateBufferLineToString(m[1],!0,0,m[0]);B&&B.isWrapped?R[R.length-1]+=P:R.push(P)}}return R.map(x=>x.replace(g," ")).join(s.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(h){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),s.isLinux&&h&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(h){let m=this._getMouseBufferCoords(h),E=this._model.finalSelectionStart,R=this._model.finalSelectionEnd;return!!(E&&R&&m)&&this._areCoordsInSelection(m,E,R)}isCellInSelection(h,m){let E=this._model.finalSelectionStart,R=this._model.finalSelectionEnd;return!(!E||!R)&&this._areCoordsInSelection([h,m],E,R)}_areCoordsInSelection(h,m,E){return h[1]>m[1]&&h[1]<E[1]||m[1]===E[1]&&h[1]===m[1]&&h[0]>=m[0]&&h[0]<E[0]||m[1]<E[1]&&h[1]===E[1]&&h[0]<E[0]||m[1]<E[1]&&h[1]===m[1]&&h[0]>=m[0]}_selectWordAtCursor(h,m){var E,R;let x=(R=(E=this._linkifier.currentLink)===null||E===void 0?void 0:E.link)===null||R===void 0?void 0:R.range;if(x)return this._model.selectionStart=[x.start.x-1,x.start.y-1],this._model.selectionStartLength=(0,t.getRangeLength)(x,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let B=this._getMouseBufferCoords(h);return!!B&&(this._selectWordAt(B,m),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(h,m){this._model.clearSelection(),h=Math.max(h,0),m=Math.min(m,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,h],this._model.selectionEnd=[this._bufferService.cols,m],this.refresh(),this._onSelectionChange.fire()}_handleTrim(h){this._model.handleTrim(h)&&this.refresh()}_getMouseBufferCoords(h){let m=this._mouseService.getCoords(h,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(m)return m[0]--,m[1]--,m[1]+=this._bufferService.buffer.ydisp,m}_getMouseEventScrollAmount(h){let m=(0,n.getCoordsRelativeToElement)(this._coreBrowserService.window,h,this._screenElement)[1],E=this._renderService.dimensions.css.canvas.height;return m>=0&&m<=E?0:(m>E&&(m-=E),m=Math.min(Math.max(m,-50),50),m/=50,m/Math.abs(m)+Math.round(14*m))}shouldForceSelection(h){return s.isMac?h.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:h.shiftKey}handleMouseDown(h){if(this._mouseDownTimeStamp=h.timeStamp,(h.button!==2||!this.hasSelection)&&h.button===0){if(!this._enabled){if(!this.shouldForceSelection(h))return;h.stopPropagation()}h.preventDefault(),this._dragScrollAmount=0,this._enabled&&h.shiftKey?this._handleIncrementalClick(h):h.detail===1?this._handleSingleClick(h):h.detail===2?this._handleDoubleClick(h):h.detail===3&&this._handleTripleClick(h),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(h){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(h))}_handleSingleClick(h){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(h)?3:0,this._model.selectionStart=this._getMouseBufferCoords(h),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let m=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);m&&m.length!==this._model.selectionStart[0]&&m.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(h){this._selectWordAtCursor(h,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(h){let m=this._getMouseBufferCoords(h);m&&(this._activeSelectionMode=2,this._selectLineAt(m[1]))}shouldColumnSelect(h){return h.altKey&&!(s.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(h){if(h.stopImmediatePropagation(),!this._model.selectionStart)return;let m=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(h),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(h),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let E=this._bufferService.buffer;if(this._model.selectionEnd[1]<E.lines.length){let R=E.lines.get(this._model.selectionEnd[1]);R&&R.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}m&&m[0]===this._model.selectionEnd[0]&&m[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let h=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(h.ydisp+this._bufferService.rows,h.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=h.ydisp),this.refresh()}}_handleMouseUp(h){let m=h.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&m<500&&h.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let E=this._mouseService.getCoords(h,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(E&&E[0]!==void 0&&E[1]!==void 0){let R=(0,l.moveToCellSequence)(E[0]-1,E[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(R,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let h=this._model.finalSelectionStart,m=this._model.finalSelectionEnd,E=!(!h||!m||h[0]===m[0]&&h[1]===m[1]);E?h&&m&&(this._oldSelectionStart&&this._oldSelectionEnd&&h[0]===this._oldSelectionStart[0]&&h[1]===this._oldSelectionStart[1]&&m[0]===this._oldSelectionEnd[0]&&m[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(h,m,E)):this._oldHasSelection&&this._fireOnSelectionChange(h,m,E)}_fireOnSelectionChange(h,m,E){this._oldSelectionStart=h,this._oldSelectionEnd=m,this._oldHasSelection=E,this._onSelectionChange.fire()}_handleBufferActivate(h){this.clearSelection(),this._trimListener.dispose(),this._trimListener=h.activeBuffer.lines.onTrim(m=>this._handleTrim(m))}_convertViewportColToCharacterIndex(h,m){let E=m;for(let R=0;m>=R;R++){let x=h.loadCell(R,this._workCell).getChars().length;this._workCell.getWidth()===0?E--:x>1&&m!==R&&(E+=x-1)}return E}setSelection(h,m,E){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[h,m],this._model.selectionStartLength=E,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(h){this._isClickInSelection(h)||(this._selectWordAtCursor(h,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(h,m,E=!0,R=!0){if(h[0]>=this._bufferService.cols)return;let x=this._bufferService.buffer,B=x.lines.get(h[1]);if(!B)return;let P=x.translateBufferLineToString(h[1],!1),O=this._convertViewportColToCharacterIndex(B,h[0]),W=O,F=h[0]-O,C=0,L=0,D=0,A=0;if(P.charAt(O)===" "){for(;O>0&&P.charAt(O-1)===" ";)O--;for(;W<P.length&&P.charAt(W+1)===" ";)W++}else{let K=h[0],z=h[0];B.getWidth(K)===0&&(C++,K--),B.getWidth(z)===2&&(L++,z++);let Y=B.getString(z).length;for(Y>1&&(A+=Y-1,W+=Y-1);K>0&&O>0&&!this._isCharWordSeparator(B.loadCell(K-1,this._workCell));){B.loadCell(K-1,this._workCell);let w=this._workCell.getChars().length;this._workCell.getWidth()===0?(C++,K--):w>1&&(D+=w-1,O-=w-1),O--,K--}for(;z<B.length&&W+1<P.length&&!this._isCharWordSeparator(B.loadCell(z+1,this._workCell));){B.loadCell(z+1,this._workCell);let w=this._workCell.getChars().length;this._workCell.getWidth()===2?(L++,z++):w>1&&(A+=w-1,W+=w-1),W++,z++}}W++;let N=O+F-C+D,j=Math.min(this._bufferService.cols,W-O+C+L-D-A);if(m||P.slice(O,W).trim()!==""){if(E&&N===0&&B.getCodePoint(0)!==32){let K=x.lines.get(h[1]-1);if(K&&B.isWrapped&&K.getCodePoint(this._bufferService.cols-1)!==32){let z=this._getWordAt([this._bufferService.cols-1,h[1]-1],!1,!0,!1);if(z){let Y=this._bufferService.cols-z.start;N-=Y,j+=Y}}}if(R&&N+j===this._bufferService.cols&&B.getCodePoint(this._bufferService.cols-1)!==32){let K=x.lines.get(h[1]+1);if(K?.isWrapped&&K.getCodePoint(0)!==32){let z=this._getWordAt([0,h[1]+1],!1,!1,!0);z&&(j+=z.length)}}return{start:N,length:j}}}_selectWordAt(h,m){let E=this._getWordAt(h,m);if(E){for(;E.start<0;)E.start+=this._bufferService.cols,h[1]--;this._model.selectionStart=[E.start,h[1]],this._model.selectionStartLength=E.length}}_selectToWordAt(h){let m=this._getWordAt(h,!0);if(m){let E=h[1];for(;m.start<0;)m.start+=this._bufferService.cols,E--;if(!this._model.areSelectionValuesReversed())for(;m.start+m.length>this._bufferService.cols;)m.length-=this._bufferService.cols,E++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?m.start:m.start+m.length,E]}}_isCharWordSeparator(h){return h.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(h.getChars())>=0}_selectLineAt(h){let m=this._bufferService.buffer.getWrappedRangeForLine(h),E={start:{x:0,y:m.first},end:{x:this._bufferService.cols-1,y:m.last}};this._model.selectionStart=[0,m.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,t.getRangeLength)(E,this._bufferService.cols)}};r.SelectionService=b=o([d(3,c.IBufferService),d(4,c.ICoreService),d(5,p.IMouseService),d(6,c.IOptionsService),d(7,p.IRenderService),d(8,p.ICoreBrowserService)],b)},4725:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IThemeService=r.ICharacterJoinerService=r.ISelectionService=r.IRenderService=r.IMouseService=r.ICoreBrowserService=r.ICharSizeService=void 0;let o=a(8343);r.ICharSizeService=(0,o.createDecorator)("CharSizeService"),r.ICoreBrowserService=(0,o.createDecorator)("CoreBrowserService"),r.IMouseService=(0,o.createDecorator)("MouseService"),r.IRenderService=(0,o.createDecorator)("RenderService"),r.ISelectionService=(0,o.createDecorator)("SelectionService"),r.ICharacterJoinerService=(0,o.createDecorator)("CharacterJoinerService"),r.IThemeService=(0,o.createDecorator)("ThemeService")},6731:function(k,r,a){var o=this&&this.__decorate||function(b,h,m,E){var R,x=arguments.length,B=x<3?h:E===null?E=Object.getOwnPropertyDescriptor(h,m):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(b,h,m,E);else for(var P=b.length-1;P>=0;P--)(R=b[P])&&(B=(x<3?R(B):x>3?R(h,m,B):R(h,m))||B);return x>3&&B&&Object.defineProperty(h,m,B),B},d=this&&this.__param||function(b,h){return function(m,E){h(m,E,b)}};Object.defineProperty(r,"__esModule",{value:!0}),r.ThemeService=r.DEFAULT_ANSI_COLORS=void 0;let n=a(7239),l=a(8055),_=a(8460),p=a(844),f=a(2585),e=l.css.toColor("#ffffff"),s=l.css.toColor("#000000"),t=l.css.toColor("#ffffff"),i=l.css.toColor("#000000"),c={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};r.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let b=[l.css.toColor("#2e3436"),l.css.toColor("#cc0000"),l.css.toColor("#4e9a06"),l.css.toColor("#c4a000"),l.css.toColor("#3465a4"),l.css.toColor("#75507b"),l.css.toColor("#06989a"),l.css.toColor("#d3d7cf"),l.css.toColor("#555753"),l.css.toColor("#ef2929"),l.css.toColor("#8ae234"),l.css.toColor("#fce94f"),l.css.toColor("#729fcf"),l.css.toColor("#ad7fa8"),l.css.toColor("#34e2e2"),l.css.toColor("#eeeeec")],h=[0,95,135,175,215,255];for(let m=0;m<216;m++){let E=h[m/36%6|0],R=h[m/6%6|0],x=h[m%6];b.push({css:l.channels.toCss(E,R,x),rgba:l.channels.toRgba(E,R,x)})}for(let m=0;m<24;m++){let E=8+10*m;b.push({css:l.channels.toCss(E,E,E),rgba:l.channels.toRgba(E,E,E)})}return b})());let u=r.ThemeService=class extends p.Disposable{get colors(){return this._colors}constructor(b){super(),this._optionsService=b,this._contrastCache=new n.ColorContrastCache,this._halfContrastCache=new n.ColorContrastCache,this._onChangeColors=this.register(new _.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:e,background:s,cursor:t,cursorAccent:i,selectionForeground:void 0,selectionBackgroundTransparent:c,selectionBackgroundOpaque:l.color.blend(s,c),selectionInactiveBackgroundTransparent:c,selectionInactiveBackgroundOpaque:l.color.blend(s,c),ansi:r.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(b={}){let h=this._colors;if(h.foreground=g(b.foreground,e),h.background=g(b.background,s),h.cursor=g(b.cursor,t),h.cursorAccent=g(b.cursorAccent,i),h.selectionBackgroundTransparent=g(b.selectionBackground,c),h.selectionBackgroundOpaque=l.color.blend(h.background,h.selectionBackgroundTransparent),h.selectionInactiveBackgroundTransparent=g(b.selectionInactiveBackground,h.selectionBackgroundTransparent),h.selectionInactiveBackgroundOpaque=l.color.blend(h.background,h.selectionInactiveBackgroundTransparent),h.selectionForeground=b.selectionForeground?g(b.selectionForeground,l.NULL_COLOR):void 0,h.selectionForeground===l.NULL_COLOR&&(h.selectionForeground=void 0),l.color.isOpaque(h.selectionBackgroundTransparent)&&(h.selectionBackgroundTransparent=l.color.opacity(h.selectionBackgroundTransparent,.3)),l.color.isOpaque(h.selectionInactiveBackgroundTransparent)&&(h.selectionInactiveBackgroundTransparent=l.color.opacity(h.selectionInactiveBackgroundTransparent,.3)),h.ansi=r.DEFAULT_ANSI_COLORS.slice(),h.ansi[0]=g(b.black,r.DEFAULT_ANSI_COLORS[0]),h.ansi[1]=g(b.red,r.DEFAULT_ANSI_COLORS[1]),h.ansi[2]=g(b.green,r.DEFAULT_ANSI_COLORS[2]),h.ansi[3]=g(b.yellow,r.DEFAULT_ANSI_COLORS[3]),h.ansi[4]=g(b.blue,r.DEFAULT_ANSI_COLORS[4]),h.ansi[5]=g(b.magenta,r.DEFAULT_ANSI_COLORS[5]),h.ansi[6]=g(b.cyan,r.DEFAULT_ANSI_COLORS[6]),h.ansi[7]=g(b.white,r.DEFAULT_ANSI_COLORS[7]),h.ansi[8]=g(b.brightBlack,r.DEFAULT_ANSI_COLORS[8]),h.ansi[9]=g(b.brightRed,r.DEFAULT_ANSI_COLORS[9]),h.ansi[10]=g(b.brightGreen,r.DEFAULT_ANSI_COLORS[10]),h.ansi[11]=g(b.brightYellow,r.DEFAULT_ANSI_COLORS[11]),h.ansi[12]=g(b.brightBlue,r.DEFAULT_ANSI_COLORS[12]),h.ansi[13]=g(b.brightMagenta,r.DEFAULT_ANSI_COLORS[13]),h.ansi[14]=g(b.brightCyan,r.DEFAULT_ANSI_COLORS[14]),h.ansi[15]=g(b.brightWhite,r.DEFAULT_ANSI_COLORS[15]),b.extendedAnsi){let m=Math.min(h.ansi.length-16,b.extendedAnsi.length);for(let E=0;E<m;E++)h.ansi[E+16]=g(b.extendedAnsi[E],r.DEFAULT_ANSI_COLORS[E+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(b){this._restoreColor(b),this._onChangeColors.fire(this.colors)}_restoreColor(b){if(b!==void 0)switch(b){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[b]=this._restoreColors.ansi[b]}else for(let h=0;h<this._restoreColors.ansi.length;++h)this._colors.ansi[h]=this._restoreColors.ansi[h]}modifyColors(b){b(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function g(b,h){if(b!==void 0)try{return l.css.toColor(b)}catch{}return h}r.ThemeService=u=o([d(0,f.IOptionsService)],u)},6349:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CircularList=void 0;let o=a(8460),d=a(844);class n extends d.Disposable{constructor(_){super(),this._maxLength=_,this.onDeleteEmitter=this.register(new o.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new o.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new o.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(_){if(this._maxLength===_)return;let p=new Array(_);for(let f=0;f<Math.min(_,this.length);f++)p[f]=this._array[this._getCyclicIndex(f)];this._array=p,this._maxLength=_,this._startIndex=0}get length(){return this._length}set length(_){if(_>this._length)for(let p=this._length;p<_;p++)this._array[p]=void 0;this._length=_}get(_){return this._array[this._getCyclicIndex(_)]}set(_,p){this._array[this._getCyclicIndex(_)]=p}push(_){this._array[this._getCyclicIndex(this._length)]=_,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(_,p,...f){if(p){for(let e=_;e<this._length-p;e++)this._array[this._getCyclicIndex(e)]=this._array[this._getCyclicIndex(e+p)];this._length-=p,this.onDeleteEmitter.fire({index:_,amount:p})}for(let e=this._length-1;e>=_;e--)this._array[this._getCyclicIndex(e+f.length)]=this._array[this._getCyclicIndex(e)];for(let e=0;e<f.length;e++)this._array[this._getCyclicIndex(_+e)]=f[e];if(f.length&&this.onInsertEmitter.fire({index:_,amount:f.length}),this._length+f.length>this._maxLength){let e=this._length+f.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=f.length}trimStart(_){_>this._length&&(_=this._length),this._startIndex+=_,this._length-=_,this.onTrimEmitter.fire(_)}shiftElements(_,p,f){if(!(p<=0)){if(_<0||_>=this._length)throw new Error("start argument out of range");if(_+f<0)throw new Error("Cannot shift elements in list beyond index 0");if(f>0){for(let s=p-1;s>=0;s--)this.set(_+s+f,this.get(_+s));let e=_+p+f-this._length;if(e>0)for(this._length+=e;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let e=0;e<p;e++)this.set(_+e+f,this.get(_+e))}}_getCyclicIndex(_){return(this._startIndex+_)%this._maxLength}}r.CircularList=n},1439:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function a(o,d=5){if(typeof o!="object")return o;let n=Array.isArray(o)?[]:{};for(let l in o)n[l]=d<=1?o[l]:o[l]&&a(o[l],d-1);return n}},8055:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.contrastRatio=r.toPaddedHex=r.rgba=r.rgb=r.css=r.color=r.channels=r.NULL_COLOR=void 0;let o=a(6114),d=0,n=0,l=0,_=0;var p,f,e,s,t;function i(u){let g=u.toString(16);return g.length<2?"0"+g:g}function c(u,g){return u<g?(g+.05)/(u+.05):(u+.05)/(g+.05)}r.NULL_COLOR={css:"#00000000",rgba:0},function(u){u.toCss=function(g,b,h,m){return m!==void 0?`#${i(g)}${i(b)}${i(h)}${i(m)}`:`#${i(g)}${i(b)}${i(h)}`},u.toRgba=function(g,b,h,m=255){return(g<<24|b<<16|h<<8|m)>>>0}}(p||(r.channels=p={})),function(u){function g(b,h){return _=Math.round(255*h),[d,n,l]=t.toChannels(b.rgba),{css:p.toCss(d,n,l,_),rgba:p.toRgba(d,n,l,_)}}u.blend=function(b,h){if(_=(255&h.rgba)/255,_===1)return{css:h.css,rgba:h.rgba};let m=h.rgba>>24&255,E=h.rgba>>16&255,R=h.rgba>>8&255,x=b.rgba>>24&255,B=b.rgba>>16&255,P=b.rgba>>8&255;return d=x+Math.round((m-x)*_),n=B+Math.round((E-B)*_),l=P+Math.round((R-P)*_),{css:p.toCss(d,n,l),rgba:p.toRgba(d,n,l)}},u.isOpaque=function(b){return(255&b.rgba)==255},u.ensureContrastRatio=function(b,h,m){let E=t.ensureContrastRatio(b.rgba,h.rgba,m);if(E)return t.toColor(E>>24&255,E>>16&255,E>>8&255)},u.opaque=function(b){let h=(255|b.rgba)>>>0;return[d,n,l]=t.toChannels(h),{css:p.toCss(d,n,l),rgba:h}},u.opacity=g,u.multiplyOpacity=function(b,h){return _=255&b.rgba,g(b,_*h/255)},u.toColorRGB=function(b){return[b.rgba>>24&255,b.rgba>>16&255,b.rgba>>8&255]}}(f||(r.color=f={})),function(u){let g,b;if(!o.isNode){let h=document.createElement("canvas");h.width=1,h.height=1;let m=h.getContext("2d",{willReadFrequently:!0});m&&(g=m,g.globalCompositeOperation="copy",b=g.createLinearGradient(0,0,1,1))}u.toColor=function(h){if(h.match(/#[\da-f]{3,8}/i))switch(h.length){case 4:return d=parseInt(h.slice(1,2).repeat(2),16),n=parseInt(h.slice(2,3).repeat(2),16),l=parseInt(h.slice(3,4).repeat(2),16),t.toColor(d,n,l);case 5:return d=parseInt(h.slice(1,2).repeat(2),16),n=parseInt(h.slice(2,3).repeat(2),16),l=parseInt(h.slice(3,4).repeat(2),16),_=parseInt(h.slice(4,5).repeat(2),16),t.toColor(d,n,l,_);case 7:return{css:h,rgba:(parseInt(h.slice(1),16)<<8|255)>>>0};case 9:return{css:h,rgba:parseInt(h.slice(1),16)>>>0}}let m=h.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(m)return d=parseInt(m[1]),n=parseInt(m[2]),l=parseInt(m[3]),_=Math.round(255*(m[5]===void 0?1:parseFloat(m[5]))),t.toColor(d,n,l,_);if(!g||!b)throw new Error("css.toColor: Unsupported css format");if(g.fillStyle=b,g.fillStyle=h,typeof g.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(g.fillRect(0,0,1,1),[d,n,l,_]=g.getImageData(0,0,1,1).data,_!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:p.toRgba(d,n,l,_),css:h}}}(e||(r.css=e={})),function(u){function g(b,h,m){let E=b/255,R=h/255,x=m/255;return .2126*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))+.7152*(R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4))+.0722*(x<=.03928?x/12.92:Math.pow((x+.055)/1.055,2.4))}u.relativeLuminance=function(b){return g(b>>16&255,b>>8&255,255&b)},u.relativeLuminance2=g}(s||(r.rgb=s={})),function(u){function g(h,m,E){let R=h>>24&255,x=h>>16&255,B=h>>8&255,P=m>>24&255,O=m>>16&255,W=m>>8&255,F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(R,x,B));for(;F<E&&(P>0||O>0||W>0);)P-=Math.max(0,Math.ceil(.1*P)),O-=Math.max(0,Math.ceil(.1*O)),W-=Math.max(0,Math.ceil(.1*W)),F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(R,x,B));return(P<<24|O<<16|W<<8|255)>>>0}function b(h,m,E){let R=h>>24&255,x=h>>16&255,B=h>>8&255,P=m>>24&255,O=m>>16&255,W=m>>8&255,F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(R,x,B));for(;F<E&&(P<255||O<255||W<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),O=Math.min(255,O+Math.ceil(.1*(255-O))),W=Math.min(255,W+Math.ceil(.1*(255-W))),F=c(s.relativeLuminance2(P,O,W),s.relativeLuminance2(R,x,B));return(P<<24|O<<16|W<<8|255)>>>0}u.ensureContrastRatio=function(h,m,E){let R=s.relativeLuminance(h>>8),x=s.relativeLuminance(m>>8);if(c(R,x)<E){if(x<R){let O=g(h,m,E),W=c(R,s.relativeLuminance(O>>8));if(W<E){let F=b(h,m,E);return W>c(R,s.relativeLuminance(F>>8))?O:F}return O}let B=b(h,m,E),P=c(R,s.relativeLuminance(B>>8));if(P<E){let O=g(h,m,E);return P>c(R,s.relativeLuminance(O>>8))?B:O}return B}},u.reduceLuminance=g,u.increaseLuminance=b,u.toChannels=function(h){return[h>>24&255,h>>16&255,h>>8&255,255&h]},u.toColor=function(h,m,E,R){return{css:p.toCss(h,m,E,R),rgba:p.toRgba(h,m,E,R)}}}(t||(r.rgba=t={})),r.toPaddedHex=i,r.contrastRatio=c},8969:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreTerminal=void 0;let o=a(844),d=a(2585),n=a(4348),l=a(7866),_=a(744),p=a(7302),f=a(6975),e=a(8460),s=a(1753),t=a(1480),i=a(7994),c=a(9282),u=a(5435),g=a(5981),b=a(2660),h=!1;class m extends o.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new e.EventEmitter),this._onScroll.event(R=>{var x;(x=this._onScrollApi)===null||x===void 0||x.fire(R.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(R){for(let x in R)this.optionsService.options[x]=R[x]}constructor(R){super(),this._windowsWrappingHeuristics=this.register(new o.MutableDisposable),this._onBinary=this.register(new e.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new e.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new e.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new e.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new e.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new p.OptionsService(R)),this._instantiationService.setService(d.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(_.BufferService)),this._instantiationService.setService(d.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(l.LogService)),this._instantiationService.setService(d.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(f.CoreService)),this._instantiationService.setService(d.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(s.CoreMouseService)),this._instantiationService.setService(d.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(t.UnicodeService)),this._instantiationService.setService(d.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(i.CharsetService),this._instantiationService.setService(d.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(b.OscLinkService),this._instantiationService.setService(d.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new u.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,e.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,e.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,e.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,e.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new g.WriteBuffer((x,B)=>this._inputHandler.parse(x,B))),this.register((0,e.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(R,x){this._writeBuffer.write(R,x)}writeSync(R,x){this._logService.logLevel<=d.LogLevelEnum.WARN&&!h&&(this._logService.warn("writeSync is unreliable and will be removed soon."),h=!0),this._writeBuffer.writeSync(R,x)}resize(R,x){isNaN(R)||isNaN(x)||(R=Math.max(R,_.MINIMUM_COLS),x=Math.max(x,_.MINIMUM_ROWS),this._bufferService.resize(R,x))}scroll(R,x=!1){this._bufferService.scroll(R,x)}scrollLines(R,x,B){this._bufferService.scrollLines(R,x,B)}scrollPages(R){this.scrollLines(R*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(R){let x=R-this._bufferService.buffer.ydisp;x!==0&&this.scrollLines(x)}registerEscHandler(R,x){return this._inputHandler.registerEscHandler(R,x)}registerDcsHandler(R,x){return this._inputHandler.registerDcsHandler(R,x)}registerCsiHandler(R,x){return this._inputHandler.registerCsiHandler(R,x)}registerOscHandler(R,x){return this._inputHandler.registerOscHandler(R,x)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let R=!1,x=this.optionsService.rawOptions.windowsPty;x&&x.buildNumber!==void 0&&x.buildNumber!==void 0?R=x.backend==="conpty"&&x.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(R=!0),R?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let R=[];R.push(this.onLineFeed(c.updateWindowsModeWrappedState.bind(null,this._bufferService))),R.push(this.registerCsiHandler({final:"H"},()=>((0,c.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,o.toDisposable)(()=>{for(let x of R)x.dispose()})}}}r.CoreTerminal=m},8460:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let o=0;o<this._listeners.length;o++)if(this._listeners[o]===a)return void this._listeners.splice(o,1)}}})),this._event}fire(a,o){let d=[];for(let n=0;n<this._listeners.length;n++)d.push(this._listeners[n]);for(let n=0;n<d.length;n++)d[n].call(void 0,a,o)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(a,o){return a(d=>o.fire(d))}},5435:function(k,r,a){var o=this&&this.__decorate||function(F,C,L,D){var A,N=arguments.length,j=N<3?C:D===null?D=Object.getOwnPropertyDescriptor(C,L):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(F,C,L,D);else for(var K=F.length-1;K>=0;K--)(A=F[K])&&(j=(N<3?A(j):N>3?A(C,L,j):A(C,L))||j);return N>3&&j&&Object.defineProperty(C,L,j),j},d=this&&this.__param||function(F,C){return function(L,D){C(L,D,F)}};Object.defineProperty(r,"__esModule",{value:!0}),r.InputHandler=r.WindowsOptionsReportType=void 0;let n=a(2584),l=a(7116),_=a(2015),p=a(844),f=a(482),e=a(8437),s=a(8460),t=a(643),i=a(511),c=a(3734),u=a(2585),g=a(6242),b=a(6351),h=a(5941),m={"(":0,")":1,"*":2,"+":3,"-":1,".":2},E=131072;function R(F,C){if(F>24)return C.setWinLines||!1;switch(F){case 1:return!!C.restoreWin;case 2:return!!C.minimizeWin;case 3:return!!C.setWinPosition;case 4:return!!C.setWinSizePixels;case 5:return!!C.raiseWin;case 6:return!!C.lowerWin;case 7:return!!C.refreshWin;case 8:return!!C.setWinSizeChars;case 9:return!!C.maximizeWin;case 10:return!!C.fullscreenWin;case 11:return!!C.getWinState;case 13:return!!C.getWinPosition;case 14:return!!C.getWinSizePixels;case 15:return!!C.getScreenSizePixels;case 16:return!!C.getCellSizePixels;case 18:return!!C.getWinSizeChars;case 19:return!!C.getScreenSizeChars;case 20:return!!C.getIconTitle;case 21:return!!C.getWinTitle;case 22:return!!C.pushTitle;case 23:return!!C.popTitle;case 24:return!!C.setWinLines}return!1}var x;(function(F){F[F.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",F[F.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(x||(r.WindowsOptionsReportType=x={}));let B=0;class P extends p.Disposable{getAttrData(){return this._curAttrData}constructor(C,L,D,A,N,j,K,z,Y=new _.EscapeSequenceParser){super(),this._bufferService=C,this._charsetService=L,this._coreService=D,this._logService=A,this._optionsService=N,this._oscLinkService=j,this._coreMouseService=K,this._unicodeService=z,this._parser=Y,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new f.StringToUtf32,this._utf8Decoder=new f.Utf8ToUtf32,this._workCell=new i.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new s.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new s.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new s.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new s.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new s.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new s.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new s.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new s.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new s.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new s.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new s.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new O(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(w=>this._activeBuffer=w.activeBuffer)),this._parser.setCsiHandlerFallback((w,M)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(w),params:M.toArray()})}),this._parser.setEscHandlerFallback(w=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(w)})}),this._parser.setExecuteHandlerFallback(w=>{this._logService.debug("Unknown EXECUTE code: ",{code:w})}),this._parser.setOscHandlerFallback((w,M,H)=>{this._logService.debug("Unknown OSC code: ",{identifier:w,action:M,data:H})}),this._parser.setDcsHandlerFallback((w,M,H)=>{M==="HOOK"&&(H=H.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(w),action:M,payload:H})}),this._parser.setPrintHandler((w,M,H)=>this.print(w,M,H)),this._parser.registerCsiHandler({final:"@"},w=>this.insertChars(w)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},w=>this.scrollLeft(w)),this._parser.registerCsiHandler({final:"A"},w=>this.cursorUp(w)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},w=>this.scrollRight(w)),this._parser.registerCsiHandler({final:"B"},w=>this.cursorDown(w)),this._parser.registerCsiHandler({final:"C"},w=>this.cursorForward(w)),this._parser.registerCsiHandler({final:"D"},w=>this.cursorBackward(w)),this._parser.registerCsiHandler({final:"E"},w=>this.cursorNextLine(w)),this._parser.registerCsiHandler({final:"F"},w=>this.cursorPrecedingLine(w)),this._parser.registerCsiHandler({final:"G"},w=>this.cursorCharAbsolute(w)),this._parser.registerCsiHandler({final:"H"},w=>this.cursorPosition(w)),this._parser.registerCsiHandler({final:"I"},w=>this.cursorForwardTab(w)),this._parser.registerCsiHandler({final:"J"},w=>this.eraseInDisplay(w,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},w=>this.eraseInDisplay(w,!0)),this._parser.registerCsiHandler({final:"K"},w=>this.eraseInLine(w,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},w=>this.eraseInLine(w,!0)),this._parser.registerCsiHandler({final:"L"},w=>this.insertLines(w)),this._parser.registerCsiHandler({final:"M"},w=>this.deleteLines(w)),this._parser.registerCsiHandler({final:"P"},w=>this.deleteChars(w)),this._parser.registerCsiHandler({final:"S"},w=>this.scrollUp(w)),this._parser.registerCsiHandler({final:"T"},w=>this.scrollDown(w)),this._parser.registerCsiHandler({final:"X"},w=>this.eraseChars(w)),this._parser.registerCsiHandler({final:"Z"},w=>this.cursorBackwardTab(w)),this._parser.registerCsiHandler({final:"`"},w=>this.charPosAbsolute(w)),this._parser.registerCsiHandler({final:"a"},w=>this.hPositionRelative(w)),this._parser.registerCsiHandler({final:"b"},w=>this.repeatPrecedingCharacter(w)),this._parser.registerCsiHandler({final:"c"},w=>this.sendDeviceAttributesPrimary(w)),this._parser.registerCsiHandler({prefix:">",final:"c"},w=>this.sendDeviceAttributesSecondary(w)),this._parser.registerCsiHandler({final:"d"},w=>this.linePosAbsolute(w)),this._parser.registerCsiHandler({final:"e"},w=>this.vPositionRelative(w)),this._parser.registerCsiHandler({final:"f"},w=>this.hVPosition(w)),this._parser.registerCsiHandler({final:"g"},w=>this.tabClear(w)),this._parser.registerCsiHandler({final:"h"},w=>this.setMode(w)),this._parser.registerCsiHandler({prefix:"?",final:"h"},w=>this.setModePrivate(w)),this._parser.registerCsiHandler({final:"l"},w=>this.resetMode(w)),this._parser.registerCsiHandler({prefix:"?",final:"l"},w=>this.resetModePrivate(w)),this._parser.registerCsiHandler({final:"m"},w=>this.charAttributes(w)),this._parser.registerCsiHandler({final:"n"},w=>this.deviceStatus(w)),this._parser.registerCsiHandler({prefix:"?",final:"n"},w=>this.deviceStatusPrivate(w)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},w=>this.softReset(w)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},w=>this.setCursorStyle(w)),this._parser.registerCsiHandler({final:"r"},w=>this.setScrollRegion(w)),this._parser.registerCsiHandler({final:"s"},w=>this.saveCursor(w)),this._parser.registerCsiHandler({final:"t"},w=>this.windowOptions(w)),this._parser.registerCsiHandler({final:"u"},w=>this.restoreCursor(w)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},w=>this.insertColumns(w)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},w=>this.deleteColumns(w)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},w=>this.selectProtected(w)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},w=>this.requestMode(w,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},w=>this.requestMode(w,!1)),this._parser.setExecuteHandler(n.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(n.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(n.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(n.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(n.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(n.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(n.C1.IND,()=>this.index()),this._parser.setExecuteHandler(n.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(n.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new g.OscHandler(w=>(this.setTitle(w),this.setIconName(w),!0))),this._parser.registerOscHandler(1,new g.OscHandler(w=>this.setIconName(w))),this._parser.registerOscHandler(2,new g.OscHandler(w=>this.setTitle(w))),this._parser.registerOscHandler(4,new g.OscHandler(w=>this.setOrReportIndexedColor(w))),this._parser.registerOscHandler(8,new g.OscHandler(w=>this.setHyperlink(w))),this._parser.registerOscHandler(10,new g.OscHandler(w=>this.setOrReportFgColor(w))),this._parser.registerOscHandler(11,new g.OscHandler(w=>this.setOrReportBgColor(w))),this._parser.registerOscHandler(12,new g.OscHandler(w=>this.setOrReportCursorColor(w))),this._parser.registerOscHandler(104,new g.OscHandler(w=>this.restoreIndexedColor(w))),this._parser.registerOscHandler(110,new g.OscHandler(w=>this.restoreFgColor(w))),this._parser.registerOscHandler(111,new g.OscHandler(w=>this.restoreBgColor(w))),this._parser.registerOscHandler(112,new g.OscHandler(w=>this.restoreCursorColor(w))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let w in l.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:w},()=>this.selectCharset("("+w)),this._parser.registerEscHandler({intermediates:")",final:w},()=>this.selectCharset(")"+w)),this._parser.registerEscHandler({intermediates:"*",final:w},()=>this.selectCharset("*"+w)),this._parser.registerEscHandler({intermediates:"+",final:w},()=>this.selectCharset("+"+w)),this._parser.registerEscHandler({intermediates:"-",final:w},()=>this.selectCharset("-"+w)),this._parser.registerEscHandler({intermediates:".",final:w},()=>this.selectCharset("."+w)),this._parser.registerEscHandler({intermediates:"/",final:w},()=>this.selectCharset("/"+w));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(w=>(this._logService.error("Parsing error: ",w),w)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new b.DcsHandler((w,M)=>this.requestStatusString(w,M)))}_preserveStack(C,L,D,A){this._parseStack.paused=!0,this._parseStack.cursorStartX=C,this._parseStack.cursorStartY=L,this._parseStack.decodedLength=D,this._parseStack.position=A}_logSlowResolvingAsync(C){this._logService.logLevel<=u.LogLevelEnum.WARN&&Promise.race([C,new Promise((L,D)=>setTimeout(()=>D("#SLOW_TIMEOUT"),5e3))]).catch(L=>{if(L!=="#SLOW_TIMEOUT")throw L;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(C,L){let D,A=this._activeBuffer.x,N=this._activeBuffer.y,j=0,K=this._parseStack.paused;if(K){if(D=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,L))return this._logSlowResolvingAsync(D),D;A=this._parseStack.cursorStartX,N=this._parseStack.cursorStartY,this._parseStack.paused=!1,C.length>E&&(j=this._parseStack.position+E)}if(this._logService.logLevel<=u.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof C=="string"?` "${C}"`:` "${Array.prototype.map.call(C,z=>String.fromCharCode(z)).join("")}"`),typeof C=="string"?C.split("").map(z=>z.charCodeAt(0)):C),this._parseBuffer.length<C.length&&this._parseBuffer.length<E&&(this._parseBuffer=new Uint32Array(Math.min(C.length,E))),K||this._dirtyRowTracker.clearRange(),C.length>E)for(let z=j;z<C.length;z+=E){let Y=z+E<C.length?z+E:C.length,w=typeof C=="string"?this._stringDecoder.decode(C.substring(z,Y),this._parseBuffer):this._utf8Decoder.decode(C.subarray(z,Y),this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,w))return this._preserveStack(A,N,w,z),this._logSlowResolvingAsync(D),D}else if(!K){let z=typeof C=="string"?this._stringDecoder.decode(C,this._parseBuffer):this._utf8Decoder.decode(C,this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,z))return this._preserveStack(A,N,z,0),this._logSlowResolvingAsync(D),D}this._activeBuffer.x===A&&this._activeBuffer.y===N||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(C,L,D){let A,N,j=this._charsetService.charset,K=this._optionsService.rawOptions.screenReaderMode,z=this._bufferService.cols,Y=this._coreService.decPrivateModes.wraparound,w=this._coreService.modes.insertMode,M=this._curAttrData,H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&D-L>0&&H.getWidth(this._activeBuffer.x-1)===2&&H.setCellFromCodePoint(this._activeBuffer.x-1,0,1,M.fg,M.bg,M.extended);for(let I=L;I<D;++I){if(A=C[I],N=this._unicodeService.wcwidth(A),A<127&&j){let q=j[String.fromCharCode(A)];q&&(A=q.charCodeAt(0))}if(K&&this._onA11yChar.fire((0,f.stringFromCodePoint)(A)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),N||!this._activeBuffer.x){if(this._activeBuffer.x+N-1>=z){if(Y){for(;this._activeBuffer.x<z;)H.setCellFromCodePoint(this._activeBuffer.x++,0,1,M.fg,M.bg,M.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=z-1,N===2)continue}if(w&&(H.insertCells(this._activeBuffer.x,N,this._activeBuffer.getNullCell(M),M),H.getWidth(z-1)===2&&H.setCellFromCodePoint(z-1,t.NULL_CELL_CODE,t.NULL_CELL_WIDTH,M.fg,M.bg,M.extended)),H.setCellFromCodePoint(this._activeBuffer.x++,A,N,M.fg,M.bg,M.extended),N>0)for(;--N;)H.setCellFromCodePoint(this._activeBuffer.x++,0,0,M.fg,M.bg,M.extended)}else H.getWidth(this._activeBuffer.x-1)?H.addCodepointToCell(this._activeBuffer.x-1,A):H.addCodepointToCell(this._activeBuffer.x-2,A)}D-L>0&&(H.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<z&&D-L>0&&H.getWidth(this._activeBuffer.x)===0&&!H.hasContent(this._activeBuffer.x)&&H.setCellFromCodePoint(this._activeBuffer.x,0,1,M.fg,M.bg,M.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(C,L){return C.final!=="t"||C.prefix||C.intermediates?this._parser.registerCsiHandler(C,L):this._parser.registerCsiHandler(C,D=>!R(D.params[0],this._optionsService.rawOptions.windowOptions)||L(D))}registerDcsHandler(C,L){return this._parser.registerDcsHandler(C,new b.DcsHandler(L))}registerEscHandler(C,L){return this._parser.registerEscHandler(C,L)}registerOscHandler(C,L){return this._parser.registerOscHandler(C,new g.OscHandler(L))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var C;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||C===void 0)&&C.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);L.hasWidth(this._activeBuffer.x)&&!L.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let C=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-C),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(C=this._bufferService.cols-1){this._activeBuffer.x=Math.min(C,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(C,L){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=C,this._activeBuffer.y=this._activeBuffer.scrollTop+L):(this._activeBuffer.x=C,this._activeBuffer.y=L),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(C,L){this._restrictCursor(),this._setCursor(this._activeBuffer.x+C,this._activeBuffer.y+L)}cursorUp(C){let L=this._activeBuffer.y-this._activeBuffer.scrollTop;return L>=0?this._moveCursor(0,-Math.min(L,C.params[0]||1)):this._moveCursor(0,-(C.params[0]||1)),!0}cursorDown(C){let L=this._activeBuffer.scrollBottom-this._activeBuffer.y;return L>=0?this._moveCursor(0,Math.min(L,C.params[0]||1)):this._moveCursor(0,C.params[0]||1),!0}cursorForward(C){return this._moveCursor(C.params[0]||1,0),!0}cursorBackward(C){return this._moveCursor(-(C.params[0]||1),0),!0}cursorNextLine(C){return this.cursorDown(C),this._activeBuffer.x=0,!0}cursorPrecedingLine(C){return this.cursorUp(C),this._activeBuffer.x=0,!0}cursorCharAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(C){return this._setCursor(C.length>=2?(C.params[1]||1)-1:0,(C.params[0]||1)-1),!0}charPosAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(C){return this._moveCursor(C.params[0]||1,0),!0}linePosAbsolute(C){return this._setCursor(this._activeBuffer.x,(C.params[0]||1)-1),!0}vPositionRelative(C){return this._moveCursor(0,C.params[0]||1),!0}hVPosition(C){return this.cursorPosition(C),!0}tabClear(C){let L=C.params[0];return L===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:L===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let L=C.params[0]||1;for(;L--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let L=C.params[0]||1;for(;L--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(C){let L=C.params[0];return L===1&&(this._curAttrData.bg|=536870912),L!==2&&L!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(C,L,D,A=!1,N=!1){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);j.replaceCells(L,D,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),N),A&&(j.isWrapped=!1)}_resetBufferLine(C,L=!1){let D=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);D&&(D.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),L),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+C),D.isWrapped=!1)}eraseInDisplay(C,L=!1){let D;switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,L);D<this._bufferService.rows;D++)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(D);break;case 1:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D,0,this._activeBuffer.x+1,!0,L),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(D+1).isWrapped=!1);D--;)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(0);break;case 2:for(D=this._bufferService.rows,this._dirtyRowTracker.markDirty(D-1);D--;)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(0);break;case 3:let A=this._activeBuffer.lines.length-this._bufferService.rows;A>0&&(this._activeBuffer.lines.trimStart(A),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-A,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-A,0),this._onScroll.fire(0))}return!0}eraseInLine(C,L=!1){switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,L);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,L);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,L)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(C){this._restrictCursor();let L=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,A=this._bufferService.rows-1-this._activeBuffer.scrollBottom,N=this._bufferService.rows-1+this._activeBuffer.ybase-A+1;for(;L--;)this._activeBuffer.lines.splice(N-1,1),this._activeBuffer.lines.splice(D,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(C){this._restrictCursor();let L=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,A;for(A=this._bufferService.rows-1-this._activeBuffer.scrollBottom,A=this._bufferService.rows-1+this._activeBuffer.ybase-A;L--;)this._activeBuffer.lines.splice(D,1),this._activeBuffer.lines.splice(A,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.insertCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.deleteCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(C){let L=C.params[0]||1;for(;L--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(C){let L=C.params[0]||1;for(;L--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(e.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.deleteCells(0,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.insertCells(0,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.insertCells(this._activeBuffer.x,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);A.deleteCells(this._activeBuffer.x,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),A.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(C.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(C){if(!this._parser.precedingCodepoint)return!0;let L=C.params[0]||1,D=new Uint32Array(L);for(let A=0;A<L;++A)D[A]=this._parser.precedingCodepoint;return this.print(D,0,D.length),!0}sendDeviceAttributesPrimary(C){return C.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(C){return C.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(C.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(C){return(this._optionsService.rawOptions.termName+"").indexOf(C)===0}setMode(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,l.DEFAULT_CHARSET),this._charsetService.setgCharset(1,l.DEFAULT_CHARSET),this._charsetService.setgCharset(2,l.DEFAULT_CHARSET),this._charsetService.setgCharset(3,l.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),C.params[L]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(C,L){let D=this._coreService.decPrivateModes,{activeProtocol:A,activeEncoding:N}=this._coreMouseService,j=this._coreService,{buffers:K,cols:z}=this._bufferService,{active:Y,alt:w}=K,M=this._optionsService.rawOptions,H=G=>G?1:2,I=C.params[0];return q=I,U=L?I===2?4:I===4?H(j.modes.insertMode):I===12?3:I===20?H(M.convertEol):0:I===1?H(D.applicationCursorKeys):I===3?M.windowOptions.setWinLines?z===80?2:z===132?1:0:0:I===6?H(D.origin):I===7?H(D.wraparound):I===8?3:I===9?H(A==="X10"):I===12?H(M.cursorBlink):I===25?H(!j.isCursorHidden):I===45?H(D.reverseWraparound):I===66?H(D.applicationKeypad):I===67?4:I===1e3?H(A==="VT200"):I===1002?H(A==="DRAG"):I===1003?H(A==="ANY"):I===1004?H(D.sendFocus):I===1005?4:I===1006?H(N==="SGR"):I===1015?4:I===1016?H(N==="SGR_PIXELS"):I===1048?1:I===47||I===1047||I===1049?H(Y===w):I===2004?H(D.bracketedPasteMode):0,j.triggerDataEvent(`${n.C0.ESC}[${L?"":"?"}${q};${U}$y`),!0;var q,U}_updateAttrColor(C,L,D,A,N){return L===2?(C|=50331648,C&=-16777216,C|=c.AttributeData.fromColorRGB([D,A,N])):L===5&&(C&=-50331904,C|=33554432|255&D),C}_extractColor(C,L,D){let A=[0,0,-1,0,0,0],N=0,j=0;do{if(A[j+N]=C.params[L+j],C.hasSubParams(L+j)){let K=C.getSubParams(L+j),z=0;do A[1]===5&&(N=1),A[j+z+1+N]=K[z];while(++z<K.length&&z+j+1+N<A.length);break}if(A[1]===5&&j+N>=2||A[1]===2&&j+N>=5)break;A[1]&&(N=1)}while(++j+L<C.length&&j+N<A.length);for(let K=2;K<A.length;++K)A[K]===-1&&(A[K]=0);switch(A[0]){case 38:D.fg=this._updateAttrColor(D.fg,A[1],A[3],A[4],A[5]);break;case 48:D.bg=this._updateAttrColor(D.bg,A[1],A[3],A[4],A[5]);break;case 58:D.extended=D.extended.clone(),D.extended.underlineColor=this._updateAttrColor(D.extended.underlineColor,A[1],A[3],A[4],A[5])}return j}_processUnderline(C,L){L.extended=L.extended.clone(),(!~C||C>5)&&(C=1),L.extended.underlineStyle=C,L.fg|=268435456,C===0&&(L.fg&=-268435457),L.updateExtended()}_processSGR0(C){C.fg=e.DEFAULT_ATTR_DATA.fg,C.bg=e.DEFAULT_ATTR_DATA.bg,C.extended=C.extended.clone(),C.extended.underlineStyle=0,C.extended.underlineColor&=-67108864,C.updateExtended()}charAttributes(C){if(C.length===1&&C.params[0]===0)return this._processSGR0(this._curAttrData),!0;let L=C.length,D,A=this._curAttrData;for(let N=0;N<L;N++)D=C.params[N],D>=30&&D<=37?(A.fg&=-50331904,A.fg|=16777216|D-30):D>=40&&D<=47?(A.bg&=-50331904,A.bg|=16777216|D-40):D>=90&&D<=97?(A.fg&=-50331904,A.fg|=16777224|D-90):D>=100&&D<=107?(A.bg&=-50331904,A.bg|=16777224|D-100):D===0?this._processSGR0(A):D===1?A.fg|=134217728:D===3?A.bg|=67108864:D===4?(A.fg|=268435456,this._processUnderline(C.hasSubParams(N)?C.getSubParams(N)[0]:1,A)):D===5?A.fg|=536870912:D===7?A.fg|=67108864:D===8?A.fg|=1073741824:D===9?A.fg|=2147483648:D===2?A.bg|=134217728:D===21?this._processUnderline(2,A):D===22?(A.fg&=-134217729,A.bg&=-134217729):D===23?A.bg&=-67108865:D===24?(A.fg&=-268435457,this._processUnderline(0,A)):D===25?A.fg&=-536870913:D===27?A.fg&=-67108865:D===28?A.fg&=-1073741825:D===29?A.fg&=2147483647:D===39?(A.fg&=-67108864,A.fg|=16777215&e.DEFAULT_ATTR_DATA.fg):D===49?(A.bg&=-67108864,A.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):D===38||D===48||D===58?N+=this._extractColor(C,N,A):D===53?A.bg|=1073741824:D===55?A.bg&=-1073741825:D===59?(A.extended=A.extended.clone(),A.extended.underlineColor=-1,A.updateExtended()):D===100?(A.fg&=-67108864,A.fg|=16777215&e.DEFAULT_ATTR_DATA.fg,A.bg&=-67108864,A.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",D);return!0}deviceStatus(C){switch(C.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:let L=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${L};${D}R`)}return!0}deviceStatusPrivate(C){if(C.params[0]===6){let L=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${L};${D}R`)}return!0}softReset(C){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(C){let L=C.params[0]||1;switch(L){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let D=L%2==1;return this._optionsService.options.cursorBlink=D,!0}setScrollRegion(C){let L=C.params[0]||1,D;return(C.length<2||(D=C.params[1])>this._bufferService.rows||D===0)&&(D=this._bufferService.rows),D>L&&(this._activeBuffer.scrollTop=L-1,this._activeBuffer.scrollBottom=D-1,this._setCursor(0,0)),!0}windowOptions(C){if(!R(C.params[0],this._optionsService.rawOptions.windowOptions))return!0;let L=C.length>1?C.params[1]:0;switch(C.params[0]){case 14:L!==2&&this._onRequestWindowsOptionsReport.fire(x.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(x.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:L!==0&&L!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),L!==0&&L!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:L!==0&&L!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),L!==0&&L!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(C){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(C){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(C){return this._windowTitle=C,this._onTitleChange.fire(C),!0}setIconName(C){return this._iconName=C,!0}setOrReportIndexedColor(C){let L=[],D=C.split(";");for(;D.length>1;){let A=D.shift(),N=D.shift();if(/^\d+$/.exec(A)){let j=parseInt(A);if(W(j))if(N==="?")L.push({type:0,index:j});else{let K=(0,h.parseColor)(N);K&&L.push({type:1,index:j,color:K})}}}return L.length&&this._onColor.fire(L),!0}setHyperlink(C){let L=C.split(";");return!(L.length<2)&&(L[1]?this._createHyperlink(L[0],L[1]):!L[0]&&this._finishHyperlink())}_createHyperlink(C,L){this._getCurrentLinkId()&&this._finishHyperlink();let D=C.split(":"),A,N=D.findIndex(j=>j.startsWith("id="));return N!==-1&&(A=D[N].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:A,uri:L}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(C,L){let D=C.split(";");for(let A=0;A<D.length&&!(L>=this._specialColors.length);++A,++L)if(D[A]==="?")this._onColor.fire([{type:0,index:this._specialColors[L]}]);else{let N=(0,h.parseColor)(D[A]);N&&this._onColor.fire([{type:1,index:this._specialColors[L],color:N}])}return!0}setOrReportFgColor(C){return this._setOrReportSpecialColor(C,0)}setOrReportBgColor(C){return this._setOrReportSpecialColor(C,1)}setOrReportCursorColor(C){return this._setOrReportSpecialColor(C,2)}restoreIndexedColor(C){if(!C)return this._onColor.fire([{type:2}]),!0;let L=[],D=C.split(";");for(let A=0;A<D.length;++A)if(/^\d+$/.exec(D[A])){let N=parseInt(D[A]);W(N)&&L.push({type:2,index:N})}return L.length&&this._onColor.fire(L),!0}restoreFgColor(C){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(C){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(C){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,l.DEFAULT_CHARSET),!0}selectCharset(C){return C.length!==2?(this.selectDefaultCharset(),!0):(C[0]==="/"||this._charsetService.setgCharset(m[C[0]],l.CHARSETS[C[1]]||l.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let C=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,C,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(C){return this._charsetService.setgLevel(C),!0}screenAlignmentPattern(){let C=new i.CellData;C.content=4194373,C.fg=this._curAttrData.fg,C.bg=this._curAttrData.bg,this._setCursor(0,0);for(let L=0;L<this._bufferService.rows;++L){let D=this._activeBuffer.ybase+this._activeBuffer.y+L,A=this._activeBuffer.lines.get(D);A&&(A.fill(C),A.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(C,L){let D=this._bufferService.buffer,A=this._optionsService.rawOptions;return(N=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${N}${n.C0.ESC}\\`),!0))(C==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:C==='"p'?'P1$r61;1"p':C==="r"?`P1$r${D.scrollTop+1};${D.scrollBottom+1}r`:C==="m"?"P1$r0m":C===" q"?`P1$r${{block:2,underline:4,bar:6}[A.cursorStyle]-(A.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(C,L){this._dirtyRowTracker.markRangeDirty(C,L)}}r.InputHandler=P;let O=class{constructor(F){this._bufferService=F,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(F){F<this.start?this.start=F:F>this.end&&(this.end=F)}markRangeDirty(F,C){F>C&&(B=F,F=C,C=B),F<this.start&&(this.start=F),C>this.end&&(this.end=C)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function W(F){return 0<=F&&F<256}O=o([d(0,u.IBufferService)],O)},844:(k,r)=>{function a(o){for(let d of o)d.dispose();o.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let o of this._disposables)o.dispose();this._disposables.length=0}register(o){return this._disposables.push(o),o}unregister(o){let d=this._disposables.indexOf(o);d!==-1&&this._disposables.splice(d,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(o){var d;this._isDisposed||o===this._value||((d=this._value)===null||d===void 0||d.dispose(),this._value=o)}clear(){this.value=void 0}dispose(){var o;this._isDisposed=!0,(o=this._value)===null||o===void 0||o.dispose(),this._value=void 0}},r.toDisposable=function(o){return{dispose:o}},r.disposeArray=a,r.getDisposeArrayDisposable=function(o){return{dispose:()=>a(o)}}},1505:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FourKeyMap=r.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(d,n,l){this._data[d]||(this._data[d]={}),this._data[d][n]=l}get(d,n){return this._data[d]?this._data[d][n]:void 0}clear(){this._data={}}}r.TwoKeyMap=a,r.FourKeyMap=class{constructor(){this._data=new a}set(o,d,n,l,_){this._data.get(o,d)||this._data.set(o,d,new a),this._data.get(o,d).set(n,l,_)}get(o,d,n,l){var _;return(_=this._data.get(o,d))===null||_===void 0?void 0:_.get(n,l)}clear(){this._data.clear()}}},6114:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isChromeOS=r.isLinux=r.isWindows=r.isIphone=r.isIpad=r.isMac=r.getSafariVersion=r.isSafari=r.isLegacyEdge=r.isFirefox=r.isNode=void 0,r.isNode=typeof navigator>"u";let a=r.isNode?"node":navigator.userAgent,o=r.isNode?"node":navigator.platform;r.isFirefox=a.includes("Firefox"),r.isLegacyEdge=a.includes("Edge"),r.isSafari=/^((?!chrome|android).)*safari/i.test(a),r.getSafariVersion=function(){if(!r.isSafari)return 0;let d=a.match(/Version\/(\d+)/);return d===null||d.length<2?0:parseInt(d[1])},r.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(o),r.isIpad=o==="iPad",r.isIphone=o==="iPhone",r.isWindows=["Windows","Win16","Win32","WinCE"].includes(o),r.isLinux=o.indexOf("Linux")>=0,r.isChromeOS=/\bCrOS\b/.test(a)},6106:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SortedList=void 0;let a=0;r.SortedList=class{constructor(o){this._getKey=o,this._array=[]}clear(){this._array.length=0}insert(o){this._array.length!==0?(a=this._search(this._getKey(o)),this._array.splice(a,0,o)):this._array.push(o)}delete(o){if(this._array.length===0)return!1;let d=this._getKey(o);if(d===void 0||(a=this._search(d),a===-1)||this._getKey(this._array[a])!==d)return!1;do if(this._array[a]===o)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===d);return!1}*getKeyIterator(o){if(this._array.length!==0&&(a=this._search(o),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===o))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===o)}forEachByKey(o,d){if(this._array.length!==0&&(a=this._search(o),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===o))do d(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===o)}values(){return[...this._array].values()}_search(o){let d=0,n=this._array.length-1;for(;n>=d;){let l=d+n>>1,_=this._getKey(this._array[l]);if(_>o)n=l-1;else{if(!(_<o)){for(;l>0&&this._getKey(this._array[l-1])===o;)l--;return l}d=l+1}}return d}}},7226:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DebouncedIdleTask=r.IdleTaskQueue=r.PriorityTaskQueue=void 0;let o=a(6114);class d{constructor(){this._tasks=[],this._i=0}enqueue(_){this._tasks.push(_),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(_){this._idleCallback=void 0;let p=0,f=0,e=_.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(p=Date.now(),this._tasks[this._i]()||this._i++,p=Math.max(1,Date.now()-p),f=Math.max(p,f),s=_.timeRemaining(),1.5*f>s)return e-p<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-p))}ms`),void this._start();e=s}this.clear()}}class n extends d{_requestCallback(_){return setTimeout(()=>_(this._createDeadline(16)))}_cancelCallback(_){clearTimeout(_)}_createDeadline(_){let p=Date.now()+_;return{timeRemaining:()=>Math.max(0,p-Date.now())}}}r.PriorityTaskQueue=n,r.IdleTaskQueue=!o.isNode&&"requestIdleCallback"in window?class extends d{_requestCallback(l){return requestIdleCallback(l)}_cancelCallback(l){cancelIdleCallback(l)}}:n,r.DebouncedIdleTask=class{constructor(){this._queue=new r.IdleTaskQueue}set(l){this._queue.clear(),this._queue.enqueue(l)}flush(){this._queue.flush()}}},9282:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.updateWindowsModeWrappedState=void 0;let o=a(643);r.updateWindowsModeWrappedState=function(d){let n=d.buffer.lines.get(d.buffer.ybase+d.buffer.y-1),l=n?.get(d.cols-1),_=d.buffer.lines.get(d.buffer.ybase+d.buffer.y);_&&l&&(_.isWrapped=l[o.CHAR_DATA_CODE_INDEX]!==o.NULL_CELL_CODE&&l[o.CHAR_DATA_CODE_INDEX]!==o.WHITESPACE_CELL_CODE)}},3734:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ExtendedAttrs=r.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new o}static toColorRGB(n){return[n>>>16&255,n>>>8&255,255&n]}static fromColorRGB(n){return(255&n[0])<<16|(255&n[1])<<8|255&n[2]}clone(){let n=new a;return n.fg=this.fg,n.bg=this.bg,n.extended=this.extended.clone(),n}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}r.AttributeData=a;class o{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(n){this._ext=n}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(n){this._ext&=-469762049,this._ext|=n<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(n){this._ext&=-67108864,this._ext|=67108863&n}get urlId(){return this._urlId}set urlId(n){this._urlId=n}constructor(n=0,l=0){this._ext=0,this._urlId=0,this._ext=n,this._urlId=l}clone(){return new o(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}r.ExtendedAttrs=o},9092:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Buffer=r.MAX_BUFFER_SIZE=void 0;let o=a(6349),d=a(7226),n=a(3734),l=a(8437),_=a(4634),p=a(511),f=a(643),e=a(4863),s=a(7116);r.MAX_BUFFER_SIZE=4294967295,r.Buffer=class{constructor(t,i,c){this._hasScrollback=t,this._optionsService=i,this._bufferService=c,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=l.DEFAULT_ATTR_DATA.clone(),this.savedCharset=s.DEFAULT_CHARSET,this.markers=[],this._nullCell=p.CellData.fromCharData([0,f.NULL_CELL_CHAR,f.NULL_CELL_WIDTH,f.NULL_CELL_CODE]),this._whitespaceCell=p.CellData.fromCharData([0,f.WHITESPACE_CELL_CHAR,f.WHITESPACE_CELL_WIDTH,f.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new d.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg,this._nullCell.extended=t.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg,this._whitespaceCell.extended=t.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(t,i){return new l.BufferLine(this._bufferService.cols,this.getNullCell(t),i)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows}_getCorrectBufferLength(t){if(!this._hasScrollback)return t;let i=t+this._optionsService.rawOptions.scrollback;return i>r.MAX_BUFFER_SIZE?r.MAX_BUFFER_SIZE:i}fillViewportRows(t){if(this.lines.length===0){t===void 0&&(t=l.DEFAULT_ATTR_DATA);let i=this._rows;for(;i--;)this.lines.push(this.getBlankLine(t))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(t,i){let c=this.getNullCell(l.DEFAULT_ATTR_DATA),u=0,g=this._getCorrectBufferLength(i);if(g>this.lines.maxLength&&(this.lines.maxLength=g),this.lines.length>0){if(this._cols<t)for(let h=0;h<this.lines.length;h++)u+=+this.lines.get(h).resize(t,c);let b=0;if(this._rows<i)for(let h=this._rows;h<i;h++)this.lines.length<i+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new l.BufferLine(t,c)):this.ybase>0&&this.lines.length<=this.ybase+this.y+b+1?(this.ybase--,b++,this.ydisp>0&&this.ydisp--):this.lines.push(new l.BufferLine(t,c)));else for(let h=this._rows;h>i;h--)this.lines.length>i+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(g<this.lines.maxLength){let h=this.lines.length-g;h>0&&(this.lines.trimStart(h),this.ybase=Math.max(this.ybase-h,0),this.ydisp=Math.max(this.ydisp-h,0),this.savedY=Math.max(this.savedY-h,0)),this.lines.maxLength=g}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,i-1),b&&(this.y+=b),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=i-1,this._isReflowEnabled&&(this._reflow(t,i),this._cols>t))for(let b=0;b<this.lines.length;b++)u+=+this.lines.get(b).resize(t,c);this._cols=t,this._rows=i,this._memoryCleanupQueue.clear(),u>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let t=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,t=!1);let i=0;for(;this._memoryCleanupPosition<this.lines.length;)if(i+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),i>100)return!0;return t}get _isReflowEnabled(){let t=this._optionsService.rawOptions.windowsPty;return t&&t.buildNumber?this._hasScrollback&&t.backend==="conpty"&&t.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(t,i){this._cols!==t&&(t>this._cols?this._reflowLarger(t,i):this._reflowSmaller(t,i))}_reflowLarger(t,i){let c=(0,_.reflowLargerGetLinesToRemove)(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(l.DEFAULT_ATTR_DATA));if(c.length>0){let u=(0,_.reflowLargerCreateNewLayout)(this.lines,c);(0,_.reflowLargerApplyNewLayout)(this.lines,u.layout),this._reflowLargerAdjustViewport(t,i,u.countRemoved)}}_reflowLargerAdjustViewport(t,i,c){let u=this.getNullCell(l.DEFAULT_ATTR_DATA),g=c;for(;g-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<i&&this.lines.push(new l.BufferLine(t,u))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-c,0)}_reflowSmaller(t,i){let c=this.getNullCell(l.DEFAULT_ATTR_DATA),u=[],g=0;for(let b=this.lines.length-1;b>=0;b--){let h=this.lines.get(b);if(!h||!h.isWrapped&&h.getTrimmedLength()<=t)continue;let m=[h];for(;h.isWrapped&&b>0;)h=this.lines.get(--b),m.unshift(h);let E=this.ybase+this.y;if(E>=b&&E<b+m.length)continue;let R=m[m.length-1].getTrimmedLength(),x=(0,_.reflowSmallerGetNewLineLengths)(m,this._cols,t),B=x.length-m.length,P;P=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+B):Math.max(0,this.lines.length-this.lines.maxLength+B);let O=[];for(let A=0;A<B;A++){let N=this.getBlankLine(l.DEFAULT_ATTR_DATA,!0);O.push(N)}O.length>0&&(u.push({start:b+m.length+g,newLines:O}),g+=O.length),m.push(...O);let W=x.length-1,F=x[W];F===0&&(W--,F=x[W]);let C=m.length-B-1,L=R;for(;C>=0;){let A=Math.min(L,F);if(m[W]===void 0)break;if(m[W].copyCellsFrom(m[C],L-A,F-A,A,!0),F-=A,F===0&&(W--,F=x[W]),L-=A,L===0){C--;let N=Math.max(C,0);L=(0,_.getWrappedLineTrimmedLength)(m,N,this._cols)}}for(let A=0;A<m.length;A++)x[A]<t&&m[A].setCell(x[A],c);let D=B-P;for(;D-- >0;)this.ybase===0?this.y<i-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+g)-i&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+B,this.ybase+i-1)}if(u.length>0){let b=[],h=[];for(let W=0;W<this.lines.length;W++)h.push(this.lines.get(W));let m=this.lines.length,E=m-1,R=0,x=u[R];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+g);let B=0;for(let W=Math.min(this.lines.maxLength-1,m+g-1);W>=0;W--)if(x&&x.start>E+B){for(let F=x.newLines.length-1;F>=0;F--)this.lines.set(W--,x.newLines[F]);W++,b.push({index:E+1,amount:x.newLines.length}),B+=x.newLines.length,x=u[++R]}else this.lines.set(W,h[E--]);let P=0;for(let W=b.length-1;W>=0;W--)b[W].index+=P,this.lines.onInsertEmitter.fire(b[W]),P+=b[W].amount;let O=Math.max(0,m+g-this.lines.maxLength);O>0&&this.lines.onTrimEmitter.fire(O)}}translateBufferLineToString(t,i,c=0,u){let g=this.lines.get(t);return g?g.translateToString(i,c,u):""}getWrappedRangeForLine(t){let i=t,c=t;for(;i>0&&this.lines.get(i).isWrapped;)i--;for(;c+1<this.lines.length&&this.lines.get(c+1).isWrapped;)c++;return{first:i,last:c}}setupTabStops(t){for(t!=null?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.rawOptions.tabStopWidth)this.tabs[t]=!0}prevStop(t){for(t==null&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t}nextStop(t){for(t==null&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t}clearMarkers(t){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].line===t&&(this.markers[i].dispose(),this.markers.splice(i--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].dispose(),this.markers.splice(t--,1);this._isClearing=!1}addMarker(t){let i=new e.Marker(t);return this.markers.push(i),i.register(this.lines.onTrim(c=>{i.line-=c,i.line<0&&i.dispose()})),i.register(this.lines.onInsert(c=>{i.line>=c.index&&(i.line+=c.amount)})),i.register(this.lines.onDelete(c=>{i.line>=c.index&&i.line<c.index+c.amount&&i.dispose(),i.line>c.index&&(i.line-=c.amount)})),i.register(i.onDispose(()=>this._removeMarker(i))),i}_removeMarker(t){this._isClearing||this.markers.splice(this.markers.indexOf(t),1)}}},8437:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLine=r.DEFAULT_ATTR_DATA=void 0;let o=a(3734),d=a(511),n=a(643),l=a(482);r.DEFAULT_ATTR_DATA=Object.freeze(new o.AttributeData);let _=0;class p{constructor(e,s,t=!1){this.isWrapped=t,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);let i=s||d.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let c=0;c<e;++c)this.setCell(c,i);this.length=e}get(e){let s=this._data[3*e+0],t=2097151&s;return[this._data[3*e+1],2097152&s?this._combined[e]:t?(0,l.stringFromCodePoint)(t):"",s>>22,2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):t]}set(e,s){this._data[3*e+1]=s[n.CHAR_DATA_ATTR_INDEX],s[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=s[1],this._data[3*e+0]=2097152|e|s[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=s[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|s[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){let s=this._data[3*e+0];return 2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&s}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){let s=this._data[3*e+0];return 2097152&s?this._combined[e]:2097151&s?(0,l.stringFromCodePoint)(2097151&s):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,s){return _=3*e,s.content=this._data[_+0],s.fg=this._data[_+1],s.bg=this._data[_+2],2097152&s.content&&(s.combinedData=this._combined[e]),268435456&s.bg&&(s.extended=this._extendedAttrs[e]),s}setCell(e,s){2097152&s.content&&(this._combined[e]=s.combinedData),268435456&s.bg&&(this._extendedAttrs[e]=s.extended),this._data[3*e+0]=s.content,this._data[3*e+1]=s.fg,this._data[3*e+2]=s.bg}setCellFromCodePoint(e,s,t,i,c,u){268435456&c&&(this._extendedAttrs[e]=u),this._data[3*e+0]=s|t<<22,this._data[3*e+1]=i,this._data[3*e+2]=c}addCodepointToCell(e,s){let t=this._data[3*e+0];2097152&t?this._combined[e]+=(0,l.stringFromCodePoint)(s):(2097151&t?(this._combined[e]=(0,l.stringFromCodePoint)(2097151&t)+(0,l.stringFromCodePoint)(s),t&=-2097152,t|=2097152):t=s|4194304,this._data[3*e+0]=t)}insertCells(e,s,t,i){if((e%=this.length)&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),s<this.length-e){let c=new d.CellData;for(let u=this.length-e-s-1;u>=0;--u)this.setCell(e+s+u,this.loadCell(e+u,c));for(let u=0;u<s;++u)this.setCell(e+u,t)}else for(let c=e;c<this.length;++c)this.setCell(c,t);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs)}deleteCells(e,s,t,i){if(e%=this.length,s<this.length-e){let c=new d.CellData;for(let u=0;u<this.length-e-s;++u)this.setCell(e+u,this.loadCell(e+s+u,c));for(let u=this.length-s;u<this.length;++u)this.setCell(u,t)}else for(let c=e;c<this.length;++c)this.setCell(c,t);e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),this.getWidth(e)!==0||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs)}replaceCells(e,s,t,i,c=!1){if(c)for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs);e<s&&e<this.length;)this.isProtected(e)||this.setCell(e,t),e++;else for(e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new o.ExtendedAttrs);e<s&&e<this.length;)this.setCell(e++,t)}resize(e,s){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let t=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*t)this._data=new Uint32Array(this._data.buffer,0,t);else{let i=new Uint32Array(t);i.set(this._data),this._data=i}for(let i=this.length;i<e;++i)this.setCell(i,s)}else{this._data=this._data.subarray(0,t);let i=Object.keys(this._combined);for(let u=0;u<i.length;u++){let g=parseInt(i[u],10);g>=e&&delete this._combined[g]}let c=Object.keys(this._extendedAttrs);for(let u=0;u<c.length;u++){let g=parseInt(c[u],10);g>=e&&delete this._extendedAttrs[g]}}return this.length=e,4*t*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,s=!1){if(s)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(let s in e._combined)this._combined[s]=e._combined[s];this._extendedAttrs={};for(let s in e._extendedAttrs)this._extendedAttrs[s]=e._extendedAttrs[s];this.isWrapped=e.isWrapped}clone(){let e=new p(0);e._data=new Uint32Array(this._data),e.length=this.length;for(let s in this._combined)e._combined[s]=this._combined[s];for(let s in this._extendedAttrs)e._extendedAttrs[s]=this._extendedAttrs[s];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,s,t,i,c){let u=e._data;if(c)for(let b=i-1;b>=0;b--){for(let h=0;h<3;h++)this._data[3*(t+b)+h]=u[3*(s+b)+h];268435456&u[3*(s+b)+2]&&(this._extendedAttrs[t+b]=e._extendedAttrs[s+b])}else for(let b=0;b<i;b++){for(let h=0;h<3;h++)this._data[3*(t+b)+h]=u[3*(s+b)+h];268435456&u[3*(s+b)+2]&&(this._extendedAttrs[t+b]=e._extendedAttrs[s+b])}let g=Object.keys(e._combined);for(let b=0;b<g.length;b++){let h=parseInt(g[b],10);h>=s&&(this._combined[h-s+t]=e._combined[h])}}translateToString(e=!1,s=0,t=this.length){e&&(t=Math.min(t,this.getTrimmedLength()));let i="";for(;s<t;){let c=this._data[3*s+0],u=2097151&c;i+=2097152&c?this._combined[s]:u?(0,l.stringFromCodePoint)(u):n.WHITESPACE_CELL_CHAR,s+=c>>22||1}return i}}r.BufferLine=p},4841:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getRangeLength=void 0,r.getRangeLength=function(a,o){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return o*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(k,r)=>{function a(o,d,n){if(d===o.length-1)return o[d].getTrimmedLength();let l=!o[d].hasContent(n-1)&&o[d].getWidth(n-1)===1,_=o[d+1].getWidth(0)===2;return l&&_?n-1:n}Object.defineProperty(r,"__esModule",{value:!0}),r.getWrappedLineTrimmedLength=r.reflowSmallerGetNewLineLengths=r.reflowLargerApplyNewLayout=r.reflowLargerCreateNewLayout=r.reflowLargerGetLinesToRemove=void 0,r.reflowLargerGetLinesToRemove=function(o,d,n,l,_){let p=[];for(let f=0;f<o.length-1;f++){let e=f,s=o.get(++e);if(!s.isWrapped)continue;let t=[o.get(f)];for(;e<o.length&&s.isWrapped;)t.push(s),s=o.get(++e);if(l>=f&&l<e){f+=t.length-1;continue}let i=0,c=a(t,i,d),u=1,g=0;for(;u<t.length;){let h=a(t,u,d),m=h-g,E=n-c,R=Math.min(m,E);t[i].copyCellsFrom(t[u],g,c,R,!1),c+=R,c===n&&(i++,c=0),g+=R,g===h&&(u++,g=0),c===0&&i!==0&&t[i-1].getWidth(n-1)===2&&(t[i].copyCellsFrom(t[i-1],n-1,c++,1,!1),t[i-1].setCell(n-1,_))}t[i].replaceCells(c,n,_);let b=0;for(let h=t.length-1;h>0&&(h>i||t[h].getTrimmedLength()===0);h--)b++;b>0&&(p.push(f+t.length-b),p.push(b)),f+=t.length-1}return p},r.reflowLargerCreateNewLayout=function(o,d){let n=[],l=0,_=d[l],p=0;for(let f=0;f<o.length;f++)if(_===f){let e=d[++l];o.onDeleteEmitter.fire({index:f-p,amount:e}),f+=e-1,p+=e,_=d[++l]}else n.push(f);return{layout:n,countRemoved:p}},r.reflowLargerApplyNewLayout=function(o,d){let n=[];for(let l=0;l<d.length;l++)n.push(o.get(d[l]));for(let l=0;l<n.length;l++)o.set(l,n[l]);o.length=d.length},r.reflowSmallerGetNewLineLengths=function(o,d,n){let l=[],_=o.map((s,t)=>a(o,t,d)).reduce((s,t)=>s+t),p=0,f=0,e=0;for(;e<_;){if(_-e<n){l.push(_-e);break}p+=n;let s=a(o,f,d);p>s&&(p-=s,f++);let t=o[f].getWidth(p-1)===2;t&&p--;let i=t?n-1:n;l.push(i),e+=i}return l},r.getWrappedLineTrimmedLength=a},5295:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferSet=void 0;let o=a(8460),d=a(844),n=a(9092);class l extends d.Disposable{constructor(p,f){super(),this._optionsService=p,this._bufferService=f,this._onBufferActivate=this.register(new o.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(p){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(p),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(p,f){this._normal.resize(p,f),this._alt.resize(p,f),this.setupTabStops(p)}setupTabStops(p){this._normal.setupTabStops(p),this._alt.setupTabStops(p)}}r.BufferSet=l},511:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CellData=void 0;let o=a(482),d=a(643),n=a(3734);class l extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(p){let f=new l;return f.setFromCharData(p),f}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,o.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(p){this.fg=p[d.CHAR_DATA_ATTR_INDEX],this.bg=0;let f=!1;if(p[d.CHAR_DATA_CHAR_INDEX].length>2)f=!0;else if(p[d.CHAR_DATA_CHAR_INDEX].length===2){let e=p[d.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){let s=p[d.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(e-55296)+s-56320+65536|p[d.CHAR_DATA_WIDTH_INDEX]<<22:f=!0}else f=!0}else this.content=p[d.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|p[d.CHAR_DATA_WIDTH_INDEX]<<22;f&&(this.combinedData=p[d.CHAR_DATA_CHAR_INDEX],this.content=2097152|p[d.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.CellData=l},643:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WHITESPACE_CELL_CODE=r.WHITESPACE_CELL_WIDTH=r.WHITESPACE_CELL_CHAR=r.NULL_CELL_CODE=r.NULL_CELL_WIDTH=r.NULL_CELL_CHAR=r.CHAR_DATA_CODE_INDEX=r.CHAR_DATA_WIDTH_INDEX=r.CHAR_DATA_CHAR_INDEX=r.CHAR_DATA_ATTR_INDEX=r.DEFAULT_EXT=r.DEFAULT_ATTR=r.DEFAULT_COLOR=void 0,r.DEFAULT_COLOR=0,r.DEFAULT_ATTR=256|r.DEFAULT_COLOR<<9,r.DEFAULT_EXT=0,r.CHAR_DATA_ATTR_INDEX=0,r.CHAR_DATA_CHAR_INDEX=1,r.CHAR_DATA_WIDTH_INDEX=2,r.CHAR_DATA_CODE_INDEX=3,r.NULL_CELL_CHAR="",r.NULL_CELL_WIDTH=1,r.NULL_CELL_CODE=0,r.WHITESPACE_CELL_CHAR=" ",r.WHITESPACE_CELL_WIDTH=1,r.WHITESPACE_CELL_CODE=32},4863:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Marker=void 0;let o=a(8460),d=a(844);class n{get id(){return this._id}constructor(_){this.line=_,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new o.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,d.disposeArray)(this._disposables),this._disposables.length=0)}register(_){return this._disposables.push(_),_}}r.Marker=n,n._nextId=1},7116:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CHARSET=r.CHARSETS=void 0,r.CHARSETS={},r.DEFAULT_CHARSET=r.CHARSETS.B,r.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},r.CHARSETS.A={"#":"\xA3"},r.CHARSETS.B=void 0,r.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},r.CHARSETS.C=r.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},r.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},r.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},r.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},r.CHARSETS.E=r.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},r.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},r.CHARSETS.H=r.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(k,r)=>{var a,o,d;Object.defineProperty(r,"__esModule",{value:!0}),r.C1_ESCAPED=r.C1=r.C0=void 0,function(n){n.NUL="\0",n.SOH="",n.STX="",n.ETX="",n.EOT="",n.ENQ="",n.ACK="",n.BEL="\x07",n.BS="\b",n.HT="	",n.LF=`
`,n.VT="\v",n.FF="\f",n.CR="\r",n.SO="",n.SI="",n.DLE="",n.DC1="",n.DC2="",n.DC3="",n.DC4="",n.NAK="",n.SYN="",n.ETB="",n.CAN="",n.EM="",n.SUB="",n.ESC="\x1B",n.FS="",n.GS="",n.RS="",n.US="",n.SP=" ",n.DEL="\x7F"}(a||(r.C0=a={})),function(n){n.PAD="\x80",n.HOP="\x81",n.BPH="\x82",n.NBH="\x83",n.IND="\x84",n.NEL="\x85",n.SSA="\x86",n.ESA="\x87",n.HTS="\x88",n.HTJ="\x89",n.VTS="\x8A",n.PLD="\x8B",n.PLU="\x8C",n.RI="\x8D",n.SS2="\x8E",n.SS3="\x8F",n.DCS="\x90",n.PU1="\x91",n.PU2="\x92",n.STS="\x93",n.CCH="\x94",n.MW="\x95",n.SPA="\x96",n.EPA="\x97",n.SOS="\x98",n.SGCI="\x99",n.SCI="\x9A",n.CSI="\x9B",n.ST="\x9C",n.OSC="\x9D",n.PM="\x9E",n.APC="\x9F"}(o||(r.C1=o={})),function(n){n.ST=`${a.ESC}\\`}(d||(r.C1_ESCAPED=d={}))},7399:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.evaluateKeyboardEvent=void 0;let o=a(2584),d={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};r.evaluateKeyboardEvent=function(n,l,_,p){let f={type:0,cancel:!1,key:void 0},e=(n.shiftKey?1:0)|(n.altKey?2:0)|(n.ctrlKey?4:0)|(n.metaKey?8:0);switch(n.keyCode){case 0:n.key==="UIKeyInputUpArrow"?f.key=l?o.C0.ESC+"OA":o.C0.ESC+"[A":n.key==="UIKeyInputLeftArrow"?f.key=l?o.C0.ESC+"OD":o.C0.ESC+"[D":n.key==="UIKeyInputRightArrow"?f.key=l?o.C0.ESC+"OC":o.C0.ESC+"[C":n.key==="UIKeyInputDownArrow"&&(f.key=l?o.C0.ESC+"OB":o.C0.ESC+"[B");break;case 8:if(n.altKey){f.key=o.C0.ESC+o.C0.DEL;break}f.key=o.C0.DEL;break;case 9:if(n.shiftKey){f.key=o.C0.ESC+"[Z";break}f.key=o.C0.HT,f.cancel=!0;break;case 13:f.key=n.altKey?o.C0.ESC+o.C0.CR:o.C0.CR,f.cancel=!0;break;case 27:f.key=o.C0.ESC,n.altKey&&(f.key=o.C0.ESC+o.C0.ESC),f.cancel=!0;break;case 37:if(n.metaKey)break;e?(f.key=o.C0.ESC+"[1;"+(e+1)+"D",f.key===o.C0.ESC+"[1;3D"&&(f.key=o.C0.ESC+(_?"b":"[1;5D"))):f.key=l?o.C0.ESC+"OD":o.C0.ESC+"[D";break;case 39:if(n.metaKey)break;e?(f.key=o.C0.ESC+"[1;"+(e+1)+"C",f.key===o.C0.ESC+"[1;3C"&&(f.key=o.C0.ESC+(_?"f":"[1;5C"))):f.key=l?o.C0.ESC+"OC":o.C0.ESC+"[C";break;case 38:if(n.metaKey)break;e?(f.key=o.C0.ESC+"[1;"+(e+1)+"A",_||f.key!==o.C0.ESC+"[1;3A"||(f.key=o.C0.ESC+"[1;5A")):f.key=l?o.C0.ESC+"OA":o.C0.ESC+"[A";break;case 40:if(n.metaKey)break;e?(f.key=o.C0.ESC+"[1;"+(e+1)+"B",_||f.key!==o.C0.ESC+"[1;3B"||(f.key=o.C0.ESC+"[1;5B")):f.key=l?o.C0.ESC+"OB":o.C0.ESC+"[B";break;case 45:n.shiftKey||n.ctrlKey||(f.key=o.C0.ESC+"[2~");break;case 46:f.key=e?o.C0.ESC+"[3;"+(e+1)+"~":o.C0.ESC+"[3~";break;case 36:f.key=e?o.C0.ESC+"[1;"+(e+1)+"H":l?o.C0.ESC+"OH":o.C0.ESC+"[H";break;case 35:f.key=e?o.C0.ESC+"[1;"+(e+1)+"F":l?o.C0.ESC+"OF":o.C0.ESC+"[F";break;case 33:n.shiftKey?f.type=2:n.ctrlKey?f.key=o.C0.ESC+"[5;"+(e+1)+"~":f.key=o.C0.ESC+"[5~";break;case 34:n.shiftKey?f.type=3:n.ctrlKey?f.key=o.C0.ESC+"[6;"+(e+1)+"~":f.key=o.C0.ESC+"[6~";break;case 112:f.key=e?o.C0.ESC+"[1;"+(e+1)+"P":o.C0.ESC+"OP";break;case 113:f.key=e?o.C0.ESC+"[1;"+(e+1)+"Q":o.C0.ESC+"OQ";break;case 114:f.key=e?o.C0.ESC+"[1;"+(e+1)+"R":o.C0.ESC+"OR";break;case 115:f.key=e?o.C0.ESC+"[1;"+(e+1)+"S":o.C0.ESC+"OS";break;case 116:f.key=e?o.C0.ESC+"[15;"+(e+1)+"~":o.C0.ESC+"[15~";break;case 117:f.key=e?o.C0.ESC+"[17;"+(e+1)+"~":o.C0.ESC+"[17~";break;case 118:f.key=e?o.C0.ESC+"[18;"+(e+1)+"~":o.C0.ESC+"[18~";break;case 119:f.key=e?o.C0.ESC+"[19;"+(e+1)+"~":o.C0.ESC+"[19~";break;case 120:f.key=e?o.C0.ESC+"[20;"+(e+1)+"~":o.C0.ESC+"[20~";break;case 121:f.key=e?o.C0.ESC+"[21;"+(e+1)+"~":o.C0.ESC+"[21~";break;case 122:f.key=e?o.C0.ESC+"[23;"+(e+1)+"~":o.C0.ESC+"[23~";break;case 123:f.key=e?o.C0.ESC+"[24;"+(e+1)+"~":o.C0.ESC+"[24~";break;default:if(!n.ctrlKey||n.shiftKey||n.altKey||n.metaKey)if(_&&!p||!n.altKey||n.metaKey)!_||n.altKey||n.ctrlKey||n.shiftKey||!n.metaKey?n.key&&!n.ctrlKey&&!n.altKey&&!n.metaKey&&n.keyCode>=48&&n.key.length===1?f.key=n.key:n.key&&n.ctrlKey&&(n.key==="_"&&(f.key=o.C0.US),n.key==="@"&&(f.key=o.C0.NUL)):n.keyCode===65&&(f.type=1);else{let s=d[n.keyCode],t=s?.[n.shiftKey?1:0];if(t)f.key=o.C0.ESC+t;else if(n.keyCode>=65&&n.keyCode<=90){let i=n.ctrlKey?n.keyCode-64:n.keyCode+32,c=String.fromCharCode(i);n.shiftKey&&(c=c.toUpperCase()),f.key=o.C0.ESC+c}else if(n.keyCode===32)f.key=o.C0.ESC+(n.ctrlKey?o.C0.NUL:" ");else if(n.key==="Dead"&&n.code.startsWith("Key")){let i=n.code.slice(3,4);n.shiftKey||(i=i.toLowerCase()),f.key=o.C0.ESC+i,f.cancel=!0}}else n.keyCode>=65&&n.keyCode<=90?f.key=String.fromCharCode(n.keyCode-64):n.keyCode===32?f.key=o.C0.NUL:n.keyCode>=51&&n.keyCode<=55?f.key=String.fromCharCode(n.keyCode-51+27):n.keyCode===56?f.key=o.C0.DEL:n.keyCode===219?f.key=o.C0.ESC:n.keyCode===220?f.key=o.C0.FS:n.keyCode===221&&(f.key=o.C0.GS)}return f}},482:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Utf8ToUtf32=r.StringToUtf32=r.utf32ToString=r.stringFromCodePoint=void 0,r.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},r.utf32ToString=function(a,o=0,d=a.length){let n="";for(let l=o;l<d;++l){let _=a[l];_>65535?(_-=65536,n+=String.fromCharCode(55296+(_>>10))+String.fromCharCode(_%1024+56320)):n+=String.fromCharCode(_)}return n},r.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,o){let d=a.length;if(!d)return 0;let n=0,l=0;if(this._interim){let _=a.charCodeAt(l++);56320<=_&&_<=57343?o[n++]=1024*(this._interim-55296)+_-56320+65536:(o[n++]=this._interim,o[n++]=_),this._interim=0}for(let _=l;_<d;++_){let p=a.charCodeAt(_);if(55296<=p&&p<=56319){if(++_>=d)return this._interim=p,n;let f=a.charCodeAt(_);56320<=f&&f<=57343?o[n++]=1024*(p-55296)+f-56320+65536:(o[n++]=p,o[n++]=f)}else p!==65279&&(o[n++]=p)}return n}},r.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,o){let d=a.length;if(!d)return 0;let n,l,_,p,f=0,e=0,s=0;if(this.interim[0]){let c=!1,u=this.interim[0];u&=(224&u)==192?31:(240&u)==224?15:7;let g,b=0;for(;(g=63&this.interim[++b])&&b<4;)u<<=6,u|=g;let h=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,m=h-b;for(;s<m;){if(s>=d)return 0;if(g=a[s++],(192&g)!=128){s--,c=!0;break}this.interim[b++]=g,u<<=6,u|=63&g}c||(h===2?u<128?s--:o[f++]=u:h===3?u<2048||u>=55296&&u<=57343||u===65279||(o[f++]=u):u<65536||u>1114111||(o[f++]=u)),this.interim.fill(0)}let t=d-4,i=s;for(;i<d;){for(;!(!(i<t)||128&(n=a[i])||128&(l=a[i+1])||128&(_=a[i+2])||128&(p=a[i+3]));)o[f++]=n,o[f++]=l,o[f++]=_,o[f++]=p,i+=4;if(n=a[i++],n<128)o[f++]=n;else if((224&n)==192){if(i>=d)return this.interim[0]=n,f;if(l=a[i++],(192&l)!=128){i--;continue}if(e=(31&n)<<6|63&l,e<128){i--;continue}o[f++]=e}else if((240&n)==224){if(i>=d)return this.interim[0]=n,f;if(l=a[i++],(192&l)!=128){i--;continue}if(i>=d)return this.interim[0]=n,this.interim[1]=l,f;if(_=a[i++],(192&_)!=128){i--;continue}if(e=(15&n)<<12|(63&l)<<6|63&_,e<2048||e>=55296&&e<=57343||e===65279)continue;o[f++]=e}else if((248&n)==240){if(i>=d)return this.interim[0]=n,f;if(l=a[i++],(192&l)!=128){i--;continue}if(i>=d)return this.interim[0]=n,this.interim[1]=l,f;if(_=a[i++],(192&_)!=128){i--;continue}if(i>=d)return this.interim[0]=n,this.interim[1]=l,this.interim[2]=_,f;if(p=a[i++],(192&p)!=128){i--;continue}if(e=(7&n)<<18|(63&l)<<12|(63&_)<<6|63&p,e<65536||e>1114111)continue;o[f++]=e}}return f}}},225:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeV6=void 0;let a=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],o=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],d;r.UnicodeV6=class{constructor(){if(this.version="6",!d){d=new Uint8Array(65536),d.fill(1),d[0]=0,d.fill(0,1,32),d.fill(0,127,160),d.fill(2,4352,4448),d[9001]=2,d[9002]=2,d.fill(2,11904,42192),d[12351]=1,d.fill(2,44032,55204),d.fill(2,63744,64256),d.fill(2,65040,65050),d.fill(2,65072,65136),d.fill(2,65280,65377),d.fill(2,65504,65511);for(let n=0;n<a.length;++n)d.fill(0,a[n][0],a[n][1]+1)}}wcwidth(n){return n<32?0:n<127?1:n<65536?d[n]:function(l,_){let p,f=0,e=_.length-1;if(l<_[0][0]||l>_[e][1])return!1;for(;e>=f;)if(p=f+e>>1,l>_[p][1])f=p+1;else{if(!(l<_[p][0]))return!0;e=p-1}return!1}(n,o)?0:n>=131072&&n<=196605||n>=196608&&n<=262141?2:1}}},5981:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WriteBuffer=void 0;let o=a(8460),d=a(844);class n extends d.Disposable{constructor(_){super(),this._action=_,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new o.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(_,p){if(p!==void 0&&this._syncCalls>p)return void(this._syncCalls=0);if(this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let f;for(this._isSyncWriting=!0;f=this._writeBuffer.shift();){this._action(f);let e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(_,p){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(p),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(p)}_innerWrite(_=0,p=!0){let f=_||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let e=this._writeBuffer[this._bufferOffset],s=this._action(e,p);if(s){let i=c=>Date.now()-f>=12?setTimeout(()=>this._innerWrite(0,c)):this._innerWrite(f,c);return void s.catch(c=>(queueMicrotask(()=>{throw c}),Promise.resolve(!1))).then(i)}let t=this._callbacks[this._bufferOffset];if(t&&t(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-f>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}r.WriteBuffer=n},5941:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toRgbString=r.parseColor=void 0;let a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,o=/^[\da-f]+$/;function d(n,l){let _=n.toString(16),p=_.length<2?"0"+_:_;switch(l){case 4:return _[0];case 8:return p;case 12:return(p+p).slice(0,3);default:return p+p}}r.parseColor=function(n){if(!n)return;let l=n.toLowerCase();if(l.indexOf("rgb:")===0){l=l.slice(4);let _=a.exec(l);if(_){let p=_[1]?15:_[4]?255:_[7]?4095:65535;return[Math.round(parseInt(_[1]||_[4]||_[7]||_[10],16)/p*255),Math.round(parseInt(_[2]||_[5]||_[8]||_[11],16)/p*255),Math.round(parseInt(_[3]||_[6]||_[9]||_[12],16)/p*255)]}}else if(l.indexOf("#")===0&&(l=l.slice(1),o.exec(l)&&[3,6,9,12].includes(l.length))){let _=l.length/3,p=[0,0,0];for(let f=0;f<3;++f){let e=parseInt(l.slice(_*f,_*f+_),16);p[f]=_===1?e<<4:_===2?e:_===3?e>>4:e>>8}return p}},r.toRgbString=function(n,l=16){let[_,p,f]=n;return`rgb:${d(_,l)}/${d(p,l)}/${d(f,l)}`}},5770:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PAYLOAD_LIMIT=void 0,r.PAYLOAD_LIMIT=1e7},6351:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DcsHandler=r.DcsParser=void 0;let o=a(482),d=a(8742),n=a(5770),l=[];r.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=l,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=l}registerHandler(p,f){this._handlers[p]===void 0&&(this._handlers[p]=[]);let e=this._handlers[p];return e.push(f),{dispose:()=>{let s=e.indexOf(f);s!==-1&&e.splice(s,1)}}}clearHandler(p){this._handlers[p]&&delete this._handlers[p]}setHandlerFallback(p){this._handlerFb=p}reset(){if(this._active.length)for(let p=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;p>=0;--p)this._active[p].unhook(!1);this._stack.paused=!1,this._active=l,this._ident=0}hook(p,f){if(this.reset(),this._ident=p,this._active=this._handlers[p]||l,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(f);else this._handlerFb(this._ident,"HOOK",f)}put(p,f,e){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(p,f,e);else this._handlerFb(this._ident,"PUT",(0,o.utf32ToString)(p,f,e))}unhook(p,f=!0){if(this._active.length){let e=!1,s=this._active.length-1,t=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,e=f,t=this._stack.fallThrough,this._stack.paused=!1),!t&&e===!1){for(;s>=0&&(e=this._active[s].unhook(p),e!==!0);s--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,e;s--}for(;s>=0;s--)if(e=this._active[s].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,e}else this._handlerFb(this._ident,"UNHOOK",p);this._active=l,this._ident=0}};let _=new d.Params;_.addParam(0),r.DcsHandler=class{constructor(p){this._handler=p,this._data="",this._params=_,this._hitLimit=!1}hook(p){this._params=p.length>1||p.params[0]?p.clone():_,this._data="",this._hitLimit=!1}put(p,f,e){this._hitLimit||(this._data+=(0,o.utf32ToString)(p,f,e),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(p){let f=!1;if(this._hitLimit)f=!1;else if(p&&(f=this._handler(this._data,this._params),f instanceof Promise))return f.then(e=>(this._params=_,this._data="",this._hitLimit=!1,e));return this._params=_,this._data="",this._hitLimit=!1,f}}},2015:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EscapeSequenceParser=r.VT500_TRANSITION_TABLE=r.TransitionTable=void 0;let o=a(844),d=a(8742),n=a(6242),l=a(6351);class _{constructor(s){this.table=new Uint8Array(s)}setDefault(s,t){this.table.fill(s<<4|t)}add(s,t,i,c){this.table[t<<8|s]=i<<4|c}addMany(s,t,i,c){for(let u=0;u<s.length;u++)this.table[t<<8|s[u]]=i<<4|c}}r.TransitionTable=_;let p=160;r.VT500_TRANSITION_TABLE=function(){let e=new _(4095),s=Array.apply(null,Array(256)).map((b,h)=>h),t=(b,h)=>s.slice(b,h),i=t(32,127),c=t(0,24);c.push(25),c.push.apply(c,t(28,32));let u=t(0,14),g;for(g in e.setDefault(1,0),e.addMany(i,0,2,0),u)e.addMany([24,26,153,154],g,3,0),e.addMany(t(128,144),g,3,0),e.addMany(t(144,152),g,3,0),e.add(156,g,0,0),e.add(27,g,11,1),e.add(157,g,4,8),e.addMany([152,158,159],g,0,7),e.add(155,g,11,3),e.add(144,g,11,9);return e.addMany(c,0,3,0),e.addMany(c,1,3,1),e.add(127,1,0,1),e.addMany(c,8,0,8),e.addMany(c,3,3,3),e.add(127,3,0,3),e.addMany(c,4,3,4),e.add(127,4,0,4),e.addMany(c,6,3,6),e.addMany(c,5,3,5),e.add(127,5,0,5),e.addMany(c,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(t(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(c,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(t(64,127),3,7,0),e.addMany(t(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(t(48,60),4,8,4),e.addMany(t(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(t(32,64),6,0,6),e.add(127,6,0,6),e.addMany(t(64,127),6,0,0),e.addMany(t(32,48),3,9,5),e.addMany(t(32,48),5,9,5),e.addMany(t(48,64),5,0,6),e.addMany(t(64,127),5,7,0),e.addMany(t(32,48),4,9,5),e.addMany(t(32,48),1,9,2),e.addMany(t(32,48),2,9,2),e.addMany(t(48,127),2,10,0),e.addMany(t(48,80),1,10,0),e.addMany(t(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(t(96,127),1,10,0),e.add(80,1,11,9),e.addMany(c,9,0,9),e.add(127,9,0,9),e.addMany(t(28,32),9,0,9),e.addMany(t(32,48),9,9,12),e.addMany(t(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(c,11,0,11),e.addMany(t(32,128),11,0,11),e.addMany(t(28,32),11,0,11),e.addMany(c,10,0,10),e.add(127,10,0,10),e.addMany(t(28,32),10,0,10),e.addMany(t(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(t(32,48),10,9,12),e.addMany(c,12,0,12),e.add(127,12,0,12),e.addMany(t(28,32),12,0,12),e.addMany(t(32,48),12,9,12),e.addMany(t(48,64),12,0,11),e.addMany(t(64,127),12,12,13),e.addMany(t(64,127),10,12,13),e.addMany(t(64,127),9,12,13),e.addMany(c,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(p,0,2,0),e.add(p,8,5,8),e.add(p,6,0,6),e.add(p,11,0,11),e.add(p,13,13,13),e}();class f extends o.Disposable{constructor(s=r.VT500_TRANSITION_TABLE){super(),this._transitions=s,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new d.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(t,i,c)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,i)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,o.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new l.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(s,t=[64,126]){let i=0;if(s.prefix){if(s.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=s.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(s.intermediates){if(s.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let u=0;u<s.intermediates.length;++u){let g=s.intermediates.charCodeAt(u);if(32>g||g>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=g}}if(s.final.length!==1)throw new Error("final must be a single byte");let c=s.final.charCodeAt(0);if(t[0]>c||c>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=c,i}identToString(s){let t=[];for(;s;)t.push(String.fromCharCode(255&s)),s>>=8;return t.reverse().join("")}setPrintHandler(s){this._printHandler=s}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(s,t){let i=this._identifier(s,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);let c=this._escHandlers[i];return c.push(t),{dispose:()=>{let u=c.indexOf(t);u!==-1&&c.splice(u,1)}}}clearEscHandler(s){this._escHandlers[this._identifier(s,[48,126])]&&delete this._escHandlers[this._identifier(s,[48,126])]}setEscHandlerFallback(s){this._escHandlerFb=s}setExecuteHandler(s,t){this._executeHandlers[s.charCodeAt(0)]=t}clearExecuteHandler(s){this._executeHandlers[s.charCodeAt(0)]&&delete this._executeHandlers[s.charCodeAt(0)]}setExecuteHandlerFallback(s){this._executeHandlerFb=s}registerCsiHandler(s,t){let i=this._identifier(s);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);let c=this._csiHandlers[i];return c.push(t),{dispose:()=>{let u=c.indexOf(t);u!==-1&&c.splice(u,1)}}}clearCsiHandler(s){this._csiHandlers[this._identifier(s)]&&delete this._csiHandlers[this._identifier(s)]}setCsiHandlerFallback(s){this._csiHandlerFb=s}registerDcsHandler(s,t){return this._dcsParser.registerHandler(this._identifier(s),t)}clearDcsHandler(s){this._dcsParser.clearHandler(this._identifier(s))}setDcsHandlerFallback(s){this._dcsParser.setHandlerFallback(s)}registerOscHandler(s,t){return this._oscParser.registerHandler(s,t)}clearOscHandler(s){this._oscParser.clearHandler(s)}setOscHandlerFallback(s){this._oscParser.setHandlerFallback(s)}setErrorHandler(s){this._errorHandler=s}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(s,t,i,c,u){this._parseStack.state=s,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=c,this._parseStack.chunkPos=u}parse(s,t,i){let c,u=0,g=0,b=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,b=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let h=this._parseStack.handlers,m=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&m>-1){for(;m>=0&&(c=h[m](this._params),c!==!0);m--)if(c instanceof Promise)return this._parseStack.handlerPos=m,c}this._parseStack.handlers=[];break;case 4:if(i===!1&&m>-1){for(;m>=0&&(c=h[m](),c!==!0);m--)if(c instanceof Promise)return this._parseStack.handlerPos=m,c}this._parseStack.handlers=[];break;case 6:if(u=s[this._parseStack.chunkPos],c=this._dcsParser.unhook(u!==24&&u!==26,i),c)return c;u===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(u=s[this._parseStack.chunkPos],c=this._oscParser.end(u!==24&&u!==26,i),c)return c;u===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,b=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let h=b;h<t;++h){switch(u=s[h],g=this._transitions.table[this.currentState<<8|(u<160?u:p)],g>>4){case 2:for(let B=h+1;;++B){if(B>=t||(u=s[B])<32||u>126&&u<p){this._printHandler(s,h,B),h=B-1;break}if(++B>=t||(u=s[B])<32||u>126&&u<p){this._printHandler(s,h,B),h=B-1;break}if(++B>=t||(u=s[B])<32||u>126&&u<p){this._printHandler(s,h,B),h=B-1;break}if(++B>=t||(u=s[B])<32||u>126&&u<p){this._printHandler(s,h,B),h=B-1;break}}break;case 3:this._executeHandlers[u]?this._executeHandlers[u]():this._executeHandlerFb(u),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:h,code:u,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let m=this._csiHandlers[this._collect<<8|u],E=m?m.length-1:-1;for(;E>=0&&(c=m[E](this._params),c!==!0);E--)if(c instanceof Promise)return this._preserveStack(3,m,E,g,h),c;E<0&&this._csiHandlerFb(this._collect<<8|u,this._params),this.precedingCodepoint=0;break;case 8:do switch(u){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(u-48)}while(++h<t&&(u=s[h])>47&&u<60);h--;break;case 9:this._collect<<=8,this._collect|=u;break;case 10:let R=this._escHandlers[this._collect<<8|u],x=R?R.length-1:-1;for(;x>=0&&(c=R[x](),c!==!0);x--)if(c instanceof Promise)return this._preserveStack(4,R,x,g,h),c;x<0&&this._escHandlerFb(this._collect<<8|u),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|u,this._params);break;case 13:for(let B=h+1;;++B)if(B>=t||(u=s[B])===24||u===26||u===27||u>127&&u<p){this._dcsParser.put(s,h,B),h=B-1;break}break;case 14:if(c=this._dcsParser.unhook(u!==24&&u!==26),c)return this._preserveStack(6,[],0,g,h),c;u===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let B=h+1;;B++)if(B>=t||(u=s[B])<32||u>127&&u<p){this._oscParser.put(s,h,B),h=B-1;break}break;case 6:if(c=this._oscParser.end(u!==24&&u!==26),c)return this._preserveStack(5,[],0,g,h),c;u===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&g}}}r.EscapeSequenceParser=f},6242:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OscHandler=r.OscParser=void 0;let o=a(5770),d=a(482),n=[];r.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(l,_){this._handlers[l]===void 0&&(this._handlers[l]=[]);let p=this._handlers[l];return p.push(_),{dispose:()=>{let f=p.indexOf(_);f!==-1&&p.splice(f,1)}}}clearHandler(l){this._handlers[l]&&delete this._handlers[l]}setHandlerFallback(l){this._handlerFb=l}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(this._state===2)for(let l=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;l>=0;--l)this._active[l].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let l=this._active.length-1;l>=0;l--)this._active[l].start();else this._handlerFb(this._id,"START")}_put(l,_,p){if(this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].put(l,_,p);else this._handlerFb(this._id,"PUT",(0,d.utf32ToString)(l,_,p))}start(){this.reset(),this._state=1}put(l,_,p){if(this._state!==3){if(this._state===1)for(;_<p;){let f=l[_++];if(f===59){this._state=2,this._start();break}if(f<48||57<f)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+f-48}this._state===2&&p-_>0&&this._put(l,_,p)}}end(l,_=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let p=!1,f=this._active.length-1,e=!1;if(this._stack.paused&&(f=this._stack.loopPosition-1,p=_,e=this._stack.fallThrough,this._stack.paused=!1),!e&&p===!1){for(;f>=0&&(p=this._active[f].end(l),p!==!0);f--)if(p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!1,p;f--}for(;f>=0;f--)if(p=this._active[f].end(!1),p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!0,p}else this._handlerFb(this._id,"END",l);this._active=n,this._id=-1,this._state=0}}},r.OscHandler=class{constructor(l){this._handler=l,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(l,_,p){this._hitLimit||(this._data+=(0,d.utf32ToString)(l,_,p),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(l){let _=!1;if(this._hitLimit)_=!1;else if(l&&(_=this._handler(this._data),_ instanceof Promise))return _.then(p=>(this._data="",this._hitLimit=!1,p));return this._data="",this._hitLimit=!1,_}}},8742:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Params=void 0;let a=2147483647;class o{static fromArray(n){let l=new o;if(!n.length)return l;for(let _=Array.isArray(n[0])?1:0;_<n.length;++_){let p=n[_];if(Array.isArray(p))for(let f=0;f<p.length;++f)l.addSubParam(p[f]);else l.addParam(p)}return l}constructor(n=32,l=32){if(this.maxLength=n,this.maxSubParamsLength=l,l>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(n),this.length=0,this._subParams=new Int32Array(l),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(n),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let n=new o(this.maxLength,this.maxSubParamsLength);return n.params.set(this.params),n.length=this.length,n._subParams.set(this._subParams),n._subParamsLength=this._subParamsLength,n._subParamsIdx.set(this._subParamsIdx),n._rejectDigits=this._rejectDigits,n._rejectSubDigits=this._rejectSubDigits,n._digitIsSub=this._digitIsSub,n}toArray(){let n=[];for(let l=0;l<this.length;++l){n.push(this.params[l]);let _=this._subParamsIdx[l]>>8,p=255&this._subParamsIdx[l];p-_>0&&n.push(Array.prototype.slice.call(this._subParams,_,p))}return n}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(n){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=n>a?a:n}}addSubParam(n){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=n>a?a:n,this._subParamsIdx[this.length-1]++}}hasSubParams(n){return(255&this._subParamsIdx[n])-(this._subParamsIdx[n]>>8)>0}getSubParams(n){let l=this._subParamsIdx[n]>>8,_=255&this._subParamsIdx[n];return _-l>0?this._subParams.subarray(l,_):null}getSubParamsAll(){let n={};for(let l=0;l<this.length;++l){let _=this._subParamsIdx[l]>>8,p=255&this._subParamsIdx[l];p-_>0&&(n[l]=this._subParams.slice(_,p))}return n}addDigit(n){let l;if(this._rejectDigits||!(l=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let _=this._digitIsSub?this._subParams:this.params,p=_[l-1];_[l-1]=~p?Math.min(10*p+n,a):n}}r.Params=o},5741:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AddonManager=void 0,r.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,o){let d={instance:o,dispose:o.dispose,isDisposed:!1};this._addons.push(d),o.dispose=()=>this._wrappedAddonDispose(d),o.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let o=-1;for(let d=0;d<this._addons.length;d++)if(this._addons[d]===a){o=d;break}if(o===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(o,1)}}},8771:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferApiView=void 0;let o=a(3785),d=a(511);r.BufferApiView=class{constructor(n,l){this._buffer=n,this.type=l}init(n){return this._buffer=n,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(n){let l=this._buffer.lines.get(n);if(l)return new o.BufferLineApiView(l)}getNullCell(){return new d.CellData}}},3785:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLineApiView=void 0;let o=a(511);r.BufferLineApiView=class{constructor(d){this._line=d}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(d,n){if(!(d<0||d>=this._line.length))return n?(this._line.loadCell(d,n),n):this._line.loadCell(d,new o.CellData)}translateToString(d,n,l){return this._line.translateToString(d,n,l)}}},8285:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferNamespaceApi=void 0;let o=a(8771),d=a(8460),n=a(844);class l extends n.Disposable{constructor(p){super(),this._core=p,this._onBufferChange=this.register(new d.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new o.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new o.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}r.BufferNamespaceApi=l},7975:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ParserApi=void 0,r.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,o){return this._core.registerCsiHandler(a,d=>o(d.toArray()))}addCsiHandler(a,o){return this.registerCsiHandler(a,o)}registerDcsHandler(a,o){return this._core.registerDcsHandler(a,(d,n)=>o(d,n.toArray()))}addDcsHandler(a,o){return this.registerDcsHandler(a,o)}registerEscHandler(a,o){return this._core.registerEscHandler(a,o)}addEscHandler(a,o){return this.registerEscHandler(a,o)}registerOscHandler(a,o){return this._core.registerOscHandler(a,o)}addOscHandler(a,o){return this.registerOscHandler(a,o)}}},7090:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeApi=void 0,r.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(k,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,u=arguments.length,g=u<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,t,i);else for(var b=e.length-1;b>=0;b--)(c=e[b])&&(g=(u<3?c(g):u>3?c(s,t,g):c(s,t))||g);return u>3&&g&&Object.defineProperty(s,t,g),g},d=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferService=r.MINIMUM_ROWS=r.MINIMUM_COLS=void 0;let n=a(8460),l=a(844),_=a(5295),p=a(2585);r.MINIMUM_COLS=2,r.MINIMUM_ROWS=1;let f=r.BufferService=class extends l.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,r.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,r.MINIMUM_ROWS),this.buffers=this.register(new _.BufferSet(e,this))}resize(e,s){this.cols=e,this.rows=s,this.buffers.resize(e,s),this._onResize.fire({cols:e,rows:s})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,s=!1){let t=this.buffer,i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=t.getBlankLine(e,s),this._cachedBlankLine=i),i.isWrapped=s;let c=t.ybase+t.scrollTop,u=t.ybase+t.scrollBottom;if(t.scrollTop===0){let g=t.lines.isFull;u===t.lines.length-1?g?t.lines.recycle().copyFrom(i):t.lines.push(i.clone()):t.lines.splice(u+1,0,i.clone()),g?this.isUserScrolling&&(t.ydisp=Math.max(t.ydisp-1,0)):(t.ybase++,this.isUserScrolling||t.ydisp++)}else{let g=u-c+1;t.lines.shiftElements(c+1,g-1,-1),t.lines.set(u,i.clone())}this.isUserScrolling||(t.ydisp=t.ybase),this._onScroll.fire(t.ydisp)}scrollLines(e,s,t){let i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);let c=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),c!==i.ydisp&&(s||this._onScroll.fire(i.ydisp))}};r.BufferService=f=o([d(0,p.IOptionsService)],f)},7994:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharsetService=void 0,r.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,o){this._charsets[a]=o,this.glevel===a&&(this.charset=o)}}},1753:function(k,r,a){var o=this&&this.__decorate||function(i,c,u,g){var b,h=arguments.length,m=h<3?c:g===null?g=Object.getOwnPropertyDescriptor(c,u):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(i,c,u,g);else for(var E=i.length-1;E>=0;E--)(b=i[E])&&(m=(h<3?b(m):h>3?b(c,u,m):b(c,u))||m);return h>3&&m&&Object.defineProperty(c,u,m),m},d=this&&this.__param||function(i,c){return function(u,g){c(u,g,i)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreMouseService=void 0;let n=a(2585),l=a(8460),_=a(844),p={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:i=>i.button!==4&&i.action===1&&(i.ctrl=!1,i.alt=!1,i.shift=!1,!0)},VT200:{events:19,restrict:i=>i.action!==32},DRAG:{events:23,restrict:i=>i.action!==32||i.button!==3},ANY:{events:31,restrict:i=>!0}};function f(i,c){let u=(i.ctrl?16:0)|(i.shift?4:0)|(i.alt?8:0);return i.button===4?(u|=64,u|=i.action):(u|=3&i.button,4&i.button&&(u|=64),8&i.button&&(u|=128),i.action===32?u|=32:i.action!==0||c||(u|=3)),u}let e=String.fromCharCode,s={DEFAULT:i=>{let c=[f(i,!1)+32,i.col+32,i.row+32];return c[0]>255||c[1]>255||c[2]>255?"":`\x1B[M${e(c[0])}${e(c[1])}${e(c[2])}`},SGR:i=>{let c=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${f(i,!0)};${i.col};${i.row}${c}`},SGR_PIXELS:i=>{let c=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${f(i,!0)};${i.x};${i.y}${c}`}},t=r.CoreMouseService=class extends _.Disposable{constructor(i,c){super(),this._bufferService=i,this._coreService=c,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new l.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let u of Object.keys(p))this.addProtocol(u,p[u]);for(let u of Object.keys(s))this.addEncoding(u,s[u]);this.reset()}addProtocol(i,c){this._protocols[i]=c}addEncoding(i,c){this._encodings[i]=c}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(i){if(!this._protocols[i])throw new Error(`unknown protocol "${i}"`);this._activeProtocol=i,this._onProtocolChange.fire(this._protocols[i].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(i){if(!this._encodings[i])throw new Error(`unknown encoding "${i}"`);this._activeEncoding=i}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(i){if(i.col<0||i.col>=this._bufferService.cols||i.row<0||i.row>=this._bufferService.rows||i.button===4&&i.action===32||i.button===3&&i.action!==32||i.button!==4&&(i.action===2||i.action===3)||(i.col++,i.row++,i.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,i,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(i))return!1;let c=this._encodings[this._activeEncoding](i);return c&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(c):this._coreService.triggerDataEvent(c,!0)),this._lastEvent=i,!0}explainEvents(i){return{down:!!(1&i),up:!!(2&i),drag:!!(4&i),move:!!(8&i),wheel:!!(16&i)}}_equalEvents(i,c,u){if(u){if(i.x!==c.x||i.y!==c.y)return!1}else if(i.col!==c.col||i.row!==c.row)return!1;return i.button===c.button&&i.action===c.action&&i.ctrl===c.ctrl&&i.alt===c.alt&&i.shift===c.shift}};r.CoreMouseService=t=o([d(0,n.IBufferService),d(1,n.ICoreService)],t)},6975:function(k,r,a){var o=this&&this.__decorate||function(t,i,c,u){var g,b=arguments.length,h=b<3?i:u===null?u=Object.getOwnPropertyDescriptor(i,c):u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(t,i,c,u);else for(var m=t.length-1;m>=0;m--)(g=t[m])&&(h=(b<3?g(h):b>3?g(i,c,h):g(i,c))||h);return b>3&&h&&Object.defineProperty(i,c,h),h},d=this&&this.__param||function(t,i){return function(c,u){i(c,u,t)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreService=void 0;let n=a(1439),l=a(8460),_=a(844),p=a(2585),f=Object.freeze({insertMode:!1}),e=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),s=r.CoreService=class extends _.Disposable{constructor(t,i,c){super(),this._bufferService=t,this._logService=i,this._optionsService=c,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new l.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new l.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new l.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new l.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(f),this.decPrivateModes=(0,n.clone)(e)}reset(){this.modes=(0,n.clone)(f),this.decPrivateModes=(0,n.clone)(e)}triggerDataEvent(t,i=!1){if(this._optionsService.rawOptions.disableStdin)return;let c=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&c.ybase!==c.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${t}"`,()=>t.split("").map(u=>u.charCodeAt(0))),this._onData.fire(t)}triggerBinaryEvent(t){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${t}"`,()=>t.split("").map(i=>i.charCodeAt(0))),this._onBinary.fire(t))}};r.CoreService=s=o([d(0,p.IBufferService),d(1,p.ILogService),d(2,p.IOptionsService)],s)},9074:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DecorationService=void 0;let o=a(8055),d=a(8460),n=a(844),l=a(6106),_=0,p=0;class f extends n.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new l.SortedList(t=>t?.marker.line),this._onDecorationRegistered=this.register(new d.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new d.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,n.toDisposable)(()=>this.reset()))}registerDecoration(t){if(t.marker.isDisposed)return;let i=new e(t);if(i){let c=i.marker.onDispose(()=>i.dispose());i.onDispose(()=>{i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),c.dispose())}),this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(let t of this._decorations.values())t.dispose();this._decorations.clear()}*getDecorationsAtCell(t,i,c){var u,g,b;let h=0,m=0;for(let E of this._decorations.getKeyIterator(i))h=(u=E.options.x)!==null&&u!==void 0?u:0,m=h+((g=E.options.width)!==null&&g!==void 0?g:1),t>=h&&t<m&&(!c||((b=E.options.layer)!==null&&b!==void 0?b:"bottom")===c)&&(yield E)}forEachDecorationAtCell(t,i,c,u){this._decorations.forEachByKey(i,g=>{var b,h,m;_=(b=g.options.x)!==null&&b!==void 0?b:0,p=_+((h=g.options.width)!==null&&h!==void 0?h:1),t>=_&&t<p&&(!c||((m=g.options.layer)!==null&&m!==void 0?m:"bottom")===c)&&u(g)})}}r.DecorationService=f;class e extends n.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=o.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=o.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(t){super(),this.options=t,this.onRenderEmitter=this.register(new d.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new d.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=t.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.InstantiationService=r.ServiceCollection=void 0;let o=a(2585),d=a(8343);class n{constructor(..._){this._entries=new Map;for(let[p,f]of _)this.set(p,f)}set(_,p){let f=this._entries.get(_);return this._entries.set(_,p),f}forEach(_){for(let[p,f]of this._entries.entries())_(p,f)}has(_){return this._entries.has(_)}get(_){return this._entries.get(_)}}r.ServiceCollection=n,r.InstantiationService=class{constructor(){this._services=new n,this._services.set(o.IInstantiationService,this)}setService(l,_){this._services.set(l,_)}getService(l){return this._services.get(l)}createInstance(l,..._){let p=(0,d.getServiceDependencies)(l).sort((s,t)=>s.index-t.index),f=[];for(let s of p){let t=this._services.get(s.id);if(!t)throw new Error(`[createInstance] ${l.name} depends on UNKNOWN service ${s.id}.`);f.push(t)}let e=p.length>0?p[0].index:_.length;if(_.length!==e)throw new Error(`[createInstance] First service dependency of ${l.name} at position ${e+1} conflicts with ${_.length} static arguments`);return new l(..._,...f)}}},7866:function(k,r,a){var o=this&&this.__decorate||function(e,s,t,i){var c,u=arguments.length,g=u<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,t,i);else for(var b=e.length-1;b>=0;b--)(c=e[b])&&(g=(u<3?c(g):u>3?c(s,t,g):c(s,t))||g);return u>3&&g&&Object.defineProperty(s,t,g),g},d=this&&this.__param||function(e,s){return function(t,i){s(t,i,e)}};Object.defineProperty(r,"__esModule",{value:!0}),r.traceCall=r.setTraceLogger=r.LogService=void 0;let n=a(844),l=a(2585),_={trace:l.LogLevelEnum.TRACE,debug:l.LogLevelEnum.DEBUG,info:l.LogLevelEnum.INFO,warn:l.LogLevelEnum.WARN,error:l.LogLevelEnum.ERROR,off:l.LogLevelEnum.OFF},p,f=r.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=l.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),p=this}_updateLogLevel(){this._logLevel=_[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let s=0;s<e.length;s++)typeof e[s]=="function"&&(e[s]=e[s]())}_log(e,s,t){this._evalLazyOptionalParams(t),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+s,...t)}trace(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.TRACE&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.trace.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,s)}debug(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.DEBUG&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.debug.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,s)}info(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.INFO&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.info.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.info,e,s)}warn(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.WARN&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.warn.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.warn,e,s)}error(e,...s){var t,i;this._logLevel<=l.LogLevelEnum.ERROR&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.error.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.error,e,s)}};r.LogService=f=o([d(0,l.IOptionsService)],f),r.setTraceLogger=function(e){p=e},r.traceCall=function(e,s,t){if(typeof t.value!="function")throw new Error("not supported");let i=t.value;t.value=function(...c){if(p.logLevel!==l.LogLevelEnum.TRACE)return i.apply(this,c);p.trace(`GlyphRenderer#${i.name}(${c.map(g=>JSON.stringify(g)).join(", ")})`);let u=i.apply(this,c);return p.trace(`GlyphRenderer#${i.name} return`,u),u}}},7302:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OptionsService=r.DEFAULT_OPTIONS=void 0;let o=a(8460),d=a(844),n=a(6114);r.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let l=["normal","bold","100","200","300","400","500","600","700","800","900"];class _ extends d.Disposable{constructor(f){super(),this._onOptionChange=this.register(new o.EventEmitter),this.onOptionChange=this._onOptionChange.event;let e=Object.assign({},r.DEFAULT_OPTIONS);for(let s in f)if(s in e)try{let t=f[s];e[s]=this._sanitizeAndValidateOption(s,t)}catch(t){console.error(t)}this.rawOptions=e,this.options=Object.assign({},e),this._setupOptions()}onSpecificOptionChange(f,e){return this.onOptionChange(s=>{s===f&&e(this.rawOptions[f])})}onMultipleOptionChange(f,e){return this.onOptionChange(s=>{f.indexOf(s)!==-1&&e()})}_setupOptions(){let f=s=>{if(!(s in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},e=(s,t)=>{if(!(s in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);t=this._sanitizeAndValidateOption(s,t),this.rawOptions[s]!==t&&(this.rawOptions[s]=t,this._onOptionChange.fire(s))};for(let s in this.rawOptions){let t={get:f.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this.options,s,t)}}_sanitizeAndValidateOption(f,e){switch(f){case"cursorStyle":if(e||(e=r.DEFAULT_OPTIONS[f]),!function(s){return s==="block"||s==="underline"||s==="bar"}(e))throw new Error(`"${e}" is not a valid value for ${f}`);break;case"wordSeparator":e||(e=r.DEFAULT_OPTIONS[f]);break;case"fontWeight":case"fontWeightBold":if(typeof e=="number"&&1<=e&&e<=1e3)break;e=l.includes(e)?e:r.DEFAULT_OPTIONS[f];break;case"cursorWidth":e=Math.floor(e);case"lineHeight":case"tabStopWidth":if(e<1)throw new Error(`${f} cannot be less than 1, value: ${e}`);break;case"minimumContrastRatio":e=Math.max(1,Math.min(21,Math.round(10*e)/10));break;case"scrollback":if((e=Math.min(e,4294967295))<0)throw new Error(`${f} cannot be less than 0, value: ${e}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(e<=0)throw new Error(`${f} cannot be less than or equal to 0, value: ${e}`);break;case"rows":case"cols":if(!e&&e!==0)throw new Error(`${f} must be numeric, value: ${e}`);break;case"windowsPty":e=e??{}}return e}}r.OptionsService=_},2660:function(k,r,a){var o=this&&this.__decorate||function(_,p,f,e){var s,t=arguments.length,i=t<3?p:e===null?e=Object.getOwnPropertyDescriptor(p,f):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(_,p,f,e);else for(var c=_.length-1;c>=0;c--)(s=_[c])&&(i=(t<3?s(i):t>3?s(p,f,i):s(p,f))||i);return t>3&&i&&Object.defineProperty(p,f,i),i},d=this&&this.__param||function(_,p){return function(f,e){p(f,e,_)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkService=void 0;let n=a(2585),l=r.OscLinkService=class{constructor(_){this._bufferService=_,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(_){let p=this._bufferService.buffer;if(_.id===void 0){let c=p.addMarker(p.ybase+p.y),u={data:_,id:this._nextId++,lines:[c]};return c.onDispose(()=>this._removeMarkerFromLink(u,c)),this._dataByLinkId.set(u.id,u),u.id}let f=_,e=this._getEntryIdKey(f),s=this._entriesWithId.get(e);if(s)return this.addLineToLink(s.id,p.ybase+p.y),s.id;let t=p.addMarker(p.ybase+p.y),i={id:this._nextId++,key:this._getEntryIdKey(f),data:f,lines:[t]};return t.onDispose(()=>this._removeMarkerFromLink(i,t)),this._entriesWithId.set(i.key,i),this._dataByLinkId.set(i.id,i),i.id}addLineToLink(_,p){let f=this._dataByLinkId.get(_);if(f&&f.lines.every(e=>e.line!==p)){let e=this._bufferService.buffer.addMarker(p);f.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(f,e))}}getLinkData(_){var p;return(p=this._dataByLinkId.get(_))===null||p===void 0?void 0:p.data}_getEntryIdKey(_){return`${_.id};;${_.uri}`}_removeMarkerFromLink(_,p){let f=_.lines.indexOf(p);f!==-1&&(_.lines.splice(f,1),_.lines.length===0&&(_.data.id!==void 0&&this._entriesWithId.delete(_.key),this._dataByLinkId.delete(_.id)))}};r.OscLinkService=l=o([d(0,n.IBufferService)],l)},8343:(k,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;let a="di$target",o="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(d){return d[o]||[]},r.createDecorator=function(d){if(r.serviceRegistry.has(d))return r.serviceRegistry.get(d);let n=function(l,_,p){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(f,e,s){e[a]===e?e[o].push({id:f,index:s}):(e[o]=[{id:f,index:s}],e[a]=e)})(n,l,p)};return n.toString=()=>d,r.serviceRegistry.set(d,n),n}},2585:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;let o=a(8343);var d;r.IBufferService=(0,o.createDecorator)("BufferService"),r.ICoreMouseService=(0,o.createDecorator)("CoreMouseService"),r.ICoreService=(0,o.createDecorator)("CoreService"),r.ICharsetService=(0,o.createDecorator)("CharsetService"),r.IInstantiationService=(0,o.createDecorator)("InstantiationService"),function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.OFF=5]="OFF"}(d||(r.LogLevelEnum=d={})),r.ILogService=(0,o.createDecorator)("LogService"),r.IOptionsService=(0,o.createDecorator)("OptionsService"),r.IOscLinkService=(0,o.createDecorator)("OscLinkService"),r.IUnicodeService=(0,o.createDecorator)("UnicodeService"),r.IDecorationService=(0,o.createDecorator)("DecorationService")},1480:(k,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeService=void 0;let o=a(8460),d=a(225);r.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new o.EventEmitter,this.onChange=this._onChange.event;let n=new d.UnicodeV6;this.register(n),this._active=n.version,this._activeProvider=n}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(n){if(!this._providers[n])throw new Error(`unknown Unicode version "${n}"`);this._active=n,this._activeProvider=this._providers[n],this._onChange.fire(n)}register(n){this._providers[n.version]=n}wcwidth(n){return this._activeProvider.wcwidth(n)}getStringCellWidth(n){let l=0,_=n.length;for(let p=0;p<_;++p){let f=n.charCodeAt(p);if(55296<=f&&f<=56319){if(++p>=_)return l+this.wcwidth(f);let e=n.charCodeAt(p);56320<=e&&e<=57343?f=1024*(f-55296)+e-56320+65536:l+=this.wcwidth(e)}l+=this.wcwidth(f)}return l}}}},S={};function y(k){var r=S[k];if(r!==void 0)return r.exports;var a=S[k]={exports:{}};return v[k].call(a.exports,a,a.exports,y),a.exports}var T={};return(()=>{var k=T;Object.defineProperty(k,"__esModule",{value:!0}),k.Terminal=void 0;let r=y(9042),a=y(3236),o=y(844),d=y(5741),n=y(8285),l=y(7975),_=y(7090),p=["cols","rows"];class f extends o.Disposable{constructor(s){super(),this._core=this.register(new a.Terminal(s)),this._addonManager=this.register(new d.AddonManager),this._publicOptions=Object.assign({},this._core.options);let t=c=>this._core.options[c],i=(c,u)=>{this._checkReadonlyOptions(c),this._core.options[c]=u};for(let c in this._core.options){let u={get:t.bind(this,c),set:i.bind(this,c)};Object.defineProperty(this._publicOptions,c,u)}}_checkReadonlyOptions(s){if(p.includes(s))throw new Error(`Option "${s}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new _.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new n.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let s=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:s.applicationCursorKeys,applicationKeypadMode:s.applicationKeypad,bracketedPasteMode:s.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:s.origin,reverseWraparoundMode:s.reverseWraparound,sendFocusMode:s.sendFocus,wraparoundMode:s.wraparound}}get options(){return this._publicOptions}set options(s){for(let t in s)this._publicOptions[t]=s[t]}blur(){this._core.blur()}focus(){this._core.focus()}resize(s,t){this._verifyIntegers(s,t),this._core.resize(s,t)}open(s){this._core.open(s)}attachCustomKeyEventHandler(s){this._core.attachCustomKeyEventHandler(s)}registerLinkProvider(s){return this._core.registerLinkProvider(s)}registerCharacterJoiner(s){return this._checkProposedApi(),this._core.registerCharacterJoiner(s)}deregisterCharacterJoiner(s){this._checkProposedApi(),this._core.deregisterCharacterJoiner(s)}registerMarker(s=0){return this._verifyIntegers(s),this._core.registerMarker(s)}registerDecoration(s){var t,i,c;return this._checkProposedApi(),this._verifyPositiveIntegers((t=s.x)!==null&&t!==void 0?t:0,(i=s.width)!==null&&i!==void 0?i:0,(c=s.height)!==null&&c!==void 0?c:0),this._core.registerDecoration(s)}hasSelection(){return this._core.hasSelection()}select(s,t,i){this._verifyIntegers(s,t,i),this._core.select(s,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(s,t){this._verifyIntegers(s,t),this._core.selectLines(s,t)}dispose(){super.dispose()}scrollLines(s){this._verifyIntegers(s),this._core.scrollLines(s)}scrollPages(s){this._verifyIntegers(s),this._core.scrollPages(s)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(s){this._verifyIntegers(s),this._core.scrollToLine(s)}clear(){this._core.clear()}write(s,t){this._core.write(s,t)}writeln(s,t){this._core.write(s),this._core.write(`\r
`,t)}paste(s){this._core.paste(s)}refresh(s,t){this._verifyIntegers(s,t),this._core.refresh(s,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(s){this._addonManager.loadAddon(this,s)}static get strings(){return r}_verifyIntegers(...s){for(let t of s)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...s){for(let t of s)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}k.Terminal=f})(),T})())});var ti=Xt((Je,xt)=>{(function(v,S){typeof Je=="object"&&typeof xt=="object"?xt.exports=S():typeof define=="function"&&define.amd?define([],S):typeof Je=="object"?Je.FitAddon=S():v.FitAddon=S()})(self,()=>(()=>{"use strict";var v={};return(()=>{var S=v;Object.defineProperty(S,"__esModule",{value:!0}),S.FitAddon=void 0,S.FitAddon=class{activate(y){this._terminal=y}dispose(){}fit(){let y=this.proposeDimensions();if(!y||!this._terminal||isNaN(y.cols)||isNaN(y.rows))return;let T=this._terminal._core;this._terminal.rows===y.rows&&this._terminal.cols===y.cols||(T._renderService.clear(),this._terminal.resize(y.cols,y.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let y=this._terminal._core,T=y._renderService.dimensions;if(T.css.cell.width===0||T.css.cell.height===0)return;let k=this._terminal.options.scrollback===0?0:y.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(r.getPropertyValue("height")),o=Math.max(0,parseInt(r.getPropertyValue("width"))),d=window.getComputedStyle(this._terminal.element),n=a-(parseInt(d.getPropertyValue("padding-top"))+parseInt(d.getPropertyValue("padding-bottom"))),l=o-(parseInt(d.getPropertyValue("padding-right"))+parseInt(d.getPropertyValue("padding-left")))-k;return{cols:Math.max(2,Math.floor(l/T.css.cell.width)),rows:Math.max(1,Math.floor(n/T.css.cell.height))}}}})(),v})())});function Yt(v){return v.replace(/\x1b\[[0-9;]*[a-zA-Z]/g,"")}function Me(){return new URLSearchParams(window.location.search).get("session")}function Pe(){return new URLSearchParams(window.location.search).get("project")}function Ge(v,S=null){let y=new URL(window.location.href);y.searchParams.set("session",v),S&&y.searchParams.set("project",S),window.history.pushState({sessionId:v},"",y)}function Et(){let v=new URL(window.location.href);v.searchParams.delete("session"),v.searchParams.delete("project"),window.history.pushState({},"",v)}function Zt(){Et()}var $={sessionID:null,currentProject:null,isFileBrowserOpen:!1,isFileEditorOpen:!1,currentEditingFile:null,currentBrowserPath:null,isConnected:!1};var ii=Jt(ei()),si=Jt(ti());var X=null,ge=null,J=null,Ie=0,es=10,ts=1e3;function ri(){J&&(J.onopen=null,J.onmessage=null,J.onclose=null,J.onerror=null,(J.readyState===WebSocket.OPEN||J.readyState===WebSocket.CONNECTING)&&J.close(),J=null),$.isConnected=!1,Ie=0}function de(){ri(),X&&(X.dispose(),X=null),ge=null}function Ye(){ri();let S=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`,y=new URLSearchParams;$.sessionID&&y.append("sessionID",$.sessionID),$.currentProject&&y.append("projectName",$.currentProject),y.toString()&&(S+=`?${y.toString()}`),J=new WebSocket(S),J.onopen=()=>{$.isConnected=!0,Ie=0,X&&$.sessionID&&(X.clearTextureAtlas?.(),X.refresh(0,(X.rows||1)-1)),X&&J&&J.send(JSON.stringify({type:"resize",cols:X.cols,rows:X.rows}))},J.onmessage=T=>{try{let k=JSON.parse(T.data);switch(k.type){case"output":X?.write(k.data);break;case"sessionID":$.sessionID=k.sessionID,Ge(k.sessionID,$.currentProject);break;case"exit":X?.write(`\r
Process exited with code: ${k.exitCode}\r
`),X?.write(`Connection closed. Go back to session list.\r
`),$.isConnected=!1;break;default:break}}catch(k){console.error("Error parsing message:",k)}},J.onclose=()=>{if($.isConnected=!1,Ie<es){let T=ts*Math.pow(2,Ie);Ie++,X?.write(`\r
Connection lost. Attempting to reconnect...\r
`),setTimeout(Ye,T)}else X?.write(`\r
Connection lost. Max reconnect attempts reached. Go back to session list.\r
`)},J.onerror=()=>{X?.write(`\r
WebSocket error occurred. Attempting to reconnect.\r
`),J?.close()}}function ue(){let v=document.getElementById("terminal-container");if(!v)return;v.innerHTML=`
    <div class="flex flex-col h-full">
      <div id="terminal" class="flex-1"></div>
    </div>
  `,X&&X.dispose(),X=new ii.Terminal({cursorBlink:!0,fontFamily:"Courier New, monospace",fontSize:14,theme:{background:"#000000",foreground:"#00ff00",cursor:"#00ff00",cursorAccent:"#000000",selection:"rgba(0, 255, 0, 0.3)"},allowTransparency:!1}),ge=new si.FitAddon,X.loadAddon(ge);let S=document.getElementById("terminal");if(!S)return;X.open(S),ge.fit(),X.onData(T=>{J&&J.readyState===WebSocket.OPEN&&J.send(JSON.stringify({type:"input",data:T}))}),X.focus(),Ye();let y=window.showNavigationBar;y&&y()}function ni(){ge&&ge.fit(),$.isConnected&&X&&J&&J.readyState===WebSocket.OPEN&&J.send(JSON.stringify({type:"resize",cols:X.cols,rows:X.rows}))}function Oe(){return J}async function Ze(){let v=document.getElementById("file-browser");if(v)if($.isFileBrowserOpen)v.classList.add("hidden"),v.classList.remove("flex","fullscreen"),$.isFileBrowserOpen=!1;else{v.classList.remove("hidden"),v.classList.add("flex","fullscreen"),$.isFileBrowserOpen=!0;let S=$.currentProject?`../projects/${$.currentProject}`:"~";await me(S)}}async function me(v){try{let S=await fetch(`/api/browse?path=${encodeURIComponent(v)}`),y=await S.json();if(!S.ok)throw new Error(y.error||"Failed to load directory");$.currentBrowserPath=y.currentPath,is(y);let T=document.getElementById("current-dir");T&&(T.value=y.currentPath)}catch(S){console.error("Error loading directory:",S),await window.Swal.fire({title:"Error",text:"Failed to load directory: "+S.message,icon:"error"})}}function is(v){let S=document.getElementById("file-list");S&&(S.innerHTML="",v.parentPath&&v.parentPath!==v.currentPath&&S.appendChild(oi({name:"..",type:"directory",path:v.parentPath})),v.items.forEach(y=>S.appendChild(oi(y))))}function oi(v){let S=document.createElement("div");S.className="file-item p-2 rounded cursor-pointer flex items-center gap-2 text-sm";let y=v.type==="directory"?"\u{1F4C1}":"\u{1F4C4}",T=v.name.length>25?v.name.substring(0,22)+"...":v.name;return S.innerHTML=`
    <span class="text-lg">${y}</span>
    <span class="flex-1 truncate" title="${v.name}">${T}</span>
  `,S.addEventListener("click",()=>{v.type==="directory"?me(v.path):Qe(v.path)}),S}async function Qe(v){try{let S=await fetch(`/api/file?path=${encodeURIComponent(v)}`),y=await S.json();if(!S.ok)throw new Error(y.error||"Failed to load file");$.currentEditingFile=y.path;let T=document.getElementById("file-editor");T?.classList.remove("hidden"),T?.classList.add("flex","fullscreen"),$.isFileEditorOpen=!0;let k=document.getElementById("file-content"),r=document.getElementById("editor-filename");k&&(k.value=y.content),r&&(r.textContent=v.split("/").pop()||"")}catch(S){console.error("Error opening file:",S),await window.Swal.fire({title:"Error",text:"Failed to open file: "+S.message,icon:"error"})}}async function He(){if(!$.currentEditingFile){await window.Swal.fire({title:"Warning",text:"No file is currently being edited",icon:"warning"});return}try{let S=document.getElementById("file-content")?.value||"",y=await fetch("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:$.currentEditingFile,content:S})}),T=await y.json();if(!y.ok)throw new Error(T.error||"Failed to save file");let k=document.getElementById("save-file");if(k){let r=k.textContent||"Save";k.textContent="Saved!",k.classList.add("btn-success"),setTimeout(()=>{k.textContent=r,k.classList.remove("btn-success")},1e3)}}catch(v){console.error("Error saving file:",v),await window.Swal.fire({title:"Error",text:"Failed to save file: "+v.message,icon:"error"})}}function Se(){let v=document.getElementById("file-editor");v?.classList.add("hidden"),v?.classList.remove("flex","fullscreen"),$.isFileEditorOpen=!1,$.currentEditingFile=null}function be(){let v=document.getElementById("file-browser");v?.classList.add("hidden"),v?.classList.remove("flex","fullscreen"),$.isFileBrowserOpen=!1}function et(){let v=document.getElementById("new-file-modal"),S=document.getElementById("new-file-name");!v||!S||(S.value="",v.showModal(),S.focus())}function tt(){let v=document.getElementById("new-folder-modal"),S=document.getElementById("new-folder-name");!v||!S||(S.value="",v.showModal(),S.focus())}async function Fe(){let S=(document.getElementById("new-file-name")?.value||"").trim();if(!S)return;if(!$.currentBrowserPath){await window.Swal.fire({title:"Warning",text:"No directory selected",icon:"warning"});return}let y=`${$.currentBrowserPath}/${S}`;try{let T=await fetch("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:y,content:""})}),k=await T.json();if(!T.ok)throw new Error(k.error||"Failed to create file");await me($.currentBrowserPath),await Qe(y),document.getElementById("new-file-modal")?.close()}catch(T){console.error("Error creating file:",T),await window.Swal.fire({title:"Error",text:"Failed to create file: "+T.message,icon:"error"})}}async function We(){let S=(document.getElementById("new-folder-name")?.value||"").trim();if(!S)return;if(!$.currentBrowserPath){await window.Swal.fire({title:"Warning",text:"No directory selected",icon:"warning"});return}let y=`${$.currentBrowserPath}/${S}`;try{let T=await fetch("/api/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:y})}),k=await T.json();if(!T.ok)throw new Error(k.error||"Failed to create folder");await me($.currentBrowserPath),document.getElementById("new-folder-modal")?.close()}catch(T){console.error("Error creating folder:",T),await window.Swal.fire({title:"Error",text:"Failed to create folder: "+T.message,icon:"error"})}}var ai;(function(v){v[v.None=0]="None",v[v.Mutable=1]="Mutable",v[v.Watching=2]="Watching",v[v.RecursedCheck=4]="RecursedCheck",v[v.Recursed=8]="Recursed",v[v.Dirty=16]="Dirty",v[v.Pending=32]="Pending"})(ai||(ai={}));var li=[],Bt=[],{link:nt,unlink:Rt,propagate:ss,checkDirty:rs,endTracking:Ci,startTracking:yi,shallowPropagate:ns}=function({update:v,notify:S,unwatched:y}){let T=0;return{link:function(o,d){let n=d.depsTail;if(n!==void 0&&n.dep===o)return;let l;if(4&d.flags&&(l=n!==void 0?n.nextDep:d.deps,l!==void 0&&l.dep===o))return l.version=T,void(d.depsTail=l);let _=o.subsTail;if(_!==void 0&&_.version===T&&_.sub===d)return;let p=d.depsTail=o.subsTail={version:T,dep:o,sub:d,prevDep:n,nextDep:l,prevSub:_,nextSub:void 0};l!==void 0&&(l.prevDep=p),n!==void 0?n.nextDep=p:d.deps=p,_!==void 0?_.nextSub=p:o.subs=p},unlink:k,propagate:function(o){let d,n=o.nextSub;e:for(;;){let l=o.sub,_=l.flags;if(3&_&&(60&_?12&_?4&_?48&_||!a(o,l)?_=0:(l.flags=40|_,_&=1):l.flags=-9&_|32:_=0:l.flags=32|_,2&_&&S(l),1&_)){let p=l.subs;if(p!==void 0){o=p,p.nextSub!==void 0&&(d={value:n,prev:d},n=o.nextSub);continue}}if((o=n)===void 0){for(;d!==void 0;)if(o=d.value,d=d.prev,o!==void 0){n=o.nextSub;continue e}break}n=o.nextSub}},checkDirty:function(o,d){let n,l=0;e:for(;;){let _=o.dep,p=_.flags,f=!1;if(16&d.flags)f=!0;else if(17&~p){if(!(33&~p)){o.nextSub===void 0&&o.prevSub===void 0||(n={value:o,prev:n}),o=_.deps,d=_,++l;continue}}else if(v(_)){let e=_.subs;e.nextSub!==void 0&&r(e),f=!0}if(f||o.nextDep===void 0){for(;l;){--l;let e=d.subs,s=e.nextSub!==void 0;if(s?(o=n.value,n=n.prev):o=e,f){if(v(d)){s&&r(e),d=o.sub;continue}}else d.flags&=-33;if(d=o.sub,o.nextDep!==void 0){o=o.nextDep;continue e}f=!1}return f}o=o.nextDep}},endTracking:function(o){let d=o.depsTail,n=d!==void 0?d.nextDep:o.deps;for(;n!==void 0;)n=k(n,o);o.flags&=-5},startTracking:function(o){++T,o.depsTail=void 0,o.flags=-57&o.flags|4},shallowPropagate:r};function k(o,d=o.sub){let n=o.dep,l=o.prevDep,_=o.nextDep,p=o.nextSub,f=o.prevSub;return _!==void 0?_.prevDep=l:d.depsTail=l,l!==void 0?l.nextDep=_:d.deps=_,p!==void 0?p.prevSub=f:n.subsTail=f,f!==void 0?f.nextSub=p:(n.subs=p)===void 0&&y(n),_}function r(o){do{let d=o.sub,n=o.nextSub,l=d.flags;(48&l)==32&&(d.flags=16|l,2&l&&S(d)),o=n}while(o!==void 0)}function a(o,d){let n=d.depsTail;if(n!==void 0){let l=d.deps;do{if(l===o)return!0;if(l===n)break;l=l.nextDep}while(l!==void 0)}return!1}}({update:v=>"getter"in v?ls(v):ki(v,v.value),notify:function v(S){let y=S.flags;if(!(64&y)){S.flags=64|y;let T=S.subs;T!==void 0?v(T.sub):Bt[Tt++]=S}},unwatched(v){if("getter"in v){let S=v.deps;if(S!==void 0){v.flags=17;do S=Rt(S,v);while(S!==void 0)}}else"previousValue"in v||Wt.call(v)}}),ye,Ee,os=0,it=0,Tt=0;function oe(v){let S=ye;return ye=v,S}function ci(v){let S=Ee;return Ee=v,S}function Ei(v){return hs.bind({previousValue:v,value:v,subs:void 0,subsTail:void 0,flags:1})}function as(v){let S={fn:v,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:2};ye!==void 0?nt(S,ye):Ee!==void 0&&nt(S,Ee);let y=oe(S);try{S.fn()}finally{oe(y)}return Wt.bind(S)}function ls(v){let S=oe(v);yi(v);try{let y=v.value;return y!==(v.value=v.getter(y))}finally{oe(S),Ci(v)}}function ki(v,S){return v.flags=1,v.previousValue!==(v.previousValue=S)}function xi(v,S){if(16&S||32&S&&rs(v.deps,v)){let T=oe(v);yi(v);try{v.fn()}finally{oe(T),Ci(v)}return}32&S&&(v.flags=-33&S);let y=v.deps;for(;y!==void 0;){let T=y.dep,k=T.flags;64&k&&xi(T,T.flags=-65&k),y=y.nextDep}}function cs(){for(;it<Tt;){let v=Bt[it];Bt[it++]=void 0,xi(v,v.flags&=-65)}it=0,Tt=0}function hs(...v){if(!v.length){let S=this.value;if(16&this.flags&&ki(this,S)){let y=this.subs;y!==void 0&&ns(y)}return ye!==void 0&&nt(this,ye),S}{let S=v[0];if(this.value!==(this.value=S)){this.flags=17;let y=this.subs;y!==void 0&&(ss(y),os||cs())}}}function Wt(){let v=this.deps;for(;v!==void 0;)v=Rt(v,this);let S=this.subs;S!==void 0&&Rt(S),this.flags=0}var ds={greedy:!1};var us=v=>{li.push(oe(void 0));try{return v()}finally{oe(li.pop())}},_e=class{constructor(S,y){this._=S(y)}get value(){return this._()}set value(S){this._(S)}peek(){return us(this._)}valueOf(){return this.value}};var At=class extends _e{constructor(S){super(Ei,[S])}get value(){return super.value[0]}set value(S){super.value=[S]}peek(){return super.peek()[0]}};var Li=(v,{greedy:S=!1}=ds)=>S?new At(v):new _e(Ei,v);var hi=v=>{Li=v},{isArray:di}=Array,{assign:fs,defineProperties:_s,entries:Nt,freeze:Di}=Object,Mt=class{#e;constructor(S){this.#e=S}valueOf(){return this.#e}toString(){return String(this.#e)}};var ui=v=>document.createComment(v),Ce=42,Bi=new Set(["plaintext","script","style","textarea","title","xmp"]),Ri=new Set(["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),Ne=Di({}),ee=Di([]),se=(v,S)=>(v.children===ee&&(v.children=[]),v.children.push(S),S.parent=v,S),vs=(v,S,y)=>{v.props===Ne&&(v.props={}),v.props[S]=y},je=(v,S,y)=>{v!==S&&y.push(v)},ve=class{constructor(S){this.type=S,this.parent=null}toJSON(){return[this.type,this.data]}},ot=class extends ve{constructor(S){super(8),this.data=S}toString(){return`<!--${this.data}-->`}},at=class extends ve{constructor(S){super(10),this.data=S}toString(){return`<!${this.data}>`}},lt=class extends ve{constructor(S){super(3),this.data=S}toString(){return this.data}},ct=class extends ve{constructor(){super(Ce),this.name="template",this.props=Ne,this.children=ee}toJSON(){let S=[Ce];return je(this.props,Ne,S),je(this.children,ee,S),S}toString(){let S="";for(let y in this.props){let T=this.props[y];T!=null&&(typeof T=="boolean"?T&&(S+=` ${y}`):S+=` ${y}="${T}"`)}return`<template${S}>${this.children.join("")}</template>`}},ht=class extends ve{constructor(S,y=!1){super(1),this.name=S,this.xml=y,this.props=Ne,this.children=ee}toJSON(){let S=[1,this.name,+this.xml];return je(this.props,Ne,S),je(this.children,ee,S),S}toString(){let{xml:S,name:y,props:T,children:k}=this,{length:r}=k,a=`<${y}`;for(let o in T){let d=T[o];d!=null&&(typeof d=="boolean"?d&&(a+=S?` ${o}=""`:` ${o}`):a+=` ${o}="${d}"`)}if(r){a+=">";for(let o=!S&&Bi.has(y),d=0;d<r;d++)a+=o?k[d].data:k[d];a+=`</${y}>`}else a+=S?" />":Ri.has(y)?">":`></${y}>`;return a}},dt=class extends ve{constructor(){super(11),this.name="#fragment",this.children=ee}toJSON(){let S=[11];return je(this.children,ee,S),S}toString(){return this.children.join("")}},fe="\0",ps=`"${fe}"`,gs=`'${fe}'`,ms=/\x00|<[^><\s]+/g,Ss=/([^\s/>=]+)(?:=(\x00|(?:(['"])[\s\S]*?\3)))?/g,bs=(v,S,y,T,k)=>[S,y,T],st=v=>{let S=[];for(;v.parent;){switch(v.type){case Ce:case 1:v.name==="template"&&S.push(-1)}S.push(v.parent.children.indexOf(v)),v=v.parent}return S},fi=(v,S)=>{do v=v.parent;while(S.has(v));return v},ws=(v,S)=>S<0?v.content:v.childNodes[S],Cs=(v,S)=>S.reduceRight(ws,v),_i,Ti=!1,jt=({firstChild:v,lastChild:S})=>{let y=_i||(_i=document.createRange());return y.setStartAfter(v),y.setEndAfter(S),y.deleteContents(),v},_t=(v,S)=>Ti&&v.nodeType===11?1/S<0?S?jt(v):v.lastChild:S?v.valueOf():v.firstChild:v,ne=Symbol("nodes"),ys={get(){return this.firstChild.parentNode}},Es={value(v){jt(this).replaceWith(v)}},ks={value(){jt(this).remove()}},xs={value(){let{parentNode:v}=this;if(v===this)this[ne]===ee&&(this[ne]=[...this.childNodes]);else{if(v){let{firstChild:S,lastChild:y}=this;for(this[ne]=[S];S!==y;)this[ne].push(S=S.nextSibling)}this.replaceChildren(...this[ne])}return this}};function Ut(v){let S=ui("<>"),y=ui("</>");return v.replaceChildren(S,...v.childNodes,y),Ti=!0,_s(v,{[ne]:{writable:!0,value:ee},firstChild:{value:S},lastChild:{value:y},parentNode:ys,valueOf:xs,replaceWith:Es,remove:ks})}Ut.prototype=DocumentFragment.prototype;var we=16,vi=32768,Ai=((v=globalThis.document)=>{let S,y=v.createElement("template");return(T,k=!1)=>{if(k)return S||(S=v.createRange(),S.selectNodeContents(v.createElementNS("http://www.w3.org/2000/svg","svg"))),S.createContextualFragment(T);y.innerHTML=T;let r=y.content;return y=y.cloneNode(!1),r}})(document),rt=Symbol("ref"),Ls=(v,S)=>{for(let[y,T]of Nt(S)){let k=y==="role"?y:`aria-${y.toLowerCase()}`;T==null?v.removeAttribute(k):v.setAttribute(k,T)}},Mi=v=>(S,y)=>{y==null?S.removeAttribute(v):S.setAttribute(v,y)},Ds=(v,S)=>{v[ne]=((y,T,k,r)=>{let a=r.parentNode,o=T.length,d=y.length,n=o,l=0,_=0,p=null;for(;l<d||_<n;)if(d===l){let f=n<o?_?k(T[_-1],-0).nextSibling:k(T[n],0):r;for(;_<n;)a.insertBefore(k(T[_++],1),f)}else if(n===_)for(;l<d;)p&&p.has(y[l])||k(y[l],-1).remove(),l++;else if(y[l]===T[_])l++,_++;else if(y[d-1]===T[n-1])d--,n--;else if(y[l]===T[n-1]&&T[_]===y[d-1]){let f=k(y[--d],-0).nextSibling;a.insertBefore(k(T[_++],1),k(y[l++],-0).nextSibling),a.insertBefore(k(T[--n],1),f),y[d]=T[n]}else{if(!p){p=new Map;let e=_;for(;e<n;)p.set(T[e],e++)}let f=p.get(y[l])??-1;if(f<0)k(y[l++],-1).remove();else if(_<f&&f<n){let e=l,s=1;for(;++e<d&&e<n&&p.get(y[e])===f+s;)s++;if(s>f-_){let t=k(y[l],0);for(;_<f;)a.insertBefore(k(T[_++],1),t)}else a.replaceChild(k(T[_++],1),k(y[l++],-1))}else l++}return T})(v[ne]||ee,S,_t,v)},pi=new WeakMap,Pt=(v,S)=>{let y=typeof S=="object"?S??v:((k,r)=>{let a=pi.get(k);return a?a.data=r:pi.set(k,a=document.createTextNode(r)),a})(v,S),T=v[ne]??v;y!==T&&T.replaceWith(_t(v[ne]=y,1))},Bs=(v,S)=>{Pt(v,S instanceof _e?S.value:S)},Rs=({dataset:v},S)=>{for(let[y,T]of Nt(S))T==null?delete v[y]:v[y]=T},gi=new Map,Lt=v=>{let S=gi.get(v);return S||gi.set(v,S=It(v)),S},It=v=>(S,y)=>{S[v]=y},Ts=(v,S)=>{for(let[y,T]of Nt(S))Mi(y)(v,T)},As=(v,S,y)=>y?(T,k)=>{let r=T[S];r?.length&&T.removeEventListener(v,...r),k&&T.addEventListener(v,...k),T[S]=k}:(T,k)=>{let r=T[S];r&&T.removeEventListener(v,r),k&&T.addEventListener(v,k),T[S]=k},Ms=v=>(S,y)=>{S.toggleAttribute(v,!!y)},Ot=!1,Pi=!0,ut=v=>{Pi=v},$t=()=>Pi,vt=v=>_t(v.n?v.update(v):v.valueOf(!1),1),mi=(v,S)=>{let y=[],T=v.length,k=S.length;for(let r,a,o=0,d=0;d<k;d++)r=S[d],y[d]=o<T&&(a=v[o++]).t===r.t?(S[d]=a).update(r):r.valueOf(!1);return y},Si=(v,S,y)=>{let T=Li,k=y.length,r=0;hi(o=>r<k?y[r++]:y[r++]=o instanceof _e?o:T(o));let a=$t();a&&ut(!a);try{return v(S,Ii)}finally{a&&ut(a),hi(T)}},Ht=(v,S)=>(v.t===S.t?v.update(S):(v.n.replaceWith(vt(S)),v=S),v),Ps=(v,S,y)=>{let T,k=[],r=[we,null,y],a=!0;return as(()=>{if(a)a=!1,T=Si(S,y,k),k.length||(k=ee),T?(v.replaceWith(vt(T)),r[1]=T):v.remove();else{let o=Si(S,y,k);T&&Ht(T,o)===o&&(r[2]=T=o)}}),r},bi=Symbol(),Ii={},ft=class v{constructor(S,y){this.t=S,this.v=y,this.n=null,this.k=-1}valueOf(S=$t()){let[y,T,k]=this.t,r=document.importNode(y,!0),a=this.v,o,d,n,l=a.length,_=ee;if(0<l){for(_=T.slice(0);l--;){let[s,t,i]=T[l],c=a[l];if(d!==s&&(o=Cs(r,s),d=s),i&we){let u=o[bi]||(o[bi]={});if(i===we){for(let{name:g,value:b}of o.attributes)u[g]??=b;u.children??=[...o.content.childNodes],_[l]=Ps(o,c,u)}else t(u,c),_[l]=[i,t,u]}else{let u=!0;S||!(8&i)||i&vi||(1&i?(u=!1,c.length&&t(o,c[0]instanceof v?mi(ee,c):c)):c instanceof v&&(u=!1,t(o,vt(c)))),u&&(i===512?this.k=l:(i===16384&&(n??=new Set).add(o),t(o,c))),_[l]=[i,t,c,o],S&&8&i&&o.remove()}}n&&(s=>{for(let t of s){let i=t[rt];typeof i=="function"?i(t):i instanceof _e?i.value=t:i&&(i.current=t)}})(n)}let{childNodes:p}=r,f=p.length,e=f===1?p[0]:f?Ut(r):r;return this.v=_,this.n=e,-1<this.k&&k.set(_[this.k][2],e,this),e}update(S){let y=this.k,T=this.v,k=S.v;if(-1<y&&T[y][2]!==k[y])return((a,o)=>a.t[2].get(o)?.update(a)??a.valueOf(!1))(S,k[y]);let{length:r}=T;for(;r--;){let a=T[r],[o,d,n]=a;if(o===512)continue;let l=k[r];if(o&we)if(o===we){let _=l(n,Ii);d&&Ht(d,_)===_&&(a[2]=_)}else d(n,l);else{let _=l;if(1&o){if(8&o)l.length&&l[0]instanceof v&&(_=mi(n,l));else if(256&o&&l[0]===n[0])continue}else if(8&o)if(o&vi){if(l===n){d(a[3],_);continue}}else n instanceof v&&(l=Ht(n,l),_=l.n);l!==n&&(a[2]=l,d(a[3],_))}}return this.n}},wi=new WeakMap,Ft=class extends Map{constructor(){super()._=new FinalizationRegistry(S=>this.delete(S))}get(S){let y=super.get(S)?.deref();return y&&wi.get(y)}set(S,y,T){wi.set(y,T),this._.register(y,S),super.set(S,new WeakRef(y))}},Is=(({Comment:v=ot,DocumentType:S=at,Text:y=lt,Fragment:T=dt,Element:k=ht,Component:r=ct,update:a=bs})=>(o,d,n)=>{let l=o.join(fe).trim(),_=new Set,p=[],f=new T,e=0,s=0,t=0,i=ee;for(let c of l.matchAll(ms)){if(0<s){s--;continue}let u=c[0],g=c.index;if(e<g&&se(f,new y(l.slice(e,g))),u===fe){f.name==="table"&&(f=se(f,new k("tbody",n)),_.add(f));let b=se(f,new v("\u25E6"));p.push(a(b,8,st(b),"",d[t++])),e=g+1}else if(u.startsWith("<!")){let b=l.indexOf(">",g+2);if(l.slice(b-2,b+1)==="-->"){let h=l.slice(g+4,b-2);h[0]==="!"&&se(f,new v(h.slice(1).replace(/!$/,"")))}else se(f,new S(l.slice(g+2,b)));e=b+1}else if(u.startsWith("</")){let b=l.indexOf(">",g+2);n&&f.name==="svg"&&(n=!1),f=fi(f,_),e=b+1}else{let b=g+u.length,h=l.indexOf(">",b),m=u.slice(1),E=m;if(m===fe?(E="template",f=se(f,new r),i=st(f).slice(1),p.push(a(f,Ce,i,"",d[t++]))):(n||(E=E.toLowerCase(),f.name!=="table"||E!=="tr"&&E!=="td"||(f=se(f,new k("tbody",n)),_.add(f)),f.name==="tbody"&&E==="td"&&(f=se(f,new k("tr",n)),_.add(f))),f=se(f,new k(E,!!n&&E!=="svg")),i=ee),b<h){let x=!1;for(let[B,P,O]of l.slice(b,h).matchAll(Ss))if(O===fe||O===ps||O===gs||(x=P.endsWith(fe))){let W=i===ee?i=st(f):i;p.push(a(f,2,W,x?P.slice(0,-1):P,d[t++])),x=!1,s++}else vs(f,P,!O||O.slice(1,-1));i=ee}e=h+1;let R=0<h&&l[h-1]==="/";if(n)R&&(f=f.parent);else if(R||Ri.has(E))f=R?fi(f,_):f.parent;else if(E==="svg")n=!0;else if(Bi.has(E)){let x=l.indexOf(`</${m}>`,e),B=l.slice(e,x);B.trim()===fe?(s++,p.push(a(f,3,st(f),"",d[t++]))):se(f,new y(B)),f=f.parent,e=x+m.length+3,s++;continue}}}return e<l.length&&se(f,new y(l.slice(e))),[f,p]})({Comment:ot,DocumentType:at,Text:lt,Fragment:dt,Element:ht,Component:ct,update:(v,S,y,T,k)=>{switch(S){case Ce:return[y,k,we];case 8:return di(k)?[y,Ds,9]:k instanceof Mt?[y,(r=v.xml,(a,o)=>{let d=a[rt]??(a[rt]={});d.v!==o&&(d.f=Ut(Ai(o,r)),d.v=o),Pt(a,d.f)}),8192]:k instanceof _e?[y,Bs,32776]:[y,Pt,8];case 3:return[y,Lt("textContent"),2048];case 2:{let a=v.type===Ce;switch(T.at(0)){case"@":{let o=di(k);return[y,As(T.slice(1),Symbol(T),o),o?257:256]}case"?":return[y,Ms(T.slice(1)),4096];case".":return T==="..."?[y,a?fs:Ts,a?144:128]:[y,It(T.slice(1)),a?80:64];default:return a?[y,It(T),1040]:T==="aria"?[y,Ls,2]:T!=="data"||/^object$/i.test(v.name)?T==="key"?[y,Ot=!0,512]:T==="ref"?[y,Lt(rt),16384]:T.startsWith("on")?[y,Lt(T.toLowerCase()),64]:[y,Mi(T),4]:[y,Rs,32]}}}var r}}),Oi=(v,S=new WeakMap)=>(y,...T)=>{let k=S.get(y);return k||(k=Is(y,T,v),k.push((()=>{let r=Ot;return Ot=!1,r})()?new Ft:null),k[0]=Ai(k[0].toString(),v),S.set(y,k)),new ft(k,T)},Os=Oi(!1),qr=Oi(!0),Dt=new WeakMap;function ae(v,...S){let y=Os.apply(null,arguments);return $t()?y.valueOf(!0):y}var Hi=(v,S)=>{let y=Dt.get(v);if(y&&y[0](),typeof S=="function"){let T;ut(!1);let k=function(r){let a={deps:void 0,depsTail:void 0,subs:void 0,subsTail:void 0,flags:0};Ee!==void 0&&nt(a,Ee);let o=oe(void 0),d=ci(a);try{r()}finally{ci(d),oe(o)}return Wt.bind(a)}(()=>{T=S()});if(y&&y[1].t===T.t)y[1].update(T);else{let r=T.valueOf(!1);v.replaceChildren(r)}Dt.set(v,[k,T])}else ut(!0),Dt.delete(v),v.replaceChildren(S instanceof ft?vt(S):_t(S,1));return v};function gt(){typeof window.cleanupTerminal=="function"&&window.cleanupTerminal(),$.sessionID=null,$.currentProject=null,typeof window.updateURLWithoutSession=="function"&&window.updateURLWithoutSession(),le()}function mt(){typeof window.cleanupTerminal=="function"&&window.cleanupTerminal(),$.sessionID=null,$.currentProject=null,le()}async function le(){let v=window.hideNavigationBar;v&&v();try{let[S,y]=await Promise.all([fetch("/api/sessions"),fetch("/api/projects-with-worktrees")]),T=await S.json(),k=await y.json(),r=document.getElementById("terminal-container");if(!r)return;let a=n=>ae`
      <div class="card bg-base-200 shadow-lg hover:shadow-xl transition-shadow">
        <div class="card-body p-4">
          <div class="flex justify-between items-start">
            <div class="cursor-pointer flex-1" onclick=${()=>pt(n.id,n.projectName)}>
              <div class="flex items-center gap-2 mb-2">
                <h3 class="font-semibold text-sm">${n.id}</h3>
                <span class="badge badge-primary badge-sm">${n.projectName}</span>
              </div>
              <p class="text-xs opacity-70 line-clamp-2 break-all">Status: <span>${Yt(n.status)}</span></p>
              <p class="text-xs opacity-50">Created: ${new Date(n.created).toLocaleString()}</p>
            </div>
            <div class="flex gap-2">
              <button class="btn btn-primary btn-sm" onclick=${()=>pt(n.id,n.projectName)}>Connect</button>
              <button class="btn btn-error btn-sm" onclick=${()=>qt(n.id)}>Kill</button>
            </div>
          </div>
        </div>
      </div>`,o=(n,l)=>ae`
      <div class="bg-base-100 rounded-lg p-3 flex justify-between items-center">
        <div class="cursor-pointer flex-1" onclick=${()=>window.openWorktree?.(n,l.name)}>
          <div class="flex items-center gap-2">
            <span class="text-success"></span>
            <span class="font-medium text-sm">${l.name}</span>
            <span class="badge badge-outline badge-xs">${l.branch}</span>
          </div>
          <p class="text-xs opacity-60 mt-1">${l.relativePath}</p>
        </div>
        <div class="flex gap-1">
          <button class="btn btn-xs btn-primary" onclick=${()=>window.openWorktree?.(n,l.name)}>Open</button>
          <button class="btn btn-xs btn-success" onclick=${()=>window.mergeWorktree?.(n,l.name)}>Merge</button>
          <button class="btn btn-xs btn-error" onclick=${()=>window.deleteWorktree?.(n,l.name)}>Delete</button>
        </div>
      </div>`,d=n=>ae`
      <div class="card bg-base-300 shadow-lg">
        <div class="card-body p-4">
          <div class="flex justify-between items-center mb-4">
            <div class="cursor-pointer flex-1" onclick=${()=>Ue(n.name)}>
              <h3 class="text-lg font-bold">${n.name}</h3>
            </div>
            <div class="flex gap-2">
              <button class="btn btn-primary btn-sm" onclick=${()=>Ue(n.name)}>Open Project</button>
              <button class="btn btn-secondary btn-sm" onclick=${()=>window.createWorktreeModal?.(n.name)}>+ Worktree</button>
              <button class="btn btn-error btn-sm" onclick=${()=>Kt(n.name)}>Delete</button>
            </div>
          </div>
          ${n.worktrees.length>0?ae`<div class="mt-3">
                <h4 class="text-sm font-semibold mb-2 opacity-80">Worktrees:</h4>
                <div class="grid gap-2">
                  ${n.worktrees.map(l=>o(n.name,l))}
                </div>
               </div>`:ae`<p class="text-xs opacity-50 mt-2">No worktrees</p>`}
        </div>
      </div>`;Hi(r,ae`<div class="p-6 max-w-6xl mx-auto h-full flex flex-col overflow-y-auto">
        <div class="flex items-center justify-between mb-8">
          <h1 class="text-3xl font-bold">Shell Dashboard</h1>
          <div class="flex gap-2">
            <button class="btn btn-outline btn-sm" onclick=${()=>window.showEnvironmentManager?.()}><span class="text-lg"></span> Environment Variables</button>
            <button class="btn btn-outline btn-sm" onclick=${()=>window.showAliasesManager?.()}><span class="text-lg"></span> Shell Aliases</button>
          </div>
        </div>
        <div class="mb-8">
          <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><span class="text-primary"></span> All Active Sessions</h2>
          <div class="grid gap-3 mb-6">
            ${T.length===0?ae`<p class="text-center opacity-70 py-4">No active sessions</p>`:T.map(n=>a(n))}
          </div>
        </div>
        <div class="mb-8">
          <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><span class="text-secondary"></span> All Projects & Worktrees</h2>
          <div class="mb-6">
            <div class="flex gap-2">
              <input type="text" id="project-name" placeholder="Enter project name" class="input input-bordered flex-1">
              <button class="btn btn-primary" onclick=${()=>zt()}>Create Project</button>
            </div>
          </div>
          <div class="grid gap-4">
            ${k.length===0?ae`<p class="text-center opacity-70 py-4">No projects found</p>`:k.map(n=>d(n))}
          </div>
        </div>
      </div>`)}catch(S){console.error("Failed to load sessions and projects:",S);let y=document.getElementById("terminal-container");y&&(y.innerHTML='<div class="p-6 text-center text-error">Error loading sessions and projects</div>')}}async function zt(){let S=(document.getElementById("project-name")?.value||"").trim();if(!S){await window.Swal.fire({title:"Error",text:"Please enter a project name",icon:"error"});return}try{let y=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:S})}),T=await y.json();y.ok?Ue(T.name):await window.Swal.fire({title:"Error",text:T.error||"Failed to create project",icon:"error"})}catch(y){console.error("Error creating project:",y),await window.Swal.fire({title:"Error",text:"Error creating project",icon:"error"})}}async function Kt(v){if((await window.Swal.fire({title:"Delete Project?",text:`Are you sure you want to delete the project "${v}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{let y=await fetch(`/api/projects/${encodeURIComponent(v)}`,{method:"DELETE"}),T=await y.json();y.ok?(await window.Swal.fire({title:"Deleted!",text:T.message||"Project deleted successfully",icon:"success"}),le()):await window.Swal.fire({title:"Error",text:T.error||"Failed to delete project",icon:"error"})}catch(y){console.error("Error deleting project:",y),await window.Swal.fire({title:"Error",text:"Error deleting project",icon:"error"})}}function Ue(v){$.currentProject=v,$.sessionID=null,ue()}function pt(v,S){typeof de=="function"&&de(),$.sessionID=v,$.currentProject=S??$.currentProject,typeof window.updateURLWithSession=="function"&&window.updateURLWithSession(v,$.currentProject),ue()}async function qt(v){try{let y=await(await fetch(`/api/sessions/${v}`,{method:"DELETE"})).json();y.success?le():await window.Swal.fire({title:"Error",text:"Failed to kill session: "+y.message,icon:"error"})}catch(S){console.error("Error killing session:",S),await window.Swal.fire({title:"Error",text:"Error killing session",icon:"error"})}}function Fi(){let v=document.getElementById("nav-bar");if(v){v.classList.remove("hidden");let S=document.getElementById("current-path");S&&$.currentProject&&(S.textContent=`Project: ${$.currentProject}`)}}function Wi(){document.getElementById("nav-bar")?.classList.add("hidden")}function Ni(){window.addEventListener("popstate",()=>{$.sessionID=Me(),$.currentProject=Pe(),$.sessionID?ue():le()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("back-to-sessions")?.addEventListener("click",()=>{de(),$.currentProject?mt():gt()}),document.getElementById("browse-files")?.addEventListener("click",()=>void Ze()),document.getElementById("close-browser")?.addEventListener("click",()=>be()),document.getElementById("new-folder")?.addEventListener("click",()=>tt()),document.getElementById("new-file")?.addEventListener("click",()=>et()),document.getElementById("create-file-btn")?.addEventListener("click",()=>void Fe()),document.getElementById("cancel-file-btn")?.addEventListener("click",()=>document.getElementById("new-file-modal")?.close()),document.getElementById("create-folder-btn")?.addEventListener("click",()=>void We()),document.getElementById("cancel-folder-btn")?.addEventListener("click",()=>document.getElementById("new-folder-modal")?.close()),document.getElementById("new-file-name")?.addEventListener("keypress",o=>{o.key==="Enter"&&Fe()}),document.getElementById("new-folder-name")?.addEventListener("keypress",o=>{o.key==="Enter"&&We()}),document.getElementById("save-file")?.addEventListener("click",()=>void He()),document.getElementById("close-editor")?.addEventListener("click",()=>Se()),document.getElementById("file-content")?.addEventListener("keydown",o=>{let d=o;if((d.ctrlKey||d.metaKey)&&d.key==="s"&&(d.preventDefault(),He()),d.key==="Tab"&&o.target instanceof HTMLTextAreaElement){d.preventDefault();let n=o.target.selectionStart,l=o.target.selectionEnd,_=o.target.value;o.target.value=_.substring(0,n)+"	"+_.substring(l),o.target.selectionStart=o.target.selectionEnd=n+1}}),document.addEventListener("keydown",o=>{o.key==="Escape"&&($.isFileEditorOpen?Se():$.isFileBrowserOpen&&be())}),document.addEventListener("click",o=>{let d=document.getElementById("file-browser"),n=document.getElementById("file-editor");$.isFileBrowserOpen&&d&&!d.contains(o.target)&&!o.target.closest("#browse-files")&&be(),$.isFileEditorOpen&&n&&!n.contains(o.target)&&(o.target.closest(".file-item")||Se())}),document.getElementById("file-browser")?.addEventListener("click",o=>o.stopPropagation()),document.getElementById("file-editor")?.addEventListener("click",o=>o.stopPropagation()),Fs(),Hs()}),window.addEventListener("resize",()=>ni()),document.addEventListener("visibilitychange",()=>{let v=window.terminalInstance;if(!document.hidden&&v){if(v.focus?.(),!$.isConnected){let S=Oe();(!S||S.readyState!==WebSocket.OPEN)&&window.connectWebSocket?.()}}else if(document.hidden){let S=Oe();S&&S.readyState===WebSocket.OPEN&&S.close()}}),document.addEventListener("click",v=>{let S=document.getElementById("custom-input-container");S&&!S.contains(v.target)&&window.terminalInstance?.focus?.()}),window.addEventListener("beforeunload",()=>de())}function Hs(){let v=document.getElementById("custom-command-input");if(!v)return;let S=JSON.parse(localStorage.getItem("terminalCommandHistory")||"[]"),y=-1,T="",k=null,r=l=>{if(l&&l.trim()){let _=S.indexOf(l);_>-1&&S.splice(_,1),S.unshift(l),S.length>100&&(S=S.slice(0,100)),localStorage.setItem("terminalCommandHistory",JSON.stringify(S))}},a=()=>{k?.remove(),k=document.createElement("div"),k.className="absolute bottom-full left-0 right-0 bg-base-200 border border-base-300 rounded-t-lg max-h-40 overflow-y-auto z-50 hidden",k.style.marginBottom="2px";let l=v.parentElement;return l.style.position="relative",l.appendChild(k),k},o=l=>{k||a();let _=S.filter(p=>p.toLowerCase().includes(l.toLowerCase())&&p!==l).slice(0,5);if(_.length===0){k.classList.add("hidden");return}k.innerHTML="",_.forEach(p=>{let f=document.createElement("div");f.className="px-3 py-2 cursor-pointer hover:bg-base-300 text-sm",f.textContent=p,f.addEventListener("click",()=>{v.value=p,k.classList.add("hidden"),v.focus()}),k.appendChild(f)}),k.classList.remove("hidden")},d=()=>{k?.classList.add("hidden")},n=()=>{let l=Oe(),_=(v.value||"").trim();!_||!l||(r(_),y=-1,T="",d(),window.terminalInstance?.focus?.(),setTimeout(()=>{$.isConnected&&l&&l.readyState===WebSocket.OPEN&&(l.send(JSON.stringify({type:"input",data:_})),setTimeout(()=>{l.send(JSON.stringify({type:"input",data:"\r"}))},50),v.value="",v.style.height="auto",v.rows=1,setTimeout(()=>v.focus(),100))},50))};v.addEventListener("keydown",l=>{let _=l;_.key==="Enter"?_.shiftKey?setTimeout(()=>{v.style.height="auto",v.style.height=Math.min(v.scrollHeight,120)+"px"},0):(_.preventDefault(),n()):_.key==="ArrowUp"?(_.preventDefault(),y===-1&&(T=v.value),y<S.length-1&&(y++,v.value=S[y],d())):_.key==="ArrowDown"?(_.preventDefault(),y>0?(y--,v.value=S[y],d()):y===0&&(y=-1,v.value=T,d())):_.key==="Escape"&&(d(),y=-1,T="")}),v.addEventListener("input",()=>{v.style.height="auto",v.style.height=Math.min(v.scrollHeight,120)+"px",y=-1,T=v.value;let l=v.value.trim();l.length>0?o(l):d()}),v.addEventListener("blur",()=>{v.value.trim()||(v.style.height="auto",v.rows=1),setTimeout(()=>d(),200)}),v.addEventListener("focus",()=>{let l=v.value.trim();l.length>0&&o(l)}),a(),document.addEventListener("click",l=>{!v.contains(l.target)&&(!k||!k.contains(l.target))&&d()})}function Fs(){document.getElementById("virtual-keyboard")?.addEventListener("click",async S=>{let y=S.target.closest("button[data-key-code]");if(!y)return;let T=parseInt(y.dataset.keyCode||"0",10),k="";switch(T){case 27:k="\x1B";break;case 9:k="	";break;case 17:{let o=(await window.Swal.fire({title:"Ctrl Key Combination",input:"text",inputLabel:"Enter next key for Ctrl combination",inputPlaceholder:"e.g., 'c' for Ctrl+C, 'z' for Ctrl+Z",showCancelButton:!0,inputValidator:d=>d?void 0:"You need to enter a key!"})).value;if(o){let d=o.toLowerCase().charCodeAt(0);d>=97&&d<=122?k=String.fromCharCode(d-96):o==="["?k="\x1B":o==="\\"?k="":o==="]"?k="":o==="^"?k="":o==="_"&&(k="")}break}case 3:k="";break;case 38:k="\x1B[A";break;case 40:k="\x1B[B";break;case 37:k="\x1B[D";break;case 39:k="\x1B[C";break;default:break}let r=Oe();$.isConnected&&k&&r&&(window.terminalInstance?.focus?.(),setTimeout(()=>r.send(JSON.stringify({type:"input",data:k})),50))})}var xe=null,ze=!1;async function ji(){try{let S=await(await fetch("/api/environment")).json(),y=document.getElementById("terminal-container");if(!y)return;y.innerHTML=`
      <div class="p-6 max-w-4xl mx-auto h-full flex flex-col">
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">Global Environment Variables</h1>
          <div class="flex gap-2">
            <span id="save-status" class="text-sm opacity-70"></span>
            <button id="back-to-dashboard" class="btn btn-outline">\u2190 Back to Dashboard</button>
          </div>
        </div>
        <div class="bg-base-200 rounded-lg p-4 mb-6">
          <p class="text-sm opacity-70 mb-2">Edit environment variables in KEY=VALUE format. Comments starting with # are ignored. These variables will be available in all new terminal sessions across all projects. Changes are automatically saved as you type.</p>
          <p class="text-xs opacity-50">Example: NODE_ENV=production</p>
        </div>
        <div class="bg-base-100 rounded-lg border border-base-300 flex-1 flex flex-col">
          <div class="flex items-center justify-between p-4 border-b border-base-300">
            <h2 class="text-xl font-semibold">Environment Variables</h2>
            <div class="flex gap-2">
              <button id="clear-all-vars" class="btn btn-error btn-sm">Clear All</button>
              <button id="save-manually" class="btn btn-primary btn-sm">Save Now</button>
            </div>
          </div>
          <div class="flex-1 p-4">
            <textarea id="env-editor" class="textarea textarea-bordered w-full h-full resize-none font-mono text-sm" placeholder="# Add your environment variables here
# Format: KEY=VALUE
# Example:
NODE_ENV=production
API_URL=https://api.example.com
DEBUG=true" spellcheck="false">${S.text||""}</textarea>
          </div>
        </div>
      </div>`,Ws(),ke("Loaded")}catch(v){console.error("Error loading environment variables:",v),alert("Failed to load environment variables")}}function Ws(){let v=document.getElementById("back-to-dashboard"),S=document.getElementById("env-editor"),y=document.getElementById("clear-all-vars"),T=document.getElementById("save-manually");v?.addEventListener("click",async()=>{ze&&await $e(),window.showSessionsAndProjectsList?.()}),S?.addEventListener("input",()=>{ze=!0,ke("Unsaved changes..."),xe&&window.clearTimeout(xe),xe=window.setTimeout(async()=>{await $e()},2e3)}),T?.addEventListener("click",async()=>{await $e()}),y?.addEventListener("click",async()=>{if(confirm("Are you sure you want to clear all environment variables?")){let k=document.getElementById("env-editor");k&&(k.value=""),ze=!0,await $e()}}),window.addEventListener("beforeunload",async()=>{ze&&await $e()})}async function $e(){try{let S=document.getElementById("env-editor")?.value||"";ke("Saving...");let y=await fetch("/api/environment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:S})});if(y.ok){let T=await y.json();ze=!1,ke(`Saved (${Object.keys(T.variables).length} variables)`),xe&&(window.clearTimeout(xe),xe=null)}else{let T=await y.json();ke("Save failed"),console.error("Failed to save environment variables:",T)}}catch(v){ke("Save error"),console.error("Error saving environment variables:",v)}}function ke(v){let S=document.getElementById("save-status");S&&(S.textContent=v,S.className="text-sm transition-colors duration-200",v.includes("Saved")?S.className+=" text-success":v.includes("Saving")?S.className+=" text-warning":v.includes("failed")||v.includes("error")?S.className+=" text-error":S.className+=" opacity-70",(v.includes("Saved")||v.includes("failed")||v.includes("error"))&&setTimeout(()=>{S.textContent===v&&(S.textContent="")},3e3))}var De=null,qe=!1;async function Ui(){try{let S=await(await fetch("/api/aliases")).json(),y=document.getElementById("terminal-container");if(!y)return;y.innerHTML=`
      <div class="p-6 max-w-4xl mx-auto h-full flex flex-col">
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">Shell Aliases Manager</h1>
          <div class="flex gap-2">
            <span id="alias-save-status" class="text-sm opacity-70"></span>
            <button id="back-to-dashboard" class="btn btn-outline">\u2190 Back to Dashboard</button>
          </div>
        </div>
        <div class="bg-base-200 rounded-lg p-4 mb-6">
          <p class="text-sm opacity-70 mb-2">Create and manage zsh shell aliases. Aliases are stored in your ~/.zshrc file. Use the format: <code>alias name='command'</code> or just <code>name=command</code> (auto-formatted). Changes are automatically saved and will be available in new terminal sessions.</p>
          <p class="text-xs opacity-50 mb-2">Examples:<br>\u2022 <code>alias ll='ls -la'</code><br>\u2022 <code>alias gs='git status'</code><br>\u2022 <code>alias ..='cd ..'</code></p>
          <div class="text-xs opacity-50">
            <strong>Location:</strong> ${S.zshrcPath||"~/.zshrc"}
            ${S.hasZshrc?'<span class="text-success">\u2713 Found</span>':'<span class="text-warning">\u26A0 Will be created</span>'}
          </div>
        </div>
        <div class="bg-base-100 rounded-lg border border-base-300 flex-1 flex flex-col">
          <div class="flex items-center justify-between p-4 border-b border-base-300">
            <h2 class="text-xl font-semibold">Shell Aliases</h2>
            <div class="flex gap-2">
              <button id="clear-all-aliases" class="btn btn-error btn-sm">Clear All</button>
              <button id="save-aliases-manually" class="btn btn-primary btn-sm">Save Now</button>
            </div>
          </div>
          <div class="flex-1 p-4">
            <textarea id="aliases-editor" class="textarea textarea-bordered w-full h-full resize-none font-mono text-sm" placeholder="# Add your shell aliases here
# Format: alias name='command' or just name=command
# Examples:
alias ll='ls -la'
alias gs='git status'
alias ..='cd ..'
alias grep='grep --color=auto'
alias h='history'
alias c='clear'" spellcheck="false">${S.text||""}</textarea>
          </div>
        </div>
      </div>`,Ns(),Le("Loaded")}catch(v){console.error("Error loading aliases:",v),alert("Failed to load aliases")}}function Ns(){let v=document.getElementById("back-to-dashboard"),S=document.getElementById("aliases-editor"),y=document.getElementById("clear-all-aliases"),T=document.getElementById("save-aliases-manually");v?.addEventListener("click",async()=>{qe&&await Ke(),window.showSessionsAndProjectsList?.()}),S?.addEventListener("input",()=>{qe=!0,Le("Unsaved changes..."),De&&window.clearTimeout(De),De=window.setTimeout(async()=>{await Ke()},2e3)}),T?.addEventListener("click",async()=>{await Ke()}),y?.addEventListener("click",async()=>{if(confirm("Are you sure you want to clear all aliases? This will remove all MyShell24-managed aliases from your .zshrc file.")){let k=document.getElementById("aliases-editor");k&&(k.value=""),qe=!0,await Ke()}}),window.addEventListener("beforeunload",async()=>{qe&&await Ke()})}async function Ke(){try{let S=document.getElementById("aliases-editor")?.value||"";Le("Saving...");let y=await fetch("/api/aliases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:S})});if(y.ok){let T=await y.json();qe=!1,Le(`Saved (${T.aliasCount||0} aliases)`),De&&(window.clearTimeout(De),De=null)}else{let T=await y.json();Le("Save failed"),console.error("Failed to save aliases:",T),T.details&&T.details.length>0&&alert(`Save failed:
`+T.details.join(`
`))}}catch(v){Le("Save error"),console.error("Error saving aliases:",v)}}function Le(v){let S=document.getElementById("alias-save-status");S&&(S.textContent=v,S.className="text-sm transition-colors duration-200",v.includes("Saved")?S.className+=" text-success":v.includes("Saving")?S.className+=" text-warning":v.includes("failed")||v.includes("error")?S.className+=" text-error":S.className+=" opacity-70",(v.includes("Saved")||v.includes("failed")||v.includes("error"))&&setTimeout(()=>{S.textContent===v&&(S.textContent="")},3e3))}function $i(v){if(!document.getElementById("new-worktree-modal")){document.body.insertAdjacentHTML("beforeend",`
      <dialog id="new-worktree-modal" class="modal">
        <div class="modal-box">
          <h3 class="font-bold text-lg">Create New Worktree</h3>
          <div class="py-4">
            <div class="mb-4">
              <label class="label"><span class="label-text">Worktree Name</span></label>
              <input type="text" id="new-worktree-name" placeholder="Enter worktree name..." class="input input-bordered w-full" />
            </div>
            <div class="mb-4">
              <label class="label"><span class="label-text">Branch Name (optional)</span></label>
              <input type="text" id="new-worktree-branch" placeholder="Enter new branch name..." class="input input-bordered w-full" />
              <div class="label"><span class="label-text-alt">Leave empty to checkout existing branch</span></div>
            </div>
          </div>
          <div class="modal-action">
            <button id="create-worktree-btn" class="btn btn-secondary">Create Worktree</button>
            <button id="cancel-worktree-btn" class="btn">Cancel</button>
          </div>
        </div>
        <form method="dialog" class="modal-backdrop"><button>close</button></form>
      </dialog>`),document.getElementById("create-worktree-btn")?.addEventListener("click",()=>Vt(v)),document.getElementById("cancel-worktree-btn")?.addEventListener("click",()=>document.getElementById("new-worktree-modal")?.close());let T=document.getElementById("new-worktree-name"),k=document.getElementById("new-worktree-branch");T?.addEventListener("keypress",r=>{r.key==="Enter"&&Vt(v)}),k?.addEventListener("keypress",r=>{r.key==="Enter"&&Vt(v)})}document.getElementById("new-worktree-name").value="",document.getElementById("new-worktree-branch").value="",document.getElementById("new-worktree-modal")?.showModal(),document.getElementById("new-worktree-name")?.focus()}async function Vt(v){let S=document.getElementById("new-worktree-name"),y=document.getElementById("new-worktree-branch"),T=(S?.value||"").trim(),k=(y?.value||"").trim();if(!T){await window.Swal.fire({title:"Error",text:"Please enter a worktree name",icon:"error"});return}try{let r=await fetch(`/api/projects/${encodeURIComponent(v)}/worktrees`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:T,branch:k||void 0})}),a=await r.json();r.ok?(document.getElementById("new-worktree-modal")?.close(),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:a.error||"Failed to create worktree",icon:"error"})}catch(r){console.error("Error creating worktree:",r),await window.Swal.fire({title:"Error",text:"Error creating worktree",icon:"error"})}}function zi(v,S){$.sessionID=null,$.currentProject=`${v}/worktrees/${S}`,window.initializeTerminal?.()}async function Ki(v,S){let{value:y}=await window.Swal.fire({title:"Enter target branch",input:"text",inputLabel:"Target branch to merge into",inputValue:"main",showCancelButton:!0,inputValidator:k=>k?void 0:"You need to enter a branch name!"});if(!(!y||!(await window.Swal.fire({title:"Confirm merge",text:`Are you sure you want to merge worktree "${S}" into "${y}"? This will also delete the worktree.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, merge it!"})).isConfirmed))try{let k=await fetch(`/api/projects/${encodeURIComponent(v)}/worktrees/${encodeURIComponent(S)}/merge`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetBranch:y||"main"})}),r=await k.json();k.ok?(await window.Swal.fire({title:"Success!",text:r.message||"Worktree merged successfully",icon:"success"}),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:r.error||"Failed to merge worktree",icon:"error"})}catch(k){console.error("Error merging worktree:",k),await window.Swal.fire({title:"Error",text:"Error merging worktree",icon:"error"})}}async function qi(v,S){if((await window.Swal.fire({title:"Delete Worktree",text:`Are you sure you want to delete worktree "${S}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{let T=await fetch(`/api/projects/${encodeURIComponent(v)}/worktrees/${encodeURIComponent(S)}`,{method:"DELETE"}),k=await T.json();T.ok?(await window.Swal.fire({title:"Success!",text:k.message||"Worktree deleted successfully",icon:"success"}),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:k.error||"Failed to delete worktree",icon:"error"})}catch(T){console.error("Error deleting worktree:",T),await window.Swal.fire({title:"Error",text:"Error deleting worktree",icon:"error"})}}Object.assign(window,{getSessionIDFromURL:Me,getProjectFromURL:Pe,updateURLWithSession:Ge,clearURLParams:Et,updateURLWithoutSession:Zt,initializeTerminal:ue,cleanupTerminal:de,connectWebSocket:Ye,showNavigationBar:Fi,hideNavigationBar:Wi,goBackToProjectList:mt,goBackToSessionList:gt,showSessionsAndProjectsList:le,createNewProject:zt,deleteProject:Kt,selectProject:Ue,connectToSession:pt,killSession:qt,toggleFileBrowser:Ze,loadDirectory:me,openFileInEditor:Qe,saveCurrentFile:He,closeFileBrowser:be,closeFileEditor:Se,createNewFile:et,createNewFolder:tt,handleFileCreation:Fe,handleFolderCreation:We,showEnvironmentManager:ji,showAliasesManager:Ui,createWorktreeModal:$i,openWorktree:zi,mergeWorktree:Ki,deleteWorktree:qi});$.sessionID=Me();$.currentProject=Pe();Ni();$.sessionID?ue():le();})();
//# sourceMappingURL=bundle.js.map
