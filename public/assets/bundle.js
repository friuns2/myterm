"use strict";(()=>{var Ti=Object.create;var Ft=Object.defineProperty;var Mi=Object.getOwnPropertyDescriptor;var Pi=Object.getOwnPropertyNames;var Ii=Object.getPrototypeOf,Oi=Object.prototype.hasOwnProperty;var Wt=(v,g)=>()=>(g||v((g={exports:{}}).exports,g),g.exports);var Hi=(v,g,w,A)=>{if(g&&typeof g=="object"||typeof g=="function")for(let E of Pi(g))!Oi.call(v,E)&&E!==w&&Ft(v,E,{get:()=>g[E],enumerable:!(A=Mi(g,E))||A.enumerable});return v};var Nt=(v,g,w)=>(w=v!=null?Ti(Ii(v)):{},Hi(g||!v||!v.__esModule?Ft(w,"default",{value:v,enumerable:!0}):w,v));var ni=Wt((Qe,Bt)=>{(function(v,g){if(typeof Qe=="object"&&typeof Bt=="object")Bt.exports=g();else if(typeof define=="function"&&define.amd)define([],g);else{var w=g();for(var A in w)(typeof Qe=="object"?Qe:v)[A]=w[A]}})(self,()=>(()=>{"use strict";var v={4567:function(E,s,o){var a=this&&this.__decorate||function(i,l,u,m){var b,h=arguments.length,S=h<3?l:m===null?m=Object.getOwnPropertyDescriptor(l,u):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(i,l,u,m);else for(var k=i.length-1;k>=0;k--)(b=i[k])&&(S=(h<3?b(S):h>3?b(l,u,S):b(l,u))||S);return h>3&&S&&Object.defineProperty(l,u,S),S},f=this&&this.__param||function(i,l){return function(u,m){l(u,m,i)}};Object.defineProperty(s,"__esModule",{value:!0}),s.AccessibilityManager=void 0;let n=o(9042),d=o(6114),c=o(9924),p=o(844),_=o(5596),e=o(4725),r=o(3656),t=s.AccessibilityManager=class extends p.Disposable{constructor(i,l){super(),this._terminal=i,this._renderService=l,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let u=0;u<this._terminal.rows;u++)this._rowElements[u]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[u]);if(this._topBoundaryFocusListener=u=>this._handleBoundaryFocus(u,0),this._bottomBoundaryFocusListener=u=>this._handleBoundaryFocus(u,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new c.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(u=>this._handleResize(u.rows))),this.register(this._terminal.onRender(u=>this._refreshRows(u.start,u.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(u=>this._handleChar(u))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(u=>this._handleTab(u))),this.register(this._terminal.onKey(u=>this._handleKey(u.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new _.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,r.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,p.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(i){for(let l=0;l<i;l++)this._handleChar(" ")}_handleChar(i){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==i&&(this._charsToAnnounce+=i):this._charsToAnnounce+=i,i===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=n.tooMuchOutput)),d.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,d.isMac&&this._liveRegion.remove()}_handleKey(i){this._clearLiveRegion(),/\p{Control}/u.test(i)||this._charsToConsume.push(i)}_refreshRows(i,l){this._liveRegionDebouncer.refresh(i,l,this._terminal.rows)}_renderRows(i,l){let u=this._terminal.buffer,m=u.lines.length.toString();for(let b=i;b<=l;b++){let h=u.translateBufferLineToString(u.ydisp+b,!0),S=(u.ydisp+b+1).toString(),k=this._rowElements[b];k&&(h.length===0?k.innerText="\xA0":k.textContent=h,k.setAttribute("aria-posinset",S),k.setAttribute("aria-setsize",m))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(i,l){let u=i.target,m=this._rowElements[l===0?1:this._rowElements.length-2];if(u.getAttribute("aria-posinset")===(l===0?"1":`${this._terminal.buffer.lines.length}`)||i.relatedTarget!==m)return;let b,h;if(l===0?(b=u,h=this._rowElements.pop(),this._rowContainer.removeChild(h)):(b=this._rowElements.shift(),h=u,this._rowContainer.removeChild(b)),b.removeEventListener("focus",this._topBoundaryFocusListener),h.removeEventListener("focus",this._bottomBoundaryFocusListener),l===0){let S=this._createAccessibilityTreeNode();this._rowElements.unshift(S),this._rowContainer.insertAdjacentElement("afterbegin",S)}else{let S=this._createAccessibilityTreeNode();this._rowElements.push(S),this._rowContainer.appendChild(S)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(l===0?-1:1),this._rowElements[l===0?1:this._rowElements.length-2].focus(),i.preventDefault(),i.stopImmediatePropagation()}_handleResize(i){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let l=this._rowContainer.children.length;l<this._terminal.rows;l++)this._rowElements[l]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[l]);for(;this._rowElements.length>i;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let i=document.createElement("div");return i.setAttribute("role","listitem"),i.tabIndex=-1,this._refreshRowDimensions(i),i}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let i=0;i<this._terminal.rows;i++)this._refreshRowDimensions(this._rowElements[i])}}_refreshRowDimensions(i){i.style.height=`${this._renderService.dimensions.css.cell.height}px`}};s.AccessibilityManager=t=a([f(1,e.IRenderService)],t)},3614:(E,s)=>{function o(d){return d.replace(/\r?\n/g,"\r")}function a(d,c){return c?"\x1B[200~"+d+"\x1B[201~":d}function f(d,c,p,_){d=a(d=o(d),p.decPrivateModes.bracketedPasteMode&&_.rawOptions.ignoreBracketedPasteMode!==!0),p.triggerDataEvent(d,!0),c.value=""}function n(d,c,p){let _=p.getBoundingClientRect(),e=d.clientX-_.left-10,r=d.clientY-_.top-10;c.style.width="20px",c.style.height="20px",c.style.left=`${e}px`,c.style.top=`${r}px`,c.style.zIndex="1000",c.focus()}Object.defineProperty(s,"__esModule",{value:!0}),s.rightClickHandler=s.moveTextAreaUnderMouseCursor=s.paste=s.handlePasteEvent=s.copyHandler=s.bracketTextForPaste=s.prepareTextForTerminal=void 0,s.prepareTextForTerminal=o,s.bracketTextForPaste=a,s.copyHandler=function(d,c){d.clipboardData&&d.clipboardData.setData("text/plain",c.selectionText),d.preventDefault()},s.handlePasteEvent=function(d,c,p,_){d.stopPropagation(),d.clipboardData&&f(d.clipboardData.getData("text/plain"),c,p,_)},s.paste=f,s.moveTextAreaUnderMouseCursor=n,s.rightClickHandler=function(d,c,p,_,e){n(d,c,p),e&&_.rightClickSelect(d),c.value=_.selectionText,c.select()}},7239:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorContrastCache=void 0;let a=o(1505);s.ColorContrastCache=class{constructor(){this._color=new a.TwoKeyMap,this._css=new a.TwoKeyMap}setCss(f,n,d){this._css.set(f,n,d)}getCss(f,n){return this._css.get(f,n)}setColor(f,n,d){this._color.set(f,n,d)}getColor(f,n){return this._color.get(f,n)}clear(){this._color.clear(),this._css.clear()}}},3656:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.addDisposableDomListener=void 0,s.addDisposableDomListener=function(o,a,f,n){o.addEventListener(a,f,n);let d=!1;return{dispose:()=>{d||(d=!0,o.removeEventListener(a,f,n))}}}},6465:function(E,s,o){var a=this&&this.__decorate||function(e,r,t,i){var l,u=arguments.length,m=u<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(e,r,t,i);else for(var b=e.length-1;b>=0;b--)(l=e[b])&&(m=(u<3?l(m):u>3?l(r,t,m):l(r,t))||m);return u>3&&m&&Object.defineProperty(r,t,m),m},f=this&&this.__param||function(e,r){return function(t,i){r(t,i,e)}};Object.defineProperty(s,"__esModule",{value:!0}),s.Linkifier2=void 0;let n=o(3656),d=o(8460),c=o(844),p=o(2585),_=s.Linkifier2=class extends c.Disposable{get currentLink(){return this._currentLink}constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new d.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new d.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,c.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,c.toDisposable)(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{let r=this._linkProviders.indexOf(e);r!==-1&&this._linkProviders.splice(r,1)}}}attachToDom(e,r,t){this._element=e,this._mouseService=r,this._renderService=t,this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;let r=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!r)return;this._isMouseOut=!1;let t=e.composedPath();for(let i=0;i<t.length;i++){let l=t[i];if(l.classList.contains("xterm"))break;if(l.classList.contains("xterm-hover"))return}this._lastBufferCell&&r.x===this._lastBufferCell.x&&r.y===this._lastBufferCell.y||(this._handleHover(r),this._lastBufferCell=r)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,r){var t,i;this._activeProviderReplies&&r||((t=this._activeProviderReplies)===null||t===void 0||t.forEach(u=>{u?.forEach(m=>{m.link.dispose&&m.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let l=!1;for(let[u,m]of this._linkProviders.entries())r?!((i=this._activeProviderReplies)===null||i===void 0)&&i.get(u)&&(l=this._checkLinkProviderResult(u,e,l)):m.provideLinks(e.y,b=>{var h,S;if(this._isMouseOut)return;let k=b?.map(R=>({link:R}));(h=this._activeProviderReplies)===null||h===void 0||h.set(u,k),l=this._checkLinkProviderResult(u,e,l),((S=this._activeProviderReplies)===null||S===void 0?void 0:S.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,r){let t=new Set;for(let i=0;i<r.size;i++){let l=r.get(i);if(l)for(let u=0;u<l.length;u++){let m=l[u],b=m.link.range.start.y<e?0:m.link.range.start.x,h=m.link.range.end.y>e?this._bufferService.cols:m.link.range.end.x;for(let S=b;S<=h;S++){if(t.has(S)){l.splice(u--,1);break}t.add(S)}}}}_checkLinkProviderResult(e,r,t){var i;if(!this._activeProviderReplies)return t;let l=this._activeProviderReplies.get(e),u=!1;for(let m=0;m<e;m++)this._activeProviderReplies.has(m)&&!this._activeProviderReplies.get(m)||(u=!0);if(!u&&l){let m=l.find(b=>this._linkAtPosition(b.link,r));m&&(t=!0,this._handleNewLink(m))}if(this._activeProviderReplies.size===this._linkProviders.length&&!t)for(let m=0;m<this._activeProviderReplies.size;m++){let b=(i=this._activeProviderReplies.get(m))===null||i===void 0?void 0:i.find(h=>this._linkAtPosition(h.link,r));if(b){t=!0,this._handleNewLink(b);break}}return t}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;let r=this._positionFromMouseEvent(e,this._element,this._mouseService);r&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,r)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,r){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!r||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=r)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,c.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;let r=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);r&&this._linkAtPosition(e.link,r)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0||e.link.decorations.underline,pointerCursor:e.link.decorations===void 0||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var t,i;return(i=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||i===void 0?void 0:i.decorations.pointerCursor},set:t=>{var i,l;!((i=this._currentLink)===null||i===void 0)&&i.state&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&((l=this._element)===null||l===void 0||l.classList.toggle("xterm-cursor-pointer",t)))}},underline:{get:()=>{var t,i;return(i=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||i===void 0?void 0:i.decorations.underline},set:t=>{var i,l,u;!((i=this._currentLink)===null||i===void 0)&&i.state&&((u=(l=this._currentLink)===null||l===void 0?void 0:l.state)===null||u===void 0?void 0:u.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(t=>{if(!this._currentLink)return;let i=t.start===0?0:t.start+1+this._bufferService.buffer.ydisp,l=this._bufferService.buffer.ydisp+1+t.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=l&&(this._clearCurrentLink(i,l),this._lastMouseEvent&&this._element)){let u=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);u&&this._askForLink(u,!1)}})))}_linkHover(e,r,t){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(r,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),r.hover&&r.hover(t,r.text)}_fireUnderlineEvent(e,r){let t=e.range,i=this._bufferService.buffer.ydisp,l=this._createLinkUnderlineEvent(t.start.x-1,t.start.y-i-1,t.end.x,t.end.y-i-1,void 0);(r?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(l)}_linkLeave(e,r,t){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(r,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),r.leave&&r.leave(t,r.text)}_linkAtPosition(e,r){let t=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,l=r.y*this._bufferService.cols+r.x;return t<=l&&l<=i}_positionFromMouseEvent(e,r,t){let i=t.getCoords(e,r,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,r,t,i,l){return{x1:e,y1:r,x2:t,y2:i,cols:this._bufferService.cols,fg:l}}};s.Linkifier2=_=a([f(0,p.IBufferService)],_)},9042:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.tooMuchOutput=s.promptLabel=void 0,s.promptLabel="Terminal input",s.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(E,s,o){var a=this&&this.__decorate||function(_,e,r,t){var i,l=arguments.length,u=l<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,r):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(_,e,r,t);else for(var m=_.length-1;m>=0;m--)(i=_[m])&&(u=(l<3?i(u):l>3?i(e,r,u):i(e,r))||u);return l>3&&u&&Object.defineProperty(e,r,u),u},f=this&&this.__param||function(_,e){return function(r,t){e(r,t,_)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OscLinkProvider=void 0;let n=o(511),d=o(2585),c=s.OscLinkProvider=class{constructor(_,e,r){this._bufferService=_,this._optionsService=e,this._oscLinkService=r}provideLinks(_,e){var r;let t=this._bufferService.buffer.lines.get(_-1);if(!t)return void e(void 0);let i=[],l=this._optionsService.rawOptions.linkHandler,u=new n.CellData,m=t.getTrimmedLength(),b=-1,h=-1,S=!1;for(let k=0;k<m;k++)if(h!==-1||t.hasContent(k)){if(t.loadCell(k,u),u.hasExtendedAttrs()&&u.extended.urlId){if(h===-1){h=k,b=u.extended.urlId;continue}S=u.extended.urlId!==b}else h!==-1&&(S=!0);if(S||h!==-1&&k===m-1){let R=(r=this._oscLinkService.getLinkData(b))===null||r===void 0?void 0:r.uri;if(R){let x={start:{x:h+1,y:_},end:{x:k+(S||k!==m-1?0:1),y:_}},B=!1;if(!l?.allowNonHttpProtocols)try{let P=new URL(R);["http:","https:"].includes(P.protocol)||(B=!0)}catch{B=!0}B||i.push({text:R,range:x,activate:(P,H)=>l?l.activate(P,H,x):p(0,H),hover:(P,H)=>{var W;return(W=l?.hover)===null||W===void 0?void 0:W.call(l,P,H,x)},leave:(P,H)=>{var W;return(W=l?.leave)===null||W===void 0?void 0:W.call(l,P,H,x)}})}S=!1,u.hasExtendedAttrs()&&u.extended.urlId?(h=k,b=u.extended.urlId):(h=-1,b=-1)}}e(i)}};function p(_,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){let r=window.open();if(r){try{r.opener=null}catch{}r.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}s.OscLinkProvider=c=a([f(0,d.IBufferService),f(1,d.IOptionsService),f(2,d.IOscLinkService)],c)},6193:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.RenderDebouncer=void 0,s.RenderDebouncer=class{constructor(o,a){this._parentWindow=o,this._renderCallback=a,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(o){return this._refreshCallbacks.push(o),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(o,a,f){this._rowCount=f,o=o!==void 0?o:0,a=a!==void 0?a:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,a):a,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let o=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,a),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let o of this._refreshCallbacks)o(0);this._refreshCallbacks=[]}}},5596:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ScreenDprMonitor=void 0;let a=o(844);class f extends a.Disposable{constructor(d){super(),this._parentWindow=d,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,a.toDisposable)(()=>{this.clearListener()}))}setListener(d){this._listener&&this.clearListener(),this._listener=d,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var d;this._outerListener&&((d=this._resolutionMediaMatchList)===null||d===void 0||d.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}s.ScreenDprMonitor=f},3236:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Terminal=void 0;let a=o(3614),f=o(3656),n=o(6465),d=o(9042),c=o(3730),p=o(1680),_=o(3107),e=o(5744),r=o(2950),t=o(1296),i=o(428),l=o(4269),u=o(5114),m=o(8934),b=o(3230),h=o(9312),S=o(4725),k=o(6731),R=o(8055),x=o(8969),B=o(8460),P=o(844),H=o(6114),W=o(8437),F=o(2584),C=o(7399),L=o(5941),D=o(9074),T=o(2585),N=o(5435),j=o(4567),q=typeof window<"u"?window.document:null;class K extends x.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(y={}){super(y),this.browser=H,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new P.MutableDisposable),this._onCursorMove=this.register(new B.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new B.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new B.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new B.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new B.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new B.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new B.EventEmitter),this._onBlur=this.register(new B.EventEmitter),this._onA11yCharEmitter=this.register(new B.EventEmitter),this._onA11yTabEmitter=this.register(new B.EventEmitter),this._onWillOpen=this.register(new B.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(n.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(c.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(D.DecorationService),this._instantiationService.setService(T.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((M,O)=>this.refresh(M,O))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(M=>this._reportWindowsOptions(M))),this.register(this._inputHandler.onColor(M=>this._handleColorEvent(M))),this.register((0,B.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,B.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,B.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,B.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(M=>this._afterResize(M.cols,M.rows))),this.register((0,P.toDisposable)(()=>{var M,O;this._customKeyEventHandler=void 0,(O=(M=this.element)===null||M===void 0?void 0:M.parentNode)===null||O===void 0||O.removeChild(this.element)}))}_handleColorEvent(y){if(this._themeService)for(let M of y){let O,I="";switch(M.index){case 256:O="foreground",I="10";break;case 257:O="background",I="11";break;case 258:O="cursor",I="12";break;default:O="ansi",I="4;"+M.index}switch(M.type){case 0:let V=R.color.toColorRGB(O==="ansi"?this._themeService.colors.ansi[M.index]:this._themeService.colors[O]);this.coreService.triggerDataEvent(`${F.C0.ESC}]${I};${(0,L.toRgbString)(V)}${F.C1_ESCAPED.ST}`);break;case 1:if(O==="ansi")this._themeService.modifyColors(U=>U.ansi[M.index]=R.rgba.toColor(...M.color));else{let U=O;this._themeService.modifyColors(X=>X[U]=R.rgba.toColor(...M.color))}break;case 2:this._themeService.restoreColor(M.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(y){y?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(j.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(y){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(F.C0.ESC+"[I"),this.updateCursorStyle(y),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var y;return(y=this.textarea)===null||y===void 0?void 0:y.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(F.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let y=this.buffer.ybase+this.buffer.y,M=this.buffer.lines.get(y);if(!M)return;let O=Math.min(this.buffer.x,this.cols-1),I=this._renderService.dimensions.css.cell.height,V=M.getWidth(O),U=this._renderService.dimensions.css.cell.width*V,X=this.buffer.y*this._renderService.dimensions.css.cell.height,se=O*this._renderService.dimensions.css.cell.width;this.textarea.style.left=se+"px",this.textarea.style.top=X+"px",this.textarea.style.width=U+"px",this.textarea.style.height=I+"px",this.textarea.style.lineHeight=I+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,f.addDisposableDomListener)(this.element,"copy",M=>{this.hasSelection()&&(0,a.copyHandler)(M,this._selectionService)}));let y=M=>(0,a.handlePasteEvent)(M,this.textarea,this.coreService,this.optionsService);this.register((0,f.addDisposableDomListener)(this.textarea,"paste",y)),this.register((0,f.addDisposableDomListener)(this.element,"paste",y)),H.isFirefox?this.register((0,f.addDisposableDomListener)(this.element,"mousedown",M=>{M.button===2&&(0,a.rightClickHandler)(M,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,f.addDisposableDomListener)(this.element,"contextmenu",M=>{(0,a.rightClickHandler)(M,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),H.isLinux&&this.register((0,f.addDisposableDomListener)(this.element,"auxclick",M=>{M.button===1&&(0,a.moveTextAreaUnderMouseCursor)(M,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,f.addDisposableDomListener)(this.textarea,"keyup",y=>this._keyUp(y),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keydown",y=>this._keyDown(y),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keypress",y=>this._keyPress(y),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionupdate",y=>this._compositionHelper.compositionupdate(y))),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,f.addDisposableDomListener)(this.textarea,"input",y=>this._inputEvent(y),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(y){var M;if(!y)throw new Error("Terminal requires a parent element.");y.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=y.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),y.appendChild(this.element);let O=q.createDocumentFragment();this._viewportElement=q.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),O.appendChild(this._viewportElement),this._viewportScrollArea=q.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=q.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=q.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),O.appendChild(this.screenElement),this.textarea=q.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",d.promptLabel),H.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(u.CoreBrowserService,this.textarea,(M=this._document.defaultView)!==null&&M!==void 0?M:window),this._instantiationService.setService(S.ICoreBrowserService,this._coreBrowserService),this.register((0,f.addDisposableDomListener)(this.textarea,"focus",I=>this._handleTextAreaFocus(I))),this.register((0,f.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(i.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(S.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(k.ThemeService),this._instantiationService.setService(S.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(l.CharacterJoinerService),this._instantiationService.setService(S.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(b.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(S.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(I=>this._onRender.fire(I))),this.onResize(I=>this._renderService.resize(I.cols,I.rows)),this._compositionView=q.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(r.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(O);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(m.MouseService),this._instantiationService.setService(S.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(p.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(I=>this.scrollLines(I.amount,I.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(h.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(S.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(I=>this.scrollLines(I.amount,I.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(I=>this._renderService.handleSelectionChanged(I.start,I.end,I.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(I=>{this.textarea.value=I,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(I=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,f.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(_.BufferDecorationRenderer,this.screenElement)),this.register((0,f.addDisposableDomListener)(this.element,"mousedown",I=>this._selectionService.handleMouseDown(I))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(j.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",I=>this._handleScreenReaderModeOptionChange(I))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",I=>{!this._overviewRulerRenderer&&I&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(t.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){let y=this,M=this.element;function O(U){let X=y._mouseService.getMouseReportCoords(U,y.screenElement);if(!X)return!1;let se,re;switch(U.overrideType||U.type){case"mousemove":re=32,U.buttons===void 0?(se=3,U.button!==void 0&&(se=U.button<3?U.button:3)):se=1&U.buttons?0:4&U.buttons?1:2&U.buttons?2:3;break;case"mouseup":re=0,se=U.button<3?U.button:3;break;case"mousedown":re=1,se=U.button<3?U.button:3;break;case"wheel":if(y.viewport.getLinesScrolled(U)===0)return!1;re=U.deltaY<0?0:1,se=4;break;default:return!1}return!(re===void 0||se===void 0||se>4)&&y.coreMouseService.triggerMouseEvent({col:X.col,row:X.row,x:X.x,y:X.y,button:se,action:re,ctrl:U.ctrlKey,alt:U.altKey,shift:U.shiftKey})}let I={mouseup:null,wheel:null,mousedrag:null,mousemove:null},V={mouseup:U=>(O(U),U.buttons||(this._document.removeEventListener("mouseup",I.mouseup),I.mousedrag&&this._document.removeEventListener("mousemove",I.mousedrag)),this.cancel(U)),wheel:U=>(O(U),this.cancel(U,!0)),mousedrag:U=>{U.buttons&&O(U)},mousemove:U=>{U.buttons||O(U)}};this.register(this.coreMouseService.onProtocolChange(U=>{U?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(U)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&U?I.mousemove||(M.addEventListener("mousemove",V.mousemove),I.mousemove=V.mousemove):(M.removeEventListener("mousemove",I.mousemove),I.mousemove=null),16&U?I.wheel||(M.addEventListener("wheel",V.wheel,{passive:!1}),I.wheel=V.wheel):(M.removeEventListener("wheel",I.wheel),I.wheel=null),2&U?I.mouseup||(M.addEventListener("mouseup",V.mouseup),I.mouseup=V.mouseup):(this._document.removeEventListener("mouseup",I.mouseup),M.removeEventListener("mouseup",I.mouseup),I.mouseup=null),4&U?I.mousedrag||(I.mousedrag=V.mousedrag):(this._document.removeEventListener("mousemove",I.mousedrag),I.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,f.addDisposableDomListener)(M,"mousedown",U=>{if(U.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(U))return O(U),I.mouseup&&this._document.addEventListener("mouseup",I.mouseup),I.mousedrag&&this._document.addEventListener("mousemove",I.mousedrag),this.cancel(U)})),this.register((0,f.addDisposableDomListener)(M,"wheel",U=>{if(!I.wheel){if(!this.buffer.hasScrollback){let X=this.viewport.getLinesScrolled(U);if(X===0)return;let se=F.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(U.deltaY<0?"A":"B"),re="";for(let fe=0;fe<Math.abs(X);fe++)re+=se;return this.coreService.triggerDataEvent(re,!0),this.cancel(U,!0)}return this.viewport.handleWheel(U)?this.cancel(U):void 0}},{passive:!1})),this.register((0,f.addDisposableDomListener)(M,"touchstart",U=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(U),this.cancel(U)},{passive:!0})),this.register((0,f.addDisposableDomListener)(M,"touchmove",U=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(U)?void 0:this.cancel(U)},{passive:!1}))}refresh(y,M){var O;(O=this._renderService)===null||O===void 0||O.refreshRows(y,M)}updateCursorStyle(y){var M;!((M=this._selectionService)===null||M===void 0)&&M.shouldColumnSelect(y)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(y,M,O=0){var I;O===1?(super.scrollLines(y,M,O),this.refresh(0,this.rows-1)):(I=this.viewport)===null||I===void 0||I.scrollLines(y)}paste(y){(0,a.paste)(y,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(y){this._customKeyEventHandler=y}registerLinkProvider(y){return this.linkifier2.registerLinkProvider(y)}registerCharacterJoiner(y){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let M=this._characterJoinerService.register(y);return this.refresh(0,this.rows-1),M}deregisterCharacterJoiner(y){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(y)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(y){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+y)}registerDecoration(y){return this._decorationService.registerDecoration(y)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(y,M,O){this._selectionService.setSelection(y,M,O)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var y;(y=this._selectionService)===null||y===void 0||y.clearSelection()}selectAll(){var y;(y=this._selectionService)===null||y===void 0||y.selectAll()}selectLines(y,M){var O;(O=this._selectionService)===null||O===void 0||O.selectLines(y,M)}_keyDown(y){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(y)===!1)return!1;let M=this.browser.isMac&&this.options.macOptionIsMeta&&y.altKey;if(!M&&!this._compositionHelper.keydown(y))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;M||y.key!=="Dead"&&y.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let O=(0,C.evaluateKeyboardEvent)(y,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(y),O.type===3||O.type===2){let I=this.rows-1;return this.scrollLines(O.type===2?-I:I),this.cancel(y,!0)}return O.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,y)||(O.cancel&&this.cancel(y,!0),!O.key||!!(y.key&&!y.ctrlKey&&!y.altKey&&!y.metaKey&&y.key.length===1&&y.key.charCodeAt(0)>=65&&y.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(O.key!==F.C0.ETX&&O.key!==F.C0.CR||(this.textarea.value=""),this._onKey.fire({key:O.key,domEvent:y}),this._showCursor(),this.coreService.triggerDataEvent(O.key,!0),!this.optionsService.rawOptions.screenReaderMode||y.altKey||y.ctrlKey?this.cancel(y,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(y,M){let O=y.isMac&&!this.options.macOptionIsMeta&&M.altKey&&!M.ctrlKey&&!M.metaKey||y.isWindows&&M.altKey&&M.ctrlKey&&!M.metaKey||y.isWindows&&M.getModifierState("AltGraph");return M.type==="keypress"?O:O&&(!M.keyCode||M.keyCode>47)}_keyUp(y){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(y)===!1||(function(M){return M.keyCode===16||M.keyCode===17||M.keyCode===18}(y)||this.focus(),this.updateCursorStyle(y),this._keyPressHandled=!1)}_keyPress(y){let M;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(y)===!1)return!1;if(this.cancel(y),y.charCode)M=y.charCode;else if(y.which===null||y.which===void 0)M=y.keyCode;else{if(y.which===0||y.charCode===0)return!1;M=y.which}return!(!M||(y.altKey||y.ctrlKey||y.metaKey)&&!this._isThirdLevelShift(this.browser,y)||(M=String.fromCharCode(M),this._onKey.fire({key:M,domEvent:y}),this._showCursor(),this.coreService.triggerDataEvent(M,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(y){if(y.data&&y.inputType==="insertText"&&(!y.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let M=y.data;return this.coreService.triggerDataEvent(M,!0),this.cancel(y),!0}return!1}resize(y,M){y!==this.cols||M!==this.rows?super.resize(y,M):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(y,M){var O,I;(O=this._charSizeService)===null||O===void 0||O.measure(),(I=this.viewport)===null||I===void 0||I.syncScrollArea(!0)}clear(){var y;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let M=1;M<this.rows;M++)this.buffer.lines.push(this.buffer.getBlankLine(W.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(y=this.viewport)===null||y===void 0||y.reset(),this.refresh(0,this.rows-1)}}reset(){var y,M;this.options.rows=this.rows,this.options.cols=this.cols;let O=this._customKeyEventHandler;this._setup(),super.reset(),(y=this._selectionService)===null||y===void 0||y.reset(),this._decorationService.reset(),(M=this.viewport)===null||M===void 0||M.reset(),this._customKeyEventHandler=O,this.refresh(0,this.rows-1)}clearTextureAtlas(){var y;(y=this._renderService)===null||y===void 0||y.clearTextureAtlas()}_reportFocus(){var y;!((y=this.element)===null||y===void 0)&&y.classList.contains("focus")?this.coreService.triggerDataEvent(F.C0.ESC+"[I"):this.coreService.triggerDataEvent(F.C0.ESC+"[O")}_reportWindowsOptions(y){if(this._renderService)switch(y){case N.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let M=this._renderService.dimensions.css.canvas.width.toFixed(0),O=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${F.C0.ESC}[4;${O};${M}t`);break;case N.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let I=this._renderService.dimensions.css.cell.width.toFixed(0),V=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${F.C0.ESC}[6;${V};${I}t`)}}cancel(y,M){if(this.options.cancelEvents||M)return y.preventDefault(),y.stopPropagation(),!1}}s.Terminal=K},9924:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TimeBasedDebouncer=void 0,s.TimeBasedDebouncer=class{constructor(o,a=1e3){this._renderCallback=o,this._debounceThresholdMS=a,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(o,a,f){this._rowCount=f,o=o!==void 0?o:0,a=a!==void 0?a:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,a):a;let n=Date.now();if(n-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=n,this._innerRefresh();else if(!this._additionalRefreshRequested){let d=n-this._lastRefreshMs,c=this._debounceThresholdMS-d;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},c)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let o=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,a)}}},1680:function(E,s,o){var a=this&&this.__decorate||function(r,t,i,l){var u,m=arguments.length,b=m<3?t:l===null?l=Object.getOwnPropertyDescriptor(t,i):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(r,t,i,l);else for(var h=r.length-1;h>=0;h--)(u=r[h])&&(b=(m<3?u(b):m>3?u(t,i,b):u(t,i))||b);return m>3&&b&&Object.defineProperty(t,i,b),b},f=this&&this.__param||function(r,t){return function(i,l){t(i,l,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.Viewport=void 0;let n=o(3656),d=o(4725),c=o(8460),p=o(844),_=o(2585),e=s.Viewport=class extends p.Disposable{constructor(r,t,i,l,u,m,b,h){super(),this._viewportElement=r,this._scrollArea=t,this._bufferService=i,this._optionsService=l,this._charSizeService=u,this._renderService=m,this._coreBrowserService=b,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new c.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,n.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(S=>this._activeBuffer=S.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(S=>this._renderDimensions=S)),this._handleThemeChange(h.colors),this.register(h.onChangeColors(S=>this._handleThemeChange(S))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(r){this._viewportElement.style.backgroundColor=r.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(r){if(r)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let t=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==t&&(this._lastRecordedBufferHeight=t,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let r=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==r&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=r),this._refreshAnimationFrame=null}syncScrollArea(r=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(r);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(r)}_handleScroll(r){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});let t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let r=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(r*(this._smoothScrollState.target-this._smoothScrollState.origin)),r<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(r,t){let i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&this._viewportElement.scrollTop!==0||t>0&&i<this._lastRecordedBufferHeight)||(r.cancelable&&r.preventDefault(),!1)}handleWheel(r){let t=this._getPixelsScrolled(r);return t!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(r,t))}scrollLines(r){if(r!==0)if(this._optionsService.rawOptions.smoothScrollDuration){let t=r*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:r,suppressScrollEvent:!1})}_getPixelsScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let t=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(r,t){var i;let l,u="",m=[],b=t??this._bufferService.buffer.lines.length,h=this._bufferService.buffer.lines;for(let S=r;S<b;S++){let k=h.get(S);if(!k)continue;let R=(i=h.get(S+1))===null||i===void 0?void 0:i.isWrapped;if(u+=k.translateToString(!R),!R||S===h.length-1){let x=document.createElement("div");x.textContent=u,m.push(x),u.length>0&&(l=x),u=""}}return{bufferElements:m,cursorElement:l}}getLinesScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let t=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(r,t){let i=this._optionsService.rawOptions.fastScrollModifier;return i==="alt"&&t.altKey||i==="ctrl"&&t.ctrlKey||i==="shift"&&t.shiftKey?r*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:r*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(r){this._lastTouchY=r.touches[0].pageY}handleTouchMove(r){let t=this._lastTouchY-r.touches[0].pageY;return this._lastTouchY=r.touches[0].pageY,t!==0&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(r,t))}};s.Viewport=e=a([f(2,_.IBufferService),f(3,_.IOptionsService),f(4,d.ICharSizeService),f(5,d.IRenderService),f(6,d.ICoreBrowserService),f(7,d.IThemeService)],e)},3107:function(E,s,o){var a=this&&this.__decorate||function(e,r,t,i){var l,u=arguments.length,m=u<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(e,r,t,i);else for(var b=e.length-1;b>=0;b--)(l=e[b])&&(m=(u<3?l(m):u>3?l(r,t,m):l(r,t))||m);return u>3&&m&&Object.defineProperty(r,t,m),m},f=this&&this.__param||function(e,r){return function(t,i){r(t,i,e)}};Object.defineProperty(s,"__esModule",{value:!0}),s.BufferDecorationRenderer=void 0;let n=o(3656),d=o(4725),c=o(844),p=o(2585),_=s.BufferDecorationRenderer=class extends c.Disposable{constructor(e,r,t,i){super(),this._screenElement=e,this._bufferService=r,this._decorationService=t,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,n.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(l=>this._removeDecoration(l))),this.register((0,c.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var r,t;let i=document.createElement("div");i.classList.add("xterm-decoration"),i.classList.toggle("xterm-decoration-top-layer",((r=e?.options)===null||r===void 0?void 0:r.layer)==="top"),i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",i.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let l=(t=e.options.x)!==null&&t!==void 0?t:0;return l&&l>this._bufferService.cols&&(i.style.display="none"),this._refreshXPosition(e,i),i}_refreshStyle(e){let r=e.marker.line-this._bufferService.buffers.active.ydisp;if(r<0||r>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let t=this._decorationElements.get(e);t||(t=this._createElement(e),e.element=t,this._decorationElements.set(e,t),this._container.appendChild(t),e.onDispose(()=>{this._decorationElements.delete(e),t.remove()})),t.style.top=r*this._renderService.dimensions.css.cell.height+"px",t.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(t)}}_refreshXPosition(e,r=e.element){var t;if(!r)return;let i=(t=e.options.x)!==null&&t!==void 0?t:0;(e.options.anchor||"left")==="right"?r.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":r.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var r;(r=this._decorationElements.get(e))===null||r===void 0||r.remove(),this._decorationElements.delete(e),e.dispose()}};s.BufferDecorationRenderer=_=a([f(1,p.IBufferService),f(2,p.IDecorationService),f(3,d.IRenderService)],_)},5871:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorZoneStore=void 0,s.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(o){if(o.options.overviewRulerOptions){for(let a of this._zones)if(a.color===o.options.overviewRulerOptions.color&&a.position===o.options.overviewRulerOptions.position){if(this._lineIntersectsZone(a,o.marker.line))return;if(this._lineAdjacentToZone(a,o.marker.line,o.options.overviewRulerOptions.position))return void this._addLineToZone(a,o.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=o.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=o.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=o.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=o.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:o.options.overviewRulerOptions.color,position:o.options.overviewRulerOptions.position,startBufferLine:o.marker.line,endBufferLine:o.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(o){this._linePadding=o}_lineIntersectsZone(o,a){return a>=o.startBufferLine&&a<=o.endBufferLine}_lineAdjacentToZone(o,a,f){return a>=o.startBufferLine-this._linePadding[f||"full"]&&a<=o.endBufferLine+this._linePadding[f||"full"]}_addLineToZone(o,a){o.startBufferLine=Math.min(o.startBufferLine,a),o.endBufferLine=Math.max(o.endBufferLine,a)}}},5744:function(E,s,o){var a=this&&this.__decorate||function(l,u,m,b){var h,S=arguments.length,k=S<3?u:b===null?b=Object.getOwnPropertyDescriptor(u,m):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(l,u,m,b);else for(var R=l.length-1;R>=0;R--)(h=l[R])&&(k=(S<3?h(k):S>3?h(u,m,k):h(u,m))||k);return S>3&&k&&Object.defineProperty(u,m,k),k},f=this&&this.__param||function(l,u){return function(m,b){u(m,b,l)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OverviewRulerRenderer=void 0;let n=o(5871),d=o(3656),c=o(4725),p=o(844),_=o(2585),e={full:0,left:0,center:0,right:0},r={full:0,left:0,center:0,right:0},t={full:0,left:0,center:0,right:0},i=s.OverviewRulerRenderer=class extends p.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(l,u,m,b,h,S,k){var R;super(),this._viewportElement=l,this._screenElement=u,this._bufferService=m,this._decorationService=b,this._renderService=h,this._optionsService=S,this._coreBrowseService=k,this._colorZoneStore=new n.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(R=this._viewportElement.parentElement)===null||R===void 0||R.insertBefore(this._canvas,this._viewportElement);let x=this._canvas.getContext("2d");if(!x)throw new Error("Ctx cannot be null");this._ctx=x,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,p.toDisposable)(()=>{var B;(B=this._canvas)===null||B===void 0||B.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,d.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let l=Math.floor(this._canvas.width/3),u=Math.ceil(this._canvas.width/3);r.full=this._canvas.width,r.left=l,r.center=u,r.right=l,this._refreshDrawHeightConstants(),t.full=0,t.left=0,t.center=r.left,t.right=r.left+r.center}_refreshDrawHeightConstants(){e.full=Math.round(2*this._coreBrowseService.dpr);let l=this._canvas.height/this._bufferService.buffer.lines.length,u=Math.round(Math.max(Math.min(l,12),6)*this._coreBrowseService.dpr);e.left=u,e.center=u,e.right=u}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let u of this._decorationService.decorations)this._colorZoneStore.addDecoration(u);this._ctx.lineWidth=1;let l=this._colorZoneStore.zones;for(let u of l)u.position!=="full"&&this._renderColorZone(u);for(let u of l)u.position==="full"&&this._renderColorZone(u);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(l){this._ctx.fillStyle=l.color,this._ctx.fillRect(t[l.position||"full"],Math.round((this._canvas.height-1)*(l.startBufferLine/this._bufferService.buffers.active.lines.length)-e[l.position||"full"]/2),r[l.position||"full"],Math.round((this._canvas.height-1)*((l.endBufferLine-l.startBufferLine)/this._bufferService.buffers.active.lines.length)+e[l.position||"full"]))}_queueRefresh(l,u){this._shouldUpdateDimensions=l||this._shouldUpdateDimensions,this._shouldUpdateAnchor=u||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};s.OverviewRulerRenderer=i=a([f(2,_.IBufferService),f(3,_.IDecorationService),f(4,c.IRenderService),f(5,_.IOptionsService),f(6,c.ICoreBrowserService)],i)},2950:function(E,s,o){var a=this&&this.__decorate||function(_,e,r,t){var i,l=arguments.length,u=l<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,r):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(_,e,r,t);else for(var m=_.length-1;m>=0;m--)(i=_[m])&&(u=(l<3?i(u):l>3?i(e,r,u):i(e,r))||u);return l>3&&u&&Object.defineProperty(e,r,u),u},f=this&&this.__param||function(_,e){return function(r,t){e(r,t,_)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CompositionHelper=void 0;let n=o(4725),d=o(2585),c=o(2584),p=s.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(_,e,r,t,i,l){this._textarea=_,this._compositionView=e,this._bufferService=r,this._optionsService=t,this._coreService=i,this._renderService=l,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(_){this._compositionView.textContent=_.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(_){if(this._isComposing||this._isSendingComposition){if(_.keyCode===229||_.keyCode===16||_.keyCode===17||_.keyCode===18)return!1;this._finalizeComposition(!1)}return _.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(_){if(this._compositionView.classList.remove("active"),this._isComposing=!1,_){let e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let r;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,r=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),r.length>0&&this._coreService.triggerDataEvent(r,!0)}},0)}else{this._isSendingComposition=!1;let e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){let _=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let e=this._textarea.value,r=e.replace(_,"");this._dataAlreadySent=r,e.length>_.length?this._coreService.triggerDataEvent(r,!0):e.length<_.length?this._coreService.triggerDataEvent(`${c.C0.DEL}`,!0):e.length===_.length&&e!==_&&this._coreService.triggerDataEvent(e,!0)}},0)}updateCompositionElements(_){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),r=this._renderService.dimensions.css.cell.height,t=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=t+"px",this._compositionView.style.height=r+"px",this._compositionView.style.lineHeight=r+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let l=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=t+"px",this._textarea.style.width=Math.max(l.width,1)+"px",this._textarea.style.height=Math.max(l.height,1)+"px",this._textarea.style.lineHeight=l.height+"px"}_||setTimeout(()=>this.updateCompositionElements(!0),0)}}};s.CompositionHelper=p=a([f(2,d.IBufferService),f(3,d.IOptionsService),f(4,d.ICoreService),f(5,n.IRenderService)],p)},9806:(E,s)=>{function o(a,f,n){let d=n.getBoundingClientRect(),c=a.getComputedStyle(n),p=parseInt(c.getPropertyValue("padding-left")),_=parseInt(c.getPropertyValue("padding-top"));return[f.clientX-d.left-p,f.clientY-d.top-_]}Object.defineProperty(s,"__esModule",{value:!0}),s.getCoords=s.getCoordsRelativeToElement=void 0,s.getCoordsRelativeToElement=o,s.getCoords=function(a,f,n,d,c,p,_,e,r){if(!p)return;let t=o(a,f,n);return t?(t[0]=Math.ceil((t[0]+(r?_/2:0))/_),t[1]=Math.ceil(t[1]/e),t[0]=Math.min(Math.max(t[0],1),d+(r?1:0)),t[1]=Math.min(Math.max(t[1],1),c),t):void 0}},9504:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.moveToCellSequence=void 0;let a=o(2584);function f(e,r,t,i){let l=e-n(e,t),u=r-n(r,t),m=Math.abs(l-u)-function(b,h,S){let k=0,R=b-n(b,S),x=h-n(h,S);for(let B=0;B<Math.abs(R-x);B++){let P=d(b,h)==="A"?-1:1,H=S.buffer.lines.get(R+P*B);H?.isWrapped&&k++}return k}(e,r,t);return _(m,p(d(e,r),i))}function n(e,r){let t=0,i=r.buffer.lines.get(e),l=i?.isWrapped;for(;l&&e>=0&&e<r.rows;)t++,i=r.buffer.lines.get(--e),l=i?.isWrapped;return t}function d(e,r){return e>r?"A":"B"}function c(e,r,t,i,l,u){let m=e,b=r,h="";for(;m!==t||b!==i;)m+=l?1:-1,l&&m>u.cols-1?(h+=u.buffer.translateBufferLineToString(b,!1,e,m),m=0,e=0,b++):!l&&m<0&&(h+=u.buffer.translateBufferLineToString(b,!1,0,e+1),m=u.cols-1,e=m,b--);return h+u.buffer.translateBufferLineToString(b,!1,e,m)}function p(e,r){let t=r?"O":"[";return a.C0.ESC+t+e}function _(e,r){e=Math.floor(e);let t="";for(let i=0;i<e;i++)t+=r;return t}s.moveToCellSequence=function(e,r,t,i){let l=t.buffer.x,u=t.buffer.y;if(!t.buffer.hasScrollback)return function(h,S,k,R,x,B){return f(S,R,x,B).length===0?"":_(c(h,S,h,S-n(S,x),!1,x).length,p("D",B))}(l,u,0,r,t,i)+f(u,r,t,i)+function(h,S,k,R,x,B){let P;P=f(S,R,x,B).length>0?R-n(R,x):S;let H=R,W=function(F,C,L,D,T,N){let j;return j=f(L,D,T,N).length>0?D-n(D,T):C,F<L&&j<=D||F>=L&&j<D?"C":"D"}(h,S,k,R,x,B);return _(c(h,P,k,H,W==="C",x).length,p(W,B))}(l,u,e,r,t,i);let m;if(u===r)return m=l>e?"D":"C",_(Math.abs(l-e),p(m,i));m=u>r?"D":"C";let b=Math.abs(u-r);return _(function(h,S){return S.cols-h}(u>r?e:l,t)+(b-1)*t.cols+1+((u>r?l:e)-1),p(m,i))}},1296:function(E,s,o){var a=this&&this.__decorate||function(x,B,P,H){var W,F=arguments.length,C=F<3?B:H===null?H=Object.getOwnPropertyDescriptor(B,P):H;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(x,B,P,H);else for(var L=x.length-1;L>=0;L--)(W=x[L])&&(C=(F<3?W(C):F>3?W(B,P,C):W(B,P))||C);return F>3&&C&&Object.defineProperty(B,P,C),C},f=this&&this.__param||function(x,B){return function(P,H){B(P,H,x)}};Object.defineProperty(s,"__esModule",{value:!0}),s.DomRenderer=void 0;let n=o(3787),d=o(2550),c=o(2223),p=o(6171),_=o(4725),e=o(8055),r=o(8460),t=o(844),i=o(2585),l="xterm-dom-renderer-owner-",u="xterm-rows",m="xterm-fg-",b="xterm-bg-",h="xterm-focus",S="xterm-selection",k=1,R=s.DomRenderer=class extends t.Disposable{constructor(x,B,P,H,W,F,C,L,D,T){super(),this._element=x,this._screenElement=B,this._viewportElement=P,this._linkifier2=H,this._charSizeService=F,this._optionsService=C,this._bufferService=L,this._coreBrowserService=D,this._themeService=T,this._terminalClass=k++,this._rowElements=[],this.onRequestRedraw=this.register(new r.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(u),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(S),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,p.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(N=>this._injectCss(N))),this._injectCss(this._themeService.colors),this._rowFactory=W.createInstance(n.DomRendererRowFactory,document),this._element.classList.add(l+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(N=>this._handleLinkHover(N))),this.register(this._linkifier2.onHideLinkUnderline(N=>this._handleLinkLeave(N))),this.register((0,t.toDisposable)(()=>{this._element.classList.remove(l+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new d.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let x=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*x,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*x),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/x),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/x),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let P of this._rowElements)P.style.width=`${this.dimensions.css.canvas.width}px`,P.style.height=`${this.dimensions.css.cell.height}px`,P.style.lineHeight=`${this.dimensions.css.cell.height}px`,P.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let B=`${this._terminalSelector} .${u} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=B,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(x){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let B=`${this._terminalSelector} .${u} { color: ${x.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;B+=`${this._terminalSelector} .${u} .xterm-dim { color: ${e.color.multiplyOpacity(x.foreground,.5).css};}`,B+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,B+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",B+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${x.cursor.css};  color: ${x.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${x.cursor.css}; }}`,B+=`${this._terminalSelector} .${u}.${h} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${u}.${h} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-block { background-color: ${x.cursor.css}; color: ${x.cursorAccent.css};}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${x.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${x.cursor.css} inset;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${x.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,B+=`${this._terminalSelector} .${S} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${S} div { position: absolute; background-color: ${x.selectionBackgroundOpaque.css};}${this._terminalSelector} .${S} div { position: absolute; background-color: ${x.selectionInactiveBackgroundOpaque.css};}`;for(let[P,H]of x.ansi.entries())B+=`${this._terminalSelector} .${m}${P} { color: ${H.css}; }${this._terminalSelector} .${m}${P}.xterm-dim { color: ${e.color.multiplyOpacity(H,.5).css}; }${this._terminalSelector} .${b}${P} { background-color: ${H.css}; }`;B+=`${this._terminalSelector} .${m}${c.INVERTED_DEFAULT_COLOR} { color: ${e.color.opaque(x.background).css}; }${this._terminalSelector} .${m}${c.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${e.color.multiplyOpacity(e.color.opaque(x.background),.5).css}; }${this._terminalSelector} .${b}${c.INVERTED_DEFAULT_COLOR} { background-color: ${x.foreground.css}; }`,this._themeStyleElement.textContent=B}_setDefaultSpacing(){let x=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${x}px`,this._rowFactory.defaultSpacing=x}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(x,B){for(let P=this._rowElements.length;P<=B;P++){let H=document.createElement("div");this._rowContainer.appendChild(H),this._rowElements.push(H)}for(;this._rowElements.length>B;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(x,B){this._refreshRowElements(x,B),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(h)}handleFocus(){this._rowContainer.classList.add(h),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(x,B,P){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(x,B,P),this.renderRows(0,this._bufferService.rows-1),!x||!B)return;let H=x[1]-this._bufferService.buffer.ydisp,W=B[1]-this._bufferService.buffer.ydisp,F=Math.max(H,0),C=Math.min(W,this._bufferService.rows-1);if(F>=this._bufferService.rows||C<0)return;let L=document.createDocumentFragment();if(P){let D=x[0]>B[0];L.appendChild(this._createSelectionElement(F,D?B[0]:x[0],D?x[0]:B[0],C-F+1))}else{let D=H===F?x[0]:0,T=F===W?B[0]:this._bufferService.cols;L.appendChild(this._createSelectionElement(F,D,T));let N=C-F-1;if(L.appendChild(this._createSelectionElement(F+1,0,this._bufferService.cols,N)),F!==C){let j=W===C?B[0]:this._bufferService.cols;L.appendChild(this._createSelectionElement(C,0,j))}}this._selectionContainer.appendChild(L)}_createSelectionElement(x,B,P,H=1){let W=document.createElement("div");return W.style.height=H*this.dimensions.css.cell.height+"px",W.style.top=x*this.dimensions.css.cell.height+"px",W.style.left=B*this.dimensions.css.cell.width+"px",W.style.width=this.dimensions.css.cell.width*(P-B)+"px",W}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let x of this._rowElements)x.replaceChildren()}renderRows(x,B){let P=this._bufferService.buffer,H=P.ybase+P.y,W=Math.min(P.x,this._bufferService.cols-1),F=this._optionsService.rawOptions.cursorBlink,C=this._optionsService.rawOptions.cursorStyle,L=this._optionsService.rawOptions.cursorInactiveStyle;for(let D=x;D<=B;D++){let T=D+P.ydisp,N=this._rowElements[D],j=P.lines.get(T);if(!N||!j)break;N.replaceChildren(...this._rowFactory.createRow(j,T,T===H,C,L,W,F,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${l}${this._terminalClass}`}_handleLinkHover(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!0)}_handleLinkLeave(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!1)}_setCellUnderline(x,B,P,H,W,F){P<0&&(x=0),H<0&&(B=0);let C=this._bufferService.rows-1;P=Math.max(Math.min(P,C),0),H=Math.max(Math.min(H,C),0),W=Math.min(W,this._bufferService.cols);let L=this._bufferService.buffer,D=L.ybase+L.y,T=Math.min(L.x,W-1),N=this._optionsService.rawOptions.cursorBlink,j=this._optionsService.rawOptions.cursorStyle,q=this._optionsService.rawOptions.cursorInactiveStyle;for(let K=P;K<=H;++K){let Q=K+L.ydisp,y=this._rowElements[K],M=L.lines.get(Q);if(!y||!M)break;y.replaceChildren(...this._rowFactory.createRow(M,Q,Q===D,j,q,T,N,this.dimensions.css.cell.width,this._widthCache,F?K===P?x:0:-1,F?(K===H?B:W)-1:-1))}}};s.DomRenderer=R=a([f(4,i.IInstantiationService),f(5,_.ICharSizeService),f(6,i.IOptionsService),f(7,i.IBufferService),f(8,_.ICoreBrowserService),f(9,_.IThemeService)],R)},3787:function(E,s,o){var a=this&&this.__decorate||function(m,b,h,S){var k,R=arguments.length,x=R<3?b:S===null?S=Object.getOwnPropertyDescriptor(b,h):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(m,b,h,S);else for(var B=m.length-1;B>=0;B--)(k=m[B])&&(x=(R<3?k(x):R>3?k(b,h,x):k(b,h))||x);return R>3&&x&&Object.defineProperty(b,h,x),x},f=this&&this.__param||function(m,b){return function(h,S){b(h,S,m)}};Object.defineProperty(s,"__esModule",{value:!0}),s.DomRendererRowFactory=void 0;let n=o(2223),d=o(643),c=o(511),p=o(2585),_=o(8055),e=o(4725),r=o(4269),t=o(6171),i=o(3734),l=s.DomRendererRowFactory=class{constructor(m,b,h,S,k,R,x){this._document=m,this._characterJoinerService=b,this._optionsService=h,this._coreBrowserService=S,this._coreService=k,this._decorationService=R,this._themeService=x,this._workCell=new c.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(m,b,h){this._selectionStart=m,this._selectionEnd=b,this._columnSelectMode=h}createRow(m,b,h,S,k,R,x,B,P,H,W){let F=[],C=this._characterJoinerService.getJoinedCharacters(b),L=this._themeService.colors,D,T=m.getNoBgTrimmedLength();h&&T<R+1&&(T=R+1);let N=0,j="",q=0,K=0,Q=0,y=!1,M=0,O=!1,I=0,V=[],U=H!==-1&&W!==-1;for(let X=0;X<T;X++){m.loadCell(X,this._workCell);let se=this._workCell.getWidth();if(se===0)continue;let re=!1,fe=X,G=this._workCell;if(C.length>0&&X===C[0][0]){re=!0;let ee=C.shift();G=new r.JoinedCellData(this._workCell,m.translateToString(!0,ee[0],ee[1]),ee[1]-ee[0]),fe=ee[1]-1,se=G.getWidth()}let xe=this._isCellInSelection(X,b),ft=h&&X===R,vt=U&&X>=H&&X<=W,pt=!1;this._decorationService.forEachDecorationAtCell(X,b,void 0,ee=>{pt=!0});let Ke=G.getChars()||d.WHITESPACE_CELL_CHAR;if(Ke===" "&&(G.isUnderline()||G.isOverline())&&(Ke="\xA0"),I=se*B-P.get(Ke,G.isBold(),G.isItalic()),D){if(N&&(xe&&O||!xe&&!O&&G.bg===q)&&(xe&&O&&L.selectionForeground||G.fg===K)&&G.extended.ext===Q&&vt===y&&I===M&&!ft&&!re&&!pt){j+=Ke,N++;continue}N&&(D.textContent=j),D=this._document.createElement("span"),N=0,j=""}else D=this._document.createElement("span");if(q=G.bg,K=G.fg,Q=G.extended.ext,y=vt,M=I,O=xe,re&&R>=X&&R<=fe&&(R=X),!this._coreService.isCursorHidden&&ft){if(V.push("xterm-cursor"),this._coreBrowserService.isFocused)x&&V.push("xterm-cursor-blink"),V.push(S==="bar"?"xterm-cursor-bar":S==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(k)switch(k){case"outline":V.push("xterm-cursor-outline");break;case"block":V.push("xterm-cursor-block");break;case"bar":V.push("xterm-cursor-bar");break;case"underline":V.push("xterm-cursor-underline")}}if(G.isBold()&&V.push("xterm-bold"),G.isItalic()&&V.push("xterm-italic"),G.isDim()&&V.push("xterm-dim"),j=G.isInvisible()?d.WHITESPACE_CELL_CHAR:G.getChars()||d.WHITESPACE_CELL_CHAR,G.isUnderline()&&(V.push(`xterm-underline-${G.extended.underlineStyle}`),j===" "&&(j="\xA0"),!G.isUnderlineColorDefault()))if(G.isUnderlineColorRGB())D.style.textDecorationColor=`rgb(${i.AttributeData.toColorRGB(G.getUnderlineColor()).join(",")})`;else{let ee=G.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&G.isBold()&&ee<8&&(ee+=8),D.style.textDecorationColor=L.ansi[ee].css}G.isOverline()&&(V.push("xterm-overline"),j===" "&&(j="\xA0")),G.isStrikethrough()&&V.push("xterm-strikethrough"),vt&&(D.style.textDecoration="underline");let ne=G.getFgColor(),Le=G.getFgColorMode(),oe=G.getBgColor(),De=G.getBgColorMode(),gt=!!G.isInverse();if(gt){let ee=ne;ne=oe,oe=ee;let Ai=Le;Le=De,De=Ai}let le,mt,ce,Be=!1;switch(this._decorationService.forEachDecorationAtCell(X,b,void 0,ee=>{ee.options.layer!=="top"&&Be||(ee.backgroundColorRGB&&(De=50331648,oe=ee.backgroundColorRGB.rgba>>8&16777215,le=ee.backgroundColorRGB),ee.foregroundColorRGB&&(Le=50331648,ne=ee.foregroundColorRGB.rgba>>8&16777215,mt=ee.foregroundColorRGB),Be=ee.options.layer==="top")}),!Be&&xe&&(le=this._coreBrowserService.isFocused?L.selectionBackgroundOpaque:L.selectionInactiveBackgroundOpaque,oe=le.rgba>>8&16777215,De=50331648,Be=!0,L.selectionForeground&&(Le=50331648,ne=L.selectionForeground.rgba>>8&16777215,mt=L.selectionForeground)),Be&&V.push("xterm-decoration-top"),De){case 16777216:case 33554432:ce=L.ansi[oe],V.push(`xterm-bg-${oe}`);break;case 50331648:ce=_.rgba.toColor(oe>>16,oe>>8&255,255&oe),this._addStyle(D,`background-color:#${u((oe>>>0).toString(16),"0",6)}`);break;default:gt?(ce=L.foreground,V.push(`xterm-bg-${n.INVERTED_DEFAULT_COLOR}`)):ce=L.background}switch(le||G.isDim()&&(le=_.color.multiplyOpacity(ce,.5)),Le){case 16777216:case 33554432:G.isBold()&&ne<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ne+=8),this._applyMinimumContrast(D,ce,L.ansi[ne],G,le,void 0)||V.push(`xterm-fg-${ne}`);break;case 50331648:let ee=_.rgba.toColor(ne>>16&255,ne>>8&255,255&ne);this._applyMinimumContrast(D,ce,ee,G,le,mt)||this._addStyle(D,`color:#${u(ne.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(D,ce,L.foreground,G,le,void 0)||gt&&V.push(`xterm-fg-${n.INVERTED_DEFAULT_COLOR}`)}V.length&&(D.className=V.join(" "),V.length=0),ft||re||pt?D.textContent=j:N++,I!==this.defaultSpacing&&(D.style.letterSpacing=`${I}px`),F.push(D),X=fe}return D&&N&&(D.textContent=j),F}_applyMinimumContrast(m,b,h,S,k,R){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,t.excludeFromContrastRatioDemands)(S.getCode()))return!1;let x=this._getContrastCache(S),B;if(k||R||(B=x.getColor(b.rgba,h.rgba)),B===void 0){let P=this._optionsService.rawOptions.minimumContrastRatio/(S.isDim()?2:1);B=_.color.ensureContrastRatio(k||b,R||h,P),x.setColor((k||b).rgba,(R||h).rgba,B??null)}return!!B&&(this._addStyle(m,`color:${B.css}`),!0)}_getContrastCache(m){return m.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(m,b){m.setAttribute("style",`${m.getAttribute("style")||""}${b};`)}_isCellInSelection(m,b){let h=this._selectionStart,S=this._selectionEnd;return!(!h||!S)&&(this._columnSelectMode?h[0]<=S[0]?m>=h[0]&&b>=h[1]&&m<S[0]&&b<=S[1]:m<h[0]&&b>=h[1]&&m>=S[0]&&b<=S[1]:b>h[1]&&b<S[1]||h[1]===S[1]&&b===h[1]&&m>=h[0]&&m<S[0]||h[1]<S[1]&&b===S[1]&&m<S[0]||h[1]<S[1]&&b===h[1]&&m>=h[0])}};function u(m,b,h){for(;m.length<h;)m=b+m;return m}s.DomRendererRowFactory=l=a([f(1,e.ICharacterJoinerService),f(2,p.IOptionsService),f(3,e.ICoreBrowserService),f(4,p.ICoreService),f(5,p.IDecorationService),f(6,e.IThemeService)],l)},2550:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WidthCache=void 0,s.WidthCache=class{constructor(o){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=o.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let a=o.createElement("span"),f=o.createElement("span");f.style.fontWeight="bold";let n=o.createElement("span");n.style.fontStyle="italic";let d=o.createElement("span");d.style.fontWeight="bold",d.style.fontStyle="italic",this._measureElements=[a,f,n,d],this._container.appendChild(a),this._container.appendChild(f),this._container.appendChild(n),this._container.appendChild(d),o.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(o,a,f,n){o===this._font&&a===this._fontSize&&f===this._weight&&n===this._weightBold||(this._font=o,this._fontSize=a,this._weight=f,this._weightBold=n,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${f}`,this._measureElements[1].style.fontWeight=`${n}`,this._measureElements[2].style.fontWeight=`${f}`,this._measureElements[3].style.fontWeight=`${n}`,this.clear())}get(o,a,f){let n=0;if(!a&&!f&&o.length===1&&(n=o.charCodeAt(0))<256)return this._flat[n]!==-9999?this._flat[n]:this._flat[n]=this._measure(o,0);let d=o;a&&(d+="B"),f&&(d+="I");let c=this._holey.get(d);if(c===void 0){let p=0;a&&(p|=1),f&&(p|=2),c=this._measure(o,p),this._holey.set(d,c)}return c}_measure(o,a){let f=this._measureElements[a];return f.textContent=o.repeat(32),f.offsetWidth/32}}},2223:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TEXT_BASELINE=s.DIM_OPACITY=s.INVERTED_DEFAULT_COLOR=void 0;let a=o(6114);s.INVERTED_DEFAULT_COLOR=257,s.DIM_OPACITY=.5,s.TEXT_BASELINE=a.isFirefox||a.isLegacyEdge?"bottom":"ideographic"},6171:(E,s)=>{function o(a){return 57508<=a&&a<=57558}Object.defineProperty(s,"__esModule",{value:!0}),s.createRenderDimensions=s.excludeFromContrastRatioDemands=s.isRestrictedPowerlineGlyph=s.isPowerlineGlyph=s.throwIfFalsy=void 0,s.throwIfFalsy=function(a){if(!a)throw new Error("value must not be falsy");return a},s.isPowerlineGlyph=o,s.isRestrictedPowerlineGlyph=function(a){return 57520<=a&&a<=57527},s.excludeFromContrastRatioDemands=function(a){return o(a)||function(f){return 9472<=f&&f<=9631}(a)},s.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SelectionModel=void 0,s.SelectionModel=class{constructor(o){this._bufferService=o,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?o%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)-1]:[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[o,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[Math.max(o,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let o=this.selectionStart,a=this.selectionEnd;return!(!o||!a)&&(o[1]>a[1]||o[1]===a[1]&&o[0]>a[0])}handleTrim(o){return this.selectionStart&&(this.selectionStart[1]-=o),this.selectionEnd&&(this.selectionEnd[1]-=o),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(E,s,o){var a=this&&this.__decorate||function(e,r,t,i){var l,u=arguments.length,m=u<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(e,r,t,i);else for(var b=e.length-1;b>=0;b--)(l=e[b])&&(m=(u<3?l(m):u>3?l(r,t,m):l(r,t))||m);return u>3&&m&&Object.defineProperty(r,t,m),m},f=this&&this.__param||function(e,r){return function(t,i){r(t,i,e)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CharSizeService=void 0;let n=o(2585),d=o(8460),c=o(844),p=s.CharSizeService=class extends c.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,r,t){super(),this._optionsService=t,this.width=0,this.height=0,this._onCharSizeChange=this.register(new d.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new _(e,r,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){let e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};s.CharSizeService=p=a([f(2,n.IOptionsService)],p);class _{constructor(r,t,i){this._document=r,this._parentElement=t,this._optionsService=i,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;let r={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return r.width!==0&&r.height!==0&&(this._result.width=r.width/32,this._result.height=Math.ceil(r.height)),this._result}}},4269:function(E,s,o){var a=this&&this.__decorate||function(r,t,i,l){var u,m=arguments.length,b=m<3?t:l===null?l=Object.getOwnPropertyDescriptor(t,i):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(r,t,i,l);else for(var h=r.length-1;h>=0;h--)(u=r[h])&&(b=(m<3?u(b):m>3?u(t,i,b):u(t,i))||b);return m>3&&b&&Object.defineProperty(t,i,b),b},f=this&&this.__param||function(r,t){return function(i,l){t(i,l,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CharacterJoinerService=s.JoinedCellData=void 0;let n=o(3734),d=o(643),c=o(511),p=o(2585);class _ extends n.AttributeData{constructor(t,i,l){super(),this.content=0,this.combinedData="",this.fg=t.fg,this.bg=t.bg,this.combinedData=i,this._width=l}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(t){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}s.JoinedCellData=_;let e=s.CharacterJoinerService=class ri{constructor(t){this._bufferService=t,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new c.CellData}register(t){let i={id:this._nextCharacterJoinerId++,handler:t};return this._characterJoiners.push(i),i.id}deregister(t){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===t)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(t){if(this._characterJoiners.length===0)return[];let i=this._bufferService.buffer.lines.get(t);if(!i||i.length===0)return[];let l=[],u=i.translateToString(!0),m=0,b=0,h=0,S=i.getFg(0),k=i.getBg(0);for(let R=0;R<i.getTrimmedLength();R++)if(i.loadCell(R,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==S||this._workCell.bg!==k){if(R-m>1){let x=this._getJoinedRanges(u,h,b,i,m);for(let B=0;B<x.length;B++)l.push(x[B])}m=R,h=b,S=this._workCell.fg,k=this._workCell.bg}b+=this._workCell.getChars().length||d.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-m>1){let R=this._getJoinedRanges(u,h,b,i,m);for(let x=0;x<R.length;x++)l.push(R[x])}return l}_getJoinedRanges(t,i,l,u,m){let b=t.substring(i,l),h=[];try{h=this._characterJoiners[0].handler(b)}catch(S){console.error(S)}for(let S=1;S<this._characterJoiners.length;S++)try{let k=this._characterJoiners[S].handler(b);for(let R=0;R<k.length;R++)ri._mergeRanges(h,k[R])}catch(k){console.error(k)}return this._stringRangesToCellRanges(h,u,m),h}_stringRangesToCellRanges(t,i,l){let u=0,m=!1,b=0,h=t[u];if(h){for(let S=l;S<this._bufferService.cols;S++){let k=i.getWidth(S),R=i.getString(S).length||d.WHITESPACE_CELL_CHAR.length;if(k!==0){if(!m&&h[0]<=b&&(h[0]=S,m=!0),h[1]<=b){if(h[1]=S,h=t[++u],!h)break;h[0]<=b?(h[0]=S,m=!0):m=!1}b+=R}}h&&(h[1]=this._bufferService.cols)}}static _mergeRanges(t,i){let l=!1;for(let u=0;u<t.length;u++){let m=t[u];if(l){if(i[1]<=m[0])return t[u-1][1]=i[1],t;if(i[1]<=m[1])return t[u-1][1]=Math.max(i[1],m[1]),t.splice(u,1),t;t.splice(u,1),u--}else{if(i[1]<=m[0])return t.splice(u,0,i),t;if(i[1]<=m[1])return m[0]=Math.min(i[0],m[0]),t;i[0]<m[1]&&(m[0]=Math.min(i[0],m[0]),l=!0)}}return l?t[t.length-1][1]=i[1]:t.push(i),t}};s.CharacterJoinerService=e=a([f(0,p.IBufferService)],e)},5114:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CoreBrowserService=void 0,s.CoreBrowserService=class{constructor(o,a){this._textarea=o,this.window=a,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(E,s,o){var a=this&&this.__decorate||function(p,_,e,r){var t,i=arguments.length,l=i<3?_:r===null?r=Object.getOwnPropertyDescriptor(_,e):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(p,_,e,r);else for(var u=p.length-1;u>=0;u--)(t=p[u])&&(l=(i<3?t(l):i>3?t(_,e,l):t(_,e))||l);return i>3&&l&&Object.defineProperty(_,e,l),l},f=this&&this.__param||function(p,_){return function(e,r){_(e,r,p)}};Object.defineProperty(s,"__esModule",{value:!0}),s.MouseService=void 0;let n=o(4725),d=o(9806),c=s.MouseService=class{constructor(p,_){this._renderService=p,this._charSizeService=_}getCoords(p,_,e,r,t){return(0,d.getCoords)(window,p,_,e,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,t)}getMouseReportCoords(p,_){let e=(0,d.getCoordsRelativeToElement)(window,p,_);if(this._charSizeService.hasValidSize)return e[0]=Math.min(Math.max(e[0],0),this._renderService.dimensions.css.canvas.width-1),e[1]=Math.min(Math.max(e[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}};s.MouseService=c=a([f(0,n.IRenderService),f(1,n.ICharSizeService)],c)},3230:function(E,s,o){var a=this&&this.__decorate||function(l,u,m,b){var h,S=arguments.length,k=S<3?u:b===null?b=Object.getOwnPropertyDescriptor(u,m):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(l,u,m,b);else for(var R=l.length-1;R>=0;R--)(h=l[R])&&(k=(S<3?h(k):S>3?h(u,m,k):h(u,m))||k);return S>3&&k&&Object.defineProperty(u,m,k),k},f=this&&this.__param||function(l,u){return function(m,b){u(m,b,l)}};Object.defineProperty(s,"__esModule",{value:!0}),s.RenderService=void 0;let n=o(3656),d=o(6193),c=o(5596),p=o(4725),_=o(8460),e=o(844),r=o(7226),t=o(2585),i=s.RenderService=class extends e.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(l,u,m,b,h,S,k,R){if(super(),this._rowCount=l,this._charSizeService=b,this._renderer=this.register(new e.MutableDisposable),this._pausedResizeTask=new r.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new _.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new _.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new _.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new _.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new d.RenderDebouncer(k.window,(x,B)=>this._renderRows(x,B)),this.register(this._renderDebouncer),this._screenDprMonitor=new c.ScreenDprMonitor(k.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(S.onResize(()=>this._fullRefresh())),this.register(S.buffers.onBufferActivate(()=>{var x;return(x=this._renderer.value)===null||x===void 0?void 0:x.clear()})),this.register(m.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(h.onDecorationRegistered(()=>this._fullRefresh())),this.register(h.onDecorationRemoved(()=>this._fullRefresh())),this.register(m.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(S.cols,S.rows),this._fullRefresh()})),this.register(m.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(S.buffer.y,S.buffer.y,!0))),this.register((0,n.addDisposableDomListener)(k.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(R.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in k.window){let x=new k.window.IntersectionObserver(B=>this._handleIntersectionChange(B[B.length-1]),{threshold:0});x.observe(u),this.register({dispose:()=>x.disconnect()})}}_handleIntersectionChange(l){this._isPaused=l.isIntersecting===void 0?l.intersectionRatio===0:!l.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(l,u,m=!1){this._isPaused?this._needsFullRefresh=!0:(m||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(l,u,this._rowCount))}_renderRows(l,u){this._renderer.value&&(l=Math.min(l,this._rowCount-1),u=Math.min(u,this._rowCount-1),this._renderer.value.renderRows(l,u),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:l,end:u}),this._onRender.fire({start:l,end:u}),this._isNextRenderRedrawOnly=!0)}resize(l,u){this._rowCount=u,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(l){this._renderer.value=l,this._renderer.value.onRequestRedraw(u=>this.refreshRows(u.start,u.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(l){return this._renderDebouncer.addRefreshCallback(l)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var l,u;this._renderer.value&&((u=(l=this._renderer.value).clearTextureAtlas)===null||u===void 0||u.call(l),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(l,u){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(l,u)):this._renderer.value.handleResize(l,u),this._fullRefresh())}handleCharSizeChanged(){var l;(l=this._renderer.value)===null||l===void 0||l.handleCharSizeChanged()}handleBlur(){var l;(l=this._renderer.value)===null||l===void 0||l.handleBlur()}handleFocus(){var l;(l=this._renderer.value)===null||l===void 0||l.handleFocus()}handleSelectionChanged(l,u,m){var b;this._selectionState.start=l,this._selectionState.end=u,this._selectionState.columnSelectMode=m,(b=this._renderer.value)===null||b===void 0||b.handleSelectionChanged(l,u,m)}handleCursorMove(){var l;(l=this._renderer.value)===null||l===void 0||l.handleCursorMove()}clear(){var l;(l=this._renderer.value)===null||l===void 0||l.clear()}};s.RenderService=i=a([f(2,t.IOptionsService),f(3,p.ICharSizeService),f(4,t.IDecorationService),f(5,t.IBufferService),f(6,p.ICoreBrowserService),f(7,p.IThemeService)],i)},9312:function(E,s,o){var a=this&&this.__decorate||function(h,S,k,R){var x,B=arguments.length,P=B<3?S:R===null?R=Object.getOwnPropertyDescriptor(S,k):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(h,S,k,R);else for(var H=h.length-1;H>=0;H--)(x=h[H])&&(P=(B<3?x(P):B>3?x(S,k,P):x(S,k))||P);return B>3&&P&&Object.defineProperty(S,k,P),P},f=this&&this.__param||function(h,S){return function(k,R){S(k,R,h)}};Object.defineProperty(s,"__esModule",{value:!0}),s.SelectionService=void 0;let n=o(9806),d=o(9504),c=o(456),p=o(4725),_=o(8460),e=o(844),r=o(6114),t=o(4841),i=o(511),l=o(2585),u="\xA0",m=new RegExp(u,"g"),b=s.SelectionService=class extends e.Disposable{constructor(h,S,k,R,x,B,P,H,W){super(),this._element=h,this._screenElement=S,this._linkifier=k,this._bufferService=R,this._coreService=x,this._mouseService=B,this._optionsService=P,this._renderService=H,this._coreBrowserService=W,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new i.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new _.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new _.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new _.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=F=>this._handleMouseMove(F),this._mouseUpListener=F=>this._handleMouseUp(F),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(F=>this._handleTrim(F)),this.register(this._bufferService.buffers.onBufferActivate(F=>this._handleBufferActivate(F))),this.enable(),this._model=new c.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,e.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let h=this._model.finalSelectionStart,S=this._model.finalSelectionEnd;return!(!h||!S||h[0]===S[0]&&h[1]===S[1])}get selectionText(){let h=this._model.finalSelectionStart,S=this._model.finalSelectionEnd;if(!h||!S)return"";let k=this._bufferService.buffer,R=[];if(this._activeSelectionMode===3){if(h[0]===S[0])return"";let x=h[0]<S[0]?h[0]:S[0],B=h[0]<S[0]?S[0]:h[0];for(let P=h[1];P<=S[1];P++){let H=k.translateBufferLineToString(P,!0,x,B);R.push(H)}}else{let x=h[1]===S[1]?S[0]:void 0;R.push(k.translateBufferLineToString(h[1],!0,h[0],x));for(let B=h[1]+1;B<=S[1]-1;B++){let P=k.lines.get(B),H=k.translateBufferLineToString(B,!0);P?.isWrapped?R[R.length-1]+=H:R.push(H)}if(h[1]!==S[1]){let B=k.lines.get(S[1]),P=k.translateBufferLineToString(S[1],!0,0,S[0]);B&&B.isWrapped?R[R.length-1]+=P:R.push(P)}}return R.map(x=>x.replace(m," ")).join(r.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(h){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),r.isLinux&&h&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(h){let S=this._getMouseBufferCoords(h),k=this._model.finalSelectionStart,R=this._model.finalSelectionEnd;return!!(k&&R&&S)&&this._areCoordsInSelection(S,k,R)}isCellInSelection(h,S){let k=this._model.finalSelectionStart,R=this._model.finalSelectionEnd;return!(!k||!R)&&this._areCoordsInSelection([h,S],k,R)}_areCoordsInSelection(h,S,k){return h[1]>S[1]&&h[1]<k[1]||S[1]===k[1]&&h[1]===S[1]&&h[0]>=S[0]&&h[0]<k[0]||S[1]<k[1]&&h[1]===k[1]&&h[0]<k[0]||S[1]<k[1]&&h[1]===S[1]&&h[0]>=S[0]}_selectWordAtCursor(h,S){var k,R;let x=(R=(k=this._linkifier.currentLink)===null||k===void 0?void 0:k.link)===null||R===void 0?void 0:R.range;if(x)return this._model.selectionStart=[x.start.x-1,x.start.y-1],this._model.selectionStartLength=(0,t.getRangeLength)(x,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let B=this._getMouseBufferCoords(h);return!!B&&(this._selectWordAt(B,S),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(h,S){this._model.clearSelection(),h=Math.max(h,0),S=Math.min(S,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,h],this._model.selectionEnd=[this._bufferService.cols,S],this.refresh(),this._onSelectionChange.fire()}_handleTrim(h){this._model.handleTrim(h)&&this.refresh()}_getMouseBufferCoords(h){let S=this._mouseService.getCoords(h,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(S)return S[0]--,S[1]--,S[1]+=this._bufferService.buffer.ydisp,S}_getMouseEventScrollAmount(h){let S=(0,n.getCoordsRelativeToElement)(this._coreBrowserService.window,h,this._screenElement)[1],k=this._renderService.dimensions.css.canvas.height;return S>=0&&S<=k?0:(S>k&&(S-=k),S=Math.min(Math.max(S,-50),50),S/=50,S/Math.abs(S)+Math.round(14*S))}shouldForceSelection(h){return r.isMac?h.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:h.shiftKey}handleMouseDown(h){if(this._mouseDownTimeStamp=h.timeStamp,(h.button!==2||!this.hasSelection)&&h.button===0){if(!this._enabled){if(!this.shouldForceSelection(h))return;h.stopPropagation()}h.preventDefault(),this._dragScrollAmount=0,this._enabled&&h.shiftKey?this._handleIncrementalClick(h):h.detail===1?this._handleSingleClick(h):h.detail===2?this._handleDoubleClick(h):h.detail===3&&this._handleTripleClick(h),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(h){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(h))}_handleSingleClick(h){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(h)?3:0,this._model.selectionStart=this._getMouseBufferCoords(h),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let S=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);S&&S.length!==this._model.selectionStart[0]&&S.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(h){this._selectWordAtCursor(h,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(h){let S=this._getMouseBufferCoords(h);S&&(this._activeSelectionMode=2,this._selectLineAt(S[1]))}shouldColumnSelect(h){return h.altKey&&!(r.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(h){if(h.stopImmediatePropagation(),!this._model.selectionStart)return;let S=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(h),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(h),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let k=this._bufferService.buffer;if(this._model.selectionEnd[1]<k.lines.length){let R=k.lines.get(this._model.selectionEnd[1]);R&&R.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}S&&S[0]===this._model.selectionEnd[0]&&S[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let h=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(h.ydisp+this._bufferService.rows,h.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=h.ydisp),this.refresh()}}_handleMouseUp(h){let S=h.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&S<500&&h.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let k=this._mouseService.getCoords(h,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(k&&k[0]!==void 0&&k[1]!==void 0){let R=(0,d.moveToCellSequence)(k[0]-1,k[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(R,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let h=this._model.finalSelectionStart,S=this._model.finalSelectionEnd,k=!(!h||!S||h[0]===S[0]&&h[1]===S[1]);k?h&&S&&(this._oldSelectionStart&&this._oldSelectionEnd&&h[0]===this._oldSelectionStart[0]&&h[1]===this._oldSelectionStart[1]&&S[0]===this._oldSelectionEnd[0]&&S[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(h,S,k)):this._oldHasSelection&&this._fireOnSelectionChange(h,S,k)}_fireOnSelectionChange(h,S,k){this._oldSelectionStart=h,this._oldSelectionEnd=S,this._oldHasSelection=k,this._onSelectionChange.fire()}_handleBufferActivate(h){this.clearSelection(),this._trimListener.dispose(),this._trimListener=h.activeBuffer.lines.onTrim(S=>this._handleTrim(S))}_convertViewportColToCharacterIndex(h,S){let k=S;for(let R=0;S>=R;R++){let x=h.loadCell(R,this._workCell).getChars().length;this._workCell.getWidth()===0?k--:x>1&&S!==R&&(k+=x-1)}return k}setSelection(h,S,k){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[h,S],this._model.selectionStartLength=k,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(h){this._isClickInSelection(h)||(this._selectWordAtCursor(h,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(h,S,k=!0,R=!0){if(h[0]>=this._bufferService.cols)return;let x=this._bufferService.buffer,B=x.lines.get(h[1]);if(!B)return;let P=x.translateBufferLineToString(h[1],!1),H=this._convertViewportColToCharacterIndex(B,h[0]),W=H,F=h[0]-H,C=0,L=0,D=0,T=0;if(P.charAt(H)===" "){for(;H>0&&P.charAt(H-1)===" ";)H--;for(;W<P.length&&P.charAt(W+1)===" ";)W++}else{let q=h[0],K=h[0];B.getWidth(q)===0&&(C++,q--),B.getWidth(K)===2&&(L++,K++);let Q=B.getString(K).length;for(Q>1&&(T+=Q-1,W+=Q-1);q>0&&H>0&&!this._isCharWordSeparator(B.loadCell(q-1,this._workCell));){B.loadCell(q-1,this._workCell);let y=this._workCell.getChars().length;this._workCell.getWidth()===0?(C++,q--):y>1&&(D+=y-1,H-=y-1),H--,q--}for(;K<B.length&&W+1<P.length&&!this._isCharWordSeparator(B.loadCell(K+1,this._workCell));){B.loadCell(K+1,this._workCell);let y=this._workCell.getChars().length;this._workCell.getWidth()===2?(L++,K++):y>1&&(T+=y-1,W+=y-1),W++,K++}}W++;let N=H+F-C+D,j=Math.min(this._bufferService.cols,W-H+C+L-D-T);if(S||P.slice(H,W).trim()!==""){if(k&&N===0&&B.getCodePoint(0)!==32){let q=x.lines.get(h[1]-1);if(q&&B.isWrapped&&q.getCodePoint(this._bufferService.cols-1)!==32){let K=this._getWordAt([this._bufferService.cols-1,h[1]-1],!1,!0,!1);if(K){let Q=this._bufferService.cols-K.start;N-=Q,j+=Q}}}if(R&&N+j===this._bufferService.cols&&B.getCodePoint(this._bufferService.cols-1)!==32){let q=x.lines.get(h[1]+1);if(q?.isWrapped&&q.getCodePoint(0)!==32){let K=this._getWordAt([0,h[1]+1],!1,!1,!0);K&&(j+=K.length)}}return{start:N,length:j}}}_selectWordAt(h,S){let k=this._getWordAt(h,S);if(k){for(;k.start<0;)k.start+=this._bufferService.cols,h[1]--;this._model.selectionStart=[k.start,h[1]],this._model.selectionStartLength=k.length}}_selectToWordAt(h){let S=this._getWordAt(h,!0);if(S){let k=h[1];for(;S.start<0;)S.start+=this._bufferService.cols,k--;if(!this._model.areSelectionValuesReversed())for(;S.start+S.length>this._bufferService.cols;)S.length-=this._bufferService.cols,k++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?S.start:S.start+S.length,k]}}_isCharWordSeparator(h){return h.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(h.getChars())>=0}_selectLineAt(h){let S=this._bufferService.buffer.getWrappedRangeForLine(h),k={start:{x:0,y:S.first},end:{x:this._bufferService.cols-1,y:S.last}};this._model.selectionStart=[0,S.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,t.getRangeLength)(k,this._bufferService.cols)}};s.SelectionService=b=a([f(3,l.IBufferService),f(4,l.ICoreService),f(5,p.IMouseService),f(6,l.IOptionsService),f(7,p.IRenderService),f(8,p.ICoreBrowserService)],b)},4725:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.IThemeService=s.ICharacterJoinerService=s.ISelectionService=s.IRenderService=s.IMouseService=s.ICoreBrowserService=s.ICharSizeService=void 0;let a=o(8343);s.ICharSizeService=(0,a.createDecorator)("CharSizeService"),s.ICoreBrowserService=(0,a.createDecorator)("CoreBrowserService"),s.IMouseService=(0,a.createDecorator)("MouseService"),s.IRenderService=(0,a.createDecorator)("RenderService"),s.ISelectionService=(0,a.createDecorator)("SelectionService"),s.ICharacterJoinerService=(0,a.createDecorator)("CharacterJoinerService"),s.IThemeService=(0,a.createDecorator)("ThemeService")},6731:function(E,s,o){var a=this&&this.__decorate||function(b,h,S,k){var R,x=arguments.length,B=x<3?h:k===null?k=Object.getOwnPropertyDescriptor(h,S):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(b,h,S,k);else for(var P=b.length-1;P>=0;P--)(R=b[P])&&(B=(x<3?R(B):x>3?R(h,S,B):R(h,S))||B);return x>3&&B&&Object.defineProperty(h,S,B),B},f=this&&this.__param||function(b,h){return function(S,k){h(S,k,b)}};Object.defineProperty(s,"__esModule",{value:!0}),s.ThemeService=s.DEFAULT_ANSI_COLORS=void 0;let n=o(7239),d=o(8055),c=o(8460),p=o(844),_=o(2585),e=d.css.toColor("#ffffff"),r=d.css.toColor("#000000"),t=d.css.toColor("#ffffff"),i=d.css.toColor("#000000"),l={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};s.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let b=[d.css.toColor("#2e3436"),d.css.toColor("#cc0000"),d.css.toColor("#4e9a06"),d.css.toColor("#c4a000"),d.css.toColor("#3465a4"),d.css.toColor("#75507b"),d.css.toColor("#06989a"),d.css.toColor("#d3d7cf"),d.css.toColor("#555753"),d.css.toColor("#ef2929"),d.css.toColor("#8ae234"),d.css.toColor("#fce94f"),d.css.toColor("#729fcf"),d.css.toColor("#ad7fa8"),d.css.toColor("#34e2e2"),d.css.toColor("#eeeeec")],h=[0,95,135,175,215,255];for(let S=0;S<216;S++){let k=h[S/36%6|0],R=h[S/6%6|0],x=h[S%6];b.push({css:d.channels.toCss(k,R,x),rgba:d.channels.toRgba(k,R,x)})}for(let S=0;S<24;S++){let k=8+10*S;b.push({css:d.channels.toCss(k,k,k),rgba:d.channels.toRgba(k,k,k)})}return b})());let u=s.ThemeService=class extends p.Disposable{get colors(){return this._colors}constructor(b){super(),this._optionsService=b,this._contrastCache=new n.ColorContrastCache,this._halfContrastCache=new n.ColorContrastCache,this._onChangeColors=this.register(new c.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:e,background:r,cursor:t,cursorAccent:i,selectionForeground:void 0,selectionBackgroundTransparent:l,selectionBackgroundOpaque:d.color.blend(r,l),selectionInactiveBackgroundTransparent:l,selectionInactiveBackgroundOpaque:d.color.blend(r,l),ansi:s.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(b={}){let h=this._colors;if(h.foreground=m(b.foreground,e),h.background=m(b.background,r),h.cursor=m(b.cursor,t),h.cursorAccent=m(b.cursorAccent,i),h.selectionBackgroundTransparent=m(b.selectionBackground,l),h.selectionBackgroundOpaque=d.color.blend(h.background,h.selectionBackgroundTransparent),h.selectionInactiveBackgroundTransparent=m(b.selectionInactiveBackground,h.selectionBackgroundTransparent),h.selectionInactiveBackgroundOpaque=d.color.blend(h.background,h.selectionInactiveBackgroundTransparent),h.selectionForeground=b.selectionForeground?m(b.selectionForeground,d.NULL_COLOR):void 0,h.selectionForeground===d.NULL_COLOR&&(h.selectionForeground=void 0),d.color.isOpaque(h.selectionBackgroundTransparent)&&(h.selectionBackgroundTransparent=d.color.opacity(h.selectionBackgroundTransparent,.3)),d.color.isOpaque(h.selectionInactiveBackgroundTransparent)&&(h.selectionInactiveBackgroundTransparent=d.color.opacity(h.selectionInactiveBackgroundTransparent,.3)),h.ansi=s.DEFAULT_ANSI_COLORS.slice(),h.ansi[0]=m(b.black,s.DEFAULT_ANSI_COLORS[0]),h.ansi[1]=m(b.red,s.DEFAULT_ANSI_COLORS[1]),h.ansi[2]=m(b.green,s.DEFAULT_ANSI_COLORS[2]),h.ansi[3]=m(b.yellow,s.DEFAULT_ANSI_COLORS[3]),h.ansi[4]=m(b.blue,s.DEFAULT_ANSI_COLORS[4]),h.ansi[5]=m(b.magenta,s.DEFAULT_ANSI_COLORS[5]),h.ansi[6]=m(b.cyan,s.DEFAULT_ANSI_COLORS[6]),h.ansi[7]=m(b.white,s.DEFAULT_ANSI_COLORS[7]),h.ansi[8]=m(b.brightBlack,s.DEFAULT_ANSI_COLORS[8]),h.ansi[9]=m(b.brightRed,s.DEFAULT_ANSI_COLORS[9]),h.ansi[10]=m(b.brightGreen,s.DEFAULT_ANSI_COLORS[10]),h.ansi[11]=m(b.brightYellow,s.DEFAULT_ANSI_COLORS[11]),h.ansi[12]=m(b.brightBlue,s.DEFAULT_ANSI_COLORS[12]),h.ansi[13]=m(b.brightMagenta,s.DEFAULT_ANSI_COLORS[13]),h.ansi[14]=m(b.brightCyan,s.DEFAULT_ANSI_COLORS[14]),h.ansi[15]=m(b.brightWhite,s.DEFAULT_ANSI_COLORS[15]),b.extendedAnsi){let S=Math.min(h.ansi.length-16,b.extendedAnsi.length);for(let k=0;k<S;k++)h.ansi[k+16]=m(b.extendedAnsi[k],s.DEFAULT_ANSI_COLORS[k+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(b){this._restoreColor(b),this._onChangeColors.fire(this.colors)}_restoreColor(b){if(b!==void 0)switch(b){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[b]=this._restoreColors.ansi[b]}else for(let h=0;h<this._restoreColors.ansi.length;++h)this._colors.ansi[h]=this._restoreColors.ansi[h]}modifyColors(b){b(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function m(b,h){if(b!==void 0)try{return d.css.toColor(b)}catch{}return h}s.ThemeService=u=a([f(0,_.IOptionsService)],u)},6349:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CircularList=void 0;let a=o(8460),f=o(844);class n extends f.Disposable{constructor(c){super(),this._maxLength=c,this.onDeleteEmitter=this.register(new a.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new a.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new a.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(c){if(this._maxLength===c)return;let p=new Array(c);for(let _=0;_<Math.min(c,this.length);_++)p[_]=this._array[this._getCyclicIndex(_)];this._array=p,this._maxLength=c,this._startIndex=0}get length(){return this._length}set length(c){if(c>this._length)for(let p=this._length;p<c;p++)this._array[p]=void 0;this._length=c}get(c){return this._array[this._getCyclicIndex(c)]}set(c,p){this._array[this._getCyclicIndex(c)]=p}push(c){this._array[this._getCyclicIndex(this._length)]=c,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(c,p,..._){if(p){for(let e=c;e<this._length-p;e++)this._array[this._getCyclicIndex(e)]=this._array[this._getCyclicIndex(e+p)];this._length-=p,this.onDeleteEmitter.fire({index:c,amount:p})}for(let e=this._length-1;e>=c;e--)this._array[this._getCyclicIndex(e+_.length)]=this._array[this._getCyclicIndex(e)];for(let e=0;e<_.length;e++)this._array[this._getCyclicIndex(c+e)]=_[e];if(_.length&&this.onInsertEmitter.fire({index:c,amount:_.length}),this._length+_.length>this._maxLength){let e=this._length+_.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=_.length}trimStart(c){c>this._length&&(c=this._length),this._startIndex+=c,this._length-=c,this.onTrimEmitter.fire(c)}shiftElements(c,p,_){if(!(p<=0)){if(c<0||c>=this._length)throw new Error("start argument out of range");if(c+_<0)throw new Error("Cannot shift elements in list beyond index 0");if(_>0){for(let r=p-1;r>=0;r--)this.set(c+r+_,this.get(c+r));let e=c+p+_-this._length;if(e>0)for(this._length+=e;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let e=0;e<p;e++)this.set(c+e+_,this.get(c+e))}}_getCyclicIndex(c){return(this._startIndex+c)%this._maxLength}}s.CircularList=n},1439:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.clone=void 0,s.clone=function o(a,f=5){if(typeof a!="object")return a;let n=Array.isArray(a)?[]:{};for(let d in a)n[d]=f<=1?a[d]:a[d]&&o(a[d],f-1);return n}},8055:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.contrastRatio=s.toPaddedHex=s.rgba=s.rgb=s.css=s.color=s.channels=s.NULL_COLOR=void 0;let a=o(6114),f=0,n=0,d=0,c=0;var p,_,e,r,t;function i(u){let m=u.toString(16);return m.length<2?"0"+m:m}function l(u,m){return u<m?(m+.05)/(u+.05):(u+.05)/(m+.05)}s.NULL_COLOR={css:"#00000000",rgba:0},function(u){u.toCss=function(m,b,h,S){return S!==void 0?`#${i(m)}${i(b)}${i(h)}${i(S)}`:`#${i(m)}${i(b)}${i(h)}`},u.toRgba=function(m,b,h,S=255){return(m<<24|b<<16|h<<8|S)>>>0}}(p||(s.channels=p={})),function(u){function m(b,h){return c=Math.round(255*h),[f,n,d]=t.toChannels(b.rgba),{css:p.toCss(f,n,d,c),rgba:p.toRgba(f,n,d,c)}}u.blend=function(b,h){if(c=(255&h.rgba)/255,c===1)return{css:h.css,rgba:h.rgba};let S=h.rgba>>24&255,k=h.rgba>>16&255,R=h.rgba>>8&255,x=b.rgba>>24&255,B=b.rgba>>16&255,P=b.rgba>>8&255;return f=x+Math.round((S-x)*c),n=B+Math.round((k-B)*c),d=P+Math.round((R-P)*c),{css:p.toCss(f,n,d),rgba:p.toRgba(f,n,d)}},u.isOpaque=function(b){return(255&b.rgba)==255},u.ensureContrastRatio=function(b,h,S){let k=t.ensureContrastRatio(b.rgba,h.rgba,S);if(k)return t.toColor(k>>24&255,k>>16&255,k>>8&255)},u.opaque=function(b){let h=(255|b.rgba)>>>0;return[f,n,d]=t.toChannels(h),{css:p.toCss(f,n,d),rgba:h}},u.opacity=m,u.multiplyOpacity=function(b,h){return c=255&b.rgba,m(b,c*h/255)},u.toColorRGB=function(b){return[b.rgba>>24&255,b.rgba>>16&255,b.rgba>>8&255]}}(_||(s.color=_={})),function(u){let m,b;if(!a.isNode){let h=document.createElement("canvas");h.width=1,h.height=1;let S=h.getContext("2d",{willReadFrequently:!0});S&&(m=S,m.globalCompositeOperation="copy",b=m.createLinearGradient(0,0,1,1))}u.toColor=function(h){if(h.match(/#[\da-f]{3,8}/i))switch(h.length){case 4:return f=parseInt(h.slice(1,2).repeat(2),16),n=parseInt(h.slice(2,3).repeat(2),16),d=parseInt(h.slice(3,4).repeat(2),16),t.toColor(f,n,d);case 5:return f=parseInt(h.slice(1,2).repeat(2),16),n=parseInt(h.slice(2,3).repeat(2),16),d=parseInt(h.slice(3,4).repeat(2),16),c=parseInt(h.slice(4,5).repeat(2),16),t.toColor(f,n,d,c);case 7:return{css:h,rgba:(parseInt(h.slice(1),16)<<8|255)>>>0};case 9:return{css:h,rgba:parseInt(h.slice(1),16)>>>0}}let S=h.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(S)return f=parseInt(S[1]),n=parseInt(S[2]),d=parseInt(S[3]),c=Math.round(255*(S[5]===void 0?1:parseFloat(S[5]))),t.toColor(f,n,d,c);if(!m||!b)throw new Error("css.toColor: Unsupported css format");if(m.fillStyle=b,m.fillStyle=h,typeof m.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(m.fillRect(0,0,1,1),[f,n,d,c]=m.getImageData(0,0,1,1).data,c!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:p.toRgba(f,n,d,c),css:h}}}(e||(s.css=e={})),function(u){function m(b,h,S){let k=b/255,R=h/255,x=S/255;return .2126*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.7152*(R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4))+.0722*(x<=.03928?x/12.92:Math.pow((x+.055)/1.055,2.4))}u.relativeLuminance=function(b){return m(b>>16&255,b>>8&255,255&b)},u.relativeLuminance2=m}(r||(s.rgb=r={})),function(u){function m(h,S,k){let R=h>>24&255,x=h>>16&255,B=h>>8&255,P=S>>24&255,H=S>>16&255,W=S>>8&255,F=l(r.relativeLuminance2(P,H,W),r.relativeLuminance2(R,x,B));for(;F<k&&(P>0||H>0||W>0);)P-=Math.max(0,Math.ceil(.1*P)),H-=Math.max(0,Math.ceil(.1*H)),W-=Math.max(0,Math.ceil(.1*W)),F=l(r.relativeLuminance2(P,H,W),r.relativeLuminance2(R,x,B));return(P<<24|H<<16|W<<8|255)>>>0}function b(h,S,k){let R=h>>24&255,x=h>>16&255,B=h>>8&255,P=S>>24&255,H=S>>16&255,W=S>>8&255,F=l(r.relativeLuminance2(P,H,W),r.relativeLuminance2(R,x,B));for(;F<k&&(P<255||H<255||W<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),H=Math.min(255,H+Math.ceil(.1*(255-H))),W=Math.min(255,W+Math.ceil(.1*(255-W))),F=l(r.relativeLuminance2(P,H,W),r.relativeLuminance2(R,x,B));return(P<<24|H<<16|W<<8|255)>>>0}u.ensureContrastRatio=function(h,S,k){let R=r.relativeLuminance(h>>8),x=r.relativeLuminance(S>>8);if(l(R,x)<k){if(x<R){let H=m(h,S,k),W=l(R,r.relativeLuminance(H>>8));if(W<k){let F=b(h,S,k);return W>l(R,r.relativeLuminance(F>>8))?H:F}return H}let B=b(h,S,k),P=l(R,r.relativeLuminance(B>>8));if(P<k){let H=m(h,S,k);return P>l(R,r.relativeLuminance(H>>8))?B:H}return B}},u.reduceLuminance=m,u.increaseLuminance=b,u.toChannels=function(h){return[h>>24&255,h>>16&255,h>>8&255,255&h]},u.toColor=function(h,S,k,R){return{css:p.toCss(h,S,k,R),rgba:p.toRgba(h,S,k,R)}}}(t||(s.rgba=t={})),s.toPaddedHex=i,s.contrastRatio=l},8969:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CoreTerminal=void 0;let a=o(844),f=o(2585),n=o(4348),d=o(7866),c=o(744),p=o(7302),_=o(6975),e=o(8460),r=o(1753),t=o(1480),i=o(7994),l=o(9282),u=o(5435),m=o(5981),b=o(2660),h=!1;class S extends a.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new e.EventEmitter),this._onScroll.event(R=>{var x;(x=this._onScrollApi)===null||x===void 0||x.fire(R.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(R){for(let x in R)this.optionsService.options[x]=R[x]}constructor(R){super(),this._windowsWrappingHeuristics=this.register(new a.MutableDisposable),this._onBinary=this.register(new e.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new e.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new e.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new e.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new e.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new p.OptionsService(R)),this._instantiationService.setService(f.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(c.BufferService)),this._instantiationService.setService(f.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(d.LogService)),this._instantiationService.setService(f.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(_.CoreService)),this._instantiationService.setService(f.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(r.CoreMouseService)),this._instantiationService.setService(f.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(t.UnicodeService)),this._instantiationService.setService(f.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(i.CharsetService),this._instantiationService.setService(f.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(b.OscLinkService),this._instantiationService.setService(f.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new u.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,e.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,e.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,e.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,e.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new m.WriteBuffer((x,B)=>this._inputHandler.parse(x,B))),this.register((0,e.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(R,x){this._writeBuffer.write(R,x)}writeSync(R,x){this._logService.logLevel<=f.LogLevelEnum.WARN&&!h&&(this._logService.warn("writeSync is unreliable and will be removed soon."),h=!0),this._writeBuffer.writeSync(R,x)}resize(R,x){isNaN(R)||isNaN(x)||(R=Math.max(R,c.MINIMUM_COLS),x=Math.max(x,c.MINIMUM_ROWS),this._bufferService.resize(R,x))}scroll(R,x=!1){this._bufferService.scroll(R,x)}scrollLines(R,x,B){this._bufferService.scrollLines(R,x,B)}scrollPages(R){this.scrollLines(R*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(R){let x=R-this._bufferService.buffer.ydisp;x!==0&&this.scrollLines(x)}registerEscHandler(R,x){return this._inputHandler.registerEscHandler(R,x)}registerDcsHandler(R,x){return this._inputHandler.registerDcsHandler(R,x)}registerCsiHandler(R,x){return this._inputHandler.registerCsiHandler(R,x)}registerOscHandler(R,x){return this._inputHandler.registerOscHandler(R,x)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let R=!1,x=this.optionsService.rawOptions.windowsPty;x&&x.buildNumber!==void 0&&x.buildNumber!==void 0?R=x.backend==="conpty"&&x.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(R=!0),R?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let R=[];R.push(this.onLineFeed(l.updateWindowsModeWrappedState.bind(null,this._bufferService))),R.push(this.registerCsiHandler({final:"H"},()=>((0,l.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,a.toDisposable)(()=>{for(let x of R)x.dispose()})}}}s.CoreTerminal=S},8460:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.forwardEvent=s.EventEmitter=void 0,s.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=o=>(this._listeners.push(o),{dispose:()=>{if(!this._disposed){for(let a=0;a<this._listeners.length;a++)if(this._listeners[a]===o)return void this._listeners.splice(a,1)}}})),this._event}fire(o,a){let f=[];for(let n=0;n<this._listeners.length;n++)f.push(this._listeners[n]);for(let n=0;n<f.length;n++)f[n].call(void 0,o,a)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},s.forwardEvent=function(o,a){return o(f=>a.fire(f))}},5435:function(E,s,o){var a=this&&this.__decorate||function(F,C,L,D){var T,N=arguments.length,j=N<3?C:D===null?D=Object.getOwnPropertyDescriptor(C,L):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(F,C,L,D);else for(var q=F.length-1;q>=0;q--)(T=F[q])&&(j=(N<3?T(j):N>3?T(C,L,j):T(C,L))||j);return N>3&&j&&Object.defineProperty(C,L,j),j},f=this&&this.__param||function(F,C){return function(L,D){C(L,D,F)}};Object.defineProperty(s,"__esModule",{value:!0}),s.InputHandler=s.WindowsOptionsReportType=void 0;let n=o(2584),d=o(7116),c=o(2015),p=o(844),_=o(482),e=o(8437),r=o(8460),t=o(643),i=o(511),l=o(3734),u=o(2585),m=o(6242),b=o(6351),h=o(5941),S={"(":0,")":1,"*":2,"+":3,"-":1,".":2},k=131072;function R(F,C){if(F>24)return C.setWinLines||!1;switch(F){case 1:return!!C.restoreWin;case 2:return!!C.minimizeWin;case 3:return!!C.setWinPosition;case 4:return!!C.setWinSizePixels;case 5:return!!C.raiseWin;case 6:return!!C.lowerWin;case 7:return!!C.refreshWin;case 8:return!!C.setWinSizeChars;case 9:return!!C.maximizeWin;case 10:return!!C.fullscreenWin;case 11:return!!C.getWinState;case 13:return!!C.getWinPosition;case 14:return!!C.getWinSizePixels;case 15:return!!C.getScreenSizePixels;case 16:return!!C.getCellSizePixels;case 18:return!!C.getWinSizeChars;case 19:return!!C.getScreenSizeChars;case 20:return!!C.getIconTitle;case 21:return!!C.getWinTitle;case 22:return!!C.pushTitle;case 23:return!!C.popTitle;case 24:return!!C.setWinLines}return!1}var x;(function(F){F[F.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",F[F.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(x||(s.WindowsOptionsReportType=x={}));let B=0;class P extends p.Disposable{getAttrData(){return this._curAttrData}constructor(C,L,D,T,N,j,q,K,Q=new c.EscapeSequenceParser){super(),this._bufferService=C,this._charsetService=L,this._coreService=D,this._logService=T,this._optionsService=N,this._oscLinkService=j,this._coreMouseService=q,this._unicodeService=K,this._parser=Q,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new _.StringToUtf32,this._utf8Decoder=new _.Utf8ToUtf32,this._workCell=new i.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new r.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new r.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new r.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new r.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new r.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new r.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new r.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new r.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new r.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new r.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new r.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new r.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new r.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new H(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(y=>this._activeBuffer=y.activeBuffer)),this._parser.setCsiHandlerFallback((y,M)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(y),params:M.toArray()})}),this._parser.setEscHandlerFallback(y=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(y)})}),this._parser.setExecuteHandlerFallback(y=>{this._logService.debug("Unknown EXECUTE code: ",{code:y})}),this._parser.setOscHandlerFallback((y,M,O)=>{this._logService.debug("Unknown OSC code: ",{identifier:y,action:M,data:O})}),this._parser.setDcsHandlerFallback((y,M,O)=>{M==="HOOK"&&(O=O.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(y),action:M,payload:O})}),this._parser.setPrintHandler((y,M,O)=>this.print(y,M,O)),this._parser.registerCsiHandler({final:"@"},y=>this.insertChars(y)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},y=>this.scrollLeft(y)),this._parser.registerCsiHandler({final:"A"},y=>this.cursorUp(y)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},y=>this.scrollRight(y)),this._parser.registerCsiHandler({final:"B"},y=>this.cursorDown(y)),this._parser.registerCsiHandler({final:"C"},y=>this.cursorForward(y)),this._parser.registerCsiHandler({final:"D"},y=>this.cursorBackward(y)),this._parser.registerCsiHandler({final:"E"},y=>this.cursorNextLine(y)),this._parser.registerCsiHandler({final:"F"},y=>this.cursorPrecedingLine(y)),this._parser.registerCsiHandler({final:"G"},y=>this.cursorCharAbsolute(y)),this._parser.registerCsiHandler({final:"H"},y=>this.cursorPosition(y)),this._parser.registerCsiHandler({final:"I"},y=>this.cursorForwardTab(y)),this._parser.registerCsiHandler({final:"J"},y=>this.eraseInDisplay(y,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},y=>this.eraseInDisplay(y,!0)),this._parser.registerCsiHandler({final:"K"},y=>this.eraseInLine(y,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},y=>this.eraseInLine(y,!0)),this._parser.registerCsiHandler({final:"L"},y=>this.insertLines(y)),this._parser.registerCsiHandler({final:"M"},y=>this.deleteLines(y)),this._parser.registerCsiHandler({final:"P"},y=>this.deleteChars(y)),this._parser.registerCsiHandler({final:"S"},y=>this.scrollUp(y)),this._parser.registerCsiHandler({final:"T"},y=>this.scrollDown(y)),this._parser.registerCsiHandler({final:"X"},y=>this.eraseChars(y)),this._parser.registerCsiHandler({final:"Z"},y=>this.cursorBackwardTab(y)),this._parser.registerCsiHandler({final:"`"},y=>this.charPosAbsolute(y)),this._parser.registerCsiHandler({final:"a"},y=>this.hPositionRelative(y)),this._parser.registerCsiHandler({final:"b"},y=>this.repeatPrecedingCharacter(y)),this._parser.registerCsiHandler({final:"c"},y=>this.sendDeviceAttributesPrimary(y)),this._parser.registerCsiHandler({prefix:">",final:"c"},y=>this.sendDeviceAttributesSecondary(y)),this._parser.registerCsiHandler({final:"d"},y=>this.linePosAbsolute(y)),this._parser.registerCsiHandler({final:"e"},y=>this.vPositionRelative(y)),this._parser.registerCsiHandler({final:"f"},y=>this.hVPosition(y)),this._parser.registerCsiHandler({final:"g"},y=>this.tabClear(y)),this._parser.registerCsiHandler({final:"h"},y=>this.setMode(y)),this._parser.registerCsiHandler({prefix:"?",final:"h"},y=>this.setModePrivate(y)),this._parser.registerCsiHandler({final:"l"},y=>this.resetMode(y)),this._parser.registerCsiHandler({prefix:"?",final:"l"},y=>this.resetModePrivate(y)),this._parser.registerCsiHandler({final:"m"},y=>this.charAttributes(y)),this._parser.registerCsiHandler({final:"n"},y=>this.deviceStatus(y)),this._parser.registerCsiHandler({prefix:"?",final:"n"},y=>this.deviceStatusPrivate(y)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},y=>this.softReset(y)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},y=>this.setCursorStyle(y)),this._parser.registerCsiHandler({final:"r"},y=>this.setScrollRegion(y)),this._parser.registerCsiHandler({final:"s"},y=>this.saveCursor(y)),this._parser.registerCsiHandler({final:"t"},y=>this.windowOptions(y)),this._parser.registerCsiHandler({final:"u"},y=>this.restoreCursor(y)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},y=>this.insertColumns(y)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},y=>this.deleteColumns(y)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},y=>this.selectProtected(y)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},y=>this.requestMode(y,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},y=>this.requestMode(y,!1)),this._parser.setExecuteHandler(n.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(n.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(n.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(n.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(n.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(n.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(n.C1.IND,()=>this.index()),this._parser.setExecuteHandler(n.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(n.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new m.OscHandler(y=>(this.setTitle(y),this.setIconName(y),!0))),this._parser.registerOscHandler(1,new m.OscHandler(y=>this.setIconName(y))),this._parser.registerOscHandler(2,new m.OscHandler(y=>this.setTitle(y))),this._parser.registerOscHandler(4,new m.OscHandler(y=>this.setOrReportIndexedColor(y))),this._parser.registerOscHandler(8,new m.OscHandler(y=>this.setHyperlink(y))),this._parser.registerOscHandler(10,new m.OscHandler(y=>this.setOrReportFgColor(y))),this._parser.registerOscHandler(11,new m.OscHandler(y=>this.setOrReportBgColor(y))),this._parser.registerOscHandler(12,new m.OscHandler(y=>this.setOrReportCursorColor(y))),this._parser.registerOscHandler(104,new m.OscHandler(y=>this.restoreIndexedColor(y))),this._parser.registerOscHandler(110,new m.OscHandler(y=>this.restoreFgColor(y))),this._parser.registerOscHandler(111,new m.OscHandler(y=>this.restoreBgColor(y))),this._parser.registerOscHandler(112,new m.OscHandler(y=>this.restoreCursorColor(y))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let y in d.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:y},()=>this.selectCharset("("+y)),this._parser.registerEscHandler({intermediates:")",final:y},()=>this.selectCharset(")"+y)),this._parser.registerEscHandler({intermediates:"*",final:y},()=>this.selectCharset("*"+y)),this._parser.registerEscHandler({intermediates:"+",final:y},()=>this.selectCharset("+"+y)),this._parser.registerEscHandler({intermediates:"-",final:y},()=>this.selectCharset("-"+y)),this._parser.registerEscHandler({intermediates:".",final:y},()=>this.selectCharset("."+y)),this._parser.registerEscHandler({intermediates:"/",final:y},()=>this.selectCharset("/"+y));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(y=>(this._logService.error("Parsing error: ",y),y)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new b.DcsHandler((y,M)=>this.requestStatusString(y,M)))}_preserveStack(C,L,D,T){this._parseStack.paused=!0,this._parseStack.cursorStartX=C,this._parseStack.cursorStartY=L,this._parseStack.decodedLength=D,this._parseStack.position=T}_logSlowResolvingAsync(C){this._logService.logLevel<=u.LogLevelEnum.WARN&&Promise.race([C,new Promise((L,D)=>setTimeout(()=>D("#SLOW_TIMEOUT"),5e3))]).catch(L=>{if(L!=="#SLOW_TIMEOUT")throw L;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(C,L){let D,T=this._activeBuffer.x,N=this._activeBuffer.y,j=0,q=this._parseStack.paused;if(q){if(D=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,L))return this._logSlowResolvingAsync(D),D;T=this._parseStack.cursorStartX,N=this._parseStack.cursorStartY,this._parseStack.paused=!1,C.length>k&&(j=this._parseStack.position+k)}if(this._logService.logLevel<=u.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof C=="string"?` "${C}"`:` "${Array.prototype.map.call(C,K=>String.fromCharCode(K)).join("")}"`),typeof C=="string"?C.split("").map(K=>K.charCodeAt(0)):C),this._parseBuffer.length<C.length&&this._parseBuffer.length<k&&(this._parseBuffer=new Uint32Array(Math.min(C.length,k))),q||this._dirtyRowTracker.clearRange(),C.length>k)for(let K=j;K<C.length;K+=k){let Q=K+k<C.length?K+k:C.length,y=typeof C=="string"?this._stringDecoder.decode(C.substring(K,Q),this._parseBuffer):this._utf8Decoder.decode(C.subarray(K,Q),this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,y))return this._preserveStack(T,N,y,K),this._logSlowResolvingAsync(D),D}else if(!q){let K=typeof C=="string"?this._stringDecoder.decode(C,this._parseBuffer):this._utf8Decoder.decode(C,this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,K))return this._preserveStack(T,N,K,0),this._logSlowResolvingAsync(D),D}this._activeBuffer.x===T&&this._activeBuffer.y===N||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(C,L,D){let T,N,j=this._charsetService.charset,q=this._optionsService.rawOptions.screenReaderMode,K=this._bufferService.cols,Q=this._coreService.decPrivateModes.wraparound,y=this._coreService.modes.insertMode,M=this._curAttrData,O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&D-L>0&&O.getWidth(this._activeBuffer.x-1)===2&&O.setCellFromCodePoint(this._activeBuffer.x-1,0,1,M.fg,M.bg,M.extended);for(let I=L;I<D;++I){if(T=C[I],N=this._unicodeService.wcwidth(T),T<127&&j){let V=j[String.fromCharCode(T)];V&&(T=V.charCodeAt(0))}if(q&&this._onA11yChar.fire((0,_.stringFromCodePoint)(T)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),N||!this._activeBuffer.x){if(this._activeBuffer.x+N-1>=K){if(Q){for(;this._activeBuffer.x<K;)O.setCellFromCodePoint(this._activeBuffer.x++,0,1,M.fg,M.bg,M.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=K-1,N===2)continue}if(y&&(O.insertCells(this._activeBuffer.x,N,this._activeBuffer.getNullCell(M),M),O.getWidth(K-1)===2&&O.setCellFromCodePoint(K-1,t.NULL_CELL_CODE,t.NULL_CELL_WIDTH,M.fg,M.bg,M.extended)),O.setCellFromCodePoint(this._activeBuffer.x++,T,N,M.fg,M.bg,M.extended),N>0)for(;--N;)O.setCellFromCodePoint(this._activeBuffer.x++,0,0,M.fg,M.bg,M.extended)}else O.getWidth(this._activeBuffer.x-1)?O.addCodepointToCell(this._activeBuffer.x-1,T):O.addCodepointToCell(this._activeBuffer.x-2,T)}D-L>0&&(O.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<K&&D-L>0&&O.getWidth(this._activeBuffer.x)===0&&!O.hasContent(this._activeBuffer.x)&&O.setCellFromCodePoint(this._activeBuffer.x,0,1,M.fg,M.bg,M.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(C,L){return C.final!=="t"||C.prefix||C.intermediates?this._parser.registerCsiHandler(C,L):this._parser.registerCsiHandler(C,D=>!R(D.params[0],this._optionsService.rawOptions.windowOptions)||L(D))}registerDcsHandler(C,L){return this._parser.registerDcsHandler(C,new b.DcsHandler(L))}registerEscHandler(C,L){return this._parser.registerEscHandler(C,L)}registerOscHandler(C,L){return this._parser.registerOscHandler(C,new m.OscHandler(L))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var C;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||C===void 0)&&C.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);L.hasWidth(this._activeBuffer.x)&&!L.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let C=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-C),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(C=this._bufferService.cols-1){this._activeBuffer.x=Math.min(C,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(C,L){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=C,this._activeBuffer.y=this._activeBuffer.scrollTop+L):(this._activeBuffer.x=C,this._activeBuffer.y=L),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(C,L){this._restrictCursor(),this._setCursor(this._activeBuffer.x+C,this._activeBuffer.y+L)}cursorUp(C){let L=this._activeBuffer.y-this._activeBuffer.scrollTop;return L>=0?this._moveCursor(0,-Math.min(L,C.params[0]||1)):this._moveCursor(0,-(C.params[0]||1)),!0}cursorDown(C){let L=this._activeBuffer.scrollBottom-this._activeBuffer.y;return L>=0?this._moveCursor(0,Math.min(L,C.params[0]||1)):this._moveCursor(0,C.params[0]||1),!0}cursorForward(C){return this._moveCursor(C.params[0]||1,0),!0}cursorBackward(C){return this._moveCursor(-(C.params[0]||1),0),!0}cursorNextLine(C){return this.cursorDown(C),this._activeBuffer.x=0,!0}cursorPrecedingLine(C){return this.cursorUp(C),this._activeBuffer.x=0,!0}cursorCharAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(C){return this._setCursor(C.length>=2?(C.params[1]||1)-1:0,(C.params[0]||1)-1),!0}charPosAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(C){return this._moveCursor(C.params[0]||1,0),!0}linePosAbsolute(C){return this._setCursor(this._activeBuffer.x,(C.params[0]||1)-1),!0}vPositionRelative(C){return this._moveCursor(0,C.params[0]||1),!0}hVPosition(C){return this.cursorPosition(C),!0}tabClear(C){let L=C.params[0];return L===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:L===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let L=C.params[0]||1;for(;L--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let L=C.params[0]||1;for(;L--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(C){let L=C.params[0];return L===1&&(this._curAttrData.bg|=536870912),L!==2&&L!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(C,L,D,T=!1,N=!1){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);j.replaceCells(L,D,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),N),T&&(j.isWrapped=!1)}_resetBufferLine(C,L=!1){let D=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);D&&(D.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),L),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+C),D.isWrapped=!1)}eraseInDisplay(C,L=!1){let D;switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,L);D<this._bufferService.rows;D++)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(D);break;case 1:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D,0,this._activeBuffer.x+1,!0,L),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(D+1).isWrapped=!1);D--;)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(0);break;case 2:for(D=this._bufferService.rows,this._dirtyRowTracker.markDirty(D-1);D--;)this._resetBufferLine(D,L);this._dirtyRowTracker.markDirty(0);break;case 3:let T=this._activeBuffer.lines.length-this._bufferService.rows;T>0&&(this._activeBuffer.lines.trimStart(T),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-T,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-T,0),this._onScroll.fire(0))}return!0}eraseInLine(C,L=!1){switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,L);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,L);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,L)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(C){this._restrictCursor();let L=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,N=this._bufferService.rows-1+this._activeBuffer.ybase-T+1;for(;L--;)this._activeBuffer.lines.splice(N-1,1),this._activeBuffer.lines.splice(D,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(C){this._restrictCursor();let L=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,T;for(T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,T=this._bufferService.rows-1+this._activeBuffer.ybase-T;L--;)this._activeBuffer.lines.splice(D,1),this._activeBuffer.lines.splice(T,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.insertCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.deleteCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(C){let L=C.params[0]||1;for(;L--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(C){let L=C.params[0]||1;for(;L--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(e.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);T.deleteCells(0,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);T.insertCells(0,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);T.insertCells(this._activeBuffer.x,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let L=C.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);T.deleteCells(this._activeBuffer.x,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(C){this._restrictCursor();let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return L&&(L.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(C.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(C){if(!this._parser.precedingCodepoint)return!0;let L=C.params[0]||1,D=new Uint32Array(L);for(let T=0;T<L;++T)D[T]=this._parser.precedingCodepoint;return this.print(D,0,D.length),!0}sendDeviceAttributesPrimary(C){return C.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(C){return C.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(C.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(C){return(this._optionsService.rawOptions.termName+"").indexOf(C)===0}setMode(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,d.DEFAULT_CHARSET),this._charsetService.setgCharset(1,d.DEFAULT_CHARSET),this._charsetService.setgCharset(2,d.DEFAULT_CHARSET),this._charsetService.setgCharset(3,d.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(C){for(let L=0;L<C.length;L++)switch(C.params[L]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),C.params[L]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(C,L){let D=this._coreService.decPrivateModes,{activeProtocol:T,activeEncoding:N}=this._coreMouseService,j=this._coreService,{buffers:q,cols:K}=this._bufferService,{active:Q,alt:y}=q,M=this._optionsService.rawOptions,O=X=>X?1:2,I=C.params[0];return V=I,U=L?I===2?4:I===4?O(j.modes.insertMode):I===12?3:I===20?O(M.convertEol):0:I===1?O(D.applicationCursorKeys):I===3?M.windowOptions.setWinLines?K===80?2:K===132?1:0:0:I===6?O(D.origin):I===7?O(D.wraparound):I===8?3:I===9?O(T==="X10"):I===12?O(M.cursorBlink):I===25?O(!j.isCursorHidden):I===45?O(D.reverseWraparound):I===66?O(D.applicationKeypad):I===67?4:I===1e3?O(T==="VT200"):I===1002?O(T==="DRAG"):I===1003?O(T==="ANY"):I===1004?O(D.sendFocus):I===1005?4:I===1006?O(N==="SGR"):I===1015?4:I===1016?O(N==="SGR_PIXELS"):I===1048?1:I===47||I===1047||I===1049?O(Q===y):I===2004?O(D.bracketedPasteMode):0,j.triggerDataEvent(`${n.C0.ESC}[${L?"":"?"}${V};${U}$y`),!0;var V,U}_updateAttrColor(C,L,D,T,N){return L===2?(C|=50331648,C&=-16777216,C|=l.AttributeData.fromColorRGB([D,T,N])):L===5&&(C&=-50331904,C|=33554432|255&D),C}_extractColor(C,L,D){let T=[0,0,-1,0,0,0],N=0,j=0;do{if(T[j+N]=C.params[L+j],C.hasSubParams(L+j)){let q=C.getSubParams(L+j),K=0;do T[1]===5&&(N=1),T[j+K+1+N]=q[K];while(++K<q.length&&K+j+1+N<T.length);break}if(T[1]===5&&j+N>=2||T[1]===2&&j+N>=5)break;T[1]&&(N=1)}while(++j+L<C.length&&j+N<T.length);for(let q=2;q<T.length;++q)T[q]===-1&&(T[q]=0);switch(T[0]){case 38:D.fg=this._updateAttrColor(D.fg,T[1],T[3],T[4],T[5]);break;case 48:D.bg=this._updateAttrColor(D.bg,T[1],T[3],T[4],T[5]);break;case 58:D.extended=D.extended.clone(),D.extended.underlineColor=this._updateAttrColor(D.extended.underlineColor,T[1],T[3],T[4],T[5])}return j}_processUnderline(C,L){L.extended=L.extended.clone(),(!~C||C>5)&&(C=1),L.extended.underlineStyle=C,L.fg|=268435456,C===0&&(L.fg&=-268435457),L.updateExtended()}_processSGR0(C){C.fg=e.DEFAULT_ATTR_DATA.fg,C.bg=e.DEFAULT_ATTR_DATA.bg,C.extended=C.extended.clone(),C.extended.underlineStyle=0,C.extended.underlineColor&=-67108864,C.updateExtended()}charAttributes(C){if(C.length===1&&C.params[0]===0)return this._processSGR0(this._curAttrData),!0;let L=C.length,D,T=this._curAttrData;for(let N=0;N<L;N++)D=C.params[N],D>=30&&D<=37?(T.fg&=-50331904,T.fg|=16777216|D-30):D>=40&&D<=47?(T.bg&=-50331904,T.bg|=16777216|D-40):D>=90&&D<=97?(T.fg&=-50331904,T.fg|=16777224|D-90):D>=100&&D<=107?(T.bg&=-50331904,T.bg|=16777224|D-100):D===0?this._processSGR0(T):D===1?T.fg|=134217728:D===3?T.bg|=67108864:D===4?(T.fg|=268435456,this._processUnderline(C.hasSubParams(N)?C.getSubParams(N)[0]:1,T)):D===5?T.fg|=536870912:D===7?T.fg|=67108864:D===8?T.fg|=1073741824:D===9?T.fg|=2147483648:D===2?T.bg|=134217728:D===21?this._processUnderline(2,T):D===22?(T.fg&=-134217729,T.bg&=-134217729):D===23?T.bg&=-67108865:D===24?(T.fg&=-268435457,this._processUnderline(0,T)):D===25?T.fg&=-536870913:D===27?T.fg&=-67108865:D===28?T.fg&=-1073741825:D===29?T.fg&=2147483647:D===39?(T.fg&=-67108864,T.fg|=16777215&e.DEFAULT_ATTR_DATA.fg):D===49?(T.bg&=-67108864,T.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):D===38||D===48||D===58?N+=this._extractColor(C,N,T):D===53?T.bg|=1073741824:D===55?T.bg&=-1073741825:D===59?(T.extended=T.extended.clone(),T.extended.underlineColor=-1,T.updateExtended()):D===100?(T.fg&=-67108864,T.fg|=16777215&e.DEFAULT_ATTR_DATA.fg,T.bg&=-67108864,T.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",D);return!0}deviceStatus(C){switch(C.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:let L=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${L};${D}R`)}return!0}deviceStatusPrivate(C){if(C.params[0]===6){let L=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${L};${D}R`)}return!0}softReset(C){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(C){let L=C.params[0]||1;switch(L){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let D=L%2==1;return this._optionsService.options.cursorBlink=D,!0}setScrollRegion(C){let L=C.params[0]||1,D;return(C.length<2||(D=C.params[1])>this._bufferService.rows||D===0)&&(D=this._bufferService.rows),D>L&&(this._activeBuffer.scrollTop=L-1,this._activeBuffer.scrollBottom=D-1,this._setCursor(0,0)),!0}windowOptions(C){if(!R(C.params[0],this._optionsService.rawOptions.windowOptions))return!0;let L=C.length>1?C.params[1]:0;switch(C.params[0]){case 14:L!==2&&this._onRequestWindowsOptionsReport.fire(x.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(x.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:L!==0&&L!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),L!==0&&L!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:L!==0&&L!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),L!==0&&L!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(C){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(C){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(C){return this._windowTitle=C,this._onTitleChange.fire(C),!0}setIconName(C){return this._iconName=C,!0}setOrReportIndexedColor(C){let L=[],D=C.split(";");for(;D.length>1;){let T=D.shift(),N=D.shift();if(/^\d+$/.exec(T)){let j=parseInt(T);if(W(j))if(N==="?")L.push({type:0,index:j});else{let q=(0,h.parseColor)(N);q&&L.push({type:1,index:j,color:q})}}}return L.length&&this._onColor.fire(L),!0}setHyperlink(C){let L=C.split(";");return!(L.length<2)&&(L[1]?this._createHyperlink(L[0],L[1]):!L[0]&&this._finishHyperlink())}_createHyperlink(C,L){this._getCurrentLinkId()&&this._finishHyperlink();let D=C.split(":"),T,N=D.findIndex(j=>j.startsWith("id="));return N!==-1&&(T=D[N].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:T,uri:L}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(C,L){let D=C.split(";");for(let T=0;T<D.length&&!(L>=this._specialColors.length);++T,++L)if(D[T]==="?")this._onColor.fire([{type:0,index:this._specialColors[L]}]);else{let N=(0,h.parseColor)(D[T]);N&&this._onColor.fire([{type:1,index:this._specialColors[L],color:N}])}return!0}setOrReportFgColor(C){return this._setOrReportSpecialColor(C,0)}setOrReportBgColor(C){return this._setOrReportSpecialColor(C,1)}setOrReportCursorColor(C){return this._setOrReportSpecialColor(C,2)}restoreIndexedColor(C){if(!C)return this._onColor.fire([{type:2}]),!0;let L=[],D=C.split(";");for(let T=0;T<D.length;++T)if(/^\d+$/.exec(D[T])){let N=parseInt(D[T]);W(N)&&L.push({type:2,index:N})}return L.length&&this._onColor.fire(L),!0}restoreFgColor(C){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(C){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(C){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,d.DEFAULT_CHARSET),!0}selectCharset(C){return C.length!==2?(this.selectDefaultCharset(),!0):(C[0]==="/"||this._charsetService.setgCharset(S[C[0]],d.CHARSETS[C[1]]||d.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let C=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,C,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(C){return this._charsetService.setgLevel(C),!0}screenAlignmentPattern(){let C=new i.CellData;C.content=4194373,C.fg=this._curAttrData.fg,C.bg=this._curAttrData.bg,this._setCursor(0,0);for(let L=0;L<this._bufferService.rows;++L){let D=this._activeBuffer.ybase+this._activeBuffer.y+L,T=this._activeBuffer.lines.get(D);T&&(T.fill(C),T.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(C,L){let D=this._bufferService.buffer,T=this._optionsService.rawOptions;return(N=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${N}${n.C0.ESC}\\`),!0))(C==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:C==='"p'?'P1$r61;1"p':C==="r"?`P1$r${D.scrollTop+1};${D.scrollBottom+1}r`:C==="m"?"P1$r0m":C===" q"?`P1$r${{block:2,underline:4,bar:6}[T.cursorStyle]-(T.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(C,L){this._dirtyRowTracker.markRangeDirty(C,L)}}s.InputHandler=P;let H=class{constructor(F){this._bufferService=F,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(F){F<this.start?this.start=F:F>this.end&&(this.end=F)}markRangeDirty(F,C){F>C&&(B=F,F=C,C=B),F<this.start&&(this.start=F),C>this.end&&(this.end=C)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function W(F){return 0<=F&&F<256}H=a([f(0,u.IBufferService)],H)},844:(E,s)=>{function o(a){for(let f of a)f.dispose();a.length=0}Object.defineProperty(s,"__esModule",{value:!0}),s.getDisposeArrayDisposable=s.disposeArray=s.toDisposable=s.MutableDisposable=s.Disposable=void 0,s.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let a of this._disposables)a.dispose();this._disposables.length=0}register(a){return this._disposables.push(a),a}unregister(a){let f=this._disposables.indexOf(a);f!==-1&&this._disposables.splice(f,1)}},s.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(a){var f;this._isDisposed||a===this._value||((f=this._value)===null||f===void 0||f.dispose(),this._value=a)}clear(){this.value=void 0}dispose(){var a;this._isDisposed=!0,(a=this._value)===null||a===void 0||a.dispose(),this._value=void 0}},s.toDisposable=function(a){return{dispose:a}},s.disposeArray=o,s.getDisposeArrayDisposable=function(a){return{dispose:()=>o(a)}}},1505:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.FourKeyMap=s.TwoKeyMap=void 0;class o{constructor(){this._data={}}set(f,n,d){this._data[f]||(this._data[f]={}),this._data[f][n]=d}get(f,n){return this._data[f]?this._data[f][n]:void 0}clear(){this._data={}}}s.TwoKeyMap=o,s.FourKeyMap=class{constructor(){this._data=new o}set(a,f,n,d,c){this._data.get(a,f)||this._data.set(a,f,new o),this._data.get(a,f).set(n,d,c)}get(a,f,n,d){var c;return(c=this._data.get(a,f))===null||c===void 0?void 0:c.get(n,d)}clear(){this._data.clear()}}},6114:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.isChromeOS=s.isLinux=s.isWindows=s.isIphone=s.isIpad=s.isMac=s.getSafariVersion=s.isSafari=s.isLegacyEdge=s.isFirefox=s.isNode=void 0,s.isNode=typeof navigator>"u";let o=s.isNode?"node":navigator.userAgent,a=s.isNode?"node":navigator.platform;s.isFirefox=o.includes("Firefox"),s.isLegacyEdge=o.includes("Edge"),s.isSafari=/^((?!chrome|android).)*safari/i.test(o),s.getSafariVersion=function(){if(!s.isSafari)return 0;let f=o.match(/Version\/(\d+)/);return f===null||f.length<2?0:parseInt(f[1])},s.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(a),s.isIpad=a==="iPad",s.isIphone=a==="iPhone",s.isWindows=["Windows","Win16","Win32","WinCE"].includes(a),s.isLinux=a.indexOf("Linux")>=0,s.isChromeOS=/\bCrOS\b/.test(o)},6106:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SortedList=void 0;let o=0;s.SortedList=class{constructor(a){this._getKey=a,this._array=[]}clear(){this._array.length=0}insert(a){this._array.length!==0?(o=this._search(this._getKey(a)),this._array.splice(o,0,a)):this._array.push(a)}delete(a){if(this._array.length===0)return!1;let f=this._getKey(a);if(f===void 0||(o=this._search(f),o===-1)||this._getKey(this._array[o])!==f)return!1;do if(this._array[o]===a)return this._array.splice(o,1),!0;while(++o<this._array.length&&this._getKey(this._array[o])===f);return!1}*getKeyIterator(a){if(this._array.length!==0&&(o=this._search(a),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===a))do yield this._array[o];while(++o<this._array.length&&this._getKey(this._array[o])===a)}forEachByKey(a,f){if(this._array.length!==0&&(o=this._search(a),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===a))do f(this._array[o]);while(++o<this._array.length&&this._getKey(this._array[o])===a)}values(){return[...this._array].values()}_search(a){let f=0,n=this._array.length-1;for(;n>=f;){let d=f+n>>1,c=this._getKey(this._array[d]);if(c>a)n=d-1;else{if(!(c<a)){for(;d>0&&this._getKey(this._array[d-1])===a;)d--;return d}f=d+1}}return f}}},7226:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DebouncedIdleTask=s.IdleTaskQueue=s.PriorityTaskQueue=void 0;let a=o(6114);class f{constructor(){this._tasks=[],this._i=0}enqueue(c){this._tasks.push(c),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(c){this._idleCallback=void 0;let p=0,_=0,e=c.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(p=Date.now(),this._tasks[this._i]()||this._i++,p=Math.max(1,Date.now()-p),_=Math.max(p,_),r=c.timeRemaining(),1.5*_>r)return e-p<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-p))}ms`),void this._start();e=r}this.clear()}}class n extends f{_requestCallback(c){return setTimeout(()=>c(this._createDeadline(16)))}_cancelCallback(c){clearTimeout(c)}_createDeadline(c){let p=Date.now()+c;return{timeRemaining:()=>Math.max(0,p-Date.now())}}}s.PriorityTaskQueue=n,s.IdleTaskQueue=!a.isNode&&"requestIdleCallback"in window?class extends f{_requestCallback(d){return requestIdleCallback(d)}_cancelCallback(d){cancelIdleCallback(d)}}:n,s.DebouncedIdleTask=class{constructor(){this._queue=new s.IdleTaskQueue}set(d){this._queue.clear(),this._queue.enqueue(d)}flush(){this._queue.flush()}}},9282:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.updateWindowsModeWrappedState=void 0;let a=o(643);s.updateWindowsModeWrappedState=function(f){let n=f.buffer.lines.get(f.buffer.ybase+f.buffer.y-1),d=n?.get(f.cols-1),c=f.buffer.lines.get(f.buffer.ybase+f.buffer.y);c&&d&&(c.isWrapped=d[a.CHAR_DATA_CODE_INDEX]!==a.NULL_CELL_CODE&&d[a.CHAR_DATA_CODE_INDEX]!==a.WHITESPACE_CELL_CODE)}},3734:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ExtendedAttrs=s.AttributeData=void 0;class o{constructor(){this.fg=0,this.bg=0,this.extended=new a}static toColorRGB(n){return[n>>>16&255,n>>>8&255,255&n]}static fromColorRGB(n){return(255&n[0])<<16|(255&n[1])<<8|255&n[2]}clone(){let n=new o;return n.fg=this.fg,n.bg=this.bg,n.extended=this.extended.clone(),n}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}s.AttributeData=o;class a{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(n){this._ext=n}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(n){this._ext&=-469762049,this._ext|=n<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(n){this._ext&=-67108864,this._ext|=67108863&n}get urlId(){return this._urlId}set urlId(n){this._urlId=n}constructor(n=0,d=0){this._ext=0,this._urlId=0,this._ext=n,this._urlId=d}clone(){return new a(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}s.ExtendedAttrs=a},9092:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Buffer=s.MAX_BUFFER_SIZE=void 0;let a=o(6349),f=o(7226),n=o(3734),d=o(8437),c=o(4634),p=o(511),_=o(643),e=o(4863),r=o(7116);s.MAX_BUFFER_SIZE=4294967295,s.Buffer=class{constructor(t,i,l){this._hasScrollback=t,this._optionsService=i,this._bufferService=l,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=d.DEFAULT_ATTR_DATA.clone(),this.savedCharset=r.DEFAULT_CHARSET,this.markers=[],this._nullCell=p.CellData.fromCharData([0,_.NULL_CELL_CHAR,_.NULL_CELL_WIDTH,_.NULL_CELL_CODE]),this._whitespaceCell=p.CellData.fromCharData([0,_.WHITESPACE_CELL_CHAR,_.WHITESPACE_CELL_WIDTH,_.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new f.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new a.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg,this._nullCell.extended=t.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg,this._whitespaceCell.extended=t.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(t,i){return new d.BufferLine(this._bufferService.cols,this.getNullCell(t),i)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows}_getCorrectBufferLength(t){if(!this._hasScrollback)return t;let i=t+this._optionsService.rawOptions.scrollback;return i>s.MAX_BUFFER_SIZE?s.MAX_BUFFER_SIZE:i}fillViewportRows(t){if(this.lines.length===0){t===void 0&&(t=d.DEFAULT_ATTR_DATA);let i=this._rows;for(;i--;)this.lines.push(this.getBlankLine(t))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new a.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(t,i){let l=this.getNullCell(d.DEFAULT_ATTR_DATA),u=0,m=this._getCorrectBufferLength(i);if(m>this.lines.maxLength&&(this.lines.maxLength=m),this.lines.length>0){if(this._cols<t)for(let h=0;h<this.lines.length;h++)u+=+this.lines.get(h).resize(t,l);let b=0;if(this._rows<i)for(let h=this._rows;h<i;h++)this.lines.length<i+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new d.BufferLine(t,l)):this.ybase>0&&this.lines.length<=this.ybase+this.y+b+1?(this.ybase--,b++,this.ydisp>0&&this.ydisp--):this.lines.push(new d.BufferLine(t,l)));else for(let h=this._rows;h>i;h--)this.lines.length>i+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(m<this.lines.maxLength){let h=this.lines.length-m;h>0&&(this.lines.trimStart(h),this.ybase=Math.max(this.ybase-h,0),this.ydisp=Math.max(this.ydisp-h,0),this.savedY=Math.max(this.savedY-h,0)),this.lines.maxLength=m}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,i-1),b&&(this.y+=b),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=i-1,this._isReflowEnabled&&(this._reflow(t,i),this._cols>t))for(let b=0;b<this.lines.length;b++)u+=+this.lines.get(b).resize(t,l);this._cols=t,this._rows=i,this._memoryCleanupQueue.clear(),u>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let t=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,t=!1);let i=0;for(;this._memoryCleanupPosition<this.lines.length;)if(i+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),i>100)return!0;return t}get _isReflowEnabled(){let t=this._optionsService.rawOptions.windowsPty;return t&&t.buildNumber?this._hasScrollback&&t.backend==="conpty"&&t.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(t,i){this._cols!==t&&(t>this._cols?this._reflowLarger(t,i):this._reflowSmaller(t,i))}_reflowLarger(t,i){let l=(0,c.reflowLargerGetLinesToRemove)(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(d.DEFAULT_ATTR_DATA));if(l.length>0){let u=(0,c.reflowLargerCreateNewLayout)(this.lines,l);(0,c.reflowLargerApplyNewLayout)(this.lines,u.layout),this._reflowLargerAdjustViewport(t,i,u.countRemoved)}}_reflowLargerAdjustViewport(t,i,l){let u=this.getNullCell(d.DEFAULT_ATTR_DATA),m=l;for(;m-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<i&&this.lines.push(new d.BufferLine(t,u))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-l,0)}_reflowSmaller(t,i){let l=this.getNullCell(d.DEFAULT_ATTR_DATA),u=[],m=0;for(let b=this.lines.length-1;b>=0;b--){let h=this.lines.get(b);if(!h||!h.isWrapped&&h.getTrimmedLength()<=t)continue;let S=[h];for(;h.isWrapped&&b>0;)h=this.lines.get(--b),S.unshift(h);let k=this.ybase+this.y;if(k>=b&&k<b+S.length)continue;let R=S[S.length-1].getTrimmedLength(),x=(0,c.reflowSmallerGetNewLineLengths)(S,this._cols,t),B=x.length-S.length,P;P=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+B):Math.max(0,this.lines.length-this.lines.maxLength+B);let H=[];for(let T=0;T<B;T++){let N=this.getBlankLine(d.DEFAULT_ATTR_DATA,!0);H.push(N)}H.length>0&&(u.push({start:b+S.length+m,newLines:H}),m+=H.length),S.push(...H);let W=x.length-1,F=x[W];F===0&&(W--,F=x[W]);let C=S.length-B-1,L=R;for(;C>=0;){let T=Math.min(L,F);if(S[W]===void 0)break;if(S[W].copyCellsFrom(S[C],L-T,F-T,T,!0),F-=T,F===0&&(W--,F=x[W]),L-=T,L===0){C--;let N=Math.max(C,0);L=(0,c.getWrappedLineTrimmedLength)(S,N,this._cols)}}for(let T=0;T<S.length;T++)x[T]<t&&S[T].setCell(x[T],l);let D=B-P;for(;D-- >0;)this.ybase===0?this.y<i-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+m)-i&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+B,this.ybase+i-1)}if(u.length>0){let b=[],h=[];for(let W=0;W<this.lines.length;W++)h.push(this.lines.get(W));let S=this.lines.length,k=S-1,R=0,x=u[R];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+m);let B=0;for(let W=Math.min(this.lines.maxLength-1,S+m-1);W>=0;W--)if(x&&x.start>k+B){for(let F=x.newLines.length-1;F>=0;F--)this.lines.set(W--,x.newLines[F]);W++,b.push({index:k+1,amount:x.newLines.length}),B+=x.newLines.length,x=u[++R]}else this.lines.set(W,h[k--]);let P=0;for(let W=b.length-1;W>=0;W--)b[W].index+=P,this.lines.onInsertEmitter.fire(b[W]),P+=b[W].amount;let H=Math.max(0,S+m-this.lines.maxLength);H>0&&this.lines.onTrimEmitter.fire(H)}}translateBufferLineToString(t,i,l=0,u){let m=this.lines.get(t);return m?m.translateToString(i,l,u):""}getWrappedRangeForLine(t){let i=t,l=t;for(;i>0&&this.lines.get(i).isWrapped;)i--;for(;l+1<this.lines.length&&this.lines.get(l+1).isWrapped;)l++;return{first:i,last:l}}setupTabStops(t){for(t!=null?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.rawOptions.tabStopWidth)this.tabs[t]=!0}prevStop(t){for(t==null&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t}nextStop(t){for(t==null&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t}clearMarkers(t){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].line===t&&(this.markers[i].dispose(),this.markers.splice(i--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].dispose(),this.markers.splice(t--,1);this._isClearing=!1}addMarker(t){let i=new e.Marker(t);return this.markers.push(i),i.register(this.lines.onTrim(l=>{i.line-=l,i.line<0&&i.dispose()})),i.register(this.lines.onInsert(l=>{i.line>=l.index&&(i.line+=l.amount)})),i.register(this.lines.onDelete(l=>{i.line>=l.index&&i.line<l.index+l.amount&&i.dispose(),i.line>l.index&&(i.line-=l.amount)})),i.register(i.onDispose(()=>this._removeMarker(i))),i}_removeMarker(t){this._isClearing||this.markers.splice(this.markers.indexOf(t),1)}}},8437:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLine=s.DEFAULT_ATTR_DATA=void 0;let a=o(3734),f=o(511),n=o(643),d=o(482);s.DEFAULT_ATTR_DATA=Object.freeze(new a.AttributeData);let c=0;class p{constructor(e,r,t=!1){this.isWrapped=t,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);let i=r||f.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let l=0;l<e;++l)this.setCell(l,i);this.length=e}get(e){let r=this._data[3*e+0],t=2097151&r;return[this._data[3*e+1],2097152&r?this._combined[e]:t?(0,d.stringFromCodePoint)(t):"",r>>22,2097152&r?this._combined[e].charCodeAt(this._combined[e].length-1):t]}set(e,r){this._data[3*e+1]=r[n.CHAR_DATA_ATTR_INDEX],r[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=r[1],this._data[3*e+0]=2097152|e|r[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=r[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|r[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){let r=this._data[3*e+0];return 2097152&r?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&r}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){let r=this._data[3*e+0];return 2097152&r?this._combined[e]:2097151&r?(0,d.stringFromCodePoint)(2097151&r):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,r){return c=3*e,r.content=this._data[c+0],r.fg=this._data[c+1],r.bg=this._data[c+2],2097152&r.content&&(r.combinedData=this._combined[e]),268435456&r.bg&&(r.extended=this._extendedAttrs[e]),r}setCell(e,r){2097152&r.content&&(this._combined[e]=r.combinedData),268435456&r.bg&&(this._extendedAttrs[e]=r.extended),this._data[3*e+0]=r.content,this._data[3*e+1]=r.fg,this._data[3*e+2]=r.bg}setCellFromCodePoint(e,r,t,i,l,u){268435456&l&&(this._extendedAttrs[e]=u),this._data[3*e+0]=r|t<<22,this._data[3*e+1]=i,this._data[3*e+2]=l}addCodepointToCell(e,r){let t=this._data[3*e+0];2097152&t?this._combined[e]+=(0,d.stringFromCodePoint)(r):(2097151&t?(this._combined[e]=(0,d.stringFromCodePoint)(2097151&t)+(0,d.stringFromCodePoint)(r),t&=-2097152,t|=2097152):t=r|4194304,this._data[3*e+0]=t)}insertCells(e,r,t,i){if((e%=this.length)&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs),r<this.length-e){let l=new f.CellData;for(let u=this.length-e-r-1;u>=0;--u)this.setCell(e+r+u,this.loadCell(e+u,l));for(let u=0;u<r;++u)this.setCell(e+u,t)}else for(let l=e;l<this.length;++l)this.setCell(l,t);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs)}deleteCells(e,r,t,i){if(e%=this.length,r<this.length-e){let l=new f.CellData;for(let u=0;u<this.length-e-r;++u)this.setCell(e+u,this.loadCell(e+r+u,l));for(let u=this.length-r;u<this.length;++u)this.setCell(u,t)}else for(let l=e;l<this.length;++l)this.setCell(l,t);e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs),this.getWidth(e)!==0||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs)}replaceCells(e,r,t,i,l=!1){if(l)for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs),r<this.length&&this.getWidth(r-1)===2&&!this.isProtected(r)&&this.setCellFromCodePoint(r,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs);e<r&&e<this.length;)this.isProtected(e)||this.setCell(e,t),e++;else for(e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs),r<this.length&&this.getWidth(r-1)===2&&this.setCellFromCodePoint(r,0,1,i?.fg||0,i?.bg||0,i?.extended||new a.ExtendedAttrs);e<r&&e<this.length;)this.setCell(e++,t)}resize(e,r){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let t=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*t)this._data=new Uint32Array(this._data.buffer,0,t);else{let i=new Uint32Array(t);i.set(this._data),this._data=i}for(let i=this.length;i<e;++i)this.setCell(i,r)}else{this._data=this._data.subarray(0,t);let i=Object.keys(this._combined);for(let u=0;u<i.length;u++){let m=parseInt(i[u],10);m>=e&&delete this._combined[m]}let l=Object.keys(this._extendedAttrs);for(let u=0;u<l.length;u++){let m=parseInt(l[u],10);m>=e&&delete this._extendedAttrs[m]}}return this.length=e,4*t*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,r=!1){if(r)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(let r in e._combined)this._combined[r]=e._combined[r];this._extendedAttrs={};for(let r in e._extendedAttrs)this._extendedAttrs[r]=e._extendedAttrs[r];this.isWrapped=e.isWrapped}clone(){let e=new p(0);e._data=new Uint32Array(this._data),e.length=this.length;for(let r in this._combined)e._combined[r]=this._combined[r];for(let r in this._extendedAttrs)e._extendedAttrs[r]=this._extendedAttrs[r];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,r,t,i,l){let u=e._data;if(l)for(let b=i-1;b>=0;b--){for(let h=0;h<3;h++)this._data[3*(t+b)+h]=u[3*(r+b)+h];268435456&u[3*(r+b)+2]&&(this._extendedAttrs[t+b]=e._extendedAttrs[r+b])}else for(let b=0;b<i;b++){for(let h=0;h<3;h++)this._data[3*(t+b)+h]=u[3*(r+b)+h];268435456&u[3*(r+b)+2]&&(this._extendedAttrs[t+b]=e._extendedAttrs[r+b])}let m=Object.keys(e._combined);for(let b=0;b<m.length;b++){let h=parseInt(m[b],10);h>=r&&(this._combined[h-r+t]=e._combined[h])}}translateToString(e=!1,r=0,t=this.length){e&&(t=Math.min(t,this.getTrimmedLength()));let i="";for(;r<t;){let l=this._data[3*r+0],u=2097151&l;i+=2097152&l?this._combined[r]:u?(0,d.stringFromCodePoint)(u):n.WHITESPACE_CELL_CHAR,r+=l>>22||1}return i}}s.BufferLine=p},4841:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.getRangeLength=void 0,s.getRangeLength=function(o,a){if(o.start.y>o.end.y)throw new Error(`Buffer range end (${o.end.x}, ${o.end.y}) cannot be before start (${o.start.x}, ${o.start.y})`);return a*(o.end.y-o.start.y)+(o.end.x-o.start.x+1)}},4634:(E,s)=>{function o(a,f,n){if(f===a.length-1)return a[f].getTrimmedLength();let d=!a[f].hasContent(n-1)&&a[f].getWidth(n-1)===1,c=a[f+1].getWidth(0)===2;return d&&c?n-1:n}Object.defineProperty(s,"__esModule",{value:!0}),s.getWrappedLineTrimmedLength=s.reflowSmallerGetNewLineLengths=s.reflowLargerApplyNewLayout=s.reflowLargerCreateNewLayout=s.reflowLargerGetLinesToRemove=void 0,s.reflowLargerGetLinesToRemove=function(a,f,n,d,c){let p=[];for(let _=0;_<a.length-1;_++){let e=_,r=a.get(++e);if(!r.isWrapped)continue;let t=[a.get(_)];for(;e<a.length&&r.isWrapped;)t.push(r),r=a.get(++e);if(d>=_&&d<e){_+=t.length-1;continue}let i=0,l=o(t,i,f),u=1,m=0;for(;u<t.length;){let h=o(t,u,f),S=h-m,k=n-l,R=Math.min(S,k);t[i].copyCellsFrom(t[u],m,l,R,!1),l+=R,l===n&&(i++,l=0),m+=R,m===h&&(u++,m=0),l===0&&i!==0&&t[i-1].getWidth(n-1)===2&&(t[i].copyCellsFrom(t[i-1],n-1,l++,1,!1),t[i-1].setCell(n-1,c))}t[i].replaceCells(l,n,c);let b=0;for(let h=t.length-1;h>0&&(h>i||t[h].getTrimmedLength()===0);h--)b++;b>0&&(p.push(_+t.length-b),p.push(b)),_+=t.length-1}return p},s.reflowLargerCreateNewLayout=function(a,f){let n=[],d=0,c=f[d],p=0;for(let _=0;_<a.length;_++)if(c===_){let e=f[++d];a.onDeleteEmitter.fire({index:_-p,amount:e}),_+=e-1,p+=e,c=f[++d]}else n.push(_);return{layout:n,countRemoved:p}},s.reflowLargerApplyNewLayout=function(a,f){let n=[];for(let d=0;d<f.length;d++)n.push(a.get(f[d]));for(let d=0;d<n.length;d++)a.set(d,n[d]);a.length=f.length},s.reflowSmallerGetNewLineLengths=function(a,f,n){let d=[],c=a.map((r,t)=>o(a,t,f)).reduce((r,t)=>r+t),p=0,_=0,e=0;for(;e<c;){if(c-e<n){d.push(c-e);break}p+=n;let r=o(a,_,f);p>r&&(p-=r,_++);let t=a[_].getWidth(p-1)===2;t&&p--;let i=t?n-1:n;d.push(i),e+=i}return d},s.getWrappedLineTrimmedLength=o},5295:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferSet=void 0;let a=o(8460),f=o(844),n=o(9092);class d extends f.Disposable{constructor(p,_){super(),this._optionsService=p,this._bufferService=_,this._onBufferActivate=this.register(new a.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(p){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(p),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(p,_){this._normal.resize(p,_),this._alt.resize(p,_),this.setupTabStops(p)}setupTabStops(p){this._normal.setupTabStops(p),this._alt.setupTabStops(p)}}s.BufferSet=d},511:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CellData=void 0;let a=o(482),f=o(643),n=o(3734);class d extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(p){let _=new d;return _.setFromCharData(p),_}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,a.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(p){this.fg=p[f.CHAR_DATA_ATTR_INDEX],this.bg=0;let _=!1;if(p[f.CHAR_DATA_CHAR_INDEX].length>2)_=!0;else if(p[f.CHAR_DATA_CHAR_INDEX].length===2){let e=p[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){let r=p[f.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=r&&r<=57343?this.content=1024*(e-55296)+r-56320+65536|p[f.CHAR_DATA_WIDTH_INDEX]<<22:_=!0}else _=!0}else this.content=p[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|p[f.CHAR_DATA_WIDTH_INDEX]<<22;_&&(this.combinedData=p[f.CHAR_DATA_CHAR_INDEX],this.content=2097152|p[f.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}s.CellData=d},643:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WHITESPACE_CELL_CODE=s.WHITESPACE_CELL_WIDTH=s.WHITESPACE_CELL_CHAR=s.NULL_CELL_CODE=s.NULL_CELL_WIDTH=s.NULL_CELL_CHAR=s.CHAR_DATA_CODE_INDEX=s.CHAR_DATA_WIDTH_INDEX=s.CHAR_DATA_CHAR_INDEX=s.CHAR_DATA_ATTR_INDEX=s.DEFAULT_EXT=s.DEFAULT_ATTR=s.DEFAULT_COLOR=void 0,s.DEFAULT_COLOR=0,s.DEFAULT_ATTR=256|s.DEFAULT_COLOR<<9,s.DEFAULT_EXT=0,s.CHAR_DATA_ATTR_INDEX=0,s.CHAR_DATA_CHAR_INDEX=1,s.CHAR_DATA_WIDTH_INDEX=2,s.CHAR_DATA_CODE_INDEX=3,s.NULL_CELL_CHAR="",s.NULL_CELL_WIDTH=1,s.NULL_CELL_CODE=0,s.WHITESPACE_CELL_CHAR=" ",s.WHITESPACE_CELL_WIDTH=1,s.WHITESPACE_CELL_CODE=32},4863:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Marker=void 0;let a=o(8460),f=o(844);class n{get id(){return this._id}constructor(c){this.line=c,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new a.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,f.disposeArray)(this._disposables),this._disposables.length=0)}register(c){return this._disposables.push(c),c}}s.Marker=n,n._nextId=1},7116:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DEFAULT_CHARSET=s.CHARSETS=void 0,s.CHARSETS={},s.DEFAULT_CHARSET=s.CHARSETS.B,s.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},s.CHARSETS.A={"#":"\xA3"},s.CHARSETS.B=void 0,s.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},s.CHARSETS.C=s.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},s.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},s.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},s.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},s.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},s.CHARSETS.E=s.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},s.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},s.CHARSETS.H=s.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},s.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(E,s)=>{var o,a,f;Object.defineProperty(s,"__esModule",{value:!0}),s.C1_ESCAPED=s.C1=s.C0=void 0,function(n){n.NUL="\0",n.SOH="",n.STX="",n.ETX="",n.EOT="",n.ENQ="",n.ACK="",n.BEL="\x07",n.BS="\b",n.HT="	",n.LF=`
`,n.VT="\v",n.FF="\f",n.CR="\r",n.SO="",n.SI="",n.DLE="",n.DC1="",n.DC2="",n.DC3="",n.DC4="",n.NAK="",n.SYN="",n.ETB="",n.CAN="",n.EM="",n.SUB="",n.ESC="\x1B",n.FS="",n.GS="",n.RS="",n.US="",n.SP=" ",n.DEL="\x7F"}(o||(s.C0=o={})),function(n){n.PAD="\x80",n.HOP="\x81",n.BPH="\x82",n.NBH="\x83",n.IND="\x84",n.NEL="\x85",n.SSA="\x86",n.ESA="\x87",n.HTS="\x88",n.HTJ="\x89",n.VTS="\x8A",n.PLD="\x8B",n.PLU="\x8C",n.RI="\x8D",n.SS2="\x8E",n.SS3="\x8F",n.DCS="\x90",n.PU1="\x91",n.PU2="\x92",n.STS="\x93",n.CCH="\x94",n.MW="\x95",n.SPA="\x96",n.EPA="\x97",n.SOS="\x98",n.SGCI="\x99",n.SCI="\x9A",n.CSI="\x9B",n.ST="\x9C",n.OSC="\x9D",n.PM="\x9E",n.APC="\x9F"}(a||(s.C1=a={})),function(n){n.ST=`${o.ESC}\\`}(f||(s.C1_ESCAPED=f={}))},7399:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.evaluateKeyboardEvent=void 0;let a=o(2584),f={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};s.evaluateKeyboardEvent=function(n,d,c,p){let _={type:0,cancel:!1,key:void 0},e=(n.shiftKey?1:0)|(n.altKey?2:0)|(n.ctrlKey?4:0)|(n.metaKey?8:0);switch(n.keyCode){case 0:n.key==="UIKeyInputUpArrow"?_.key=d?a.C0.ESC+"OA":a.C0.ESC+"[A":n.key==="UIKeyInputLeftArrow"?_.key=d?a.C0.ESC+"OD":a.C0.ESC+"[D":n.key==="UIKeyInputRightArrow"?_.key=d?a.C0.ESC+"OC":a.C0.ESC+"[C":n.key==="UIKeyInputDownArrow"&&(_.key=d?a.C0.ESC+"OB":a.C0.ESC+"[B");break;case 8:if(n.altKey){_.key=a.C0.ESC+a.C0.DEL;break}_.key=a.C0.DEL;break;case 9:if(n.shiftKey){_.key=a.C0.ESC+"[Z";break}_.key=a.C0.HT,_.cancel=!0;break;case 13:_.key=n.altKey?a.C0.ESC+a.C0.CR:a.C0.CR,_.cancel=!0;break;case 27:_.key=a.C0.ESC,n.altKey&&(_.key=a.C0.ESC+a.C0.ESC),_.cancel=!0;break;case 37:if(n.metaKey)break;e?(_.key=a.C0.ESC+"[1;"+(e+1)+"D",_.key===a.C0.ESC+"[1;3D"&&(_.key=a.C0.ESC+(c?"b":"[1;5D"))):_.key=d?a.C0.ESC+"OD":a.C0.ESC+"[D";break;case 39:if(n.metaKey)break;e?(_.key=a.C0.ESC+"[1;"+(e+1)+"C",_.key===a.C0.ESC+"[1;3C"&&(_.key=a.C0.ESC+(c?"f":"[1;5C"))):_.key=d?a.C0.ESC+"OC":a.C0.ESC+"[C";break;case 38:if(n.metaKey)break;e?(_.key=a.C0.ESC+"[1;"+(e+1)+"A",c||_.key!==a.C0.ESC+"[1;3A"||(_.key=a.C0.ESC+"[1;5A")):_.key=d?a.C0.ESC+"OA":a.C0.ESC+"[A";break;case 40:if(n.metaKey)break;e?(_.key=a.C0.ESC+"[1;"+(e+1)+"B",c||_.key!==a.C0.ESC+"[1;3B"||(_.key=a.C0.ESC+"[1;5B")):_.key=d?a.C0.ESC+"OB":a.C0.ESC+"[B";break;case 45:n.shiftKey||n.ctrlKey||(_.key=a.C0.ESC+"[2~");break;case 46:_.key=e?a.C0.ESC+"[3;"+(e+1)+"~":a.C0.ESC+"[3~";break;case 36:_.key=e?a.C0.ESC+"[1;"+(e+1)+"H":d?a.C0.ESC+"OH":a.C0.ESC+"[H";break;case 35:_.key=e?a.C0.ESC+"[1;"+(e+1)+"F":d?a.C0.ESC+"OF":a.C0.ESC+"[F";break;case 33:n.shiftKey?_.type=2:n.ctrlKey?_.key=a.C0.ESC+"[5;"+(e+1)+"~":_.key=a.C0.ESC+"[5~";break;case 34:n.shiftKey?_.type=3:n.ctrlKey?_.key=a.C0.ESC+"[6;"+(e+1)+"~":_.key=a.C0.ESC+"[6~";break;case 112:_.key=e?a.C0.ESC+"[1;"+(e+1)+"P":a.C0.ESC+"OP";break;case 113:_.key=e?a.C0.ESC+"[1;"+(e+1)+"Q":a.C0.ESC+"OQ";break;case 114:_.key=e?a.C0.ESC+"[1;"+(e+1)+"R":a.C0.ESC+"OR";break;case 115:_.key=e?a.C0.ESC+"[1;"+(e+1)+"S":a.C0.ESC+"OS";break;case 116:_.key=e?a.C0.ESC+"[15;"+(e+1)+"~":a.C0.ESC+"[15~";break;case 117:_.key=e?a.C0.ESC+"[17;"+(e+1)+"~":a.C0.ESC+"[17~";break;case 118:_.key=e?a.C0.ESC+"[18;"+(e+1)+"~":a.C0.ESC+"[18~";break;case 119:_.key=e?a.C0.ESC+"[19;"+(e+1)+"~":a.C0.ESC+"[19~";break;case 120:_.key=e?a.C0.ESC+"[20;"+(e+1)+"~":a.C0.ESC+"[20~";break;case 121:_.key=e?a.C0.ESC+"[21;"+(e+1)+"~":a.C0.ESC+"[21~";break;case 122:_.key=e?a.C0.ESC+"[23;"+(e+1)+"~":a.C0.ESC+"[23~";break;case 123:_.key=e?a.C0.ESC+"[24;"+(e+1)+"~":a.C0.ESC+"[24~";break;default:if(!n.ctrlKey||n.shiftKey||n.altKey||n.metaKey)if(c&&!p||!n.altKey||n.metaKey)!c||n.altKey||n.ctrlKey||n.shiftKey||!n.metaKey?n.key&&!n.ctrlKey&&!n.altKey&&!n.metaKey&&n.keyCode>=48&&n.key.length===1?_.key=n.key:n.key&&n.ctrlKey&&(n.key==="_"&&(_.key=a.C0.US),n.key==="@"&&(_.key=a.C0.NUL)):n.keyCode===65&&(_.type=1);else{let r=f[n.keyCode],t=r?.[n.shiftKey?1:0];if(t)_.key=a.C0.ESC+t;else if(n.keyCode>=65&&n.keyCode<=90){let i=n.ctrlKey?n.keyCode-64:n.keyCode+32,l=String.fromCharCode(i);n.shiftKey&&(l=l.toUpperCase()),_.key=a.C0.ESC+l}else if(n.keyCode===32)_.key=a.C0.ESC+(n.ctrlKey?a.C0.NUL:" ");else if(n.key==="Dead"&&n.code.startsWith("Key")){let i=n.code.slice(3,4);n.shiftKey||(i=i.toLowerCase()),_.key=a.C0.ESC+i,_.cancel=!0}}else n.keyCode>=65&&n.keyCode<=90?_.key=String.fromCharCode(n.keyCode-64):n.keyCode===32?_.key=a.C0.NUL:n.keyCode>=51&&n.keyCode<=55?_.key=String.fromCharCode(n.keyCode-51+27):n.keyCode===56?_.key=a.C0.DEL:n.keyCode===219?_.key=a.C0.ESC:n.keyCode===220?_.key=a.C0.FS:n.keyCode===221&&(_.key=a.C0.GS)}return _}},482:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Utf8ToUtf32=s.StringToUtf32=s.utf32ToString=s.stringFromCodePoint=void 0,s.stringFromCodePoint=function(o){return o>65535?(o-=65536,String.fromCharCode(55296+(o>>10))+String.fromCharCode(o%1024+56320)):String.fromCharCode(o)},s.utf32ToString=function(o,a=0,f=o.length){let n="";for(let d=a;d<f;++d){let c=o[d];c>65535?(c-=65536,n+=String.fromCharCode(55296+(c>>10))+String.fromCharCode(c%1024+56320)):n+=String.fromCharCode(c)}return n},s.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(o,a){let f=o.length;if(!f)return 0;let n=0,d=0;if(this._interim){let c=o.charCodeAt(d++);56320<=c&&c<=57343?a[n++]=1024*(this._interim-55296)+c-56320+65536:(a[n++]=this._interim,a[n++]=c),this._interim=0}for(let c=d;c<f;++c){let p=o.charCodeAt(c);if(55296<=p&&p<=56319){if(++c>=f)return this._interim=p,n;let _=o.charCodeAt(c);56320<=_&&_<=57343?a[n++]=1024*(p-55296)+_-56320+65536:(a[n++]=p,a[n++]=_)}else p!==65279&&(a[n++]=p)}return n}},s.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(o,a){let f=o.length;if(!f)return 0;let n,d,c,p,_=0,e=0,r=0;if(this.interim[0]){let l=!1,u=this.interim[0];u&=(224&u)==192?31:(240&u)==224?15:7;let m,b=0;for(;(m=63&this.interim[++b])&&b<4;)u<<=6,u|=m;let h=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,S=h-b;for(;r<S;){if(r>=f)return 0;if(m=o[r++],(192&m)!=128){r--,l=!0;break}this.interim[b++]=m,u<<=6,u|=63&m}l||(h===2?u<128?r--:a[_++]=u:h===3?u<2048||u>=55296&&u<=57343||u===65279||(a[_++]=u):u<65536||u>1114111||(a[_++]=u)),this.interim.fill(0)}let t=f-4,i=r;for(;i<f;){for(;!(!(i<t)||128&(n=o[i])||128&(d=o[i+1])||128&(c=o[i+2])||128&(p=o[i+3]));)a[_++]=n,a[_++]=d,a[_++]=c,a[_++]=p,i+=4;if(n=o[i++],n<128)a[_++]=n;else if((224&n)==192){if(i>=f)return this.interim[0]=n,_;if(d=o[i++],(192&d)!=128){i--;continue}if(e=(31&n)<<6|63&d,e<128){i--;continue}a[_++]=e}else if((240&n)==224){if(i>=f)return this.interim[0]=n,_;if(d=o[i++],(192&d)!=128){i--;continue}if(i>=f)return this.interim[0]=n,this.interim[1]=d,_;if(c=o[i++],(192&c)!=128){i--;continue}if(e=(15&n)<<12|(63&d)<<6|63&c,e<2048||e>=55296&&e<=57343||e===65279)continue;a[_++]=e}else if((248&n)==240){if(i>=f)return this.interim[0]=n,_;if(d=o[i++],(192&d)!=128){i--;continue}if(i>=f)return this.interim[0]=n,this.interim[1]=d,_;if(c=o[i++],(192&c)!=128){i--;continue}if(i>=f)return this.interim[0]=n,this.interim[1]=d,this.interim[2]=c,_;if(p=o[i++],(192&p)!=128){i--;continue}if(e=(7&n)<<18|(63&d)<<12|(63&c)<<6|63&p,e<65536||e>1114111)continue;a[_++]=e}}return _}}},225:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeV6=void 0;let o=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],a=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],f;s.UnicodeV6=class{constructor(){if(this.version="6",!f){f=new Uint8Array(65536),f.fill(1),f[0]=0,f.fill(0,1,32),f.fill(0,127,160),f.fill(2,4352,4448),f[9001]=2,f[9002]=2,f.fill(2,11904,42192),f[12351]=1,f.fill(2,44032,55204),f.fill(2,63744,64256),f.fill(2,65040,65050),f.fill(2,65072,65136),f.fill(2,65280,65377),f.fill(2,65504,65511);for(let n=0;n<o.length;++n)f.fill(0,o[n][0],o[n][1]+1)}}wcwidth(n){return n<32?0:n<127?1:n<65536?f[n]:function(d,c){let p,_=0,e=c.length-1;if(d<c[0][0]||d>c[e][1])return!1;for(;e>=_;)if(p=_+e>>1,d>c[p][1])_=p+1;else{if(!(d<c[p][0]))return!0;e=p-1}return!1}(n,a)?0:n>=131072&&n<=196605||n>=196608&&n<=262141?2:1}}},5981:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WriteBuffer=void 0;let a=o(8460),f=o(844);class n extends f.Disposable{constructor(c){super(),this._action=c,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new a.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(c,p){if(p!==void 0&&this._syncCalls>p)return void(this._syncCalls=0);if(this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let _;for(this._isSyncWriting=!0;_=this._writeBuffer.shift();){this._action(_);let e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(c,p){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(p),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(p)}_innerWrite(c=0,p=!0){let _=c||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let e=this._writeBuffer[this._bufferOffset],r=this._action(e,p);if(r){let i=l=>Date.now()-_>=12?setTimeout(()=>this._innerWrite(0,l)):this._innerWrite(_,l);return void r.catch(l=>(queueMicrotask(()=>{throw l}),Promise.resolve(!1))).then(i)}let t=this._callbacks[this._bufferOffset];if(t&&t(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-_>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}s.WriteBuffer=n},5941:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.toRgbString=s.parseColor=void 0;let o=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,a=/^[\da-f]+$/;function f(n,d){let c=n.toString(16),p=c.length<2?"0"+c:c;switch(d){case 4:return c[0];case 8:return p;case 12:return(p+p).slice(0,3);default:return p+p}}s.parseColor=function(n){if(!n)return;let d=n.toLowerCase();if(d.indexOf("rgb:")===0){d=d.slice(4);let c=o.exec(d);if(c){let p=c[1]?15:c[4]?255:c[7]?4095:65535;return[Math.round(parseInt(c[1]||c[4]||c[7]||c[10],16)/p*255),Math.round(parseInt(c[2]||c[5]||c[8]||c[11],16)/p*255),Math.round(parseInt(c[3]||c[6]||c[9]||c[12],16)/p*255)]}}else if(d.indexOf("#")===0&&(d=d.slice(1),a.exec(d)&&[3,6,9,12].includes(d.length))){let c=d.length/3,p=[0,0,0];for(let _=0;_<3;++_){let e=parseInt(d.slice(c*_,c*_+c),16);p[_]=c===1?e<<4:c===2?e:c===3?e>>4:e>>8}return p}},s.toRgbString=function(n,d=16){let[c,p,_]=n;return`rgb:${f(c,d)}/${f(p,d)}/${f(_,d)}`}},5770:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PAYLOAD_LIMIT=void 0,s.PAYLOAD_LIMIT=1e7},6351:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DcsHandler=s.DcsParser=void 0;let a=o(482),f=o(8742),n=o(5770),d=[];s.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=d,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=d}registerHandler(p,_){this._handlers[p]===void 0&&(this._handlers[p]=[]);let e=this._handlers[p];return e.push(_),{dispose:()=>{let r=e.indexOf(_);r!==-1&&e.splice(r,1)}}}clearHandler(p){this._handlers[p]&&delete this._handlers[p]}setHandlerFallback(p){this._handlerFb=p}reset(){if(this._active.length)for(let p=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;p>=0;--p)this._active[p].unhook(!1);this._stack.paused=!1,this._active=d,this._ident=0}hook(p,_){if(this.reset(),this._ident=p,this._active=this._handlers[p]||d,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(_);else this._handlerFb(this._ident,"HOOK",_)}put(p,_,e){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(p,_,e);else this._handlerFb(this._ident,"PUT",(0,a.utf32ToString)(p,_,e))}unhook(p,_=!0){if(this._active.length){let e=!1,r=this._active.length-1,t=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,e=_,t=this._stack.fallThrough,this._stack.paused=!1),!t&&e===!1){for(;r>=0&&(e=this._active[r].unhook(p),e!==!0);r--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,e;r--}for(;r>=0;r--)if(e=this._active[r].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,e}else this._handlerFb(this._ident,"UNHOOK",p);this._active=d,this._ident=0}};let c=new f.Params;c.addParam(0),s.DcsHandler=class{constructor(p){this._handler=p,this._data="",this._params=c,this._hitLimit=!1}hook(p){this._params=p.length>1||p.params[0]?p.clone():c,this._data="",this._hitLimit=!1}put(p,_,e){this._hitLimit||(this._data+=(0,a.utf32ToString)(p,_,e),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(p){let _=!1;if(this._hitLimit)_=!1;else if(p&&(_=this._handler(this._data,this._params),_ instanceof Promise))return _.then(e=>(this._params=c,this._data="",this._hitLimit=!1,e));return this._params=c,this._data="",this._hitLimit=!1,_}}},2015:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.EscapeSequenceParser=s.VT500_TRANSITION_TABLE=s.TransitionTable=void 0;let a=o(844),f=o(8742),n=o(6242),d=o(6351);class c{constructor(r){this.table=new Uint8Array(r)}setDefault(r,t){this.table.fill(r<<4|t)}add(r,t,i,l){this.table[t<<8|r]=i<<4|l}addMany(r,t,i,l){for(let u=0;u<r.length;u++)this.table[t<<8|r[u]]=i<<4|l}}s.TransitionTable=c;let p=160;s.VT500_TRANSITION_TABLE=function(){let e=new c(4095),r=Array.apply(null,Array(256)).map((b,h)=>h),t=(b,h)=>r.slice(b,h),i=t(32,127),l=t(0,24);l.push(25),l.push.apply(l,t(28,32));let u=t(0,14),m;for(m in e.setDefault(1,0),e.addMany(i,0,2,0),u)e.addMany([24,26,153,154],m,3,0),e.addMany(t(128,144),m,3,0),e.addMany(t(144,152),m,3,0),e.add(156,m,0,0),e.add(27,m,11,1),e.add(157,m,4,8),e.addMany([152,158,159],m,0,7),e.add(155,m,11,3),e.add(144,m,11,9);return e.addMany(l,0,3,0),e.addMany(l,1,3,1),e.add(127,1,0,1),e.addMany(l,8,0,8),e.addMany(l,3,3,3),e.add(127,3,0,3),e.addMany(l,4,3,4),e.add(127,4,0,4),e.addMany(l,6,3,6),e.addMany(l,5,3,5),e.add(127,5,0,5),e.addMany(l,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(t(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(l,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(t(64,127),3,7,0),e.addMany(t(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(t(48,60),4,8,4),e.addMany(t(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(t(32,64),6,0,6),e.add(127,6,0,6),e.addMany(t(64,127),6,0,0),e.addMany(t(32,48),3,9,5),e.addMany(t(32,48),5,9,5),e.addMany(t(48,64),5,0,6),e.addMany(t(64,127),5,7,0),e.addMany(t(32,48),4,9,5),e.addMany(t(32,48),1,9,2),e.addMany(t(32,48),2,9,2),e.addMany(t(48,127),2,10,0),e.addMany(t(48,80),1,10,0),e.addMany(t(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(t(96,127),1,10,0),e.add(80,1,11,9),e.addMany(l,9,0,9),e.add(127,9,0,9),e.addMany(t(28,32),9,0,9),e.addMany(t(32,48),9,9,12),e.addMany(t(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(l,11,0,11),e.addMany(t(32,128),11,0,11),e.addMany(t(28,32),11,0,11),e.addMany(l,10,0,10),e.add(127,10,0,10),e.addMany(t(28,32),10,0,10),e.addMany(t(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(t(32,48),10,9,12),e.addMany(l,12,0,12),e.add(127,12,0,12),e.addMany(t(28,32),12,0,12),e.addMany(t(32,48),12,9,12),e.addMany(t(48,64),12,0,11),e.addMany(t(64,127),12,12,13),e.addMany(t(64,127),10,12,13),e.addMany(t(64,127),9,12,13),e.addMany(l,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(p,0,2,0),e.add(p,8,5,8),e.add(p,6,0,6),e.add(p,11,0,11),e.add(p,13,13,13),e}();class _ extends a.Disposable{constructor(r=s.VT500_TRANSITION_TABLE){super(),this._transitions=r,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new f.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(t,i,l)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,i)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,a.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new d.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(r,t=[64,126]){let i=0;if(r.prefix){if(r.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=r.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(r.intermediates){if(r.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let u=0;u<r.intermediates.length;++u){let m=r.intermediates.charCodeAt(u);if(32>m||m>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=m}}if(r.final.length!==1)throw new Error("final must be a single byte");let l=r.final.charCodeAt(0);if(t[0]>l||l>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=l,i}identToString(r){let t=[];for(;r;)t.push(String.fromCharCode(255&r)),r>>=8;return t.reverse().join("")}setPrintHandler(r){this._printHandler=r}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(r,t){let i=this._identifier(r,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);let l=this._escHandlers[i];return l.push(t),{dispose:()=>{let u=l.indexOf(t);u!==-1&&l.splice(u,1)}}}clearEscHandler(r){this._escHandlers[this._identifier(r,[48,126])]&&delete this._escHandlers[this._identifier(r,[48,126])]}setEscHandlerFallback(r){this._escHandlerFb=r}setExecuteHandler(r,t){this._executeHandlers[r.charCodeAt(0)]=t}clearExecuteHandler(r){this._executeHandlers[r.charCodeAt(0)]&&delete this._executeHandlers[r.charCodeAt(0)]}setExecuteHandlerFallback(r){this._executeHandlerFb=r}registerCsiHandler(r,t){let i=this._identifier(r);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);let l=this._csiHandlers[i];return l.push(t),{dispose:()=>{let u=l.indexOf(t);u!==-1&&l.splice(u,1)}}}clearCsiHandler(r){this._csiHandlers[this._identifier(r)]&&delete this._csiHandlers[this._identifier(r)]}setCsiHandlerFallback(r){this._csiHandlerFb=r}registerDcsHandler(r,t){return this._dcsParser.registerHandler(this._identifier(r),t)}clearDcsHandler(r){this._dcsParser.clearHandler(this._identifier(r))}setDcsHandlerFallback(r){this._dcsParser.setHandlerFallback(r)}registerOscHandler(r,t){return this._oscParser.registerHandler(r,t)}clearOscHandler(r){this._oscParser.clearHandler(r)}setOscHandlerFallback(r){this._oscParser.setHandlerFallback(r)}setErrorHandler(r){this._errorHandler=r}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(r,t,i,l,u){this._parseStack.state=r,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=l,this._parseStack.chunkPos=u}parse(r,t,i){let l,u=0,m=0,b=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,b=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let h=this._parseStack.handlers,S=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&S>-1){for(;S>=0&&(l=h[S](this._params),l!==!0);S--)if(l instanceof Promise)return this._parseStack.handlerPos=S,l}this._parseStack.handlers=[];break;case 4:if(i===!1&&S>-1){for(;S>=0&&(l=h[S](),l!==!0);S--)if(l instanceof Promise)return this._parseStack.handlerPos=S,l}this._parseStack.handlers=[];break;case 6:if(u=r[this._parseStack.chunkPos],l=this._dcsParser.unhook(u!==24&&u!==26,i),l)return l;u===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(u=r[this._parseStack.chunkPos],l=this._oscParser.end(u!==24&&u!==26,i),l)return l;u===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,b=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let h=b;h<t;++h){switch(u=r[h],m=this._transitions.table[this.currentState<<8|(u<160?u:p)],m>>4){case 2:for(let B=h+1;;++B){if(B>=t||(u=r[B])<32||u>126&&u<p){this._printHandler(r,h,B),h=B-1;break}if(++B>=t||(u=r[B])<32||u>126&&u<p){this._printHandler(r,h,B),h=B-1;break}if(++B>=t||(u=r[B])<32||u>126&&u<p){this._printHandler(r,h,B),h=B-1;break}if(++B>=t||(u=r[B])<32||u>126&&u<p){this._printHandler(r,h,B),h=B-1;break}}break;case 3:this._executeHandlers[u]?this._executeHandlers[u]():this._executeHandlerFb(u),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:h,code:u,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let S=this._csiHandlers[this._collect<<8|u],k=S?S.length-1:-1;for(;k>=0&&(l=S[k](this._params),l!==!0);k--)if(l instanceof Promise)return this._preserveStack(3,S,k,m,h),l;k<0&&this._csiHandlerFb(this._collect<<8|u,this._params),this.precedingCodepoint=0;break;case 8:do switch(u){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(u-48)}while(++h<t&&(u=r[h])>47&&u<60);h--;break;case 9:this._collect<<=8,this._collect|=u;break;case 10:let R=this._escHandlers[this._collect<<8|u],x=R?R.length-1:-1;for(;x>=0&&(l=R[x](),l!==!0);x--)if(l instanceof Promise)return this._preserveStack(4,R,x,m,h),l;x<0&&this._escHandlerFb(this._collect<<8|u),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|u,this._params);break;case 13:for(let B=h+1;;++B)if(B>=t||(u=r[B])===24||u===26||u===27||u>127&&u<p){this._dcsParser.put(r,h,B),h=B-1;break}break;case 14:if(l=this._dcsParser.unhook(u!==24&&u!==26),l)return this._preserveStack(6,[],0,m,h),l;u===27&&(m|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let B=h+1;;B++)if(B>=t||(u=r[B])<32||u>127&&u<p){this._oscParser.put(r,h,B),h=B-1;break}break;case 6:if(l=this._oscParser.end(u!==24&&u!==26),l)return this._preserveStack(5,[],0,m,h),l;u===27&&(m|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&m}}}s.EscapeSequenceParser=_},6242:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OscHandler=s.OscParser=void 0;let a=o(5770),f=o(482),n=[];s.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(d,c){this._handlers[d]===void 0&&(this._handlers[d]=[]);let p=this._handlers[d];return p.push(c),{dispose:()=>{let _=p.indexOf(c);_!==-1&&p.splice(_,1)}}}clearHandler(d){this._handlers[d]&&delete this._handlers[d]}setHandlerFallback(d){this._handlerFb=d}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(this._state===2)for(let d=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;d>=0;--d)this._active[d].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let d=this._active.length-1;d>=0;d--)this._active[d].start();else this._handlerFb(this._id,"START")}_put(d,c,p){if(this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].put(d,c,p);else this._handlerFb(this._id,"PUT",(0,f.utf32ToString)(d,c,p))}start(){this.reset(),this._state=1}put(d,c,p){if(this._state!==3){if(this._state===1)for(;c<p;){let _=d[c++];if(_===59){this._state=2,this._start();break}if(_<48||57<_)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+_-48}this._state===2&&p-c>0&&this._put(d,c,p)}}end(d,c=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let p=!1,_=this._active.length-1,e=!1;if(this._stack.paused&&(_=this._stack.loopPosition-1,p=c,e=this._stack.fallThrough,this._stack.paused=!1),!e&&p===!1){for(;_>=0&&(p=this._active[_].end(d),p!==!0);_--)if(p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!1,p;_--}for(;_>=0;_--)if(p=this._active[_].end(!1),p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!0,p}else this._handlerFb(this._id,"END",d);this._active=n,this._id=-1,this._state=0}}},s.OscHandler=class{constructor(d){this._handler=d,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(d,c,p){this._hitLimit||(this._data+=(0,f.utf32ToString)(d,c,p),this._data.length>a.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(d){let c=!1;if(this._hitLimit)c=!1;else if(d&&(c=this._handler(this._data),c instanceof Promise))return c.then(p=>(this._data="",this._hitLimit=!1,p));return this._data="",this._hitLimit=!1,c}}},8742:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Params=void 0;let o=2147483647;class a{static fromArray(n){let d=new a;if(!n.length)return d;for(let c=Array.isArray(n[0])?1:0;c<n.length;++c){let p=n[c];if(Array.isArray(p))for(let _=0;_<p.length;++_)d.addSubParam(p[_]);else d.addParam(p)}return d}constructor(n=32,d=32){if(this.maxLength=n,this.maxSubParamsLength=d,d>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(n),this.length=0,this._subParams=new Int32Array(d),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(n),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let n=new a(this.maxLength,this.maxSubParamsLength);return n.params.set(this.params),n.length=this.length,n._subParams.set(this._subParams),n._subParamsLength=this._subParamsLength,n._subParamsIdx.set(this._subParamsIdx),n._rejectDigits=this._rejectDigits,n._rejectSubDigits=this._rejectSubDigits,n._digitIsSub=this._digitIsSub,n}toArray(){let n=[];for(let d=0;d<this.length;++d){n.push(this.params[d]);let c=this._subParamsIdx[d]>>8,p=255&this._subParamsIdx[d];p-c>0&&n.push(Array.prototype.slice.call(this._subParams,c,p))}return n}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(n){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=n>o?o:n}}addSubParam(n){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=n>o?o:n,this._subParamsIdx[this.length-1]++}}hasSubParams(n){return(255&this._subParamsIdx[n])-(this._subParamsIdx[n]>>8)>0}getSubParams(n){let d=this._subParamsIdx[n]>>8,c=255&this._subParamsIdx[n];return c-d>0?this._subParams.subarray(d,c):null}getSubParamsAll(){let n={};for(let d=0;d<this.length;++d){let c=this._subParamsIdx[d]>>8,p=255&this._subParamsIdx[d];p-c>0&&(n[d]=this._subParams.slice(c,p))}return n}addDigit(n){let d;if(this._rejectDigits||!(d=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let c=this._digitIsSub?this._subParams:this.params,p=c[d-1];c[d-1]=~p?Math.min(10*p+n,o):n}}s.Params=a},5741:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AddonManager=void 0,s.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let o=this._addons.length-1;o>=0;o--)this._addons[o].instance.dispose()}loadAddon(o,a){let f={instance:a,dispose:a.dispose,isDisposed:!1};this._addons.push(f),a.dispose=()=>this._wrappedAddonDispose(f),a.activate(o)}_wrappedAddonDispose(o){if(o.isDisposed)return;let a=-1;for(let f=0;f<this._addons.length;f++)if(this._addons[f]===o){a=f;break}if(a===-1)throw new Error("Could not dispose an addon that has not been loaded");o.isDisposed=!0,o.dispose.apply(o.instance),this._addons.splice(a,1)}}},8771:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferApiView=void 0;let a=o(3785),f=o(511);s.BufferApiView=class{constructor(n,d){this._buffer=n,this.type=d}init(n){return this._buffer=n,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(n){let d=this._buffer.lines.get(n);if(d)return new a.BufferLineApiView(d)}getNullCell(){return new f.CellData}}},3785:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLineApiView=void 0;let a=o(511);s.BufferLineApiView=class{constructor(f){this._line=f}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(f,n){if(!(f<0||f>=this._line.length))return n?(this._line.loadCell(f,n),n):this._line.loadCell(f,new a.CellData)}translateToString(f,n,d){return this._line.translateToString(f,n,d)}}},8285:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferNamespaceApi=void 0;let a=o(8771),f=o(8460),n=o(844);class d extends n.Disposable{constructor(p){super(),this._core=p,this._onBufferChange=this.register(new f.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new a.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new a.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}s.BufferNamespaceApi=d},7975:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ParserApi=void 0,s.ParserApi=class{constructor(o){this._core=o}registerCsiHandler(o,a){return this._core.registerCsiHandler(o,f=>a(f.toArray()))}addCsiHandler(o,a){return this.registerCsiHandler(o,a)}registerDcsHandler(o,a){return this._core.registerDcsHandler(o,(f,n)=>a(f,n.toArray()))}addDcsHandler(o,a){return this.registerDcsHandler(o,a)}registerEscHandler(o,a){return this._core.registerEscHandler(o,a)}addEscHandler(o,a){return this.registerEscHandler(o,a)}registerOscHandler(o,a){return this._core.registerOscHandler(o,a)}addOscHandler(o,a){return this.registerOscHandler(o,a)}}},7090:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeApi=void 0,s.UnicodeApi=class{constructor(o){this._core=o}register(o){this._core.unicodeService.register(o)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(o){this._core.unicodeService.activeVersion=o}}},744:function(E,s,o){var a=this&&this.__decorate||function(e,r,t,i){var l,u=arguments.length,m=u<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(e,r,t,i);else for(var b=e.length-1;b>=0;b--)(l=e[b])&&(m=(u<3?l(m):u>3?l(r,t,m):l(r,t))||m);return u>3&&m&&Object.defineProperty(r,t,m),m},f=this&&this.__param||function(e,r){return function(t,i){r(t,i,e)}};Object.defineProperty(s,"__esModule",{value:!0}),s.BufferService=s.MINIMUM_ROWS=s.MINIMUM_COLS=void 0;let n=o(8460),d=o(844),c=o(5295),p=o(2585);s.MINIMUM_COLS=2,s.MINIMUM_ROWS=1;let _=s.BufferService=class extends d.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,s.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,s.MINIMUM_ROWS),this.buffers=this.register(new c.BufferSet(e,this))}resize(e,r){this.cols=e,this.rows=r,this.buffers.resize(e,r),this._onResize.fire({cols:e,rows:r})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,r=!1){let t=this.buffer,i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=t.getBlankLine(e,r),this._cachedBlankLine=i),i.isWrapped=r;let l=t.ybase+t.scrollTop,u=t.ybase+t.scrollBottom;if(t.scrollTop===0){let m=t.lines.isFull;u===t.lines.length-1?m?t.lines.recycle().copyFrom(i):t.lines.push(i.clone()):t.lines.splice(u+1,0,i.clone()),m?this.isUserScrolling&&(t.ydisp=Math.max(t.ydisp-1,0)):(t.ybase++,this.isUserScrolling||t.ydisp++)}else{let m=u-l+1;t.lines.shiftElements(l+1,m-1,-1),t.lines.set(u,i.clone())}this.isUserScrolling||(t.ydisp=t.ybase),this._onScroll.fire(t.ydisp)}scrollLines(e,r,t){let i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);let l=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),l!==i.ydisp&&(r||this._onScroll.fire(i.ydisp))}};s.BufferService=_=a([f(0,p.IOptionsService)],_)},7994:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CharsetService=void 0,s.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(o){this.glevel=o,this.charset=this._charsets[o]}setgCharset(o,a){this._charsets[o]=a,this.glevel===o&&(this.charset=a)}}},1753:function(E,s,o){var a=this&&this.__decorate||function(i,l,u,m){var b,h=arguments.length,S=h<3?l:m===null?m=Object.getOwnPropertyDescriptor(l,u):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(i,l,u,m);else for(var k=i.length-1;k>=0;k--)(b=i[k])&&(S=(h<3?b(S):h>3?b(l,u,S):b(l,u))||S);return h>3&&S&&Object.defineProperty(l,u,S),S},f=this&&this.__param||function(i,l){return function(u,m){l(u,m,i)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreMouseService=void 0;let n=o(2585),d=o(8460),c=o(844),p={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:i=>i.button!==4&&i.action===1&&(i.ctrl=!1,i.alt=!1,i.shift=!1,!0)},VT200:{events:19,restrict:i=>i.action!==32},DRAG:{events:23,restrict:i=>i.action!==32||i.button!==3},ANY:{events:31,restrict:i=>!0}};function _(i,l){let u=(i.ctrl?16:0)|(i.shift?4:0)|(i.alt?8:0);return i.button===4?(u|=64,u|=i.action):(u|=3&i.button,4&i.button&&(u|=64),8&i.button&&(u|=128),i.action===32?u|=32:i.action!==0||l||(u|=3)),u}let e=String.fromCharCode,r={DEFAULT:i=>{let l=[_(i,!1)+32,i.col+32,i.row+32];return l[0]>255||l[1]>255||l[2]>255?"":`\x1B[M${e(l[0])}${e(l[1])}${e(l[2])}`},SGR:i=>{let l=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${_(i,!0)};${i.col};${i.row}${l}`},SGR_PIXELS:i=>{let l=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${_(i,!0)};${i.x};${i.y}${l}`}},t=s.CoreMouseService=class extends c.Disposable{constructor(i,l){super(),this._bufferService=i,this._coreService=l,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new d.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let u of Object.keys(p))this.addProtocol(u,p[u]);for(let u of Object.keys(r))this.addEncoding(u,r[u]);this.reset()}addProtocol(i,l){this._protocols[i]=l}addEncoding(i,l){this._encodings[i]=l}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(i){if(!this._protocols[i])throw new Error(`unknown protocol "${i}"`);this._activeProtocol=i,this._onProtocolChange.fire(this._protocols[i].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(i){if(!this._encodings[i])throw new Error(`unknown encoding "${i}"`);this._activeEncoding=i}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(i){if(i.col<0||i.col>=this._bufferService.cols||i.row<0||i.row>=this._bufferService.rows||i.button===4&&i.action===32||i.button===3&&i.action!==32||i.button!==4&&(i.action===2||i.action===3)||(i.col++,i.row++,i.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,i,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(i))return!1;let l=this._encodings[this._activeEncoding](i);return l&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(l):this._coreService.triggerDataEvent(l,!0)),this._lastEvent=i,!0}explainEvents(i){return{down:!!(1&i),up:!!(2&i),drag:!!(4&i),move:!!(8&i),wheel:!!(16&i)}}_equalEvents(i,l,u){if(u){if(i.x!==l.x||i.y!==l.y)return!1}else if(i.col!==l.col||i.row!==l.row)return!1;return i.button===l.button&&i.action===l.action&&i.ctrl===l.ctrl&&i.alt===l.alt&&i.shift===l.shift}};s.CoreMouseService=t=a([f(0,n.IBufferService),f(1,n.ICoreService)],t)},6975:function(E,s,o){var a=this&&this.__decorate||function(t,i,l,u){var m,b=arguments.length,h=b<3?i:u===null?u=Object.getOwnPropertyDescriptor(i,l):u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(t,i,l,u);else for(var S=t.length-1;S>=0;S--)(m=t[S])&&(h=(b<3?m(h):b>3?m(i,l,h):m(i,l))||h);return b>3&&h&&Object.defineProperty(i,l,h),h},f=this&&this.__param||function(t,i){return function(l,u){i(l,u,t)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreService=void 0;let n=o(1439),d=o(8460),c=o(844),p=o(2585),_=Object.freeze({insertMode:!1}),e=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),r=s.CoreService=class extends c.Disposable{constructor(t,i,l){super(),this._bufferService=t,this._logService=i,this._optionsService=l,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new d.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new d.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new d.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new d.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(_),this.decPrivateModes=(0,n.clone)(e)}reset(){this.modes=(0,n.clone)(_),this.decPrivateModes=(0,n.clone)(e)}triggerDataEvent(t,i=!1){if(this._optionsService.rawOptions.disableStdin)return;let l=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&l.ybase!==l.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${t}"`,()=>t.split("").map(u=>u.charCodeAt(0))),this._onData.fire(t)}triggerBinaryEvent(t){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${t}"`,()=>t.split("").map(i=>i.charCodeAt(0))),this._onBinary.fire(t))}};s.CoreService=r=a([f(0,p.IBufferService),f(1,p.ILogService),f(2,p.IOptionsService)],r)},9074:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DecorationService=void 0;let a=o(8055),f=o(8460),n=o(844),d=o(6106),c=0,p=0;class _ extends n.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new d.SortedList(t=>t?.marker.line),this._onDecorationRegistered=this.register(new f.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new f.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,n.toDisposable)(()=>this.reset()))}registerDecoration(t){if(t.marker.isDisposed)return;let i=new e(t);if(i){let l=i.marker.onDispose(()=>i.dispose());i.onDispose(()=>{i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),l.dispose())}),this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(let t of this._decorations.values())t.dispose();this._decorations.clear()}*getDecorationsAtCell(t,i,l){var u,m,b;let h=0,S=0;for(let k of this._decorations.getKeyIterator(i))h=(u=k.options.x)!==null&&u!==void 0?u:0,S=h+((m=k.options.width)!==null&&m!==void 0?m:1),t>=h&&t<S&&(!l||((b=k.options.layer)!==null&&b!==void 0?b:"bottom")===l)&&(yield k)}forEachDecorationAtCell(t,i,l,u){this._decorations.forEachByKey(i,m=>{var b,h,S;c=(b=m.options.x)!==null&&b!==void 0?b:0,p=c+((h=m.options.width)!==null&&h!==void 0?h:1),t>=c&&t<p&&(!l||((S=m.options.layer)!==null&&S!==void 0?S:"bottom")===l)&&u(m)})}}s.DecorationService=_;class e extends n.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=a.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=a.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(t){super(),this.options=t,this.onRenderEmitter=this.register(new f.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new f.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=t.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.InstantiationService=s.ServiceCollection=void 0;let a=o(2585),f=o(8343);class n{constructor(...c){this._entries=new Map;for(let[p,_]of c)this.set(p,_)}set(c,p){let _=this._entries.get(c);return this._entries.set(c,p),_}forEach(c){for(let[p,_]of this._entries.entries())c(p,_)}has(c){return this._entries.has(c)}get(c){return this._entries.get(c)}}s.ServiceCollection=n,s.InstantiationService=class{constructor(){this._services=new n,this._services.set(a.IInstantiationService,this)}setService(d,c){this._services.set(d,c)}getService(d){return this._services.get(d)}createInstance(d,...c){let p=(0,f.getServiceDependencies)(d).sort((r,t)=>r.index-t.index),_=[];for(let r of p){let t=this._services.get(r.id);if(!t)throw new Error(`[createInstance] ${d.name} depends on UNKNOWN service ${r.id}.`);_.push(t)}let e=p.length>0?p[0].index:c.length;if(c.length!==e)throw new Error(`[createInstance] First service dependency of ${d.name} at position ${e+1} conflicts with ${c.length} static arguments`);return new d(...c,..._)}}},7866:function(E,s,o){var a=this&&this.__decorate||function(e,r,t,i){var l,u=arguments.length,m=u<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(e,r,t,i);else for(var b=e.length-1;b>=0;b--)(l=e[b])&&(m=(u<3?l(m):u>3?l(r,t,m):l(r,t))||m);return u>3&&m&&Object.defineProperty(r,t,m),m},f=this&&this.__param||function(e,r){return function(t,i){r(t,i,e)}};Object.defineProperty(s,"__esModule",{value:!0}),s.traceCall=s.setTraceLogger=s.LogService=void 0;let n=o(844),d=o(2585),c={trace:d.LogLevelEnum.TRACE,debug:d.LogLevelEnum.DEBUG,info:d.LogLevelEnum.INFO,warn:d.LogLevelEnum.WARN,error:d.LogLevelEnum.ERROR,off:d.LogLevelEnum.OFF},p,_=s.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=d.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),p=this}_updateLogLevel(){this._logLevel=c[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let r=0;r<e.length;r++)typeof e[r]=="function"&&(e[r]=e[r]())}_log(e,r,t){this._evalLazyOptionalParams(t),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+r,...t)}trace(e,...r){var t,i;this._logLevel<=d.LogLevelEnum.TRACE&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.trace.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,r)}debug(e,...r){var t,i;this._logLevel<=d.LogLevelEnum.DEBUG&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.debug.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,r)}info(e,...r){var t,i;this._logLevel<=d.LogLevelEnum.INFO&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.info.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.info,e,r)}warn(e,...r){var t,i;this._logLevel<=d.LogLevelEnum.WARN&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.warn.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.warn,e,r)}error(e,...r){var t,i;this._logLevel<=d.LogLevelEnum.ERROR&&this._log((i=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.error.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.error,e,r)}};s.LogService=_=a([f(0,d.IOptionsService)],_),s.setTraceLogger=function(e){p=e},s.traceCall=function(e,r,t){if(typeof t.value!="function")throw new Error("not supported");let i=t.value;t.value=function(...l){if(p.logLevel!==d.LogLevelEnum.TRACE)return i.apply(this,l);p.trace(`GlyphRenderer#${i.name}(${l.map(m=>JSON.stringify(m)).join(", ")})`);let u=i.apply(this,l);return p.trace(`GlyphRenderer#${i.name} return`,u),u}}},7302:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OptionsService=s.DEFAULT_OPTIONS=void 0;let a=o(8460),f=o(844),n=o(6114);s.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let d=["normal","bold","100","200","300","400","500","600","700","800","900"];class c extends f.Disposable{constructor(_){super(),this._onOptionChange=this.register(new a.EventEmitter),this.onOptionChange=this._onOptionChange.event;let e=Object.assign({},s.DEFAULT_OPTIONS);for(let r in _)if(r in e)try{let t=_[r];e[r]=this._sanitizeAndValidateOption(r,t)}catch(t){console.error(t)}this.rawOptions=e,this.options=Object.assign({},e),this._setupOptions()}onSpecificOptionChange(_,e){return this.onOptionChange(r=>{r===_&&e(this.rawOptions[_])})}onMultipleOptionChange(_,e){return this.onOptionChange(r=>{_.indexOf(r)!==-1&&e()})}_setupOptions(){let _=r=>{if(!(r in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);return this.rawOptions[r]},e=(r,t)=>{if(!(r in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);t=this._sanitizeAndValidateOption(r,t),this.rawOptions[r]!==t&&(this.rawOptions[r]=t,this._onOptionChange.fire(r))};for(let r in this.rawOptions){let t={get:_.bind(this,r),set:e.bind(this,r)};Object.defineProperty(this.options,r,t)}}_sanitizeAndValidateOption(_,e){switch(_){case"cursorStyle":if(e||(e=s.DEFAULT_OPTIONS[_]),!function(r){return r==="block"||r==="underline"||r==="bar"}(e))throw new Error(`"${e}" is not a valid value for ${_}`);break;case"wordSeparator":e||(e=s.DEFAULT_OPTIONS[_]);break;case"fontWeight":case"fontWeightBold":if(typeof e=="number"&&1<=e&&e<=1e3)break;e=d.includes(e)?e:s.DEFAULT_OPTIONS[_];break;case"cursorWidth":e=Math.floor(e);case"lineHeight":case"tabStopWidth":if(e<1)throw new Error(`${_} cannot be less than 1, value: ${e}`);break;case"minimumContrastRatio":e=Math.max(1,Math.min(21,Math.round(10*e)/10));break;case"scrollback":if((e=Math.min(e,4294967295))<0)throw new Error(`${_} cannot be less than 0, value: ${e}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(e<=0)throw new Error(`${_} cannot be less than or equal to 0, value: ${e}`);break;case"rows":case"cols":if(!e&&e!==0)throw new Error(`${_} must be numeric, value: ${e}`);break;case"windowsPty":e=e??{}}return e}}s.OptionsService=c},2660:function(E,s,o){var a=this&&this.__decorate||function(c,p,_,e){var r,t=arguments.length,i=t<3?p:e===null?e=Object.getOwnPropertyDescriptor(p,_):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(c,p,_,e);else for(var l=c.length-1;l>=0;l--)(r=c[l])&&(i=(t<3?r(i):t>3?r(p,_,i):r(p,_))||i);return t>3&&i&&Object.defineProperty(p,_,i),i},f=this&&this.__param||function(c,p){return function(_,e){p(_,e,c)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OscLinkService=void 0;let n=o(2585),d=s.OscLinkService=class{constructor(c){this._bufferService=c,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(c){let p=this._bufferService.buffer;if(c.id===void 0){let l=p.addMarker(p.ybase+p.y),u={data:c,id:this._nextId++,lines:[l]};return l.onDispose(()=>this._removeMarkerFromLink(u,l)),this._dataByLinkId.set(u.id,u),u.id}let _=c,e=this._getEntryIdKey(_),r=this._entriesWithId.get(e);if(r)return this.addLineToLink(r.id,p.ybase+p.y),r.id;let t=p.addMarker(p.ybase+p.y),i={id:this._nextId++,key:this._getEntryIdKey(_),data:_,lines:[t]};return t.onDispose(()=>this._removeMarkerFromLink(i,t)),this._entriesWithId.set(i.key,i),this._dataByLinkId.set(i.id,i),i.id}addLineToLink(c,p){let _=this._dataByLinkId.get(c);if(_&&_.lines.every(e=>e.line!==p)){let e=this._bufferService.buffer.addMarker(p);_.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(_,e))}}getLinkData(c){var p;return(p=this._dataByLinkId.get(c))===null||p===void 0?void 0:p.data}_getEntryIdKey(c){return`${c.id};;${c.uri}`}_removeMarkerFromLink(c,p){let _=c.lines.indexOf(p);_!==-1&&(c.lines.splice(_,1),c.lines.length===0&&(c.data.id!==void 0&&this._entriesWithId.delete(c.key),this._dataByLinkId.delete(c.id)))}};s.OscLinkService=d=a([f(0,n.IBufferService)],d)},8343:(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createDecorator=s.getServiceDependencies=s.serviceRegistry=void 0;let o="di$target",a="di$dependencies";s.serviceRegistry=new Map,s.getServiceDependencies=function(f){return f[a]||[]},s.createDecorator=function(f){if(s.serviceRegistry.has(f))return s.serviceRegistry.get(f);let n=function(d,c,p){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(_,e,r){e[o]===e?e[a].push({id:_,index:r}):(e[a]=[{id:_,index:r}],e[o]=e)})(n,d,p)};return n.toString=()=>f,s.serviceRegistry.set(f,n),n}},2585:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.IDecorationService=s.IUnicodeService=s.IOscLinkService=s.IOptionsService=s.ILogService=s.LogLevelEnum=s.IInstantiationService=s.ICharsetService=s.ICoreService=s.ICoreMouseService=s.IBufferService=void 0;let a=o(8343);var f;s.IBufferService=(0,a.createDecorator)("BufferService"),s.ICoreMouseService=(0,a.createDecorator)("CoreMouseService"),s.ICoreService=(0,a.createDecorator)("CoreService"),s.ICharsetService=(0,a.createDecorator)("CharsetService"),s.IInstantiationService=(0,a.createDecorator)("InstantiationService"),function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.OFF=5]="OFF"}(f||(s.LogLevelEnum=f={})),s.ILogService=(0,a.createDecorator)("LogService"),s.IOptionsService=(0,a.createDecorator)("OptionsService"),s.IOscLinkService=(0,a.createDecorator)("OscLinkService"),s.IUnicodeService=(0,a.createDecorator)("UnicodeService"),s.IDecorationService=(0,a.createDecorator)("DecorationService")},1480:(E,s,o)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeService=void 0;let a=o(8460),f=o(225);s.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new a.EventEmitter,this.onChange=this._onChange.event;let n=new f.UnicodeV6;this.register(n),this._active=n.version,this._activeProvider=n}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(n){if(!this._providers[n])throw new Error(`unknown Unicode version "${n}"`);this._active=n,this._activeProvider=this._providers[n],this._onChange.fire(n)}register(n){this._providers[n.version]=n}wcwidth(n){return this._activeProvider.wcwidth(n)}getStringCellWidth(n){let d=0,c=n.length;for(let p=0;p<c;++p){let _=n.charCodeAt(p);if(55296<=_&&_<=56319){if(++p>=c)return d+this.wcwidth(_);let e=n.charCodeAt(p);56320<=e&&e<=57343?_=1024*(_-55296)+e-56320+65536:d+=this.wcwidth(e)}d+=this.wcwidth(_)}return d}}}},g={};function w(E){var s=g[E];if(s!==void 0)return s.exports;var o=g[E]={exports:{}};return v[E].call(o.exports,o,o.exports,w),o.exports}var A={};return(()=>{var E=A;Object.defineProperty(E,"__esModule",{value:!0}),E.Terminal=void 0;let s=w(9042),o=w(3236),a=w(844),f=w(5741),n=w(8285),d=w(7975),c=w(7090),p=["cols","rows"];class _ extends a.Disposable{constructor(r){super(),this._core=this.register(new o.Terminal(r)),this._addonManager=this.register(new f.AddonManager),this._publicOptions=Object.assign({},this._core.options);let t=l=>this._core.options[l],i=(l,u)=>{this._checkReadonlyOptions(l),this._core.options[l]=u};for(let l in this._core.options){let u={get:t.bind(this,l),set:i.bind(this,l)};Object.defineProperty(this._publicOptions,l,u)}}_checkReadonlyOptions(r){if(p.includes(r))throw new Error(`Option "${r}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new d.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new c.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new n.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let r=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:r.applicationCursorKeys,applicationKeypadMode:r.applicationKeypad,bracketedPasteMode:r.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:r.origin,reverseWraparoundMode:r.reverseWraparound,sendFocusMode:r.sendFocus,wraparoundMode:r.wraparound}}get options(){return this._publicOptions}set options(r){for(let t in r)this._publicOptions[t]=r[t]}blur(){this._core.blur()}focus(){this._core.focus()}resize(r,t){this._verifyIntegers(r,t),this._core.resize(r,t)}open(r){this._core.open(r)}attachCustomKeyEventHandler(r){this._core.attachCustomKeyEventHandler(r)}registerLinkProvider(r){return this._core.registerLinkProvider(r)}registerCharacterJoiner(r){return this._checkProposedApi(),this._core.registerCharacterJoiner(r)}deregisterCharacterJoiner(r){this._checkProposedApi(),this._core.deregisterCharacterJoiner(r)}registerMarker(r=0){return this._verifyIntegers(r),this._core.registerMarker(r)}registerDecoration(r){var t,i,l;return this._checkProposedApi(),this._verifyPositiveIntegers((t=r.x)!==null&&t!==void 0?t:0,(i=r.width)!==null&&i!==void 0?i:0,(l=r.height)!==null&&l!==void 0?l:0),this._core.registerDecoration(r)}hasSelection(){return this._core.hasSelection()}select(r,t,i){this._verifyIntegers(r,t,i),this._core.select(r,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(r,t){this._verifyIntegers(r,t),this._core.selectLines(r,t)}dispose(){super.dispose()}scrollLines(r){this._verifyIntegers(r),this._core.scrollLines(r)}scrollPages(r){this._verifyIntegers(r),this._core.scrollPages(r)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(r){this._verifyIntegers(r),this._core.scrollToLine(r)}clear(){this._core.clear()}write(r,t){this._core.write(r,t)}writeln(r,t){this._core.write(r),this._core.write(`\r
`,t)}paste(r){this._core.paste(r)}refresh(r,t){this._verifyIntegers(r,t),this._core.refresh(r,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(r){this._addonManager.loadAddon(this,r)}static get strings(){return s}_verifyIntegers(...r){for(let t of r)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...r){for(let t of r)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}E.Terminal=_})(),A})())});var oi=Wt((et,Rt)=>{(function(v,g){typeof et=="object"&&typeof Rt=="object"?Rt.exports=g():typeof define=="function"&&define.amd?define([],g):typeof et=="object"?et.FitAddon=g():v.FitAddon=g()})(self,()=>(()=>{"use strict";var v={};return(()=>{var g=v;Object.defineProperty(g,"__esModule",{value:!0}),g.FitAddon=void 0,g.FitAddon=class{activate(w){this._terminal=w}dispose(){}fit(){let w=this.proposeDimensions();if(!w||!this._terminal||isNaN(w.cols)||isNaN(w.rows))return;let A=this._terminal._core;this._terminal.rows===w.rows&&this._terminal.cols===w.cols||(A._renderService.clear(),this._terminal.resize(w.cols,w.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let w=this._terminal._core,A=w._renderService.dimensions;if(A.css.cell.width===0||A.css.cell.height===0)return;let E=this._terminal.options.scrollback===0?0:w.viewport.scrollBarWidth,s=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(s.getPropertyValue("height")),a=Math.max(0,parseInt(s.getPropertyValue("width"))),f=window.getComputedStyle(this._terminal.element),n=o-(parseInt(f.getPropertyValue("padding-top"))+parseInt(f.getPropertyValue("padding-bottom"))),d=a-(parseInt(f.getPropertyValue("padding-right"))+parseInt(f.getPropertyValue("padding-left")))-E;return{cols:Math.max(2,Math.floor(d/A.css.cell.width)),rows:Math.max(1,Math.floor(n/A.css.cell.height))}}}})(),v})())});var Je,J,Kt,Fi,_e,jt,qt,Vt,Gt,Ct,St,bt,Wi,Re={},Xt=[],Ni=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ye=Array.isArray;function ae(v,g){for(var w in g)v[w]=g[w];return v}function wt(v){v&&v.parentNode&&v.parentNode.removeChild(v)}function Et(v,g,w){var A,E,s,o={};for(s in g)s=="key"?A=g[s]:s=="ref"?E=g[s]:o[s]=g[s];if(arguments.length>2&&(o.children=arguments.length>3?Je.call(arguments,2):w),typeof v=="function"&&v.defaultProps!=null)for(s in v.defaultProps)o[s]===void 0&&(o[s]=v.defaultProps[s]);return Ve(v,o,A,E,null)}function Ve(v,g,w,A,E){var s={type:v,props:g,key:w,ref:A,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:E??++Kt,__i:-1,__u:0};return E==null&&J.vnode!=null&&J.vnode(s),s}function pe(v){return v.children}function Ge(v,g){this.props=v,this.context=g}function ve(v,g){if(g==null)return v.__?ve(v.__,v.__i+1):null;for(var w;g<v.__k.length;g++)if((w=v.__k[g])!=null&&w.__e!=null)return w.__e;return typeof v.type=="function"?ve(v):null}function Jt(v){var g,w;if((v=v.__)!=null&&v.__c!=null){for(v.__e=v.__c.base=null,g=0;g<v.__k.length;g++)if((w=v.__k[g])!=null&&w.__e!=null){v.__e=v.__c.base=w.__e;break}return Jt(v)}}function Ut(v){(!v.__d&&(v.__d=!0)&&_e.push(v)&&!Xe.__r++||jt!=J.debounceRendering)&&((jt=J.debounceRendering)||qt)(Xe)}function Xe(){for(var v,g,w,A,E,s,o,a=1;_e.length;)_e.length>a&&_e.sort(Vt),v=_e.shift(),a=_e.length,v.__d&&(w=void 0,E=(A=(g=v).__v).__e,s=[],o=[],g.__P&&((w=ae({},A)).__v=A.__v+1,J.vnode&&J.vnode(w),kt(g.__P,w,A,g.__n,g.__P.namespaceURI,32&A.__u?[E]:null,s,E??ve(A),!!(32&A.__u),o),w.__v=A.__v,w.__.__k[w.__i]=w,Qt(s,w,o),w.__e!=E&&Jt(w)));Xe.__r=0}function Yt(v,g,w,A,E,s,o,a,f,n,d){var c,p,_,e,r,t,i=A&&A.__k||Xt,l=g.length;for(f=ji(w,g,i,f,l),c=0;c<l;c++)(_=w.__k[c])!=null&&(p=_.__i==-1?Re:i[_.__i]||Re,_.__i=c,t=kt(v,_,p,E,s,o,a,f,n,d),e=_.__e,_.ref&&p.ref!=_.ref&&(p.ref&&xt(p.ref,null,_),d.push(_.ref,_.__c||e,_)),r==null&&e!=null&&(r=e),4&_.__u||p.__k===_.__k?f=Zt(_,f,v):typeof _.type=="function"&&t!==void 0?f=t:e&&(f=e.nextSibling),_.__u&=-7);return w.__e=r,f}function ji(v,g,w,A,E){var s,o,a,f,n,d=w.length,c=d,p=0;for(v.__k=new Array(E),s=0;s<E;s++)(o=g[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(f=s+p,(o=v.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Ve(null,o,null,null,null):Ye(o)?Ve(pe,{children:o},null,null,null):o.constructor==null&&o.__b>0?Ve(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=v,o.__b=v.__b+1,a=null,(n=o.__i=Ui(o,w,f,c))!=-1&&(c--,(a=w[n])&&(a.__u|=2)),a==null||a.__v==null?(n==-1&&(E>d?p--:E<d&&p++),typeof o.type!="function"&&(o.__u|=4)):n!=f&&(n==f-1?p--:n==f+1?p++:(n>f?p--:p++,o.__u|=4))):v.__k[s]=null;if(c)for(s=0;s<d;s++)(a=w[s])!=null&&!(2&a.__u)&&(a.__e==A&&(A=ve(a)),ti(a,a));return A}function Zt(v,g,w){var A,E;if(typeof v.type=="function"){for(A=v.__k,E=0;A&&E<A.length;E++)A[E]&&(A[E].__=v,g=Zt(A[E],g,w));return g}v.__e!=g&&(g&&v.type&&!w.contains(g)&&(g=ve(v)),w.insertBefore(v.__e,g||null),g=v.__e);do g=g&&g.nextSibling;while(g!=null&&g.nodeType==8);return g}function Ui(v,g,w,A){var E,s,o,a=v.key,f=v.type,n=g[w],d=n!=null&&(2&n.__u)==0;if(n===null&&v.key==null||d&&a==n.key&&f==n.type)return w;if(A>(d?1:0)){for(E=w-1,s=w+1;E>=0||s<g.length;)if((n=g[o=E>=0?E--:s++])!=null&&!(2&n.__u)&&a==n.key&&f==n.type)return o}return-1}function $t(v,g,w){g[0]=="-"?v.setProperty(g,w??""):v[g]=w==null?"":typeof w!="number"||Ni.test(g)?w:w+"px"}function qe(v,g,w,A,E){var s,o;e:if(g=="style")if(typeof w=="string")v.style.cssText=w;else{if(typeof A=="string"&&(v.style.cssText=A=""),A)for(g in A)w&&g in w||$t(v.style,g,"");if(w)for(g in w)A&&w[g]==A[g]||$t(v.style,g,w[g])}else if(g[0]=="o"&&g[1]=="n")s=g!=(g=g.replace(Gt,"$1")),o=g.toLowerCase(),g=o in v||g=="onFocusOut"||g=="onFocusIn"?o.slice(2):g.slice(2),v.l||(v.l={}),v.l[g+s]=w,w?A?w.u=A.u:(w.u=Ct,v.addEventListener(g,s?bt:St,s)):v.removeEventListener(g,s?bt:St,s);else{if(E=="http://www.w3.org/2000/svg")g=g.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(g!="width"&&g!="height"&&g!="href"&&g!="list"&&g!="form"&&g!="tabIndex"&&g!="download"&&g!="rowSpan"&&g!="colSpan"&&g!="role"&&g!="popover"&&g in v)try{v[g]=w??"";break e}catch{}typeof w=="function"||(w==null||w===!1&&g[4]!="-"?v.removeAttribute(g):v.setAttribute(g,g=="popover"&&w==1?"":w))}}function zt(v){return function(g){if(this.l){var w=this.l[g.type+v];if(g.t==null)g.t=Ct++;else if(g.t<w.u)return;return w(J.event?J.event(g):g)}}}function kt(v,g,w,A,E,s,o,a,f,n){var d,c,p,_,e,r,t,i,l,u,m,b,h,S,k,R,x,B=g.type;if(g.constructor!=null)return null;128&w.__u&&(f=!!(32&w.__u),s=[a=g.__e=w.__e]),(d=J.__b)&&d(g);e:if(typeof B=="function")try{if(i=g.props,l="prototype"in B&&B.prototype.render,u=(d=B.contextType)&&A[d.__c],m=d?u?u.props.value:d.__:A,w.__c?t=(c=g.__c=w.__c).__=c.__E:(l?g.__c=c=new B(i,m):(g.__c=c=new Ge(i,m),c.constructor=B,c.render=zi),u&&u.sub(c),c.props=i,c.state||(c.state={}),c.context=m,c.__n=A,p=c.__d=!0,c.__h=[],c._sb=[]),l&&c.__s==null&&(c.__s=c.state),l&&B.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=ae({},c.__s)),ae(c.__s,B.getDerivedStateFromProps(i,c.__s))),_=c.props,e=c.state,c.__v=g,p)l&&B.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),l&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(l&&B.getDerivedStateFromProps==null&&i!==_&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(i,m),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(i,c.__s,m)===!1||g.__v==w.__v){for(g.__v!=w.__v&&(c.props=i,c.state=c.__s,c.__d=!1),g.__e=w.__e,g.__k=w.__k,g.__k.some(function(P){P&&(P.__=g)}),b=0;b<c._sb.length;b++)c.__h.push(c._sb[b]);c._sb=[],c.__h.length&&o.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(i,c.__s,m),l&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(_,e,r)})}if(c.context=m,c.props=i,c.__P=v,c.__e=!1,h=J.__r,S=0,l){for(c.state=c.__s,c.__d=!1,h&&h(g),d=c.render(c.props,c.state,c.context),k=0;k<c._sb.length;k++)c.__h.push(c._sb[k]);c._sb=[]}else do c.__d=!1,h&&h(g),d=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++S<25);c.state=c.__s,c.getChildContext!=null&&(A=ae(ae({},A),c.getChildContext())),l&&!p&&c.getSnapshotBeforeUpdate!=null&&(r=c.getSnapshotBeforeUpdate(_,e)),R=d,d!=null&&d.type===pe&&d.key==null&&(R=ei(d.props.children)),a=Yt(v,Ye(R)?R:[R],g,w,A,E,s,o,a,f,n),c.base=g.__e,g.__u&=-161,c.__h.length&&o.push(c),t&&(c.__E=c.__=null)}catch(P){if(g.__v=null,f||s!=null)if(P.then){for(g.__u|=f?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,g.__e=a}else{for(x=s.length;x--;)wt(s[x]);yt(g)}else g.__e=w.__e,g.__k=w.__k,P.then||yt(g);J.__e(P,g,w)}else s==null&&g.__v==w.__v?(g.__k=w.__k,g.__e=w.__e):a=g.__e=$i(w.__e,g,w,A,E,s,o,f,n);return(d=J.diffed)&&d(g),128&g.__u?void 0:a}function yt(v){v&&v.__c&&(v.__c.__e=!0),v&&v.__k&&v.__k.forEach(yt)}function Qt(v,g,w){for(var A=0;A<w.length;A++)xt(w[A],w[++A],w[++A]);J.__c&&J.__c(g,v),v.some(function(E){try{v=E.__h,E.__h=[],v.some(function(s){s.call(E)})}catch(s){J.__e(s,E.__v)}})}function ei(v){return typeof v!="object"||v==null||v.__b&&v.__b>0?v:Ye(v)?v.map(ei):ae({},v)}function $i(v,g,w,A,E,s,o,a,f){var n,d,c,p,_,e,r,t=w.props,i=g.props,l=g.type;if(l=="svg"?E="http://www.w3.org/2000/svg":l=="math"?E="http://www.w3.org/1998/Math/MathML":E||(E="http://www.w3.org/1999/xhtml"),s!=null){for(n=0;n<s.length;n++)if((_=s[n])&&"setAttribute"in _==!!l&&(l?_.localName==l:_.nodeType==3)){v=_,s[n]=null;break}}if(v==null){if(l==null)return document.createTextNode(i);v=document.createElementNS(E,l,i.is&&i),a&&(J.__m&&J.__m(g,s),a=!1),s=null}if(l==null)t===i||a&&v.data==i||(v.data=i);else{if(s=s&&Je.call(v.childNodes),t=w.props||Re,!a&&s!=null)for(t={},n=0;n<v.attributes.length;n++)t[(_=v.attributes[n]).name]=_.value;for(n in t)if(_=t[n],n!="children"){if(n=="dangerouslySetInnerHTML")c=_;else if(!(n in i)){if(n=="value"&&"defaultValue"in i||n=="checked"&&"defaultChecked"in i)continue;qe(v,n,null,_,E)}}for(n in i)_=i[n],n=="children"?p=_:n=="dangerouslySetInnerHTML"?d=_:n=="value"?e=_:n=="checked"?r=_:a&&typeof _!="function"||t[n]===_||qe(v,n,_,t[n],E);if(d)a||c&&(d.__html==c.__html||d.__html==v.innerHTML)||(v.innerHTML=d.__html),g.__k=[];else if(c&&(v.innerHTML=""),Yt(g.type=="template"?v.content:v,Ye(p)?p:[p],g,w,A,l=="foreignObject"?"http://www.w3.org/1999/xhtml":E,s,o,s?s[0]:w.__k&&ve(w,0),a,f),s!=null)for(n=s.length;n--;)wt(s[n]);a||(n="value",l=="progress"&&e==null?v.removeAttribute("value"):e!=null&&(e!==v[n]||l=="progress"&&!e||l=="option"&&e!=t[n])&&qe(v,n,e,t[n],E),n="checked",r!=null&&r!=v[n]&&qe(v,n,r,t[n],E))}return v}function xt(v,g,w){try{if(typeof v=="function"){var A=typeof v.__u=="function";A&&v.__u(),A&&g==null||(v.__u=v(g))}else v.current=g}catch(E){J.__e(E,w)}}function ti(v,g,w){var A,E;if(J.unmount&&J.unmount(v),(A=v.ref)&&(A.current&&A.current!=v.__e||xt(A,null,g)),(A=v.__c)!=null){if(A.componentWillUnmount)try{A.componentWillUnmount()}catch(s){J.__e(s,g)}A.base=A.__P=null}if(A=v.__k)for(E=0;E<A.length;E++)A[E]&&ti(A[E],g,w||typeof v.type!="function");w||wt(v.__e),v.__c=v.__=v.__e=void 0}function zi(v,g,w){return this.constructor(v,w)}function Lt(v,g,w){var A,E,s,o;g==document&&(g=document.documentElement),J.__&&J.__(v,g),E=(A=typeof w=="function")?null:w&&w.__k||g.__k,s=[],o=[],kt(g,v=(!A&&w||g).__k=Et(pe,null,[v]),E||Re,Re,g.namespaceURI,!A&&w?[w]:E?null:g.firstChild?Je.call(g.childNodes):null,s,!A&&w?w:E?E.__e:g.firstChild,A,o),Qt(s,v,o)}Je=Xt.slice,J={__e:function(v,g,w,A){for(var E,s,o;g=g.__;)if((E=g.__c)&&!E.__)try{if((s=E.constructor)&&s.getDerivedStateFromError!=null&&(E.setState(s.getDerivedStateFromError(v)),o=E.__d),E.componentDidCatch!=null&&(E.componentDidCatch(v,A||{}),o=E.__d),o)return E.__E=E}catch(a){v=a}throw v}},Kt=0,Fi=function(v){return v!=null&&v.constructor==null},Ge.prototype.setState=function(v,g){var w;w=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ae({},this.state),typeof v=="function"&&(v=v(ae({},w),this.props)),v&&ae(w,v),v!=null&&this.__v&&(g&&this._sb.push(g),Ut(this))},Ge.prototype.forceUpdate=function(v){this.__v&&(this.__e=!0,v&&this.__h.push(v),Ut(this))},Ge.prototype.render=pe,_e=[],qt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Vt=function(v,g){return v.__v.__b-g.__v.__b},Xe.__r=0,Gt=/(PointerCapture)$|Capture$/i,Ct=0,St=zt(!1),bt=zt(!0),Wi=0;function ii(v){let g={30:"color: #000000",31:"color: #ff0000",32:"color: #00ff00",33:"color: #ffff00",34:"color: #0000ff",35:"color: #ff00ff",36:"color: #00ffff",37:"color: #ffffff",90:"color: #808080",91:"color: #ff8080",92:"color: #80ff80",93:"color: #ffff80",94:"color: #8080ff",95:"color: #ff80ff",96:"color: #80ffff",97:"color: #ffffff"},w=v,A=0;return w=w.replace(/\x1b\[38;2;(\d+);(\d+);(\d+)m/g,(E,s,o,a)=>(A++,`<span style="color: rgb(${s}, ${o}, ${a})">`)),w=w.replace(/\x1b\[(\d+)m/g,(E,s)=>{if(s==="0"||s==="m"){let o="</span>".repeat(A);return A=0,o}return g[s]?(A++,`<span style="${g[s]}">`):""}),w=w.replace(/\x1b\[[0-9;]*[a-zA-Z]/g,""),w+="</span>".repeat(A),w}function Ae(){return new URLSearchParams(window.location.search).get("session")}function Te(){return new URLSearchParams(window.location.search).get("project")}function Ze(v,g=null){let w=new URL(window.location.href);w.searchParams.set("session",v),g&&w.searchParams.set("project",g),window.history.pushState({sessionId:v},"",w)}function Dt(){let v=new URL(window.location.href);v.searchParams.delete("session"),v.searchParams.delete("project"),window.history.pushState({},"",v)}function si(){Dt()}var $={sessionID:null,currentProject:null,isFileBrowserOpen:!1,isFileEditorOpen:!1,currentEditingFile:null,currentBrowserPath:null,isConnected:!1};var ai=Nt(ni()),li=Nt(oi());var Y=null,ge=null,Z=null,Me=0,Ki=10,qi=1e3;function ci(){Z&&(Z.onopen=null,Z.onmessage=null,Z.onclose=null,Z.onerror=null,(Z.readyState===WebSocket.OPEN||Z.readyState===WebSocket.CONNECTING)&&Z.close(),Z=null),$.isConnected=!1,Me=0}function he(){ci(),Y&&(Y.dispose(),Y=null),ge=null}function tt(){ci();let g=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`,w=new URLSearchParams;$.sessionID&&w.append("sessionID",$.sessionID),$.currentProject&&w.append("projectName",$.currentProject),w.toString()&&(g+=`?${w.toString()}`),Z=new WebSocket(g),Z.onopen=()=>{$.isConnected=!0,Me=0,Y&&$.sessionID&&(Y.clearTextureAtlas?.(),Y.refresh(0,(Y.rows||1)-1)),Y&&Z&&Z.send(JSON.stringify({type:"resize",cols:Y.cols,rows:Y.rows}))},Z.onmessage=A=>{try{let E=JSON.parse(A.data);switch(E.type){case"output":Y?.write(E.data);break;case"sessionID":$.sessionID=E.sessionID,Ze(E.sessionID,$.currentProject);break;case"exit":Y?.write(`\r
Process exited with code: ${E.exitCode}\r
`),Y?.write(`Connection closed. Go back to session list.\r
`),$.isConnected=!1;break;default:break}}catch(E){console.error("Error parsing message:",E)}},Z.onclose=()=>{if($.isConnected=!1,Me<Ki){let A=qi*Math.pow(2,Me);Me++,Y?.write(`\r
Connection lost. Attempting to reconnect...\r
`),setTimeout(tt,A)}else Y?.write(`\r
Connection lost. Max reconnect attempts reached. Go back to session list.\r
`)},Z.onerror=()=>{Y?.write(`\r
WebSocket error occurred. Attempting to reconnect.\r
`),Z?.close()}}function de(){let v=document.getElementById("terminal-container");if(!v)return;v.innerHTML=`
    <div class="flex flex-col h-full">
      <div id="terminal" class="flex-1"></div>
    </div>
  `,Y&&Y.dispose(),Y=new ai.Terminal({cursorBlink:!0,fontFamily:"Courier New, monospace",fontSize:14,theme:{background:"#000000",foreground:"#00ff00",cursor:"#00ff00",cursorAccent:"#000000",selection:"rgba(0, 255, 0, 0.3)"},allowTransparency:!1}),ge=new li.FitAddon,Y.loadAddon(ge);let g=document.getElementById("terminal");if(!g)return;Y.open(g),ge.fit(),Y.onData(A=>{Z&&Z.readyState===WebSocket.OPEN&&Z.send(JSON.stringify({type:"input",data:A}))}),Y.focus(),tt();let w=window.showNavigationBar;w&&w()}function hi(){ge&&ge.fit(),$.isConnected&&Y&&Z&&Z.readyState===WebSocket.OPEN&&Z.send(JSON.stringify({type:"resize",cols:Y.cols,rows:Y.rows}))}function Pe(){return Z}async function it(){let v=document.getElementById("file-browser");if(v)if($.isFileBrowserOpen)v.classList.add("hidden"),v.classList.remove("flex","fullscreen"),$.isFileBrowserOpen=!1;else{v.classList.remove("hidden"),v.classList.add("flex","fullscreen"),$.isFileBrowserOpen=!0;let g=$.currentProject?`../projects/${$.currentProject}`:"~";await me(g)}}async function me(v){try{let g=await fetch(`/api/browse?path=${encodeURIComponent(v)}`),w=await g.json();if(!g.ok)throw new Error(w.error||"Failed to load directory");$.currentBrowserPath=w.currentPath,Vi(w);let A=document.getElementById("current-dir");A&&(A.value=w.currentPath)}catch(g){console.error("Error loading directory:",g),await window.Swal.fire({title:"Error",text:"Failed to load directory: "+g.message,icon:"error"})}}function Vi(v){let g=document.getElementById("file-list");g&&(g.innerHTML="",v.parentPath&&v.parentPath!==v.currentPath&&g.appendChild(di({name:"..",type:"directory",path:v.parentPath})),v.items.forEach(w=>g.appendChild(di(w))))}function di(v){let g=document.createElement("div");g.className="file-item p-2 rounded cursor-pointer flex items-center gap-2 text-sm";let w=v.type==="directory"?"\u{1F4C1}":"\u{1F4C4}",A=v.name.length>25?v.name.substring(0,22)+"...":v.name;return g.innerHTML=`
    <span class="text-lg">${w}</span>
    <span class="flex-1 truncate" title="${v.name}">${A}</span>
  `,g.addEventListener("click",()=>{v.type==="directory"?me(v.path):st(v.path)}),g}async function st(v){try{let g=await fetch(`/api/file?path=${encodeURIComponent(v)}`),w=await g.json();if(!g.ok)throw new Error(w.error||"Failed to load file");$.currentEditingFile=w.path;let A=document.getElementById("file-editor");A?.classList.remove("hidden"),A?.classList.add("flex","fullscreen"),$.isFileEditorOpen=!0;let E=document.getElementById("file-content"),s=document.getElementById("editor-filename");E&&(E.value=w.content),s&&(s.textContent=v.split("/").pop()||"")}catch(g){console.error("Error opening file:",g),await window.Swal.fire({title:"Error",text:"Failed to open file: "+g.message,icon:"error"})}}async function Ie(){if(!$.currentEditingFile){await window.Swal.fire({title:"Warning",text:"No file is currently being edited",icon:"warning"});return}try{let g=document.getElementById("file-content")?.value||"",w=await fetch("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:$.currentEditingFile,content:g})}),A=await w.json();if(!w.ok)throw new Error(A.error||"Failed to save file");let E=document.getElementById("save-file");if(E){let s=E.textContent||"Save";E.textContent="Saved!",E.classList.add("btn-success"),setTimeout(()=>{E.textContent=s,E.classList.remove("btn-success")},1e3)}}catch(v){console.error("Error saving file:",v),await window.Swal.fire({title:"Error",text:"Failed to save file: "+v.message,icon:"error"})}}function Se(){let v=document.getElementById("file-editor");v?.classList.add("hidden"),v?.classList.remove("flex","fullscreen"),$.isFileEditorOpen=!1,$.currentEditingFile=null}function be(){let v=document.getElementById("file-browser");v?.classList.add("hidden"),v?.classList.remove("flex","fullscreen"),$.isFileBrowserOpen=!1}function rt(){let v=document.getElementById("new-file-modal"),g=document.getElementById("new-file-name");!v||!g||(g.value="",v.showModal(),g.focus())}function nt(){let v=document.getElementById("new-folder-modal"),g=document.getElementById("new-folder-name");!v||!g||(g.value="",v.showModal(),g.focus())}async function Oe(){let g=(document.getElementById("new-file-name")?.value||"").trim();if(!g)return;if(!$.currentBrowserPath){await window.Swal.fire({title:"Warning",text:"No directory selected",icon:"warning"});return}let w=`${$.currentBrowserPath}/${g}`;try{let A=await fetch("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:w,content:""})}),E=await A.json();if(!A.ok)throw new Error(E.error||"Failed to create file");await me($.currentBrowserPath),await st(w),document.getElementById("new-file-modal")?.close()}catch(A){console.error("Error creating file:",A),await window.Swal.fire({title:"Error",text:"Failed to create file: "+A.message,icon:"error"})}}async function He(){let g=(document.getElementById("new-folder-name")?.value||"").trim();if(!g)return;if(!$.currentBrowserPath){await window.Swal.fire({title:"Warning",text:"No directory selected",icon:"warning"});return}let w=`${$.currentBrowserPath}/${g}`;try{let A=await fetch("/api/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:w})}),E=await A.json();if(!A.ok)throw new Error(E.error||"Failed to create folder");await me($.currentBrowserPath),document.getElementById("new-folder-modal")?.close()}catch(A){console.error("Error creating folder:",A),await window.Swal.fire({title:"Error",text:"Failed to create folder: "+A.message,icon:"error"})}}function ot(){typeof window.cleanupTerminal=="function"&&window.cleanupTerminal(),$.sessionID=null,$.currentProject=null,typeof window.updateURLWithoutSession=="function"&&window.updateURLWithoutSession(),ue()}function at(){typeof window.cleanupTerminal=="function"&&window.cleanupTerminal(),$.sessionID=null,$.currentProject=null,ue()}async function ue(){let v=document.getElementById("terminal-container");v&&(v.innerHTML="",window.render?.(window.h?.(window.Dashboard),v))}async function lt(){let g=(document.getElementById("project-name")?.value||"").trim();if(!g){await window.Swal.fire({title:"Error",text:"Please enter a project name",icon:"error"});return}try{let w=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g})}),A=await w.json();w.ok?ye(A.name):await window.Swal.fire({title:"Error",text:A.error||"Failed to create project",icon:"error"})}catch(w){console.error("Error creating project:",w),await window.Swal.fire({title:"Error",text:"Error creating project",icon:"error"})}}async function ct(v){if((await window.Swal.fire({title:"Delete Project?",text:`Are you sure you want to delete the project "${v}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{let w=await fetch(`/api/projects/${encodeURIComponent(v)}`,{method:"DELETE"}),A=await w.json();w.ok?(await window.Swal.fire({title:"Deleted!",text:A.message||"Project deleted successfully",icon:"success"}),ue()):await window.Swal.fire({title:"Error",text:A.error||"Failed to delete project",icon:"error"})}catch(w){console.error("Error deleting project:",w),await window.Swal.fire({title:"Error",text:"Error deleting project",icon:"error"})}}function ye(v){$.currentProject=v,$.sessionID=null,de()}function Fe(v,g){typeof he=="function"&&he(),$.sessionID=v,$.currentProject=g??$.currentProject,typeof window.updateURLWithSession=="function"&&window.updateURLWithSession(v,$.currentProject),de()}async function ht(v){try{let w=await(await fetch(`/api/sessions/${v}`,{method:"DELETE"})).json();w.success?ue():await window.Swal.fire({title:"Error",text:"Failed to kill session: "+w.message,icon:"error"})}catch(g){console.error("Error killing session:",g),await window.Swal.fire({title:"Error",text:"Error killing session",icon:"error"})}}function ui(){let v=document.getElementById("nav-bar");if(v){v.classList.remove("hidden");let g=document.getElementById("current-path");g&&$.currentProject&&(g.textContent=`Project: ${$.currentProject}`)}}function _i(){document.getElementById("nav-bar")?.classList.add("hidden")}function fi(){window.addEventListener("popstate",()=>{$.sessionID=Ae(),$.currentProject=Te(),$.sessionID?de():ue()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("back-to-sessions")?.addEventListener("click",()=>{he(),$.currentProject?at():ot()}),document.getElementById("browse-files")?.addEventListener("click",()=>void it()),document.getElementById("close-browser")?.addEventListener("click",()=>be()),document.getElementById("new-folder")?.addEventListener("click",()=>nt()),document.getElementById("new-file")?.addEventListener("click",()=>rt()),document.getElementById("create-file-btn")?.addEventListener("click",()=>void Oe()),document.getElementById("cancel-file-btn")?.addEventListener("click",()=>document.getElementById("new-file-modal")?.close()),document.getElementById("create-folder-btn")?.addEventListener("click",()=>void He()),document.getElementById("cancel-folder-btn")?.addEventListener("click",()=>document.getElementById("new-folder-modal")?.close()),document.getElementById("new-file-name")?.addEventListener("keypress",a=>{a.key==="Enter"&&Oe()}),document.getElementById("new-folder-name")?.addEventListener("keypress",a=>{a.key==="Enter"&&He()}),document.getElementById("save-file")?.addEventListener("click",()=>void Ie()),document.getElementById("close-editor")?.addEventListener("click",()=>Se()),document.getElementById("file-content")?.addEventListener("keydown",a=>{let f=a;if((f.ctrlKey||f.metaKey)&&f.key==="s"&&(f.preventDefault(),Ie()),f.key==="Tab"&&a.target instanceof HTMLTextAreaElement){f.preventDefault();let n=a.target.selectionStart,d=a.target.selectionEnd,c=a.target.value;a.target.value=c.substring(0,n)+"	"+c.substring(d),a.target.selectionStart=a.target.selectionEnd=n+1}}),document.addEventListener("keydown",a=>{a.key==="Escape"&&($.isFileEditorOpen?Se():$.isFileBrowserOpen&&be())}),document.addEventListener("click",a=>{let f=document.getElementById("file-browser"),n=document.getElementById("file-editor");$.isFileBrowserOpen&&f&&!f.contains(a.target)&&!a.target.closest("#browse-files")&&be(),$.isFileEditorOpen&&n&&!n.contains(a.target)&&(a.target.closest(".file-item")||Se())}),document.getElementById("file-browser")?.addEventListener("click",a=>a.stopPropagation()),document.getElementById("file-editor")?.addEventListener("click",a=>a.stopPropagation()),Xi(),Gi()}),window.addEventListener("resize",()=>hi()),document.addEventListener("visibilitychange",()=>{let v=window.terminalInstance;if(!document.hidden&&v){if(v.focus?.(),!$.isConnected){let g=Pe();(!g||g.readyState!==WebSocket.OPEN)&&window.connectWebSocket?.()}}else if(document.hidden){let g=Pe();g&&g.readyState===WebSocket.OPEN&&g.close()}}),document.addEventListener("click",v=>{let g=document.getElementById("custom-input-container");g&&!g.contains(v.target)&&window.terminalInstance?.focus?.()}),window.addEventListener("beforeunload",()=>he())}function Gi(){let v=document.getElementById("custom-command-input");if(!v)return;let g=JSON.parse(localStorage.getItem("terminalCommandHistory")||"[]"),w=-1,A="",E=null,s=d=>{if(d&&d.trim()){let c=g.indexOf(d);c>-1&&g.splice(c,1),g.unshift(d),g.length>100&&(g=g.slice(0,100)),localStorage.setItem("terminalCommandHistory",JSON.stringify(g))}},o=()=>{E?.remove(),E=document.createElement("div"),E.className="absolute bottom-full left-0 right-0 bg-base-200 border border-base-300 rounded-t-lg max-h-40 overflow-y-auto z-50 hidden",E.style.marginBottom="2px";let d=v.parentElement;return d.style.position="relative",d.appendChild(E),E},a=d=>{E||o();let c=g.filter(p=>p.toLowerCase().includes(d.toLowerCase())&&p!==d).slice(0,5);if(c.length===0){E.classList.add("hidden");return}E.innerHTML="",c.forEach(p=>{let _=document.createElement("div");_.className="px-3 py-2 cursor-pointer hover:bg-base-300 text-sm",_.textContent=p,_.addEventListener("click",()=>{v.value=p,E.classList.add("hidden"),v.focus()}),E.appendChild(_)}),E.classList.remove("hidden")},f=()=>{E?.classList.add("hidden")},n=()=>{let d=Pe(),c=(v.value||"").trim();!c||!d||(s(c),w=-1,A="",f(),window.terminalInstance?.focus?.(),setTimeout(()=>{$.isConnected&&d&&d.readyState===WebSocket.OPEN&&(d.send(JSON.stringify({type:"input",data:c})),setTimeout(()=>{d.send(JSON.stringify({type:"input",data:"\r"}))},50),v.value="",v.style.height="auto",v.rows=1,setTimeout(()=>v.focus(),100))},50))};v.addEventListener("keydown",d=>{let c=d;c.key==="Enter"?c.shiftKey?setTimeout(()=>{v.style.height="auto",v.style.height=Math.min(v.scrollHeight,120)+"px"},0):(c.preventDefault(),n()):c.key==="ArrowUp"?(c.preventDefault(),w===-1&&(A=v.value),w<g.length-1&&(w++,v.value=g[w],f())):c.key==="ArrowDown"?(c.preventDefault(),w>0?(w--,v.value=g[w],f()):w===0&&(w=-1,v.value=A,f())):c.key==="Escape"&&(f(),w=-1,A="")}),v.addEventListener("input",()=>{v.style.height="auto",v.style.height=Math.min(v.scrollHeight,120)+"px",w=-1,A=v.value;let d=v.value.trim();d.length>0?a(d):f()}),v.addEventListener("blur",()=>{v.value.trim()||(v.style.height="auto",v.rows=1),setTimeout(()=>f(),200)}),v.addEventListener("focus",()=>{let d=v.value.trim();d.length>0&&a(d)}),o(),document.addEventListener("click",d=>{!v.contains(d.target)&&(!E||!E.contains(d.target))&&f()})}function Xi(){document.getElementById("virtual-keyboard")?.addEventListener("click",async g=>{let w=g.target.closest("button[data-key-code]");if(!w)return;let A=parseInt(w.dataset.keyCode||"0",10),E="";switch(A){case 27:E="\x1B";break;case 9:E="	";break;case 17:{let a=(await window.Swal.fire({title:"Ctrl Key Combination",input:"text",inputLabel:"Enter next key for Ctrl combination",inputPlaceholder:"e.g., 'c' for Ctrl+C, 'z' for Ctrl+Z",showCancelButton:!0,inputValidator:f=>f?void 0:"You need to enter a key!"})).value;if(a){let f=a.toLowerCase().charCodeAt(0);f>=97&&f<=122?E=String.fromCharCode(f-96):a==="["?E="\x1B":a==="\\"?E="":a==="]"?E="":a==="^"?E="":a==="_"&&(E="")}break}case 3:E="";break;case 38:E="\x1B[A";break;case 40:E="\x1B[B";break;case 37:E="\x1B[D";break;case 39:E="\x1B[C";break;default:break}let s=Pe();$.isConnected&&E&&s&&(window.terminalInstance?.focus?.(),setTimeout(()=>s.send(JSON.stringify({type:"input",data:E})),50))})}var we=null,Ne=!1;async function dt(){try{let g=await(await fetch("/api/environment")).json(),w=document.getElementById("terminal-container");if(!w)return;w.innerHTML=`
      <div class="p-6 max-w-4xl mx-auto h-full flex flex-col">
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">Global Environment Variables</h1>
          <div class="flex gap-2">
            <span id="save-status" class="text-sm opacity-70"></span>
            <button id="back-to-dashboard" class="btn btn-outline">\u2190 Back to Dashboard</button>
          </div>
        </div>
        <div class="bg-base-200 rounded-lg p-4 mb-6">
          <p class="text-sm opacity-70 mb-2">Edit environment variables in KEY=VALUE format. Comments starting with # are ignored. These variables will be available in all new terminal sessions across all projects. Changes are automatically saved as you type.</p>
          <p class="text-xs opacity-50">Example: NODE_ENV=production</p>
        </div>
        <div class="bg-base-100 rounded-lg border border-base-300 flex-1 flex flex-col">
          <div class="flex items-center justify-between p-4 border-b border-base-300">
            <h2 class="text-xl font-semibold">Environment Variables</h2>
            <div class="flex gap-2">
              <button id="clear-all-vars" class="btn btn-error btn-sm">Clear All</button>
              <button id="save-manually" class="btn btn-primary btn-sm">Save Now</button>
            </div>
          </div>
          <div class="flex-1 p-4">
            <textarea id="env-editor" class="textarea textarea-bordered w-full h-full resize-none font-mono text-sm" placeholder="# Add your environment variables here
# Format: KEY=VALUE
# Example:
NODE_ENV=production
API_URL=https://api.example.com
DEBUG=true" spellcheck="false">${g.text||""}</textarea>
          </div>
        </div>
      </div>`,Ji(),Ce("Loaded")}catch(v){console.error("Error loading environment variables:",v),alert("Failed to load environment variables")}}function Ji(){let v=document.getElementById("back-to-dashboard"),g=document.getElementById("env-editor"),w=document.getElementById("clear-all-vars"),A=document.getElementById("save-manually");v?.addEventListener("click",async()=>{Ne&&await We(),window.showSessionsAndProjectsList?.()}),g?.addEventListener("input",()=>{Ne=!0,Ce("Unsaved changes..."),we&&window.clearTimeout(we),we=window.setTimeout(async()=>{await We()},2e3)}),A?.addEventListener("click",async()=>{await We()}),w?.addEventListener("click",async()=>{if(confirm("Are you sure you want to clear all environment variables?")){let E=document.getElementById("env-editor");E&&(E.value=""),Ne=!0,await We()}}),window.addEventListener("beforeunload",async()=>{Ne&&await We()})}async function We(){try{let g=document.getElementById("env-editor")?.value||"";Ce("Saving...");let w=await fetch("/api/environment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:g})});if(w.ok){let A=await w.json();Ne=!1,Ce(`Saved (${Object.keys(A.variables).length} variables)`),we&&(window.clearTimeout(we),we=null)}else{let A=await w.json();Ce("Save failed"),console.error("Failed to save environment variables:",A)}}catch(v){Ce("Save error"),console.error("Error saving environment variables:",v)}}function Ce(v){let g=document.getElementById("save-status");g&&(g.textContent=v,g.className="text-sm transition-colors duration-200",v.includes("Saved")?g.className+=" text-success":v.includes("Saving")?g.className+=" text-warning":v.includes("failed")||v.includes("error")?g.className+=" text-error":g.className+=" opacity-70",(v.includes("Saved")||v.includes("failed")||v.includes("error"))&&setTimeout(()=>{g.textContent===v&&(g.textContent="")},3e3))}var ke=null,Ue=!1;async function ut(){try{let g=await(await fetch("/api/aliases")).json(),w=document.getElementById("terminal-container");if(!w)return;w.innerHTML=`
      <div class="p-6 max-w-4xl mx-auto h-full flex flex-col">
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">Shell Aliases Manager</h1>
          <div class="flex gap-2">
            <span id="alias-save-status" class="text-sm opacity-70"></span>
            <button id="back-to-dashboard" class="btn btn-outline">\u2190 Back to Dashboard</button>
          </div>
        </div>
        <div class="bg-base-200 rounded-lg p-4 mb-6">
          <p class="text-sm opacity-70 mb-2">Create and manage zsh shell aliases. Aliases are stored in your ~/.zshrc file. Use the format: <code>alias name='command'</code> or just <code>name=command</code> (auto-formatted). Changes are automatically saved and will be available in new terminal sessions.</p>
          <p class="text-xs opacity-50 mb-2">Examples:<br>\u2022 <code>alias ll='ls -la'</code><br>\u2022 <code>alias gs='git status'</code><br>\u2022 <code>alias ..='cd ..'</code></p>
          <div class="text-xs opacity-50">
            <strong>Location:</strong> ${g.zshrcPath||"~/.zshrc"}
            ${g.hasZshrc?'<span class="text-success">\u2713 Found</span>':'<span class="text-warning">\u26A0 Will be created</span>'}
          </div>
        </div>
        <div class="bg-base-100 rounded-lg border border-base-300 flex-1 flex flex-col">
          <div class="flex items-center justify-between p-4 border-b border-base-300">
            <h2 class="text-xl font-semibold">Shell Aliases</h2>
            <div class="flex gap-2">
              <button id="clear-all-aliases" class="btn btn-error btn-sm">Clear All</button>
              <button id="save-aliases-manually" class="btn btn-primary btn-sm">Save Now</button>
            </div>
          </div>
          <div class="flex-1 p-4">
            <textarea id="aliases-editor" class="textarea textarea-bordered w-full h-full resize-none font-mono text-sm" placeholder="# Add your shell aliases here
# Format: alias name='command' or just name=command
# Examples:
alias ll='ls -la'
alias gs='git status'
alias ..='cd ..'
alias grep='grep --color=auto'
alias h='history'
alias c='clear'" spellcheck="false">${g.text||""}</textarea>
          </div>
        </div>
      </div>`,Yi(),Ee("Loaded")}catch(v){console.error("Error loading aliases:",v),alert("Failed to load aliases")}}function Yi(){let v=document.getElementById("back-to-dashboard"),g=document.getElementById("aliases-editor"),w=document.getElementById("clear-all-aliases"),A=document.getElementById("save-aliases-manually");v?.addEventListener("click",async()=>{Ue&&await je(),window.showSessionsAndProjectsList?.()}),g?.addEventListener("input",()=>{Ue=!0,Ee("Unsaved changes..."),ke&&window.clearTimeout(ke),ke=window.setTimeout(async()=>{await je()},2e3)}),A?.addEventListener("click",async()=>{await je()}),w?.addEventListener("click",async()=>{if(confirm("Are you sure you want to clear all aliases? This will remove all MyShell24-managed aliases from your .zshrc file.")){let E=document.getElementById("aliases-editor");E&&(E.value=""),Ue=!0,await je()}}),window.addEventListener("beforeunload",async()=>{Ue&&await je()})}async function je(){try{let g=document.getElementById("aliases-editor")?.value||"";Ee("Saving...");let w=await fetch("/api/aliases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:g})});if(w.ok){let A=await w.json();Ue=!1,Ee(`Saved (${A.aliasCount||0} aliases)`),ke&&(window.clearTimeout(ke),ke=null)}else{let A=await w.json();Ee("Save failed"),console.error("Failed to save aliases:",A),A.details&&A.details.length>0&&alert(`Save failed:
`+A.details.join(`
`))}}catch(v){Ee("Save error"),console.error("Error saving aliases:",v)}}function Ee(v){let g=document.getElementById("alias-save-status");g&&(g.textContent=v,g.className="text-sm transition-colors duration-200",v.includes("Saved")?g.className+=" text-success":v.includes("Saving")?g.className+=" text-warning":v.includes("failed")||v.includes("error")?g.className+=" text-error":g.className+=" opacity-70",(v.includes("Saved")||v.includes("failed")||v.includes("error"))&&setTimeout(()=>{g.textContent===v&&(g.textContent="")},3e3))}function vi(v){if(!document.getElementById("new-worktree-modal")){document.body.insertAdjacentHTML("beforeend",`
      <dialog id="new-worktree-modal" class="modal">
        <div class="modal-box">
          <h3 class="font-bold text-lg">Create New Worktree</h3>
          <div class="py-4">
            <div class="mb-4">
              <label class="label"><span class="label-text">Worktree Name</span></label>
              <input type="text" id="new-worktree-name" placeholder="Enter worktree name..." class="input input-bordered w-full" />
            </div>
            <div class="mb-4">
              <label class="label"><span class="label-text">Branch Name (optional)</span></label>
              <input type="text" id="new-worktree-branch" placeholder="Enter new branch name..." class="input input-bordered w-full" />
              <div class="label"><span class="label-text-alt">Leave empty to checkout existing branch</span></div>
            </div>
          </div>
          <div class="modal-action">
            <button id="create-worktree-btn" class="btn btn-secondary">Create Worktree</button>
            <button id="cancel-worktree-btn" class="btn">Cancel</button>
          </div>
        </div>
        <form method="dialog" class="modal-backdrop"><button>close</button></form>
      </dialog>`),document.getElementById("create-worktree-btn")?.addEventListener("click",()=>At(v)),document.getElementById("cancel-worktree-btn")?.addEventListener("click",()=>document.getElementById("new-worktree-modal")?.close());let A=document.getElementById("new-worktree-name"),E=document.getElementById("new-worktree-branch");A?.addEventListener("keypress",s=>{s.key==="Enter"&&At(v)}),E?.addEventListener("keypress",s=>{s.key==="Enter"&&At(v)})}document.getElementById("new-worktree-name").value="",document.getElementById("new-worktree-branch").value="",document.getElementById("new-worktree-modal")?.showModal(),document.getElementById("new-worktree-name")?.focus()}async function At(v){let g=document.getElementById("new-worktree-name"),w=document.getElementById("new-worktree-branch"),A=(g?.value||"").trim(),E=(w?.value||"").trim();if(!A){await window.Swal.fire({title:"Error",text:"Please enter a worktree name",icon:"error"});return}try{let s=await fetch(`/api/projects/${encodeURIComponent(v)}/worktrees`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:A,branch:E||void 0})}),o=await s.json();s.ok?(document.getElementById("new-worktree-modal")?.close(),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:o.error||"Failed to create worktree",icon:"error"})}catch(s){console.error("Error creating worktree:",s),await window.Swal.fire({title:"Error",text:"Error creating worktree",icon:"error"})}}function pi(v,g){$.sessionID=null,$.currentProject=`${v}/worktrees/${g}`,window.initializeTerminal?.()}async function gi(v,g){let{value:w}=await window.Swal.fire({title:"Enter target branch",input:"text",inputLabel:"Target branch to merge into",inputValue:"main",showCancelButton:!0,inputValidator:E=>E?void 0:"You need to enter a branch name!"});if(!(!w||!(await window.Swal.fire({title:"Confirm merge",text:`Are you sure you want to merge worktree "${g}" into "${w}"? This will also delete the worktree.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, merge it!"})).isConfirmed))try{let E=await fetch(`/api/projects/${encodeURIComponent(v)}/worktrees/${encodeURIComponent(g)}/merge`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetBranch:w||"main"})}),s=await E.json();E.ok?(await window.Swal.fire({title:"Success!",text:s.message||"Worktree merged successfully",icon:"success"}),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:s.error||"Failed to merge worktree",icon:"error"})}catch(E){console.error("Error merging worktree:",E),await window.Swal.fire({title:"Error",text:"Error merging worktree",icon:"error"})}}async function mi(v,g){if((await window.Swal.fire({title:"Delete Worktree",text:`Are you sure you want to delete worktree "${g}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{let A=await fetch(`/api/projects/${encodeURIComponent(v)}/worktrees/${encodeURIComponent(g)}`,{method:"DELETE"}),E=await A.json();A.ok?(await window.Swal.fire({title:"Success!",text:E.message||"Worktree deleted successfully",icon:"success"}),window.showSessionsAndProjectsList?.()):await window.Swal.fire({title:"Error",text:E.error||"Failed to delete worktree",icon:"error"})}catch(A){console.error("Error deleting worktree:",A),await window.Swal.fire({title:"Error",text:"Error deleting worktree",icon:"error"})}}var $e,te,Tt,Si,Mt=0,Li=[],ie=J,bi=ie.__b,yi=ie.__r,Ci=ie.diffed,wi=ie.__c,Ei=ie.unmount,ki=ie.__;function It(v,g){ie.__h&&ie.__h(te,v,Mt||g),Mt=0;var w=te.__H||(te.__H={__:[],__h:[]});return v>=w.__.length&&w.__.push({}),w.__[v]}function ze(v){return Mt=1,Zi(Ri,v)}function Zi(v,g,w){var A=It($e++,2);if(A.t=v,!A.__c&&(A.__=[w?w(g):Ri(void 0,g),function(a){var f=A.__N?A.__N[0]:A.__[0],n=A.t(f,a);f!==n&&(A.__N=[n,A.__[1]],A.__c.setState({}))}],A.__c=te,!te.__f)){var E=function(a,f,n){if(!A.__c.__H)return!0;var d=A.__c.__H.__.filter(function(p){return!!p.__c});if(d.every(function(p){return!p.__N}))return!s||s.call(this,a,f,n);var c=A.__c.props!==a;return d.forEach(function(p){if(p.__N){var _=p.__[0];p.__=p.__N,p.__N=void 0,_!==p.__[0]&&(c=!0)}}),s&&s.call(this,a,f,n)||c};te.__f=!0;var s=te.shouldComponentUpdate,o=te.componentWillUpdate;te.componentWillUpdate=function(a,f,n){if(this.__e){var d=s;s=void 0,E(a,f,n),s=d}o&&o.call(this,a,f,n)},te.shouldComponentUpdate=E}return A.__N||A.__}function Di(v,g){var w=It($e++,3);!ie.__s&&Bi(w.__H,g)&&(w.__=v,w.u=g,te.__H.__h.push(w))}function Ot(v,g){var w=It($e++,7);return Bi(w.__H,g)&&(w.__=v(),w.__H=g,w.__h=v),w.__}function Qi(){for(var v;v=Li.shift();)if(v.__P&&v.__H)try{v.__H.__h.forEach(_t),v.__H.__h.forEach(Pt),v.__H.__h=[]}catch(g){v.__H.__h=[],ie.__e(g,v.__v)}}ie.__b=function(v){te=null,bi&&bi(v)},ie.__=function(v,g){v&&g.__k&&g.__k.__m&&(v.__m=g.__k.__m),ki&&ki(v,g)},ie.__r=function(v){yi&&yi(v),$e=0;var g=(te=v.__c).__H;g&&(Tt===te?(g.__h=[],te.__h=[],g.__.forEach(function(w){w.__N&&(w.__=w.__N),w.u=w.__N=void 0})):(g.__h.forEach(_t),g.__h.forEach(Pt),g.__h=[],$e=0)),Tt=te},ie.diffed=function(v){Ci&&Ci(v);var g=v.__c;g&&g.__H&&(g.__H.__h.length&&(Li.push(g)!==1&&Si===ie.requestAnimationFrame||((Si=ie.requestAnimationFrame)||es)(Qi)),g.__H.__.forEach(function(w){w.u&&(w.__H=w.u),w.u=void 0})),Tt=te=null},ie.__c=function(v,g){g.some(function(w){try{w.__h.forEach(_t),w.__h=w.__h.filter(function(A){return!A.__||Pt(A)})}catch(A){g.some(function(E){E.__h&&(E.__h=[])}),g=[],ie.__e(A,w.__v)}}),wi&&wi(v,g)},ie.unmount=function(v){Ei&&Ei(v);var g,w=v.__c;w&&w.__H&&(w.__H.__.forEach(function(A){try{_t(A)}catch(E){g=E}}),w.__H=void 0,g&&ie.__e(g,w.__v))};var xi=typeof requestAnimationFrame=="function";function es(v){var g,w=function(){clearTimeout(A),xi&&cancelAnimationFrame(g),setTimeout(v)},A=setTimeout(w,35);xi&&(g=requestAnimationFrame(w))}function _t(v){var g=te,w=v.__c;typeof w=="function"&&(v.__c=void 0,w()),te=g}function Pt(v){var g=te;v.__c=v.__(),te=g}function Bi(v,g){return!v||v.length!==g.length||g.some(function(w,A){return w!==v[A]})}function Ri(v,g){return typeof g=="function"?g(v):g}var ts=0,Er=Array.isArray;function z(v,g,w,A,E,s){g||(g={});var o,a,f=g;if("ref"in f)for(a in f={},g)a=="ref"?o=g[a]:f[a]=g[a];var n={type:v,props:f,key:w,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ts,__i:-1,__u:0,__source:E,__self:s};if(typeof v=="function"&&(o=v.defaultProps))for(a in o)f[a]===void 0&&(f[a]=o[a]);return J.vnode&&J.vnode(n),n}function Ht(){let[v,g]=ze([]),[w,A]=ze([]),[E,s]=ze(!0),[o,a]=ze(""),f=async()=>{s(!0);try{let[c,p]=await Promise.all([fetch("/api/sessions"),fetch("/api/projects-with-worktrees")]);g(await c.json()),A(await p.json())}finally{s(!1)}};Di(()=>{f()},[]);let n=Ot(()=>v.length===0?z("p",{class:"text-center opacity-70 py-4",children:"No active sessions"}):v.map(c=>z("div",{class:"card bg-base-200 shadow-lg hover:shadow-xl transition-shadow",children:z("div",{class:"card-body p-4",children:z("div",{class:"flex justify-between items-start",children:[z("div",{class:"cursor-pointer flex-1",onClick:()=>Fe(c.id,c.projectName),children:[z("div",{class:"flex items-center gap-2 mb-2",children:[z("h3",{class:"font-semibold text-sm",children:c.id}),z("span",{class:"badge badge-primary badge-sm",children:c.projectName})]}),z("p",{class:"text-xs opacity-70 line-clamp-2 break-all",children:["Status: ",z("span",{dangerouslySetInnerHTML:{__html:ii(c.status)}})]}),z("p",{class:"text-xs opacity-50",children:["Created: ",new Date(c.created).toLocaleString()]})]}),z("div",{class:"flex gap-2",children:[z("button",{class:"btn btn-primary btn-sm",onClick:()=>Fe(c.id,c.projectName),children:"Connect"}),z("button",{class:"btn btn-error btn-sm",onClick:()=>void ht(c.id),children:"Kill"})]})]})})})),[v]),d=Ot(()=>w.length===0?z("p",{class:"text-center opacity-70 py-4",children:"No projects found"}):w.map(c=>z("div",{class:"card bg-base-300 shadow-lg",children:z("div",{class:"card-body p-4",children:[z("div",{class:"flex justify-between items-center mb-4",children:[z("div",{class:"cursor-pointer flex-1",onClick:()=>ye(c.name),children:z("h3",{class:"text-lg font-bold",children:c.name})}),z("div",{class:"flex gap-2",children:[z("button",{class:"btn btn-primary btn-sm",onClick:()=>ye(c.name),children:"Open Project"}),z("button",{class:"btn btn-secondary btn-sm",onClick:()=>window.createWorktreeModal?.(c.name),children:"+ Worktree"}),z("button",{class:"btn btn-error btn-sm",onClick:()=>void ct(c.name),children:"Delete"})]})]}),c.worktrees.length>0?z("div",{class:"mt-3",children:[z("h4",{class:"text-sm font-semibold mb-2 opacity-80",children:"Worktrees:"}),z("div",{class:"grid gap-2",children:c.worktrees.map(p=>z("div",{class:"bg-base-100 rounded-lg p-3 flex justify-between items-center",children:[z("div",{class:"cursor-pointer flex-1",onClick:()=>window.openWorktree?.(c.name,p.name),children:[z("div",{class:"flex items-center gap-2",children:[z("span",{class:"text-success",children:"\u{1F33F}"}),z("span",{class:"font-medium text-sm",children:p.name}),z("span",{class:"badge badge-outline badge-xs",children:p.branch})]}),z("p",{class:"text-xs opacity-60 mt-1",children:p.relativePath})]}),z("div",{class:"flex gap-1",children:[z("button",{class:"btn btn-xs btn-primary",onClick:()=>window.openWorktree?.(c.name,p.name),children:"Open"}),z("button",{class:"btn btn-xs btn-success",onClick:()=>window.mergeWorktree?.(c.name,p.name),children:"Merge"}),z("button",{class:"btn btn-xs btn-error",onClick:()=>window.deleteWorktree?.(c.name,p.name),children:"Delete"})]})]}))})]}):z("p",{class:"text-xs opacity-50 mt-2",children:"No worktrees"})]})})),[w]);return E?z("div",{class:"p-6",children:"Loading\u2026"}):z("div",{class:"p-6 max-w-6xl mx-auto h-full flex flex-col overflow-y-auto",children:[z("div",{class:"flex items-center justify-between mb-8",children:[z("h1",{class:"text-3xl font-bold",children:"Shell Dashboard"}),z("div",{class:"flex gap-2",children:[z("button",{class:"btn btn-outline btn-sm",onClick:()=>dt(),children:[z("span",{class:"text-lg",children:"\u{1F30D}"})," Environment Variables"]}),z("button",{class:"btn btn-outline btn-sm",onClick:()=>ut(),children:[z("span",{class:"text-lg",children:"\u26A1"})," Shell Aliases"]})]})]}),z("div",{class:"mb-8",children:[z("h2",{class:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[z("span",{class:"text-primary",children:"\u{1F5A5}\uFE0F"})," All Active Sessions"]}),z("div",{class:"grid gap-3 mb-6",children:n})]}),z("div",{class:"mb-8",children:[z("h2",{class:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[z("span",{class:"text-secondary",children:"\u{1F4C1}"})," All Projects & Worktrees"]}),z("div",{class:"mb-6",children:z("div",{class:"flex gap-2",children:[z("input",{type:"text",id:"project-name",placeholder:"Enter project name",class:"input input-bordered flex-1",value:o,onInput:c=>a(c.currentTarget.value)}),z("button",{class:"btn btn-primary",onClick:()=>void lt(),children:"Create Project"})]})}),z("div",{class:"grid gap-4",children:d})]})]})}Object.assign(window,{h:Et,render:Lt,Dashboard:Ht,getSessionIDFromURL:Ae,getProjectFromURL:Te,updateURLWithSession:Ze,clearURLParams:Dt,updateURLWithoutSession:si,initializeTerminal:de,cleanupTerminal:he,connectWebSocket:tt,showNavigationBar:ui,hideNavigationBar:_i,goBackToProjectList:at,goBackToSessionList:ot,showSessionsAndProjectsList:ue,createNewProject:lt,deleteProject:ct,selectProject:ye,connectToSession:Fe,killSession:ht,toggleFileBrowser:it,loadDirectory:me,openFileInEditor:st,saveCurrentFile:Ie,closeFileBrowser:be,closeFileEditor:Se,createNewFile:rt,createNewFolder:nt,handleFileCreation:Oe,handleFolderCreation:He,showEnvironmentManager:dt,showAliasesManager:ut,createWorktreeModal:vi,openWorktree:pi,mergeWorktree:gi,deleteWorktree:mi});$.sessionID=Ae();$.currentProject=Te();fi();if($.sessionID)de();else{let v=document.getElementById("terminal-container");v&&Lt(z(Ht,{}),v)}})();
//# sourceMappingURL=bundle.js.map
